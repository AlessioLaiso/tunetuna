import{k as ye,b as Se,a as te,h as ae,r as l,j as e,i as Ce,I as E,f as N,l as Pe,S as ke,v as Me,P as De,L as Ee,C as se,g as ie,D as Te}from"./index-Cmx2dfPc.js";import{u as ne}from"./useScrollLazyLoad-DcFrRSj0.js";import{A as Oe}from"./arrow-left-SP8lHZny.js";import{E as ze}from"./ellipsis-Cs-sse1x.js";import{C as Le}from"./chevron-up-D_u7H1P-.js";import{A as Be}from"./arrow-up-down-DnbYmK42.js";const re=45,Re=45,le=45,Fe=45;function Ye({album:n,year:p,onNavigate:j,onContextMenu:A,showImage:I=!0}){const[S,C]=l.useState(!1),d=l.useRef(!1),s=c=>{if(d.current){c.preventDefault(),c.stopPropagation(),d.current=!1;return}j(n.Id)},P=c=>{c.preventDefault(),c.stopPropagation(),d.current=!0,A(n,"desktop",{x:c.clientX,y:c.clientY}),setTimeout(()=>{d.current=!1},100)},m=ie({onLongPress:c=>{c.preventDefault(),d.current=!0,A(n,"mobile")},onClick:s});return e.jsxs("button",{onClick:s,onContextMenu:P,...m,className:"text-left group",children:[e.jsx("div",{className:"aspect-square rounded overflow-hidden mb-2 bg-zinc-900 flex items-center justify-center",children:S?e.jsx(Te,{className:"w-12 h-12 text-gray-500"}):I?e.jsx(E,{src:N.getAlbumArtUrl(n.Id,474),alt:n.Name,className:"w-full h-full object-cover",showOutline:!0,rounded:"rounded",onError:()=>C(!0)}):e.jsx("div",{className:"w-full h-full bg-zinc-900"})}),e.jsx("div",{className:"text-sm font-medium text-white truncate",children:n.Name}),p&&e.jsx("div",{className:"text-xs text-gray-400 truncate",children:p})]})}function $e({song:n,album:p,year:j,onClick:A,onContextMenu:I,contextMenuItemId:S,showImage:C=!0}){const d=S===n.Id,s=ae(),P=c=>{const b=Math.floor(c/1e7),T=Math.floor(b/60),O=b%60;return`${T}:${O.toString().padStart(2,"0")}`},m=ie({onLongPress:c=>{c.preventDefault(),I(n,"mobile")},onClick:()=>A(n)});return e.jsxs("button",{onClick:()=>A(n),onContextMenu:c=>{c.preventDefault(),I(n,"desktop",{x:c.clientX,y:c.clientY})},...m,className:`w-full flex items-center gap-3 hover:bg-white/10 transition-colors group px-4 py-3 ${d?"bg-white/10":""}`,children:[e.jsx("div",{className:"w-12 h-12 rounded-sm overflow-hidden flex-shrink-0 bg-zinc-900 self-center flex items-center justify-center",children:C?e.jsx(E,{src:N.getAlbumArtUrl(n.AlbumId||n.Id,96),alt:n.Name,className:"w-full h-full object-cover",showOutline:!0,rounded:"rounded-sm"}):e.jsx("div",{className:"w-full h-full bg-zinc-900"})}),e.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[e.jsx("div",{className:`text-sm font-medium truncate transition-colors ${(s==null?void 0:s.Id)===n.Id?"text-[var(--accent-color)]":"text-white group-hover:text-[var(--accent-color)]"}`,children:n.Name}),(p||j)&&e.jsxs("div",{className:"text-xs text-gray-400 flex items-center gap-1 min-w-0",children:[p&&e.jsx("span",{className:"truncate",children:p}),p&&j&&e.jsx("span",{className:"flex-shrink-0",children:"•"}),j&&e.jsx("span",{className:"flex-shrink-0",children:j})]})]}),n.RunTimeTicks&&e.jsx("div",{className:"text-xs text-gray-500 flex-shrink-0 text-right",children:P(n.RunTimeTicks)})]})}function Xe(){var ee;const{id:n}=ye(),p=Se(),{playAlbum:j,playTrack:A,isPlaying:I,pause:S,addToQueue:C}=te(),d=ae(),[s,P]=l.useState(null),[m,c]=l.useState([]),[b,T]=l.useState([]),[O,z]=l.useState(!0),[U,L]=l.useState(!1),[Ue,k]=l.useState(!0),[y,B]=l.useState(!0),[oe,R]=l.useState(!1),[ce,_]=l.useState("mobile"),[ue,V]=l.useState(null),[M,F]=l.useState(null),[de,Y]=l.useState(null),[me,H]=l.useState(!1),[xe,fe]=l.useState("mobile"),[he,pe]=l.useState(null),[D,ge]=l.useState("Alphabetical"),[q,Q]=l.useState(re),[G,J]=l.useState(le),X=l.useRef(null),be=te(t=>t.isQueueSidebarOpen);l.useEffect(()=>{const t=document.querySelector(".main-scrollable");t&&t.scrollTo({top:0,behavior:"auto"})},[n]);const K=t=>t.toLowerCase().replace(/[_\*\-\.]/g,"").trim();l.useEffect(()=>{if(!n)return;let t=!0;return(async()=>{var r;z(!0);try{let o=await N.getArtistById(n);if(!o){const h=(await N.getArtists({limit:1e3})).Items.find(x=>x.Id===n);h&&(o=h)}if(!t)return;if(!o){z(!1);return}P(o),B(!0);const u=await N.getArtistItems(n);if(!t)return;if(u.albums.length===0&&u.songs.length===0&&o.Name){const f=K(o.Name),x=((r=(await N.search(o.Name,50)).Artists)==null?void 0:r.Items)||[];for(const g of x){if(!t)return;if(g.Id!==n&&K(g.Name)===f){const $=await N.getArtistItems(g.Id);if($.albums.length>0||$.songs.length>0){p(`/artist/${g.Id}`,{replace:!0});return}}}}if(!t)return;const v=[...u.albums].sort((f,h)=>{const x=f.ProductionYear||(f.PremiereDate?new Date(f.PremiereDate).getFullYear():0);return(h.ProductionYear||(h.PremiereDate?new Date(h.PremiereDate).getFullYear():0))-x});c(v),T(u.songs)}catch(i){if(!t)return;console.error("Failed to load artist data:",i)}finally{t&&z(!1)}})(),()=>{t=!1}},[n,p]),l.useEffect(()=>{if(!(s!=null&&s.Overview))return;k(!0);let t=null,a=null,r=null,i=!1;const o=()=>{const f=X.current;if(!f||!(s!=null&&s.Overview)){k(!1);return}const h=window.getComputedStyle(f);let x=parseFloat(h.lineHeight||"0");if((!Number.isFinite(x)||x===0)&&(x=parseFloat(h.fontSize||"16")*1.5),x===0){k(!1);return}const g=f.scrollHeight;if(g===0&&!i){i=!0,u();return}const Ie=Math.round(g/x)>2;k(Ie)},u=()=>{t!==null&&cancelAnimationFrame(t),a!==null&&clearTimeout(a),t=requestAnimationFrame(()=>{a=window.setTimeout(o,0)}),r!==null&&clearTimeout(r),r=window.setTimeout(()=>{i=!1,o()},300)},v=()=>{i=!1,u()};return u(),window.addEventListener("resize",v),()=>{t!==null&&cancelAnimationFrame(t),a!==null&&clearTimeout(a),r!==null&&clearTimeout(r),window.removeEventListener("resize",v)}},[s==null?void 0:s.Overview]),l.useEffect(()=>{Q(re)},[m.length]),l.useEffect(()=>{J(le)},[b.length]),ne({totalCount:b.length,visibleCount:G,increment:Fe,setVisibleCount:J,threshold:1}),ne({totalCount:m.length,visibleCount:q,increment:Re,setVisibleCount:Q,threshold:1});const ve=()=>{if(w.length>0){const t=[...w].sort(()=>Math.random()-.5);j(t)}},W=t=>t.ProductionYear?t.ProductionYear.toString():t.PremiereDate?new Date(t.PremiereDate).getFullYear().toString():null,Ne=t=>{const a=t.Album||null;let r=null;if(t.AlbumId){const i=m.find(o=>o.Id===t.AlbumId);i&&(r=W(i))}return{album:a,year:r}},Z=t=>{if(t.AlbumId){const a=m.find(r=>r.Id===t.AlbumId);if(a)return a.ProductionYear||(a.PremiereDate?new Date(a.PremiereDate).getFullYear():0)}return t.ProductionYear||(t.PremiereDate?new Date(t.PremiereDate).getFullYear():0)},w=l.useMemo(()=>{if(D==="Alphabetical")return[...b].sort((r,i)=>{const o=r.Name||"",u=i.Name||"";return o.localeCompare(u)});const t=(r,i,o)=>{const u=Z(r),v=Z(i),f=r.AlbumId||"",h=i.AlbumId||"";if(u!==v)return o?v-u:u-v;if(f!==h)return f.localeCompare(h);const x=r.IndexNumber||0,g=i.IndexNumber||0;return x!==g?x-g:(r.Name||"").localeCompare(i.Name||"")},a=D==="Newest";return[...b].sort((r,i)=>t(r,i,a))},[b,D,m]),je=t=>{t.preventDefault(),t.stopPropagation(),w.length>0&&j(w)},we=t=>{t.preventDefault(),t.stopPropagation(),w.length>0&&C(w)},Ae=()=>{ge(t=>t==="Alphabetical"?"Newest":t==="Newest"?"Oldest":"Alphabetical")};return O?e.jsx("div",{className:"pb-20",children:e.jsx("div",{className:"flex items-center justify-center h-screen text-gray-400",children:e.jsx(Ce,{})})}):s?e.jsxs("div",{className:"pb-20",children:[e.jsx("div",{className:`fixed top-0 left-0 right-0 z-[60] lg:left-16 transition-[left,right] duration-300 ${be?"sidebar-open-right-offset":""}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top))"},children:e.jsx("div",{className:"max-w-[768px] mx-auto",children:e.jsxs("div",{className:"relative flex items-center justify-between gap-4 p-4",children:[e.jsx("button",{onClick:()=>p(-1),className:"text-white hover:text-zinc-300 transition-colors z-10",children:e.jsx(Oe,{className:"w-6 h-6"})}),s&&e.jsx("button",{onClick:t=>{const a=t.currentTarget.getBoundingClientRect();fe("desktop"),pe({x:a.left+a.width/2,y:a.bottom+5}),H(!0)},className:"text-white hover:text-zinc-300 transition-colors z-10",children:e.jsx(ze,{className:"w-6 h-6"})})]})})}),e.jsxs("div",{className:"relative z-30 w-screen",style:{marginTop:"calc(-1 * env(safe-area-inset-top))",marginLeft:"calc(50% - 50vw)",marginRight:"calc(50% - 50vw)"},children:[y&&e.jsxs("div",{className:"relative w-full min-h-64 md:min-h-80 bg-black",style:{paddingTop:"env(safe-area-inset-top)"},children:[e.jsx("div",{className:"w-full flex items-center justify-center md:hidden",children:e.jsx(E,{src:N.getArtistImageUrl(s.Id),alt:s.Name,className:"w-full h-auto object-contain",onError:()=>B(!1)})}),e.jsx("div",{className:"hidden md:block w-full h-80",children:e.jsx("img",{src:N.getArtistBackdropUrl(s.Id),alt:s.Name,className:"w-full h-full object-cover",onError:()=>B(!1)})}),e.jsx("div",{className:"absolute inset-x-0 top-0 bottom-[-1px] bg-gradient-to-b from-transparent via-black/60 to-black pointer-events-none"})]}),e.jsx("div",{className:`left-0 right-0 ${y?"absolute":"relative"} ${y?"pt-16":"pt-12"}`,style:y?{bottom:"-28px",paddingBottom:"1.5rem"}:{},children:e.jsxs("div",{className:"max-w-[768px] mx-auto px-4 flex items-end gap-6 md:grid md:grid-cols-3 md:gap-4",children:[y&&e.jsx("div",{className:"hidden md:block md:col-span-1",children:e.jsx("div",{className:"aspect-square rounded overflow-hidden bg-zinc-900 flex items-center justify-center",children:e.jsx(E,{src:N.getArtistImageUrl(s.Id),alt:s.Name,className:"w-full h-full object-cover",showOutline:!0,rounded:"rounded"})})}),e.jsx("div",{className:`flex-1 min-w-0 pb-2 ${y?"md:col-span-2":"md:col-span-3"}`,children:e.jsxs("div",{className:"mb-4 mt-4",children:[e.jsx("h1",{className:"text-4xl md:text-5xl font-bold text-white mb-2 break-words",children:s.Name}),e.jsxs("div",{className:"flex items-center justify-between gap-4 mt-2",children:[e.jsxs("p",{className:"text-sm text-gray-300",children:[m.length," ",m.length===1?"album":"albums"," • ",w.length," ",w.length===1?"song":"songs"]}),e.jsx("button",{onClick:()=>{var a;d&&I&&(((a=d.ArtistItems)==null?void 0:a.some(r=>r.Id===n))||d.AlbumArtist===(s==null?void 0:s.Name))?S():ve()},className:"bg-white/10 hover:bg-white/20 text-white font-semibold py-1.5 px-3 rounded-full transition-all hover:scale-105 flex items-center gap-1.5 backdrop-blur-sm border border-white/20 flex-shrink-0",children:d&&I&&((ee=d.ArtistItems)!=null&&ee.some(t=>t.Id===n)||d.AlbumArtist===(s==null?void 0:s.Name))?e.jsxs(e.Fragment,{children:[e.jsx(Pe,{className:"w-3.5 h-3.5"}),"Pause"]}):e.jsxs(e.Fragment,{children:[e.jsx(ke,{className:"w-3.5 h-3.5"}),"Shuffle"]})})]})]})})]})})]}),e.jsxs("div",{className:"pt-3 md:pt-7",children:[s.Overview&&e.jsx("div",{className:"mb-6 -mt-4 px-4",children:e.jsxs("div",{className:"text-white relative",children:[e.jsx("p",{ref:X,className:"text-sm text-gray-300 leading-relaxed absolute opacity-0 pointer-events-none -z-10",children:s.Overview}),!U&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>L(!0),className:"flex-1 text-left min-w-0",children:e.jsx("p",{className:"text-sm text-gray-300 leading-relaxed line-clamp-2",children:s.Overview})}),e.jsx("button",{onClick:()=>L(!0),className:"flex-shrink-0 text-gray-400 hover:text-white transition-colors",children:e.jsx(Me,{className:"w-4 h-4"})})]}),U&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-300 leading-relaxed whitespace-pre-line",children:s.Overview}),e.jsxs("button",{onClick:()=>L(!1),className:"mt-2 flex items-center gap-1 text-sm text-gray-400 hover:text-white transition-colors ml-auto",children:["Show less",e.jsx(Le,{className:"w-4 h-4"})]})]})]})}),m.length>0&&e.jsxs("div",{className:"mb-10 px-4",children:[e.jsxs("h2",{className:"text-2xl font-bold text-white mb-4",children:["Albums (",m.length,")"]}),e.jsx("div",{className:"grid grid-cols-3 md:grid-cols-4 gap-4",children:m.map((t,a)=>{const r=W(t);return e.jsx(Ye,{album:t,year:r,onNavigate:i=>p(`/album/${i}`),onContextMenu:(i,o,u)=>{F(i),Y("album"),_(o||"mobile"),V(u||null),R(!0)},showImage:a<q},t.Id)})})]}),b.length>0&&e.jsxs("div",{id:"songs-section",children:[e.jsxs("div",{className:"px-4 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h2",{className:"text-2xl font-bold text-white",children:["Songs (",b.length,")"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:je,className:"w-10 h-10 flex items-center justify-center text-white hover:bg-white/10 rounded-full transition-colors","aria-label":"Play all songs",children:e.jsx(De,{className:"w-5 h-5"})}),e.jsx("button",{type:"button",onClick:we,className:"w-10 h-10 flex items-center justify-center text-white hover:bg-white/10 rounded-full transition-colors","aria-label":"Add all songs to queue",children:e.jsx(Ee,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"mt-1",children:e.jsxs("button",{type:"button",onClick:Ae,className:"text-sm text-gray-400 hover:text-white transition-colors flex items-center gap-1",children:[D,e.jsx(Be,{className:"w-4 h-4"})]})})]}),e.jsx("div",{className:"space-y-0",children:w.map((t,a)=>{const{album:r,year:i}=Ne(t);return e.jsx($e,{song:t,album:r,year:i,onClick:A,onContextMenu:(o,u,v)=>{F(o),Y("song"),_(u||"mobile"),V(v||null),R(!0)},contextMenuItemId:(M==null?void 0:M.Id)||null,showImage:a<G},t.Id)})})]})]}),e.jsx(se,{item:M,itemType:de,isOpen:oe,onClose:()=>{R(!1),F(null),Y(null)},zIndex:99999,mode:ce,position:ue||void 0}),e.jsx(se,{item:s,itemType:"artist",isOpen:me,onClose:()=>{H(!1)},mode:xe,position:he||void 0})]}):e.jsx("div",{className:"pb-20",children:e.jsx("div",{className:"flex items-center justify-center h-screen text-gray-400",children:e.jsx("p",{children:"Artist not found on the Jellyfin server"})})})}export{Xe as default};
