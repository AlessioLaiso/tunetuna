import{q as G,s as J,b as W,a as I,u as X,k as L,r as l,j as e,t as Z,P as ee,C as R,e as C,l as te,f as se,I as ne,v as le}from"./index-SABcFPCf.js";import{A as oe}from"./arrow-left-CIbDMyIx.js";import{E as ie}from"./ellipsis-BXuQLaHH.js";const k=45,ae=45;function re({track:t,index:d,tracks:p,onClick:g,onContextMenu:y,contextMenuItemId:N}){var x,n;const b=N===t.Id,u=L(),i=l.useRef(!1),j=a=>{a.preventDefault(),a.stopPropagation(),i.current=!0,y(t,"desktop",{x:a.clientX,y:a.clientY}),setTimeout(()=>{i.current=!1},300)},m=se({onLongPress:a=>{a.preventDefault(),i.current=!0,y(t,"mobile")},onClick:()=>{if(i.current){i.current=!1;return}g(t,p)}});return e.jsxs("button",{onClick:()=>{if(i.current){i.current=!1;return}g(t,p)},onContextMenu:j,...m,className:`w-full flex items-center gap-3 hover:bg-white/10 transition-colors group px-4 py-3 ${b?"bg-white/10":""}`,children:[e.jsx("div",{className:"w-12 h-12 rounded-sm overflow-hidden flex-shrink-0 bg-zinc-900 self-center",children:e.jsx(ne,{src:C.getAlbumArtUrl(t.AlbumId||t.Id,96),alt:t.Name,className:"w-full h-full object-cover",showOutline:!0,rounded:"rounded-sm"})}),e.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[e.jsx("div",{className:`text-sm font-medium truncate transition-colors ${(u==null?void 0:u.Id)===t.Id?"text-[var(--accent-color)]":"text-white group-hover:text-[var(--accent-color)]"}`,children:t.Name}),e.jsxs("div",{className:"text-xs text-gray-400 truncate",children:[t.AlbumArtist||((n=(x=t.ArtistItems)==null?void 0:x[0])==null?void 0:n.Name)||"Unknown Artist",t.Album&&` â€¢ ${t.Album}`]})]}),t.RunTimeTicks&&e.jsx("div",{className:"text-xs text-gray-500 flex-shrink-0 text-right",children:le(t.RunTimeTicks)})]})}function ce(t){return t?t.charAt(0).toUpperCase()+t.slice(1):""}function xe(){const{id:t,moodValue:d}=G(),p=J(),g=W(),{playAlbum:y,playTrack:N,isPlaying:b}=I(),{songs:u,recordMoodAccess:i}=X(),j=L(),[m,x]=l.useState(null),[n,a]=l.useState([]),[O,w]=l.useState(!0),[D,P]=l.useState(!1),[v,M]=l.useState(null),[H,$]=l.useState("mobile"),[z,U]=l.useState(null),[_,T]=l.useState(!1),[B,F]=l.useState("mobile"),[V,K]=l.useState(null),[Q,A]=l.useState(k),Y=I(o=>o.isQueueSidebarOpen),f=p.pathname.startsWith("/mood/"),S=l.useMemo(()=>{if(!f||!d)return[];const o=decodeURIComponent(d);return u.filter(s=>{var r;return(r=s.Grouping)==null?void 0:r.some(c=>c.toLowerCase()===`mood_${o.toLowerCase()}`)}).map(s=>({Id:s.Id,Name:s.Name,AlbumArtist:s.AlbumArtist,ArtistItems:s.ArtistItems,Album:s.Album,AlbumId:s.AlbumId,RunTimeTicks:s.RunTimeTicks,Type:"Audio"}))},[f,d,u]);l.useEffect(()=>{if(f&&d){const s=decodeURIComponent(d);i(s),x({Id:`mood-${s}`,Name:ce(s),Type:"Mood"}),a(S),w(!1);return}if(!t)return;(async()=>{w(!0);try{const s=await C.getAlbumTracks(t);a(s);const c=(await C.getPlaylists({limit:1e3})).Items.find(h=>h.Id===t);c?x(c):s.length>0&&x({Id:t,Name:"Playlist",Type:"Playlist"})}catch(s){te.error("Failed to load playlist data:",s)}finally{w(!1)}})()},[t,f,d,S,i]),l.useEffect(()=>{A(k)},[n.length]),l.useEffect(()=>{const o=()=>{const s=window.scrollY||document.documentElement.scrollTop,r=window.innerHeight||document.documentElement.clientHeight,c=document.documentElement.scrollHeight;s+r*1.5>=c&&A(h=>Math.min(h+ae,n.length))};return window.addEventListener("scroll",o,{passive:!0}),()=>window.removeEventListener("scroll",o)},[n.length]);const q=()=>{n.length>0&&y(n)},E=()=>!n.length||!j?!1:n.some(o=>o.Id===j.Id);return O?e.jsx("div",{className:"pb-20",children:e.jsx("div",{className:"flex items-center justify-center h-screen text-gray-400",children:e.jsx("p",{children:"Loading..."})})}):!m||n.length===0?e.jsx("div",{className:"pb-20",children:e.jsx("div",{className:"flex items-center justify-center h-screen text-gray-400",children:e.jsx("p",{children:f?"No songs found for this mood":"Playlist not found"})})}):e.jsxs("div",{className:"pb-20",children:[e.jsx("div",{className:`fixed top-0 left-0 right-0 bg-black z-10 lg:left-16 transition-[left,right] duration-300 ${Y?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top))"},children:e.jsx("div",{className:"max-w-[768px] mx-auto",children:e.jsxs("div",{className:"flex items-center justify-between gap-4 pl-3 pr-4",style:{paddingTop:"calc(1rem + 8px)",paddingBottom:"1rem"},children:[e.jsx("button",{onClick:()=>g(-1),className:"text-white hover:text-zinc-300 transition-colors",children:e.jsx(oe,{className:"w-6 h-6"})}),m&&!f&&e.jsx("button",{onClick:o=>{const s=o.currentTarget.getBoundingClientRect();F("desktop"),K({x:s.left+s.width/2,y:s.bottom+5}),T(!0)},className:"text-white hover:text-zinc-300 transition-colors",children:e.jsx(ie,{className:"w-6 h-6"})})]})})}),e.jsxs("div",{className:"pt-20",children:[e.jsx("div",{className:"mb-6 px-4 pt-4",children:e.jsxs("div",{className:"w-full",children:[e.jsx("h2",{className:"text-4xl md:text-5xl font-bold mb-0.5 text-left break-words",children:m.Name}),e.jsxs("div",{className:"flex items-center justify-between gap-4 mt-2",children:[e.jsxs("div",{className:"text-gray-400",children:[n.length," ",n.length===1?"track":"tracks"]}),e.jsx("button",{onClick:E()&&b?()=>I.getState().pause():q,className:"bg-white/10 hover:bg-white/20 text-white font-semibold py-1.5 px-3 rounded-full transition-all hover:scale-105 flex items-center gap-1.5 backdrop-blur-sm border border-white/20 flex-shrink-0",children:E()&&b?e.jsxs(e.Fragment,{children:[e.jsx(Z,{className:"w-3.5 h-3.5"}),"Pause"]}):e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"w-3.5 h-3.5"}),"Play"]})})]})]})}),e.jsx("div",{children:e.jsx("div",{className:"space-y-0",children:n.slice(0,Q).map((o,s)=>e.jsx(re,{track:o,index:s,tracks:n,onClick:r=>N(r,n),onContextMenu:(r,c,h)=>{M(r),$(c||"mobile"),U(h||null),P(!0)},contextMenuItemId:(v==null?void 0:v.Id)||null},o.Id))})})]}),e.jsx(R,{item:v,itemType:"song",isOpen:D,onClose:()=>{P(!1),M(null)},mode:H,position:z||void 0}),e.jsx(R,{item:m,itemType:"playlist",isOpen:_,onClose:()=>{T(!1)},mode:B,position:V||void 0})]})}export{xe as default};
