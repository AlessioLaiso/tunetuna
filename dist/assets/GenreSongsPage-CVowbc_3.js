import{k as Ne,b as we,a as H,g as je,u as Se,p as Ae,r as a,j as e,h as Ie,S as ye,P as Ee,L as Pe,C as Ce,e as L,f as Me,D as De,I as Le}from"./index-9VyyR-5F.js";import{S as ke}from"./SongItem-srAy7ly9.js";import{P as Ge}from"./Pagination-BeyUd0Qp.js";import{A as O}from"./arrow-left-BZktwZ3q.js";import{A as Te}from"./arrow-up-down-CTrKx1sL.js";const W=45,Ye=45,D=84,Z=45,He=45;function Oe({album:l,year:w,onNavigate:y,onContextMenu:k,showImage:B=!0}){const[F,G]=a.useState(!1),g=a.useRef(!1),S=p=>{p.preventDefault(),p.stopPropagation(),g.current=!0,k(l,"desktop",{x:p.clientX,y:p.clientY}),setTimeout(()=>{g.current=!1},300)},E=Me({onLongPress:p=>{p.preventDefault(),g.current=!0,k(l,"mobile")},onClick:()=>{if(g.current){g.current=!1;return}y(l.Id)}});return e.jsxs("button",{onClick:()=>{if(g.current){g.current=!1;return}y(l.Id)},onContextMenu:S,...E,className:"text-left group",children:[e.jsx("div",{className:"aspect-square rounded overflow-hidden mb-2 bg-zinc-900 flex items-center justify-center",children:F?e.jsx(De,{className:"w-12 h-12 text-gray-500"}):B?e.jsx(Le,{src:L.getAlbumArtUrl(l.Id,474),alt:l.Name,className:"w-full h-full object-cover",showOutline:!0,rounded:"rounded",onError:()=>G(!0)}):e.jsx("div",{className:"w-full h-full bg-zinc-900"})}),e.jsx("div",{className:"text-sm font-medium text-white truncate",children:l.Name}),w&&e.jsx("div",{className:"text-xs text-gray-400 truncate",children:w})]})}function Re(){const{id:l}=Ne(),w=we(),{playAlbum:y,toggleShuffle:k,isPlaying:B,pause:F,shuffleGenreSongs:G,addToQueue:g}=H();je();const{genres:S,genreSongs:E,setGenreSongs:p}=Se(),{state:z}=Ae(),[d,_]=a.useState(null),[f,U]=a.useState([]),[ee,A]=a.useState(!0),[te,R]=a.useState(!1),[se,ne]=a.useState("mobile"),[re,ae]=a.useState(null),[oe,V]=a.useState(null),[le,$]=a.useState(null),[ie,Q]=a.useState(W),[q,J]=a.useState(Z),[ce,ue]=a.useState(0),[I,T]=a.useState(!1),[P,me]=a.useState("Alphabetical"),[Y,X]=a.useState(0),C=H(t=>t.isQueueSidebarOpen);a.useEffect(()=>{if(I){const t=setTimeout(()=>{T(!1)},1e4);return()=>clearTimeout(t)}},[I]),a.useEffect(()=>{z==="success"&&l&&ue(t=>t+1)},[z,l]),a.useEffect(()=>{if(!l)return;(async()=>{const n=E[l];if(n&&n.length>0){let s=S;s.length===0&&(s=await L.getGenres());const r=s.find(o=>o.Id===l);r&&_(r),U(n),A(!1);return}A(!0);try{let s=S;s.length===0&&(s=await L.getGenres());const r=s.find(m=>m.Id===l);if(!r){A(!1);return}_(r);const o=r.Name;if(!o){A(!1);return}const i=await L.getGenreSongs(l,o);p(l,i),U(i)}catch(s){console.error("Failed to load genre songs:",s)}finally{A(!1)}})()},[l,S,E,p,ce]);const de=async()=>{if(f.length>0&&(d!=null&&d.Id)&&(d!=null&&d.Name)&&!I){const t=H.getState(),{isShuffleAllActive:n,isShuffleGenreActive:s,shuffle:r}=t;if(n||s)return;T(!0);try{await G(d.Id,d.Name)}catch(o){console.error("Failed to shuffle genre:",o)}finally{T(!1)}}},c=a.useMemo(()=>{const t=new Map;return f.forEach(n=>{if(n.AlbumId&&n.Album&&!t.has(n.AlbumId)){const s={Id:n.AlbumId,Name:n.Album,AlbumArtist:n.AlbumArtist,ArtistItems:n.ArtistItems,ProductionYear:n.ProductionYear,PremiereDate:n.PremiereDate};t.set(n.AlbumId,s)}}),Array.from(t.values()).sort((n,s)=>{const r=n.ProductionYear||(n.PremiereDate?new Date(n.PremiereDate).getFullYear():0),o=s.ProductionYear||(s.PremiereDate?new Date(s.PremiereDate).getFullYear():0);if(r!==o)return o-r;const i=n.Name||"",m=s.Name||"";return i.localeCompare(m)})},[f]),x=c.length>84,fe=a.useMemo(()=>{if(!x)return c;const t=Y*D,n=t+D;return c.slice(t,n)},[c,Y,x]);a.useMemo(()=>{const t=new Map;f.forEach(s=>{var m,u;const r=s.AlbumArtist||((u=(m=s.ArtistItems)==null?void 0:m[0])==null?void 0:u.Name)||"Unknown Artist",o=s.AlbumId||"no-album";t.has(r)||t.set(r,new Map);const i=t.get(r);i.has(o)||i.set(o,[]),i.get(o).push(s)});const n=[];return t.forEach((s,r)=>{const o=[];s.forEach((i,m)=>{var j;const u=[...i].sort((M,pe)=>{const be=M.IndexNumber||0,ve=pe.IndexNumber||0;return be-ve}),h=((j=u[0])==null?void 0:j.Album)||"Unknown Album";o.push({albumId:m,albumName:h,songs:u})}),o.sort((i,m)=>{const u=i.songs[0],h=m.songs[0],j=(u==null?void 0:u.ProductionYear)||(u!=null&&u.PremiereDate?new Date(u.PremiereDate).getFullYear():0),M=(h==null?void 0:h.ProductionYear)||(h!=null&&h.PremiereDate?new Date(h.PremiereDate).getFullYear():0);return j!==M?M-j:i.albumName.localeCompare(m.albumName)}),n.push({artist:r,albums:o})}),n.sort((s,r)=>s.artist.localeCompare(r.artist)),n},[f]);const K=(t,n)=>{const s=n.find(o=>o.Id===t.AlbumId);if(s){const o=s.ProductionYear||(s.PremiereDate?new Date(s.PremiereDate).getFullYear():0);return s.PremiereDate?new Date(s.PremiereDate).getTime():o*1e4}const r=t.ProductionYear||(t.PremiereDate?new Date(t.PremiereDate).getFullYear():0);return t.PremiereDate?new Date(t.PremiereDate).getTime():r*1e4},N=a.useMemo(()=>P==="Alphabetical"?[...f].sort((t,n)=>{const s=t.Name||"",r=n.Name||"";return s.localeCompare(r)}):[...f].sort((t,n)=>{const s=K(t,c),r=K(n,c);if(s!==r)return P==="Newest"?r-s:s-r;const o=t.Album||"",i=n.Album||"";if(o!==i)return o.localeCompare(i);const m=t.IndexNumber||0,u=n.IndexNumber||0;if(m!==u)return m-u;const h=t.Name||"",j=n.Name||"";return h.localeCompare(j)}),[f,P,c]),he=()=>{me(t=>t==="Alphabetical"?"Newest":t==="Newest"?"Oldest":"Alphabetical")},xe=()=>{N.length>0&&y(N)},ge=()=>{N.length>0&&g(N)};a.useEffect(()=>{x||Q(W)},[c.length,x]),a.useEffect(()=>{X(0)},[l]),a.useEffect(()=>{J(Z)},[N.length]),a.useEffect(()=>{},[q]);const b=a.useCallback(()=>{const t=window.pageYOffset||document.documentElement.scrollTop||window.scrollY||0,n=window.innerHeight||document.documentElement.clientHeight,s=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight);t+n*1>=s&&J(r=>Math.min(r+He,N.length))},[N.length]);a.useEffect(()=>(document.addEventListener("scroll",b,{passive:!0,capture:!0}),window.addEventListener("scroll",b,{passive:!0}),document.addEventListener("touchmove",b,{passive:!0}),document.addEventListener("touchend",b,{passive:!0}),()=>{document.removeEventListener("scroll",b,{capture:!0}),window.removeEventListener("scroll",b),document.removeEventListener("touchmove",b),document.removeEventListener("touchend",b)}),[b]);const v=a.useCallback(()=>{const t=window.pageYOffset||document.documentElement.scrollTop||window.scrollY||0,n=window.innerHeight||document.documentElement.clientHeight,s=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight);t+n*1>=s&&Q(r=>Math.min(r+Ye,c.length))},[c.length,x]);return a.useEffect(()=>{if(!x)return document.addEventListener("scroll",v,{passive:!0,capture:!0}),window.addEventListener("scroll",v,{passive:!0}),document.addEventListener("touchmove",v,{passive:!0}),document.addEventListener("touchend",v,{passive:!0}),()=>{document.removeEventListener("scroll",v,{capture:!0}),window.removeEventListener("scroll",v),document.removeEventListener("touchmove",v),document.removeEventListener("touchend",v)}},[v,x]),ee?e.jsxs("div",{className:"pb-20",children:[e.jsx("div",{className:`fixed top-0 left-0 right-0 bg-black z-10 lg:left-16 transition-[left,right] duration-300 ${C?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top))"},children:e.jsx("div",{className:"max-w-[768px] mx-auto",children:e.jsxs("div",{className:"flex items-center gap-4 p-4",children:[e.jsx("button",{onClick:()=>w(-1),className:"text-white hover:text-zinc-300 transition-colors",children:e.jsx(O,{className:"w-6 h-6"})}),e.jsx("h1",{className:"text-xl font-bold flex-1 truncate",children:(d==null?void 0:d.Name)||""}),e.jsx("div",{className:"flex items-center",children:e.jsx(Ie,{})})]})})}),e.jsx("div",{className:"pt-20",children:e.jsx("div",{className:"flex items-center justify-center h-screen text-gray-400"})})]}):!d||f.length===0?e.jsxs("div",{className:"pb-20",children:[e.jsx("div",{className:`fixed top-0 left-0 right-0 bg-black z-10 lg:left-16 transition-[left,right] duration-300 ${C?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top))"},children:e.jsx("div",{className:"max-w-[768px] mx-auto",children:e.jsxs("div",{className:"flex items-center gap-4 p-4",children:[e.jsx("button",{onClick:()=>w(-1),className:"text-white hover:text-zinc-300 transition-colors",children:e.jsx(O,{className:"w-6 h-6"})}),e.jsx("h1",{className:"text-xl font-bold flex-1 truncate",children:"Genre"})]})})}),e.jsx("div",{className:"pt-20",children:e.jsx("div",{className:"flex items-center justify-center h-screen text-gray-400",children:e.jsx("p",{children:"Genre not found or no songs available"})})})]}):e.jsxs("div",{className:"pb-20",children:[e.jsx("div",{className:`fixed top-0 left-0 right-0 bg-black z-10 lg:left-16 transition-[left,right] duration-300 ${C?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top))"},children:e.jsx("div",{className:"max-w-[768px] mx-auto",children:e.jsxs("div",{className:"flex items-center gap-4 p-4",children:[e.jsx("button",{onClick:()=>w(-1),className:"text-white hover:text-zinc-300 transition-colors",children:e.jsx(O,{className:"w-6 h-6"})}),e.jsx("h1",{className:"text-xl font-bold flex-1 truncate",children:d.Name}),e.jsx("button",{onClick:de,disabled:I,className:"w-8 h-8 flex items-center justify-center text-white hover:bg-zinc-800 rounded-full transition-colors disabled:opacity-50","aria-label":"Shuffle genre songs",children:I?e.jsx("div",{className:"w-4 h-4 border-2 border-zinc-400 border-t-white rounded-full animate-spin"}):e.jsx(ye,{className:"w-5 h-5"})})]})})}),e.jsx("div",{className:`fixed left-0 right-0 z-[60] lg:left-16 transition-[left,right] duration-300 ${C?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 5rem - 16px)",height:"24px",background:"linear-gradient(to bottom, rgba(0, 0, 0, 0.8), transparent)"}}),e.jsxs("div",{style:{paddingTop:"calc(env(safe-area-inset-top) + 5rem)"},children:[c.length>0&&e.jsxs("div",{className:"mb-10 px-4 pt-4",children:[e.jsxs("h2",{className:"text-xl font-bold text-white mb-4",children:["Albums (",c.length,")"]}),e.jsx("div",{className:"grid grid-cols-3 md:grid-cols-4 gap-4",children:(x?fe:c).map((t,n)=>{const s=t.ProductionYear||(t.PremiereDate?new Date(t.PremiereDate).getFullYear():null);return e.jsx(Oe,{album:t,year:s,onNavigate:r=>w(`/album/${r}`),onContextMenu:(r,o,i)=>{V(r),$("album"),ne(o||"mobile"),ae(i||null),R(!0)},showImage:x?!0:n<ie},t.Id)})})]}),x&&c.length>0&&e.jsx("div",{className:"-mt-10 mb-10",children:e.jsx(Ge,{currentPage:Y,totalPages:Math.ceil(c.length/D),onPageChange:X,itemsPerPage:D,totalItems:c.length})}),f.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"px-4 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h2",{className:"text-2xl font-bold text-white",children:["Songs (",f.length,")"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:xe,className:"w-10 h-10 flex items-center justify-center text-white hover:bg-white/10 rounded-lg transition-colors","aria-label":"Play all songs",children:e.jsx(Ee,{className:"w-5 h-5"})}),e.jsx("button",{type:"button",onClick:ge,className:"w-10 h-10 flex items-center justify-center text-white hover:bg-white/10 rounded-lg transition-colors","aria-label":"Add all songs to queue",children:e.jsx(Pe,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"mt-1",children:e.jsxs("button",{type:"button",onClick:he,className:"text-sm text-gray-400 hover:text-white transition-colors flex items-center gap-1",children:[P,e.jsx(Te,{className:"w-4 h-4"})]})})]}),e.jsx("div",{className:"space-y-0",children:N.map((t,n)=>{const s=n<q;return e.jsx(ke,{song:t,showImage:s},t.Id)})})]})]}),e.jsx(Ce,{item:oe,itemType:le,isOpen:te,onClose:()=>{R(!1),V(null),$(null)},mode:se,position:re||void 0})]})}export{Re as default};
