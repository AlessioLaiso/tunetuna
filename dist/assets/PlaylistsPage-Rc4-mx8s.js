import{b as B,r as s,f as fe,j as e,I as he,e as T,C as H,u as xe,a as _,l as U,z as me,w as pe,R as ge,A as G}from"./index-BN1iXlsH.js";import{u as ye,S as Se}from"./search-D349Pgk6.js";import{A as ve}from"./arrow-up-down-CHDXKgJe.js";import"./tag-DGEzW2G4.js";import"./piano-BCe5g9mK.js";function be({playlist:r}){const C=B(),[g,u]=s.useState(!1),[w,y]=s.useState("mobile"),[j,S]=s.useState(null),i=s.useRef(!1),o=n=>{if(i.current){n.preventDefault(),i.current=!1;return}C(`/playlist/${r.Id}`)},d=fe({onLongPress:n=>{n.preventDefault(),i.current=!0,y("mobile"),S(null),u(!0)}}),N=n=>{n.preventDefault(),n.stopPropagation(),i.current=!0,y("desktop"),S({x:n.clientX,y:n.clientY}),u(!0),setTimeout(()=>{i.current=!1},300)};return e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:n=>{if(g||i.current){n.preventDefault(),n.stopPropagation();return}o(n)},onContextMenu:N,...d,className:"w-full flex items-center gap-3 hover:bg-white/10 transition-colors group px-4 py-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-sm overflow-hidden flex-shrink-0 bg-zinc-900 self-center",children:e.jsx(he,{src:T.getAlbumArtUrl(r.Id,96),alt:r.Name,className:"w-full h-full object-cover",showOutline:!0,rounded:"rounded-sm"})}),e.jsxs("div",{className:"flex-1 min-w-0 text-left flex flex-col justify-center",children:[e.jsx("div",{className:"text-sm font-medium text-white truncate group-hover:text-[var(--accent-color)] transition-colors",children:r.Name}),e.jsx("div",{className:"text-xs text-gray-400 truncate",children:r.ChildCount?`${r.ChildCount} tracks`:"Playlist"})]})]}),e.jsx(H,{item:r,itemType:"playlist",isOpen:g,onClose:()=>u(!1),mode:w,position:j||void 0})]})}const Ce=[{type:"playlists"},{type:"artists",limit:5},{type:"albums",limit:12},{type:"songs"}];function Oe(){const[r,C]=s.useState([]),[g,u]=s.useState(!0),{sortPreferences:w,setSortPreference:y}=xe(),{playTrack:j,playAlbum:S,addToQueue:i}=_(),o=w.playlists,d=s.useRef(!0),[N,n]=s.useState(!1),E=s.useRef(o),v=B(),[b,f]=s.useState(""),[h,x]=s.useState(!1),[m,c]=s.useState(null),[Y,P]=s.useState(!1),l=s.useRef(null),[J,K]=s.useState(!1),[W,X]=s.useState(null),[V,Z]=s.useState(null),[q,we]=s.useState("mobile"),[ee,je]=s.useState(null),M=_(t=>t.isQueueSidebarOpen),[te,k]=s.useState(!1),[A,O]=s.useState(""),[I,L]=s.useState(!1);s.useEffect(()=>{const t=()=>F();return window.addEventListener("playlistUpdated",t),()=>window.removeEventListener("playlistUpdated",t)},[]),s.useEffect(()=>{h||(!d.current&&E.current!==o&&n(!0),E.current=o,F())},[o,h]),s.useEffect(()=>{d.current&&(d.current=!1)},[]),s.useEffect(()=>{if(l.current&&l.current.abort(),b.trim()){P(!0),l.current=new AbortController;const t=window.setTimeout(async()=>{var p,z,D,Q;if(!((p=l.current)!=null&&p.signal.aborted))try{const R=await ye(b,450);(z=l.current)!=null&&z.signal.aborted||c(R)}catch(R){(D=l.current)!=null&&D.signal.aborted||(U.error("Search failed:",R),c(null))}finally{(Q=l.current)!=null&&Q.signal.aborted||P(!1)}},250);return()=>{window.clearTimeout(t),l.current&&l.current.abort()}}else l.current=null,c(null),P(!1)},[b]),s.useEffect(()=>()=>{l.current&&l.current.abort()},[]);const F=async()=>{u(!0);try{const t={limit:100};o==="RecentlyAdded"?(t.sortBy=["DateCreated"],t.sortOrder="Descending"):(t.sortBy=["SortName"],t.sortOrder="Ascending");const p=await T.getPlaylists(t);C(p.Items)}catch(t){U.error("Failed to load playlists:",t)}finally{u(!1),n(!1)}},$=async()=>{const t=A.trim();if(t){L(!0);try{const p=await T.createPlaylist(t);G.getState().addToast("Playlist created","success",2e3),k(!1),O(""),window.dispatchEvent(new CustomEvent("playlistUpdated")),v(`/playlist/${p.Id}`)}catch{G.getState().addToast("Failed to create playlist","error",3e3)}finally{L(!1)}}},se=t=>{f(t),t.trim().length>0&&!h&&x(!0)},ne=()=>{f(""),c(null)},le=()=>{x(!1),f(""),c(null)},ae=t=>{v(`/artist/${t}`),x(!1),f(""),c(null)},re=t=>{v(`/album/${t}`),x(!1),f(""),c(null)},oe=t=>{j(t,[t])},ie=()=>{a!=null&&a.songs&&a.songs.length>0&&S(a.songs)},ce=()=>{a!=null&&a.songs&&a.songs.length>0&&i(a.songs)},ue=t=>{v(`/playlist/${t}`),x(!1),f(""),c(null)},de=t=>{},a=s.useMemo(()=>m?{playlists:m.playlists||[],artists:m.artists||[],albums:m.albums||[],songs:m.songs||[]}:null,[m]);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"pb-20",children:[e.jsx("div",{className:`fixed top-0 left-0 right-0 bg-black z-10 lg:left-16 transition-[left,right] duration-300 ${M?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top))"},children:e.jsx("div",{className:"max-w-[768px] mx-auto",children:e.jsxs("div",{className:"p-4 min-[780px]:px-[0.66rem]",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Playlists"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>k(!0),className:"w-10 h-10 flex items-center justify-center text-white hover:bg-zinc-800 rounded-full transition-colors","aria-label":"Create playlist",children:e.jsx(me,{className:"w-6 h-6"})}),e.jsx("button",{onClick:()=>x(!0),className:"w-10 h-10 flex items-center justify-center text-white hover:bg-zinc-800 rounded-full transition-colors","aria-label":"Search",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})]})]}),!h&&e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("button",{onClick:()=>y("playlists",o==="RecentlyAdded"?"Alphabetical":"RecentlyAdded"),className:"text-sm text-gray-400 hover:text-white transition-colors flex items-center gap-1",children:[o==="RecentlyAdded"?"Recently Added":"Alphabetically",e.jsx(ve,{className:"w-4 h-4"})]}),g&&!d.current&&e.jsx("div",{className:"flex items-center",children:e.jsx(pe,{})})]})]})})}),e.jsx("div",{className:`fixed left-0 right-0 z-10 lg:left-16 transition-[left,right] duration-300 ${M?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 7rem - 8px)",height:"24px",background:"linear-gradient(to bottom, rgba(0, 0, 0, 0.8), transparent)"}}),e.jsx("div",{style:{paddingTop:"calc(env(safe-area-inset-top) + 7rem)"},children:e.jsx("div",{className:`${N?"opacity-50 pointer-events-none":""} ${h?"hidden [@media((hover:hover)_and_(pointer:fine)_and_(min-width:1024px))]:block":""}`,children:r.length===0&&!g?e.jsx("div",{className:"flex items-center justify-center py-16 text-gray-400",children:e.jsx("p",{children:"No playlists found"})}):e.jsx("div",{className:"space-y-0",children:r.map(t=>e.jsx(be,{playlist:t},t.Id))})})})]}),e.jsx(Se,{isOpen:h,onClose:le,searchQuery:b,onSearchChange:se,onClearSearch:ne,isLoading:Y,results:a,sections:Ce,filterConfig:{showGenreFilter:!1,showYearFilter:!1,showGroupingFilters:!1},filterState:{selectedGenres:[],yearRange:{min:null,max:null},selectedGroupings:{}},onOpenFilterSheet:de,onArtistClick:ae,onAlbumClick:re,onSongClick:oe,onPlaylistClick:ue,onPlayAllSongs:ie,onAddSongsToQueue:ce,isQueueSidebarOpen:M}),e.jsx(H,{item:W,itemType:V,isOpen:J,onClose:()=>{K(!1),X(null),Z(null)},zIndex:99999,mode:q,position:ee||void 0}),e.jsx(ge,{isOpen:te,onClose:()=>{k(!1),O("")},children:e.jsxs("div",{className:"pb-6",children:[e.jsx("div",{className:"mb-4 px-4",children:e.jsx("div",{className:"text-lg font-semibold text-white",children:"Create Playlist"})}),e.jsxs("div",{className:"px-4 space-y-4",children:[e.jsx("input",{type:"text",value:A,onChange:t=>O(t.target.value),onKeyDown:t=>{t.key==="Enter"&&$()},className:"w-full bg-zinc-800 text-white rounded-lg px-4 py-3 outline-none focus:ring-2 focus:ring-[var(--accent-color)]",placeholder:"Playlist name",autoFocus:!0,disabled:I}),e.jsx("button",{onClick:$,disabled:I||!A.trim(),className:"w-full py-3 bg-[var(--accent-color)] text-white font-semibold rounded-full transition-colors disabled:opacity-50",children:I?"Creating...":"Create"})]})]})})]})}export{Oe as default};
