import{K as $e,b as be,a as de,i as Ae,r as o,u as Ue,a6 as _e,a7 as He,j as e,w as Ve,I as U,e as g,Q as qe,S as Qe,a8 as Ge,E as Je,H as Xe,C as xe,l as Ke,f as Ne,D as We,T as Ze}from"./index-Cd7_tvNc.js";import{u as he}from"./useScrollLazyLoad-kkH2xyzx.js";import{A as et}from"./arrow-left-DYhKFoKY.js";import{E as tt}from"./ellipsis-DErI59CM.js";import{C as st}from"./chevron-up-Cmy-K5-5.js";import{A as nt}from"./arrow-up-down-0ksViGcK.js";const fe=45,rt=45,pe=45,at=45;function ge({album:l,year:d,onNavigate:w,onContextMenu:S,showImage:y=!0}){const[k,M]=o.useState(!1),b=o.useRef(!1),h=i=>{if(b.current){i.preventDefault(),i.stopPropagation(),b.current=!1;return}w(l.Id)},r=i=>{i.preventDefault(),i.stopPropagation(),b.current=!0,S(l,"desktop",{x:i.clientX,y:i.clientY}),setTimeout(()=>{b.current=!1},100)},T=Ne({onLongPress:i=>{i.preventDefault(),b.current=!0,S(l,"mobile")},onClick:h});return e.jsxs("button",{onClick:h,onContextMenu:r,...T,className:"text-left group",children:[e.jsx("div",{className:"aspect-square rounded overflow-hidden mb-2 bg-zinc-900 flex items-center justify-center",children:k?e.jsx(We,{className:"w-12 h-12 text-gray-500"}):y?e.jsx(U,{src:g.getAlbumArtUrl(l.Id,474),alt:l.Name,className:"w-full h-full object-cover",showOutline:!0,rounded:"rounded",onError:()=>M(!0)}):e.jsx("div",{className:"w-full h-full bg-zinc-900"})}),e.jsx("div",{className:"text-sm font-medium text-white truncate group-hover:text-[var(--accent-color)] transition-colors",children:l.Name}),d&&e.jsx("div",{className:"text-xs text-gray-400 truncate",children:d})]})}function lt({song:l,album:d,year:w,onClick:S,onContextMenu:y,contextMenuItemId:k,showImage:M=!0}){const b=be(),h=k===l.Id,r=Ae(),T=Ne({onLongPress:i=>{i.preventDefault(),y(l,"mobile")},onClick:()=>S(l)});return e.jsxs("button",{onClick:()=>S(l),onContextMenu:i=>{i.preventDefault(),y(l,"desktop",{x:i.clientX,y:i.clientY})},...T,className:`w-full flex items-center gap-3 hover:bg-white/10 transition-colors group px-4 py-3 ${h?"bg-white/10":""}`,children:[e.jsx("div",{className:"w-12 h-12 rounded-sm overflow-hidden flex-shrink-0 bg-zinc-900 self-center flex items-center justify-center",children:M?e.jsx(U,{src:g.getAlbumArtUrl(l.AlbumId||l.Id,96),alt:l.Name,className:"w-full h-full object-cover",showOutline:!0,rounded:"rounded-sm"}):e.jsx("div",{className:"w-full h-full bg-zinc-900"})}),e.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[e.jsx("div",{className:`text-sm font-medium truncate transition-colors ${(r==null?void 0:r.Id)===l.Id?"text-[var(--accent-color)]":"text-white group-hover:text-[var(--accent-color)]"}`,children:l.Name}),(d||w)&&e.jsxs("div",{className:"text-xs text-gray-400 flex items-center gap-1 min-w-0",children:[d&&(l.AlbumId?e.jsx("span",{className:"clickable-text truncate",onMouseDown:i=>i.stopPropagation(),onClick:i=>{i.stopPropagation(),b(`/album/${l.AlbumId}`)},children:d}):e.jsx("span",{className:"truncate",children:d})),d&&w&&e.jsx("span",{className:"flex-shrink-0",children:"•"}),w&&e.jsx("span",{className:"flex-shrink-0",children:w})]})]}),l.RunTimeTicks&&e.jsx("div",{className:"text-xs text-gray-500 flex-shrink-0 text-right",children:Ze(l.RunTimeTicks)})]})}function pt(){var oe;const{id:l}=$e(),d=be(),{playAlbum:w,playTrack:S,isPlaying:y,pause:k,addToQueue:M,shuffleArtist:b}=de(),h=Ae(),[r,T]=o.useState(null),[i,ve]=o.useState([]),[K,we]=o.useState([]),[E,je]=o.useState([]),[Ie,_]=o.useState(!0),[W,H]=o.useState(!1),[it,z]=o.useState(!0),[P,V]=o.useState(!0),[Se,B]=o.useState(!1),[ye,q]=o.useState("mobile"),[Ce,Q]=o.useState(null),[Y,F]=o.useState(null),[Pe,R]=o.useState(null),[De,Z]=o.useState(!1),[ke,Me]=o.useState("mobile"),[Te,Oe]=o.useState(null),[L,Ee]=o.useState("Alphabetical"),[G,ee]=o.useState(fe),[te,se]=o.useState(pe),ne=o.useRef(null),re=de(t=>t.isQueueSidebarOpen),ae=Ue(t=>t.songs),$=o.useMemo(()=>_e(ae),[ae]),O=o.useMemo(()=>{if(!l)return[];let t=$.map[l]||[];if(t.length===0&&(r!=null&&r.Name)){const a=He(r.Name),n=$.artistIdsByName.get(a);if(n){const s=[],c=new Set;for(const u of n)for(const m of $.map[u]||[])c.has(m.Id)||(c.add(m.Id),s.push(m));t=s}}return t},[l,r==null?void 0:r.Name,$]),C=o.useMemo(()=>{if(O.length===0)return E;const t=new Set(E.map(n=>n.Id)),a=O.filter(n=>!t.has(n.Id)).map(n=>({Id:n.Id,Name:n.Name,AlbumArtist:n.AlbumArtist,ArtistItems:n.ArtistItems,Album:n.Album,AlbumId:n.AlbumId,IndexNumber:n.IndexNumber,ProductionYear:n.ProductionYear,PremiereDate:n.PremiereDate,RunTimeTicks:n.RunTimeTicks,Genres:n.Genres}));return[...E,...a]},[E,O]),J=o.useMemo(()=>{const t=new Set,a=[];for(const s of K)t.add(s.Id),a.push(s);const n=new Set(i.map(s=>s.Id));for(const s of O)s.AlbumId&&!n.has(s.AlbumId)&&!t.has(s.AlbumId)&&(t.add(s.AlbumId),a.push({Id:s.AlbumId,Name:s.Album||"Unknown Album",AlbumArtist:s.AlbumArtist,ArtistItems:s.ArtistItems,ProductionYear:s.ProductionYear,PremiereDate:s.PremiereDate}));return a.sort((s,c)=>{const u=s.ProductionYear||(s.PremiereDate?new Date(s.PremiereDate).getFullYear():0);return(c.ProductionYear||(c.PremiereDate?new Date(c.PremiereDate).getFullYear():0))-u})},[K,O,i]);o.useEffect(()=>{const t=document.querySelector(".main-scrollable");t&&t.scrollTo({top:0,behavior:"auto"})},[l]);const le=t=>t.toLowerCase().replace(/[_\*\-\.]/g,"").trim();o.useEffect(()=>{if(!l)return;let t=!0;return(async()=>{var n,s,c;_(!0);try{let m=await g.getArtistById(l);if(!m){const p=(await g.getArtists({limit:1e3})).Items.find(I=>I.Id===l);p&&(m=p)}if(!t)return;if(!m){_(!1);return}T(m),V(!0);const N=await g.getArtistItems(l);if(!t)return;const v=[],f=[];for(const x of N.albums)((n=x.AlbumArtists)==null?void 0:n.some(I=>I.Id===l))||!((s=x.AlbumArtists)!=null&&s.length)?v.push(x):f.push(x);if(v.length===0&&m.Name){const x=le(m.Name),I=((c=(await g.search(m.Name,50)).Artists)==null?void 0:c.Items)||[];for(const D of I){if(!t)return;if(D.Id!==l&&le(D.Name)===x&&(await g.getArtistItems(D.Id)).albums.filter(ce=>{var ue,me;return((ue=ce.AlbumArtists)==null?void 0:ue.some(Le=>Le.Id===D.Id))||!((me=ce.AlbumArtists)!=null&&me.length)}).length>0){d(`/artist/${D.Id}`,{replace:!0});return}}}if(!t)return;const j=(x,p)=>{const I=x.ProductionYear||(x.PremiereDate?new Date(x.PremiereDate).getFullYear():0);return(p.ProductionYear||(p.PremiereDate?new Date(p.PremiereDate).getFullYear():0))-I};ve(v.sort(j)),we(f.sort(j)),je(N.songs)}catch(u){if(!t)return;Ke.error("Failed to load artist data:",u)}finally{t&&_(!1)}})(),()=>{t=!1}},[l,d]),o.useEffect(()=>{if(!(r!=null&&r.Overview))return;z(!0);let t=null,a=null,n=null,s=!1;const c=()=>{const N=ne.current;if(!N||!(r!=null&&r.Overview)){z(!1);return}const v=window.getComputedStyle(N);let f=parseFloat(v.lineHeight||"0");if((!Number.isFinite(f)||f===0)&&(f=parseFloat(v.fontSize||"16")*1.5),f===0){z(!1);return}const j=N.scrollHeight;if(j===0&&!s){s=!0,u();return}const p=Math.round(j/f)>2;z(p)},u=()=>{t!==null&&cancelAnimationFrame(t),a!==null&&clearTimeout(a),t=requestAnimationFrame(()=>{a=window.setTimeout(c,0)}),n!==null&&clearTimeout(n),n=window.setTimeout(()=>{s=!1,c()},300)},m=()=>{s=!1,u()};return u(),window.addEventListener("resize",m),()=>{t!==null&&cancelAnimationFrame(t),a!==null&&clearTimeout(a),n!==null&&clearTimeout(n),window.removeEventListener("resize",m)}},[r==null?void 0:r.Overview]),o.useEffect(()=>{ee(fe)},[i.length]),o.useEffect(()=>{se(pe)},[C.length]),he({totalCount:C.length,visibleCount:te,increment:at,setVisibleCount:se,threshold:1}),he({totalCount:i.length,visibleCount:G,increment:rt,setVisibleCount:ee,threshold:1});const ze=()=>{A.length>0&&b(A)},X=t=>t.ProductionYear?t.ProductionYear.toString():t.PremiereDate?new Date(t.PremiereDate).getFullYear().toString():null,Be=t=>{const a=t.Album||null;let n=null;if(t.AlbumId){const s=i.find(c=>c.Id===t.AlbumId);s&&(n=X(s))}return{album:a,year:n}},ie=t=>{if(t.AlbumId){const a=i.find(n=>n.Id===t.AlbumId);if(a)return a.ProductionYear||(a.PremiereDate?new Date(a.PremiereDate).getFullYear():0)}return t.ProductionYear||(t.PremiereDate?new Date(t.PremiereDate).getFullYear():0)},A=o.useMemo(()=>{if(L==="Alphabetical")return[...C].sort((n,s)=>{const c=n.Name||"",u=s.Name||"";return c.localeCompare(u)});const t=(n,s,c)=>{const u=ie(n),m=ie(s),N=n.AlbumId||"",v=s.AlbumId||"";if(u!==m)return c?m-u:u-m;if(N!==v)return N.localeCompare(v);const f=n.IndexNumber||0,j=s.IndexNumber||0;return f!==j?f-j:(n.Name||"").localeCompare(s.Name||"")},a=L==="Newest";return[...C].sort((n,s)=>t(n,s,a))},[C,L,i]),Ye=t=>{t.preventDefault(),t.stopPropagation(),A.length>0&&w(A)},Fe=t=>{t.preventDefault(),t.stopPropagation(),A.length>0&&M(A)},Re=()=>{Ee(t=>t==="Alphabetical"?"Newest":t==="Newest"?"Oldest":"Alphabetical")};return Ie?e.jsx("div",{className:"pb-20",children:e.jsx("div",{className:"flex items-center justify-center h-screen text-gray-400",children:e.jsx(Ve,{})})}):r?e.jsxs("div",{className:"pb-20",children:[e.jsx("div",{className:`fixed top-0 left-0 right-0 z-[60] lg:left-16 transition-[left,right] duration-300 ${re?"sidebar-open-right-offset":""}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top))"},children:e.jsx("div",{className:"max-w-[768px] mx-auto",children:e.jsxs("div",{className:"relative flex items-center justify-between gap-4 py-4 pl-3 pr-4",children:[e.jsx("button",{onClick:()=>d(-1),className:"text-white hover:text-zinc-300 transition-colors z-10",children:e.jsx(et,{className:"w-6 h-6"})}),r&&e.jsx("button",{onClick:t=>{const a=t.currentTarget.getBoundingClientRect();Me("desktop"),Oe({x:a.left+a.width/2,y:a.bottom+5}),Z(!0)},className:"text-white hover:text-zinc-300 transition-colors z-10",children:e.jsx(tt,{className:"w-6 h-6"})})]})})}),e.jsxs("div",{className:`relative z-30 hero-breakout ${re?"hero-breakout-sidebar":""}`,style:{marginTop:"calc(-1 * env(safe-area-inset-top))"},children:[P&&e.jsxs("div",{className:"relative w-full min-h-64 md:min-h-80 bg-black",style:{paddingTop:"env(safe-area-inset-top)"},children:[e.jsx("div",{className:"w-full flex items-center justify-center md:hidden",children:e.jsx(U,{src:g.getArtistImageUrl(r.Id),alt:r.Name,className:"w-full h-auto object-contain",onError:()=>V(!1)})}),e.jsx("div",{className:"hidden md:block w-full h-80",children:e.jsx("img",{src:g.getArtistBackdropUrl(r.Id,1920),alt:r.Name,className:"w-full h-full object-cover object-[center_20%]",onError:()=>V(!1)})}),e.jsx("div",{className:"absolute inset-x-0 top-0 bottom-[-1px] bg-gradient-to-b from-transparent via-black/60 to-black pointer-events-none"})]}),e.jsx("div",{className:`left-0 right-0 ${P?"absolute":"relative"} ${P?"pt-16":"pt-12"}`,style:P?{bottom:"-28px",paddingBottom:"1.5rem"}:{},children:e.jsxs("div",{className:"max-w-[768px] mx-auto px-4 flex items-end gap-6 md:grid md:grid-cols-3 md:gap-4",children:[P&&e.jsx("div",{className:"hidden md:block md:col-span-1",children:e.jsx("div",{className:"aspect-square rounded overflow-hidden bg-zinc-900 flex items-center justify-center",children:e.jsx(U,{src:g.getArtistImageUrl(r.Id),alt:r.Name,className:"w-full h-full object-cover",showOutline:!0,rounded:"rounded"})})}),e.jsx("div",{className:`flex-1 min-w-0 pb-2 ${P?"md:col-span-2":"md:col-span-3"}`,children:e.jsxs("div",{className:"mb-4 mt-4",children:[e.jsx("h1",{className:"text-4xl md:text-5xl font-bold text-white mb-2 break-words",children:r.Name}),e.jsxs("div",{className:"flex items-center justify-between gap-4 mt-2",children:[e.jsxs("p",{className:"text-sm text-gray-300",children:[i.length," ",i.length===1?"album":"albums"," • ",A.length," ",A.length===1?"song":"songs"]}),e.jsx("button",{onClick:()=>{var a;h&&y&&(((a=h.ArtistItems)==null?void 0:a.some(n=>n.Id===l))||h.AlbumArtist===(r==null?void 0:r.Name))?k():ze()},className:"bg-white/10 hover:bg-white/20 text-white font-semibold py-1.5 px-3 rounded-full transition-all hover:scale-105 flex items-center gap-1.5 backdrop-blur-sm border border-white/20 flex-shrink-0",children:h&&y&&((oe=h.ArtistItems)!=null&&oe.some(t=>t.Id===l)||h.AlbumArtist===(r==null?void 0:r.Name))?e.jsxs(e.Fragment,{children:[e.jsx(qe,{className:"w-3.5 h-3.5"}),"Pause"]}):e.jsxs(e.Fragment,{children:[e.jsx(Qe,{className:"w-3.5 h-3.5"}),"Shuffle"]})})]})]})})]})})]}),e.jsxs("div",{className:"pt-3 md:pt-7",children:[r.Overview&&e.jsx("div",{className:"mb-6 px-4",children:e.jsxs("div",{className:"text-white relative",children:[e.jsx("p",{ref:ne,className:"text-sm text-gray-300 leading-relaxed absolute opacity-0 pointer-events-none -z-10",children:r.Overview}),!W&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>H(!0),className:"flex-1 text-left min-w-0",children:e.jsx("p",{className:"text-sm text-gray-300 leading-relaxed line-clamp-2",children:r.Overview})}),e.jsx("button",{onClick:()=>H(!0),className:"flex-shrink-0 text-gray-400 hover:text-white transition-colors",children:e.jsx(Ge,{className:"w-4 h-4"})})]}),W&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-300 leading-relaxed whitespace-pre-line",children:r.Overview}),e.jsxs("button",{onClick:()=>H(!1),className:"mt-2 flex items-center gap-1 text-sm text-gray-400 hover:text-white transition-colors ml-auto",children:["Show less",e.jsx(st,{className:"w-4 h-4"})]})]})]})}),i.length>0&&e.jsxs("div",{className:"mb-10 px-4",children:[e.jsxs("h2",{className:"text-2xl font-bold text-white mb-4",children:["Albums (",i.length,")"]}),e.jsx("div",{className:"grid grid-cols-3 md:grid-cols-4 gap-4",children:i.map((t,a)=>{const n=X(t);return e.jsx(ge,{album:t,year:n,onNavigate:s=>d(`/album/${s}`),onContextMenu:(s,c,u)=>{F(s),R("album"),q(c||"mobile"),Q(u||null),B(!0)},showImage:a<G},t.Id)})})]}),J.length>0&&e.jsxs("div",{className:"mb-10 px-4",children:[e.jsxs("h2",{className:"text-2xl font-bold text-white mb-4",children:["Appears On (",J.length,")"]}),e.jsx("div",{className:"grid grid-cols-3 md:grid-cols-4 gap-4",children:J.map((t,a)=>{const n=X(t);return e.jsx(ge,{album:t,year:n,onNavigate:s=>d(`/album/${s}`),onContextMenu:(s,c,u)=>{F(s),R("album"),q(c||"mobile"),Q(u||null),B(!0)},showImage:a<G},t.Id)})})]}),C.length>0&&e.jsxs("div",{id:"songs-section",children:[e.jsxs("div",{className:"px-4 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h2",{className:"text-2xl font-bold text-white",children:["Songs (",C.length,")"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:Ye,className:"w-10 h-10 flex items-center justify-center text-white hover:bg-white/10 rounded-full transition-colors","aria-label":"Play all songs",children:e.jsx(Je,{className:"w-5 h-5"})}),e.jsx("button",{type:"button",onClick:Fe,className:"w-10 h-10 flex items-center justify-center text-white hover:bg-white/10 rounded-full transition-colors","aria-label":"Add all songs to queue",children:e.jsx(Xe,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"mt-1",children:e.jsxs("button",{type:"button",onClick:Re,className:"text-sm text-gray-400 hover:text-white transition-colors flex items-center gap-1",children:[L,e.jsx(nt,{className:"w-4 h-4"})]})})]}),e.jsx("div",{className:"space-y-0",children:A.map((t,a)=>{const{album:n,year:s}=Be(t);return e.jsx(lt,{song:t,album:n,year:s,onClick:S,onContextMenu:(c,u,m)=>{F(c),R("song"),q(u||"mobile"),Q(m||null),B(!0)},contextMenuItemId:(Y==null?void 0:Y.Id)||null,showImage:a<te},t.Id)})})]})]}),e.jsx(xe,{item:Y,itemType:Pe,isOpen:Se,onClose:()=>{B(!1),F(null),R(null)},zIndex:99999,mode:ye,position:Ce||void 0}),e.jsx(xe,{item:r,itemType:"artist",isOpen:De,onClose:()=>{Z(!1)},mode:ke,position:Te||void 0})]}):e.jsx("div",{className:"pb-20",children:e.jsx("div",{className:"flex items-center justify-center h-screen text-gray-400",children:e.jsx("p",{children:"Artist not found on the Jellyfin server"})})})}export{pt as default};
