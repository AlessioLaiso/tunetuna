import{u as ie,a as ce,r as s,b as Fe,e as O,j as e,d as ze,h as De,G as _e,P as He,L as Ye,C as $e,f as he,D as fe}from"./index-scgXBtC7.js";import{u as Be,f as Ve,S as Qe}from"./search-Ei8VsrFv.js";import{S as Ue}from"./SearchArtistItem-BD5CnpKm.js";import{S as We}from"./SongItem-D5JN92IM.js";import{P as Xe}from"./Pagination-BlzUVH5l.js";import{F as de}from"./FilterBottomSheet-CShdrEBf.js";import{A as Je}from"./arrow-up-down-DHpxObdw.js";import{C as qe}from"./calendar-DhXdNtGO.js";function Ke({album:r,onClick:C,onContextMenu:S,contextMenuItemId:k}){var c,x;const[E,v]=s.useState(!1),b=s.useRef(!1),M=k===r.Id,I=o=>{if(M||b.current){o.preventDefault(),o.stopPropagation(),b.current=!1;return}C(r.Id)},P=o=>{o.preventDefault(),o.stopPropagation(),b.current=!0,S(r,"album","desktop",{x:o.clientX,y:o.clientY}),setTimeout(()=>{b.current=!1},300)},N=he({onLongPress:o=>{o.preventDefault(),b.current=!0,S(r,"album","mobile")},onClick:I});return e.jsxs("button",{onClick:I,onContextMenu:P,...N,className:"text-left group",children:[e.jsx("div",{className:"aspect-square rounded overflow-hidden mb-3 bg-zinc-900 shadow-lg relative flex items-center justify-center",children:E?e.jsx(fe,{className:"w-12 h-12 text-gray-500"}):e.jsxs(e.Fragment,{children:[e.jsx("img",{src:O.getAlbumArtUrl(r.Id,474),alt:r.Name,className:"w-full h-full object-cover",onError:()=>v(!0)}),e.jsx("div",{className:"absolute inset-0 pointer-events-none border border-white rounded",style:{borderColor:"rgba(255, 255, 255, 0.03)",borderWidth:"1px"}})]})}),e.jsx("div",{className:"text-sm font-semibold text-white truncate mb-1",children:r.Name}),e.jsx("div",{className:"text-xs text-gray-400 truncate",children:r.AlbumArtist||((x=(c=r.ArtistItems)==null?void 0:c[0])==null?void 0:x.Name)||"Unknown Artist"})]})}function Ze({song:r,onClick:C,onContextMenu:S,contextMenuItemId:k,showImage:E=!0}){var o,j;const v=s.useRef(!1),b=k===r.Id,[M,I]=s.useState(!1),P=l=>{const g=Math.floor(l/1e7),D=Math.floor(g/60),R=g%60;return`${D}:${R.toString().padStart(2,"0")}`},N=l=>{if(b||v.current){l.preventDefault(),l.stopPropagation(),v.current=!1;return}C(r)},c=l=>{l.preventDefault(),l.stopPropagation(),v.current=!0,S(r,"song","desktop",{x:l.clientX,y:l.clientY}),setTimeout(()=>{v.current=!1},300)},x=he({onLongPress:l=>{l.preventDefault(),v.current=!0,S(r,"song","mobile")},onClick:N});return e.jsxs("button",{onClick:N,onContextMenu:c,...x,className:`w-full flex items-center gap-3 hover:bg-white/10 transition-colors group px-4 py-3 ${b?"bg-white/10":""}`,children:[e.jsx("div",{className:"w-12 h-12 rounded-sm overflow-hidden flex-shrink-0 bg-zinc-900 self-center relative flex items-center justify-center",children:M?e.jsx(fe,{className:"w-7 h-7 text-gray-500"}):e.jsxs(e.Fragment,{children:[e.jsx("img",{src:O.getAlbumArtUrl(r.AlbumId||r.Id,96),alt:r.Name,className:"w-full h-full object-cover",loading:"lazy",onError:()=>I(!0)}),e.jsx("div",{className:"absolute inset-0 pointer-events-none border border-white rounded-sm",style:{borderColor:"rgba(255, 255, 255, 0.03)",borderWidth:"1px"}})]})}),e.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[e.jsx("div",{className:"text-sm font-medium text-white truncate group-hover:text-[var(--accent-color)] transition-colors",children:r.Name}),e.jsxs("div",{className:"text-xs text-gray-400 truncate",children:[r.AlbumArtist||((j=(o=r.ArtistItems)==null?void 0:o[0])==null?void 0:j.Name)||"Unknown Artist",r.Album&&` â€¢ ${r.Album}`]})]}),r.RunTimeTicks&&e.jsx("div",{className:"text-xs text-gray-500 flex-shrink-0 text-right",children:P(r.RunTimeTicks)})]})}const z=90,ue=45,et=45,me=45,tt=45;function dt(){const{songs:r,setSongs:C,sortPreferences:S,setSortPreference:k,setLoading:E,loading:v,genres:b}=ie(),{playTrack:M,playAlbum:I,addToQueue:P}=ce(),N=ce(t=>t.isQueueSidebarOpen),[c,x]=s.useState(""),[o,j]=s.useState(!1),[l,g]=s.useState(null),[D,R]=s.useState(!1),[xe,ge]=s.useState("mobile"),[pe,ve]=s.useState(null),[m,B]=s.useState(null),[be,V]=s.useState(null),[je,_]=s.useState(!1),f=s.useRef(null),[G,Q]=s.useState(0),[U,W]=s.useState(0),H=Fe(),T=s.useRef(null),X=s.useRef(null),[y,J]=s.useState([]),[i,q]=s.useState({min:null,max:null}),[K,Y]=s.useState(!1),[Z,ye]=s.useState(null),[Ne,ee]=s.useState([]),w=S.songs,F=s.useRef(!0),[we,te]=s.useState(!1),se=s.useRef(w),[Se,ne]=s.useState(ue),[re,le]=s.useState(me);s.useEffect(()=>{(async()=>{try{const n=ie.getState();if(n.years.length>0)ee(n.years);else{const h=await O.getYears();ee(h)}}catch(n){console.error("Failed to load filter values:",n)}})()},[]);const ae=y.length>0||i.min!==null||i.max!==null;s.useEffect(()=>{f.current&&f.current.abort();const t=c.trim().length>0;if(t||ae){_(!0),f.current=new AbortController;const n=window.setTimeout(async()=>{var h,u,d,A;if(!((h=f.current)!=null&&h.signal.aborted))try{let p;t?p=await Be(c,450):p=await Ve(450),(u=f.current)!=null&&u.signal.aborted||g(p)}catch(p){(d=f.current)!=null&&d.signal.aborted||(console.error("Search failed:",p),g(null))}finally{(A=f.current)!=null&&A.signal.aborted||_(!1)}},250);return()=>{window.clearTimeout(n),f.current&&f.current.abort()}}else f.current=null,g(null),_(!1)},[c,ae]);const a=s.useMemo(()=>{if(!l)return null;const t=u=>{if(i.min!==null||i.max!==null)return!1;if(y.length>0){const d=u.Genres||[];if(!y.some(p=>d.some($=>$.toLowerCase()===p.toLowerCase())))return!1}return!0},n=u=>{if(y.length>0){const d=u.Genres||[];if(!y.some(p=>d.some($=>$.toLowerCase()===p.toLowerCase())))return!1}if(i.min!==null||i.max!==null){const d=u.ProductionYear;if(!d||d<=0||i.min!==null&&d<i.min||i.max!==null&&d>i.max)return!1}return!0},h=u=>!(i.min!==null||i.max!==null||y.length>0);return{songs:l.songs.filter(n),artists:l.artists.filter(t),albums:l.albums.filter(n),playlists:(l.playlists||[]).filter(h)}},[l,y,i]);s.useEffect(()=>{var t;if(o&&((t=T.current)==null||t.focus(),T.current)){const n=T.current.value.length;T.current.setSelectionRange(n,n)}},[o]),s.useEffect(()=>()=>{f.current&&f.current.abort()},[]);const Ce=t=>{x(t),t.trim().length>0&&!o&&j(!0)},Ie=()=>{x(""),g(null)},Ae=()=>{j(!1),x(""),g(null),J([]),q({min:null,max:null})},oe=t=>{ye(t),Y(!0)},ke=t=>{J(t)},Ee=t=>{q(t)},Me=t=>{H(`/artist/${t}`),j(!1),x(""),g(null)},Pe=t=>{H(`/album/${t}`),j(!1),x(""),g(null)},Te=t=>{M(t,[t])},Le=t=>{t.preventDefault(),t.stopPropagation(),a!=null&&a.songs&&a.songs.length>0&&I(a.songs)},Oe=t=>{t.preventDefault(),t.stopPropagation(),a!=null&&a.songs&&a.songs.length>0&&P(a.songs)},Re=t=>{H(`/playlist/${t}`),j(!1),x(""),g(null)},L=(t,n,h="mobile",u)=>{B(t),V(n),ge(h),ve(u||null),R(!0)};s.useEffect(()=>{c.trim()||Q(0)},[w,c]),s.useEffect(()=>{le(me)},[c,o,l==null?void 0:l.songs.length]),s.useEffect(()=>{var h;const t=X.current;if(!o||!t||!((h=l==null?void 0:l.songs)!=null&&h.length))return;const n=()=>{const u=t.scrollTop,d=t.clientHeight,A=t.scrollHeight;u+d*1.5>=A&&le(p=>Math.min(p+tt,l.songs.length))};return t.addEventListener("scroll",n,{passive:!0}),()=>t.removeEventListener("scroll",n)},[o,l==null?void 0:l.songs.length,re]),s.useEffect(()=>{ne(ue)},[G,r.length]),s.useEffect(()=>{const t=()=>{const n=window.scrollY||document.documentElement.scrollTop,h=window.innerHeight||document.documentElement.clientHeight,u=document.documentElement.scrollHeight;n+h*1.5>=u&&ne(d=>Math.min(d+et,r.length))};return window.addEventListener("scroll",t,{passive:!0}),()=>window.removeEventListener("scroll",t)},[r.length]),s.useEffect(()=>{c.trim()||(!F.current&&se.current!==w&&te(!0),se.current=w,Ge())},[G,w,c]),s.useEffect(()=>{F.current&&(F.current=!1)},[]);const Ge=async()=>{E("songs",!0);try{const t={limit:z,startIndex:G*z};w==="RecentlyAdded"?(t.sortBy=["DateCreated"],t.sortOrder="Descending"):(t.sortBy=["SortName"],t.sortOrder="Ascending");const n=await O.getSongs(t);C(n.Items),W(n.TotalRecordCount||0)}catch(t){console.error("Failed to load songs:",t),C([]),W(0)}finally{E("songs",!1),te(!1)}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"pb-20",children:[e.jsx("div",{className:`fixed top-0 left-0 right-0 bg-black z-10 lg:left-16 transition-[left,right] duration-300 ${N?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top))"},children:e.jsx("div",{className:"max-w-[768px] mx-auto",children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Songs"}),e.jsx("button",{onClick:()=>j(!0),className:"w-10 h-10 flex items-center justify-center text-white hover:bg-zinc-800 rounded-full transition-colors","aria-label":"Search",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})]}),!o&&e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("button",{onClick:()=>k("songs",w==="RecentlyAdded"?"Alphabetical":"RecentlyAdded"),className:"text-sm text-gray-400 hover:text-white transition-colors flex items-center gap-1",children:[w==="RecentlyAdded"?"Recently Added":"Alphabetically",e.jsx(Je,{className:"w-4 h-4"})]}),v.songs&&!F.current&&e.jsx("div",{className:"flex items-center",children:e.jsx(De,{})})]})]})})}),e.jsx("div",{className:`fixed left-0 right-0 z-10 lg:left-16 transition-[left,right] duration-300 ${N?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 7rem - 8px)",height:"24px",background:"linear-gradient(to bottom, rgba(0, 0, 0, 0.8), transparent)"}}),e.jsx("div",{style:{paddingTop:"calc(env(safe-area-inset-top) + 7rem)"},children:!o&&e.jsx("div",{className:we?"opacity-50 pointer-events-none":"",children:r.length===0&&!v.songs?e.jsx("div",{className:"flex items-center justify-center py-16 text-gray-400",children:e.jsx("p",{children:"No songs found"})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-0",children:r.map((t,n)=>e.jsx(We,{song:t,showImage:n<Se,onContextMenu:L,contextMenuItemId:(m==null?void 0:m.Id)||null},t.Id))}),e.jsx(Xe,{currentPage:G,totalPages:Math.ceil(U/z),onPageChange:Q,itemsPerPage:z,totalItems:U})]})})})]}),o&&ze.createPortal(e.jsx(e.Fragment,{children:e.jsxs("div",{ref:X,className:"fixed inset-0 bg-black z-[9999] overflow-y-auto p-0 m-0",children:[e.jsx("div",{className:"fixed top-0 left-0 right-0 bg-black z-50 pointer-events-none",style:{height:"env(safe-area-inset-top)",top:"var(--header-offset, 0px)"}}),e.jsx("div",{className:"fixed top-0 left-0 right-0 bg-black z-10 pt-0 pb-0 w-full m-0",style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top))",height:"76px"},children:e.jsx("div",{className:"max-w-[768px] mx-auto w-full",children:e.jsxs("div",{className:"flex items-center gap-3 px-4 pt-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(Qe,{ref:T,value:c,onChange:Ce,showClearButton:c.trim().length>0,onClear:Ie})}),e.jsx("button",{onClick:Ae,className:"px-4 py-2 text-white text-sm font-medium hover:text-zinc-300 transition-colors whitespace-nowrap flex-shrink-0",children:"Cancel"})]})})}),e.jsxs("div",{className:"max-w-[768px] mx-auto w-full",style:{paddingTop:"calc(52px + env(safe-area-inset-top))"},children:[e.jsx("div",{className:"sticky bg-black z-10 pt-3 pb-4",style:{top:"calc(76px + env(safe-area-inset-top))"},children:e.jsxs("div",{className:"flex items-center gap-3 px-4",children:[e.jsxs("button",{onClick:()=>oe("genre"),className:`flex items-center gap-2 px-3 py-2 rounded-lg transition-colors ${y.length>0?"bg-[var(--accent-color)] text-white":"bg-white/10 text-white hover:bg-white/20"}`,"aria-label":"Filter by genre",children:[e.jsx(_e,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Genre"})]}),e.jsxs("button",{onClick:()=>oe("year"),className:`flex items-center gap-2 px-3 py-2 rounded-lg transition-colors ${i.min!==null||i.max!==null?"bg-[var(--accent-color)] text-white":"bg-white/10 text-white hover:bg-white/20"}`,"aria-label":"Filter by year",children:[e.jsx(qe,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Year"})]})]})}),e.jsx("div",{className:`fixed left-0 right-0 z-[60] lg:left-16 transition-[left,right] duration-300 ${N?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 76px + 4rem)",height:"24px",background:"linear-gradient(to bottom, rgba(0, 0, 0, 0.8), transparent)"}}),e.jsx("div",{className:"pb-32",style:{paddingTop:"40px"},children:je?e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-zinc-800 border-t-[var(--accent-color)]"})}):a?e.jsxs("div",{className:"space-y-8",children:[a.songs.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 px-4",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"Songs"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:Le,className:"w-10 h-10 flex items-center justify-center text-white hover:bg-white/10 rounded-lg transition-colors","aria-label":"Play all songs",children:e.jsx(He,{className:"w-5 h-5"})}),e.jsx("button",{type:"button",onClick:Oe,className:"w-10 h-10 flex items-center justify-center text-white hover:bg-white/10 rounded-lg transition-colors","aria-label":"Add all songs to queue",children:e.jsx(Ye,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"space-y-0",children:a.songs.map((t,n)=>e.jsx(Ze,{song:t,onClick:Te,onContextMenu:L,contextMenuItemId:(m==null?void 0:m.Id)||null,showImage:n<re},t.Id))})]}),a.artists.length>0&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-4 px-4",children:"Artists"}),e.jsx("div",{className:"space-y-0",children:a.artists.slice(0,5).map(t=>e.jsx(Ue,{artist:t,onClick:Me,onContextMenu:L,contextMenuItemId:(m==null?void 0:m.Id)||null},t.Id))})]}),a.albums.length>0&&e.jsxs("div",{className:"px-4",children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Albums"}),e.jsx("div",{className:"grid grid-cols-3 gap-4",children:a.albums.slice(0,12).map(t=>e.jsx(Ke,{album:t,onClick:Pe,onContextMenu:L,contextMenuItemId:(m==null?void 0:m.Id)||null},t.Id))})]}),a.playlists&&a.playlists.length>0&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-4 px-4",children:"Playlists"}),e.jsx("div",{className:"space-y-0",children:a.playlists.map(t=>e.jsxs("button",{onClick:()=>Re(t.Id),onContextMenu:n=>{n.preventDefault(),n.stopPropagation(),L(t,"playlist","desktop",{x:n.clientX,y:n.clientY})},className:"w-full flex items-center gap-3 hover:bg-white/10 transition-colors group px-4 py-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-sm overflow-hidden flex-shrink-0 bg-zinc-900 self-center",children:e.jsx("img",{src:O.getAlbumArtUrl(t.Id,96),alt:t.Name,className:"w-full h-full object-cover",loading:"lazy"})}),e.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[e.jsx("div",{className:"text-sm font-medium text-white truncate group-hover:text-[var(--accent-color)] transition-colors",children:t.Name}),e.jsx("div",{className:"text-xs text-gray-400 truncate",children:t.ChildCount?`${t.ChildCount} tracks`:"Playlist"})]})]},t.Id))})]}),a.artists.length===0&&a.albums.length===0&&(!a.playlists||a.playlists.length===0)&&a.songs.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 text-gray-400 px-4",children:[e.jsx("div",{className:"text-lg mb-2",children:"No results found"}),e.jsx("div",{className:"text-sm",children:"Try a different search term"})]})]}):e.jsx("div",{className:"flex flex-col items-center justify-center py-16 text-gray-400 px-4"})})]})]})}),document.body),Z==="genre"&&e.jsx(de,{isOpen:K,onClose:()=>Y(!1),filterType:"genre",genres:b,selectedValues:y,onApply:ke}),Z==="year"&&e.jsx(de,{isOpen:K,onClose:()=>Y(!1),filterType:"year",availableYears:Ne,yearRange:i,onApplyYear:Ee}),e.jsx($e,{item:m,itemType:be,isOpen:D,onClose:()=>{R(!1),B(null),V(null)},zIndex:99999,mode:xe,position:pe||void 0})]})}export{dt as default};
