import{K as Se,b as re,a as Z,i as le,r as a,j as e,w as Pe,I as E,e as b,Q as ke,S as De,a6 as Me,E as Ee,H as Te,C as ee,l as Oe,f as ae,D as ze,T as Be}from"./index-CGRvUryl.js";import{u as te}from"./useScrollLazyLoad-Cgh5pZ3-.js";import{A as Le}from"./arrow-left-CwuGyWtl.js";import{E as Re}from"./ellipsis-BwAsU9Jn.js";import{C as Fe}from"./chevron-up-BE0abVjt.js";import{A as Ye}from"./arrow-up-down-Oh2KK2ce.js";const se=45,_e=45,ne=45,Ue=45;function $e({album:n,year:m,onNavigate:j,onContextMenu:w,showImage:A=!0}){const[C,S]=a.useState(!1),v=a.useRef(!1),h=r=>{if(v.current){r.preventDefault(),r.stopPropagation(),v.current=!1;return}j(n.Id)},s=r=>{r.preventDefault(),r.stopPropagation(),v.current=!0,w(n,"desktop",{x:r.clientX,y:r.clientY}),setTimeout(()=>{v.current=!1},100)},P=ae({onLongPress:r=>{r.preventDefault(),v.current=!0,w(n,"mobile")},onClick:h});return e.jsxs("button",{onClick:h,onContextMenu:s,...P,className:"text-left group",children:[e.jsx("div",{className:"aspect-square rounded overflow-hidden mb-2 bg-zinc-900 flex items-center justify-center",children:C?e.jsx(ze,{className:"w-12 h-12 text-gray-500"}):A?e.jsx(E,{src:b.getAlbumArtUrl(n.Id,474),alt:n.Name,className:"w-full h-full object-cover",showOutline:!0,rounded:"rounded",onError:()=>S(!0)}):e.jsx("div",{className:"w-full h-full bg-zinc-900"})}),e.jsx("div",{className:"text-sm font-medium text-white truncate group-hover:text-[var(--accent-color)] transition-colors",children:n.Name}),m&&e.jsx("div",{className:"text-xs text-gray-400 truncate",children:m})]})}function He({song:n,album:m,year:j,onClick:w,onContextMenu:A,contextMenuItemId:C,showImage:S=!0}){const v=re(),h=C===n.Id,s=le(),P=ae({onLongPress:r=>{r.preventDefault(),A(n,"mobile")},onClick:()=>w(n)});return e.jsxs("button",{onClick:()=>w(n),onContextMenu:r=>{r.preventDefault(),A(n,"desktop",{x:r.clientX,y:r.clientY})},...P,className:`w-full flex items-center gap-3 hover:bg-white/10 transition-colors group px-4 py-3 ${h?"bg-white/10":""}`,children:[e.jsx("div",{className:"w-12 h-12 rounded-sm overflow-hidden flex-shrink-0 bg-zinc-900 self-center flex items-center justify-center",children:S?e.jsx(E,{src:b.getAlbumArtUrl(n.AlbumId||n.Id,96),alt:n.Name,className:"w-full h-full object-cover",showOutline:!0,rounded:"rounded-sm"}):e.jsx("div",{className:"w-full h-full bg-zinc-900"})}),e.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[e.jsx("div",{className:`text-sm font-medium truncate transition-colors ${(s==null?void 0:s.Id)===n.Id?"text-[var(--accent-color)]":"text-white group-hover:text-[var(--accent-color)]"}`,children:n.Name}),(m||j)&&e.jsxs("div",{className:"text-xs text-gray-400 flex items-center gap-1 min-w-0",children:[m&&(n.AlbumId?e.jsx("span",{className:"clickable-text truncate",onMouseDown:r=>r.stopPropagation(),onClick:r=>{r.stopPropagation(),v(`/album/${n.AlbumId}`)},children:m}):e.jsx("span",{className:"truncate",children:m})),m&&j&&e.jsx("span",{className:"flex-shrink-0",children:"•"}),j&&e.jsx("span",{className:"flex-shrink-0",children:j})]})]}),n.RunTimeTicks&&e.jsx("div",{className:"text-xs text-gray-500 flex-shrink-0 text-right",children:Be(n.RunTimeTicks)})]})}function Ze(){var W;const{id:n}=Se(),m=re(),{playAlbum:j,playTrack:w,isPlaying:A,pause:C,addToQueue:S,shuffleArtist:v}=Z(),h=le(),[s,P]=a.useState(null),[r,ie]=a.useState([]),[I,oe]=a.useState([]),[ce,T]=a.useState(!0),[Y,O]=a.useState(!1),[Ve,k]=a.useState(!0),[y,z]=a.useState(!0),[ue,B]=a.useState(!1),[de,_]=a.useState("mobile"),[me,U]=a.useState(null),[D,L]=a.useState(null),[xe,R]=a.useState(null),[fe,$]=a.useState(!1),[he,pe]=a.useState("mobile"),[ge,be]=a.useState(null),[M,ve]=a.useState("Alphabetical"),[H,V]=a.useState(se),[q,Q]=a.useState(ne),G=a.useRef(null),Ne=Z(t=>t.isQueueSidebarOpen);a.useEffect(()=>{const t=document.querySelector(".main-scrollable");t&&t.scrollTo({top:0,behavior:"auto"})},[n]);const J=t=>t.toLowerCase().replace(/[_\*\-\.]/g,"").trim();a.useEffect(()=>{if(!n)return;let t=!0;return(async()=>{var l;T(!0);try{let c=await b.getArtistById(n);if(!c){const f=(await b.getArtists({limit:1e3})).Items.find(d=>d.Id===n);f&&(c=f)}if(!t)return;if(!c){T(!1);return}P(c),z(!0);const u=await b.getArtistItems(n);if(!t)return;if(u.albums.length===0&&u.songs.length===0&&c.Name){const x=J(c.Name),d=((l=(await b.search(c.Name,50)).Artists)==null?void 0:l.Items)||[];for(const p of d){if(!t)return;if(p.Id!==n&&J(p.Name)===x){const F=await b.getArtistItems(p.Id);if(F.albums.length>0||F.songs.length>0){m(`/artist/${p.Id}`,{replace:!0});return}}}}if(!t)return;const g=[...u.albums].sort((x,f)=>{const d=x.ProductionYear||(x.PremiereDate?new Date(x.PremiereDate).getFullYear():0);return(f.ProductionYear||(f.PremiereDate?new Date(f.PremiereDate).getFullYear():0))-d});ie(g),oe(u.songs)}catch(o){if(!t)return;Oe.error("Failed to load artist data:",o)}finally{t&&T(!1)}})(),()=>{t=!1}},[n,m]),a.useEffect(()=>{if(!(s!=null&&s.Overview))return;k(!0);let t=null,i=null,l=null,o=!1;const c=()=>{const x=G.current;if(!x||!(s!=null&&s.Overview)){k(!1);return}const f=window.getComputedStyle(x);let d=parseFloat(f.lineHeight||"0");if((!Number.isFinite(d)||d===0)&&(d=parseFloat(f.fontSize||"16")*1.5),d===0){k(!1);return}const p=x.scrollHeight;if(p===0&&!o){o=!0,u();return}const Ce=Math.round(p/d)>2;k(Ce)},u=()=>{t!==null&&cancelAnimationFrame(t),i!==null&&clearTimeout(i),t=requestAnimationFrame(()=>{i=window.setTimeout(c,0)}),l!==null&&clearTimeout(l),l=window.setTimeout(()=>{o=!1,c()},300)},g=()=>{o=!1,u()};return u(),window.addEventListener("resize",g),()=>{t!==null&&cancelAnimationFrame(t),i!==null&&clearTimeout(i),l!==null&&clearTimeout(l),window.removeEventListener("resize",g)}},[s==null?void 0:s.Overview]),a.useEffect(()=>{V(se)},[r.length]),a.useEffect(()=>{Q(ne)},[I.length]),te({totalCount:I.length,visibleCount:q,increment:Ue,setVisibleCount:Q,threshold:1}),te({totalCount:r.length,visibleCount:H,increment:_e,setVisibleCount:V,threshold:1});const je=()=>{N.length>0&&v(N)},X=t=>t.ProductionYear?t.ProductionYear.toString():t.PremiereDate?new Date(t.PremiereDate).getFullYear().toString():null,we=t=>{const i=t.Album||null;let l=null;if(t.AlbumId){const o=r.find(c=>c.Id===t.AlbumId);o&&(l=X(o))}return{album:i,year:l}},K=t=>{if(t.AlbumId){const i=r.find(l=>l.Id===t.AlbumId);if(i)return i.ProductionYear||(i.PremiereDate?new Date(i.PremiereDate).getFullYear():0)}return t.ProductionYear||(t.PremiereDate?new Date(t.PremiereDate).getFullYear():0)},N=a.useMemo(()=>{if(M==="Alphabetical")return[...I].sort((l,o)=>{const c=l.Name||"",u=o.Name||"";return c.localeCompare(u)});const t=(l,o,c)=>{const u=K(l),g=K(o),x=l.AlbumId||"",f=o.AlbumId||"";if(u!==g)return c?g-u:u-g;if(x!==f)return x.localeCompare(f);const d=l.IndexNumber||0,p=o.IndexNumber||0;return d!==p?d-p:(l.Name||"").localeCompare(o.Name||"")},i=M==="Newest";return[...I].sort((l,o)=>t(l,o,i))},[I,M,r]),Ae=t=>{t.preventDefault(),t.stopPropagation(),N.length>0&&j(N)},Ie=t=>{t.preventDefault(),t.stopPropagation(),N.length>0&&S(N)},ye=()=>{ve(t=>t==="Alphabetical"?"Newest":t==="Newest"?"Oldest":"Alphabetical")};return ce?e.jsx("div",{className:"pb-20",children:e.jsx("div",{className:"flex items-center justify-center h-screen text-gray-400",children:e.jsx(Pe,{})})}):s?e.jsxs("div",{className:"pb-20",children:[e.jsx("div",{className:`fixed top-0 left-0 right-0 z-[60] lg:left-16 transition-[left,right] duration-300 ${Ne?"sidebar-open-right-offset":""}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top))"},children:e.jsx("div",{className:"max-w-[768px] mx-auto",children:e.jsxs("div",{className:"relative flex items-center justify-between gap-4 py-4 pl-3 pr-4",children:[e.jsx("button",{onClick:()=>m(-1),className:"text-white hover:text-zinc-300 transition-colors z-10",children:e.jsx(Le,{className:"w-6 h-6"})}),s&&e.jsx("button",{onClick:t=>{const i=t.currentTarget.getBoundingClientRect();pe("desktop"),be({x:i.left+i.width/2,y:i.bottom+5}),$(!0)},className:"text-white hover:text-zinc-300 transition-colors z-10",children:e.jsx(Re,{className:"w-6 h-6"})})]})})}),e.jsxs("div",{className:"relative z-30 w-screen",style:{marginTop:"calc(-1 * env(safe-area-inset-top))",marginLeft:"calc(50% - 50vw)",marginRight:"calc(50% - 50vw)"},children:[y&&e.jsxs("div",{className:"relative w-full min-h-64 md:min-h-80 bg-black",style:{paddingTop:"env(safe-area-inset-top)"},children:[e.jsx("div",{className:"w-full flex items-center justify-center md:hidden",children:e.jsx(E,{src:b.getArtistImageUrl(s.Id),alt:s.Name,className:"w-full h-auto object-contain",onError:()=>z(!1)})}),e.jsx("div",{className:"hidden md:block w-full h-80",children:e.jsx("img",{src:b.getArtistBackdropUrl(s.Id,1920),alt:s.Name,className:"w-full h-full object-cover object-[center_20%]",onError:()=>z(!1)})}),e.jsx("div",{className:"absolute inset-x-0 top-0 bottom-[-1px] bg-gradient-to-b from-transparent via-black/60 to-black pointer-events-none"})]}),e.jsx("div",{className:`left-0 right-0 ${y?"absolute":"relative"} ${y?"pt-16":"pt-12"}`,style:y?{bottom:"-28px",paddingBottom:"1.5rem"}:{},children:e.jsxs("div",{className:"max-w-[768px] mx-auto px-4 flex items-end gap-6 md:grid md:grid-cols-3 md:gap-4",children:[y&&e.jsx("div",{className:"hidden md:block md:col-span-1",children:e.jsx("div",{className:"aspect-square rounded overflow-hidden bg-zinc-900 flex items-center justify-center",children:e.jsx(E,{src:b.getArtistImageUrl(s.Id),alt:s.Name,className:"w-full h-full object-cover",showOutline:!0,rounded:"rounded"})})}),e.jsx("div",{className:`flex-1 min-w-0 pb-2 ${y?"md:col-span-2":"md:col-span-3"}`,children:e.jsxs("div",{className:"mb-4 mt-4",children:[e.jsx("h1",{className:"text-4xl md:text-5xl font-bold text-white mb-2 break-words",children:s.Name}),e.jsxs("div",{className:"flex items-center justify-between gap-4 mt-2",children:[e.jsxs("p",{className:"text-sm text-gray-300",children:[r.length," ",r.length===1?"album":"albums"," • ",N.length," ",N.length===1?"song":"songs"]}),e.jsx("button",{onClick:()=>{var i;h&&A&&(((i=h.ArtistItems)==null?void 0:i.some(l=>l.Id===n))||h.AlbumArtist===(s==null?void 0:s.Name))?C():je()},className:"bg-white/10 hover:bg-white/20 text-white font-semibold py-1.5 px-3 rounded-full transition-all hover:scale-105 flex items-center gap-1.5 backdrop-blur-sm border border-white/20 flex-shrink-0",children:h&&A&&((W=h.ArtistItems)!=null&&W.some(t=>t.Id===n)||h.AlbumArtist===(s==null?void 0:s.Name))?e.jsxs(e.Fragment,{children:[e.jsx(ke,{className:"w-3.5 h-3.5"}),"Pause"]}):e.jsxs(e.Fragment,{children:[e.jsx(De,{className:"w-3.5 h-3.5"}),"Shuffle"]})})]})]})})]})})]}),e.jsxs("div",{className:"pt-3 md:pt-7",children:[s.Overview&&e.jsx("div",{className:"mb-6 -mt-4 px-4",children:e.jsxs("div",{className:"text-white relative",children:[e.jsx("p",{ref:G,className:"text-sm text-gray-300 leading-relaxed absolute opacity-0 pointer-events-none -z-10",children:s.Overview}),!Y&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>O(!0),className:"flex-1 text-left min-w-0",children:e.jsx("p",{className:"text-sm text-gray-300 leading-relaxed line-clamp-2",children:s.Overview})}),e.jsx("button",{onClick:()=>O(!0),className:"flex-shrink-0 text-gray-400 hover:text-white transition-colors",children:e.jsx(Me,{className:"w-4 h-4"})})]}),Y&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-300 leading-relaxed whitespace-pre-line",children:s.Overview}),e.jsxs("button",{onClick:()=>O(!1),className:"mt-2 flex items-center gap-1 text-sm text-gray-400 hover:text-white transition-colors ml-auto",children:["Show less",e.jsx(Fe,{className:"w-4 h-4"})]})]})]})}),r.length>0&&e.jsxs("div",{className:"mb-10 px-4",children:[e.jsxs("h2",{className:"text-2xl font-bold text-white mb-4",children:["Albums (",r.length,")"]}),e.jsx("div",{className:"grid grid-cols-3 md:grid-cols-4 gap-4",children:r.map((t,i)=>{const l=X(t);return e.jsx($e,{album:t,year:l,onNavigate:o=>m(`/album/${o}`),onContextMenu:(o,c,u)=>{L(o),R("album"),_(c||"mobile"),U(u||null),B(!0)},showImage:i<H},t.Id)})})]}),I.length>0&&e.jsxs("div",{id:"songs-section",children:[e.jsxs("div",{className:"px-4 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h2",{className:"text-2xl font-bold text-white",children:["Songs (",I.length,")"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:Ae,className:"w-10 h-10 flex items-center justify-center text-white hover:bg-white/10 rounded-full transition-colors","aria-label":"Play all songs",children:e.jsx(Ee,{className:"w-5 h-5"})}),e.jsx("button",{type:"button",onClick:Ie,className:"w-10 h-10 flex items-center justify-center text-white hover:bg-white/10 rounded-full transition-colors","aria-label":"Add all songs to queue",children:e.jsx(Te,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"mt-1",children:e.jsxs("button",{type:"button",onClick:ye,className:"text-sm text-gray-400 hover:text-white transition-colors flex items-center gap-1",children:[M,e.jsx(Ye,{className:"w-4 h-4"})]})})]}),e.jsx("div",{className:"space-y-0",children:N.map((t,i)=>{const{album:l,year:o}=we(t);return e.jsx(He,{song:t,album:l,year:o,onClick:w,onContextMenu:(c,u,g)=>{L(c),R("song"),_(u||"mobile"),U(g||null),B(!0)},contextMenuItemId:(D==null?void 0:D.Id)||null,showImage:i<q},t.Id)})})]})]}),e.jsx(ee,{item:D,itemType:xe,isOpen:ue,onClose:()=>{B(!1),L(null),R(null)},zIndex:99999,mode:de,position:me||void 0}),e.jsx(ee,{item:s,itemType:"artist",isOpen:fe,onClose:()=>{$(!1)},mode:he,position:ge||void 0})]}):e.jsx("div",{className:"pb-20",children:e.jsx("div",{className:"flex items-center justify-center h-screen text-gray-400",children:e.jsx("p",{children:"Artist not found on the Jellyfin server"})})})}export{Ze as default};
