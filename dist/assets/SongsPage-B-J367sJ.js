import{r as n,u as c,a as v,b as $e,g as Be,d as De,e as Z,l as ee,j as t,w as ze,C as He}from"./index-BYKDqJ8o.js";import{S as Ke}from"./SongItem-DH5Z1u0B.js";import{P as Ue}from"./Pagination-4b4MsveV.js";import{u as We,F as w}from"./useSearch-Cp7mq4aB.js";import{S as qe}from"./search-QndjWdlH.js";import{A as Je}from"./arrow-up-down-BsayAhDf.js";import"./chevron-right-C8kZkqUv.js";import"./tag-C3OfJ6eg.js";import"./piano-Dd66CmwD.js";const Xe=[{type:"songs"},{type:"artists",limit:5},{type:"albums",limit:12},{type:"playlists"}],b=90,te=45,Ze=45;function ct(){const[d,O]=n.useState([]),se=c(e=>e.sortPreferences),ne=c(e=>e.setSortPreference),T=c(e=>e.setLoading),E=c(e=>e.loading),oe=c(e=>e.genres),re=v(e=>e.playTrack),ae=v(e=>e.playAlbum),le=v(e=>e.addToQueue),j=v(e=>e.isQueueSidebarOpen),[u,i]=n.useState(!1),[ie,G]=n.useState(!1),[ce,ue]=n.useState("mobile"),[de,ge]=n.useState(null),[f,F]=n.useState(null),[pe,R]=n.useState(null),[m,L]=n.useState(0),[_,Q]=n.useState(0),A=$e(),[M,g]=n.useState(!1),[I,V]=n.useState(null),[S,he]=n.useState(null),[fe,Y]=n.useState([]),$=c(e=>e.songs),me=n.useMemo(()=>Be($),[$]),l=se.songs,x=n.useRef(!0),[Se,B]=n.useState(!1),D=n.useRef(l),[z,H]=n.useState(te),K=n.useRef(null),U=n.useRef(null),{searchQuery:p,setSearchQuery:xe,isSearching:ye,searchResults:a,selectedGenres:W,setSelectedGenres:Ce,yearRange:q,setYearRange:P,selectedGroupings:J,setSelectedGroupings:y,groupingMatchModes:ve,setGroupingMatchModes:be,clearSearch:C,clearAll:je}=We(),[N,X]=De();n.useEffect(()=>{const e=N.get("year"),s=N.get("grouping");let o=!1;if(e){const r=parseInt(e,10);!isNaN(r)&&r>0&&(P({min:r,max:r}),o=!0)}if(s){const r=s.indexOf("_");if(r===-1)y(h=>({...h,[s]:["yes"]}));else{const h=s.substring(0,r),k=s.substring(r+1);y(Ye=>({...Ye,[h]:[k]}))}o=!0}o&&(i(!0),X({},{replace:!0}))},[N,X,P,y]),n.useEffect(()=>{(async()=>{try{const s=c.getState();if(s.years.length>0)Y(s.years);else{const o=await Z.getYears();Y(o)}}catch(s){ee.error("Failed to load filter values:",s)}})()},[]),n.useEffect(()=>{if(u){const s=window.matchMedia("(hover: hover) and (pointer: fine) and (min-width: 1024px)").matches?U:K;setTimeout(()=>{var o;if((o=s.current)==null||o.focus(),s.current){const r=s.current.value.length;s.current.setSelectionRange(r,r)}},50)}},[u]);const Ae=e=>{xe(e),e.trim().length>0&&!u&&i(!0)},Me=()=>{C()},Ie=()=>{i(!1),je()},Pe=e=>{V(e),g(!0)},Ne=e=>{Ce(e)},ke=e=>{P(e)},we=e=>{he(e),V("grouping"),g(!0)},Oe=(e,s)=>{y(o=>({...o,[e]:s}))},Te=(e,s)=>{be(o=>({...o,[e]:s}))},Ee=e=>{A(`/artist/${e}`),i(!1),C()},Ge=e=>{A(`/album/${e}`),i(!1),C()},Fe=e=>{re(e,[e])},Re=()=>{a!=null&&a.songs&&a.songs.length>0&&ae(a.songs)},Le=()=>{a!=null&&a.songs&&a.songs.length>0&&le(a.songs)},_e=e=>{A(`/playlist/${e}`),i(!1),C()},Qe=(e,s,o="mobile",r)=>{F(e),R(s),ue(o),ge(r||null),G(!0)};n.useEffect(()=>{p.trim()||L(0)},[l,p]),n.useEffect(()=>{H(te)},[m,d.length]),n.useEffect(()=>{const e=document.querySelector(".main-scrollable");if(!e)return;const s=()=>{const o=e.scrollTop,r=e.clientHeight,h=e.scrollHeight;o+r*1.5>=h&&H(k=>Math.min(k+Ze,d.length))};return e.addEventListener("scroll",s,{passive:!0}),()=>e.removeEventListener("scroll",s)},[d.length,z]),n.useEffect(()=>{p.trim()||(!x.current&&D.current!==l&&B(!0),D.current=l,Ve())},[m,l,p]),n.useEffect(()=>{x.current&&(x.current=!1)},[]);const Ve=async()=>{T("songs",!0);try{const e={limit:b,startIndex:m*b};l==="RecentlyAdded"?(e.sortBy=["DateCreated"],e.sortOrder="Descending"):(e.sortBy=["SortName"],e.sortOrder="Ascending");const s=await Z.getSongs(e);O(s.Items),Q(s.TotalRecordCount||0)}catch(e){ee.error("Failed to load songs:",e),O([]),Q(0)}finally{T("songs",!1),B(!1)}};return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"pb-20",children:[t.jsx("div",{className:`fixed top-0 left-0 right-0 bg-black z-10 lg:left-16 transition-[left,right] duration-300 ${j?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top))"},children:t.jsx("div",{className:"max-w-[768px] mx-auto",children:t.jsxs("div",{className:"p-4 min-[780px]:px-[0.66rem]",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsx("h1",{className:"text-2xl font-bold text-white",children:"Songs"}),t.jsx("button",{onClick:()=>i(!0),className:"w-10 h-10 flex items-center justify-center text-white hover:bg-zinc-800 rounded-full transition-colors","aria-label":"Search",children:t.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})]}),!u&&t.jsxs("div",{className:"flex items-center justify-between gap-2",children:[t.jsxs("button",{onClick:()=>ne("songs",l==="RecentlyAdded"?"Alphabetical":"RecentlyAdded"),className:"text-sm text-gray-400 hover:text-white transition-colors flex items-center gap-1",children:[l==="RecentlyAdded"?"Recently Added":"Alphabetically",t.jsx(Je,{className:"w-4 h-4"})]}),E.songs&&!x.current&&t.jsx("div",{className:"flex items-center",children:t.jsx(ze,{})})]})]})})}),t.jsx("div",{className:`fixed left-0 right-0 z-10 lg:left-16 transition-[left,right] duration-300 ${j?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 7rem - 8px)",height:"24px",background:"linear-gradient(to bottom, rgba(0, 0, 0, 0.8), transparent)"}}),t.jsx("div",{style:{paddingTop:"calc(env(safe-area-inset-top) + 7rem)"},children:t.jsx("div",{className:`${Se?"opacity-50 pointer-events-none":""} ${u?"hidden [@media((hover:hover)_and_(pointer:fine)_and_(min-width:1024px))]:block":""}`,children:d.length===0&&!E.songs?t.jsx("div",{className:"flex items-center justify-center py-16 text-gray-400",children:t.jsx("p",{children:"No songs found"})}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"space-y-0",children:d.map((e,s)=>t.jsx(Ke,{song:e,showImage:s<z,onContextMenu:Qe,contextMenuItemId:(f==null?void 0:f.Id)||null},e.Id))}),t.jsx(Ue,{currentPage:m,totalPages:Math.ceil(_/b),onPageChange:L,itemsPerPage:b,totalItems:_})]})})})]}),t.jsx(qe,{isOpen:u,onClose:Ie,searchQuery:p,onSearchChange:Ae,onClearSearch:Me,isLoading:ye,results:a,sections:Xe,filterConfig:{showGenreFilter:!0,showYearFilter:!0,showGroupingFilters:!0},filterState:{selectedGenres:W,yearRange:q,selectedGroupings:J},onOpenFilterSheet:Pe,groupingCategories:me,onOpenGroupingFilterSheet:we,onArtistClick:Ee,onAlbumClick:Ge,onSongClick:Fe,onPlaylistClick:_e,onPlayAllSongs:Re,onAddSongsToQueue:Le,isQueueSidebarOpen:j,desktopSearchInputRef:U,mobileSearchInputRef:K}),I==="genre"&&t.jsx(w,{isOpen:M,onClose:()=>g(!1),filterType:"genre",genres:oe,selectedValues:W,onApply:Ne}),I==="year"&&t.jsx(w,{isOpen:M,onClose:()=>g(!1),filterType:"year",availableYears:fe,yearRange:q,onApplyYear:ke}),I==="grouping"&&S&&t.jsx(w,{isOpen:M,onClose:()=>g(!1),filterType:"grouping",groupingCategory:S,selectedGroupingValues:J[S.key]||[],onApplyGrouping:Oe,groupingMatchMode:ve[S.key]||"or",onGroupingMatchModeChange:Te}),t.jsx(He,{item:f,itemType:pe,isOpen:ie,onClose:()=>{G(!1),F(null),R(null)},zIndex:99999,mode:ce,position:de||void 0})]})}export{ct as default};
