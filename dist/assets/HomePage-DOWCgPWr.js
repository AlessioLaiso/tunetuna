import{c as Ee,r as n,u as _,g as Te,a as de,b as ne,d as _e,j as e,S as We,l as be,e as U,I as Ce,C as we,f as Ue,D as Me,h as je,i as Ve,F as Se,k as Xe,m as Qe,P as De,n as qe,o as Oe,p as ze,q as ve,s as Je,M as Ke}from"./index-Cd7_tvNc.js";import{S as Ze}from"./search-DU52e0J2.js";import{u as et,F as Ae}from"./useSearch-DqWqC4MG.js";import{C as tt,a as st}from"./chevron-right-D5vpBqml.js";import{E as nt}from"./ellipsis-DErI59CM.js";import"./tag-BuedTwWn.js";import"./piano-Bjwssuqk.js";/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lt=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],it=Ee("search",lt);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const at=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],rt=Ee("settings",at),ot=[{type:"artists",limit:5},{type:"albums",limit:12},{type:"playlists"},{type:"songs"}];function ct({onSearchStateChange:t,title:r="Search"}){const[i,a]=n.useState(!1),u=n.useRef(null),p=n.useRef(null),[x,d]=n.useState(!1),[l,o]=n.useState(null),[c,g]=n.useState(null),{genres:h,songs:f}=_(),[A,C]=n.useState([]),v=n.useMemo(()=>Te(f),[f]),{playAlbum:N,addToQueue:R,playTrack:E,shuffleAllSongs:L,isQueueSidebarOpen:G}=de(),[s,w]=n.useState(!1),{searchQuery:$,setSearchQuery:F,isSearching:P,searchResults:T,selectedGenres:D,setSelectedGenres:Z,yearRange:Q,setYearRange:le,selectedGroupings:J,setSelectedGroupings:ue,groupingMatchModes:K,setGroupingMatchModes:ee,clearSearch:W,clearAll:fe}=et({debounceMs:300});n.useEffect(()=>{if(s){const b=setTimeout(()=>{w(!1)},1e4);return()=>clearTimeout(b)}},[s]);const V=ne(),[te,se]=_e();n.useEffect(()=>{const b=te.get("yearMin"),I=te.get("yearMax"),z=te.get("genre");let X=!1;(b||I)&&(le({min:b?parseInt(b,10):null,max:I?parseInt(I,10):null}),X=!0),z&&(Z([z]),X=!0),X&&(a(!0),se({},{replace:!0}))},[]),n.useEffect(()=>{(async()=>{try{const I=_.getState();if(I.years.length>0)C(I.years);else{const z=await U.getYears();C(z)}}catch(I){be.error("Failed to load filter values:",I)}})()},[]);const pe=b=>{F(b),b.trim().length>0&&!i&&a(!0)},ie=b=>{V(`/artist/${b}`),a(!1),W()},j=b=>{V(`/album/${b}`),a(!1),W()},H=b=>{E(b,[b])},M=b=>{V(`/playlist/${b}`),a(!1),W()},B=()=>{W()},m=()=>{a(!1),fe()},O=b=>{o(b),d(!0)},S=b=>{Z(b)},k=b=>{le(b)},y=b=>{g(b),o("grouping"),d(!0)},q=(b,I)=>{ue(z=>({...z,[b]:I}))},ae=(b,I)=>{ee(z=>({...z,[b]:I}))},xe=()=>{T!=null&&T.songs&&T.songs.length>0&&N(T.songs)},re=()=>{T!=null&&T.songs&&T.songs.length>0&&R(T.songs)},oe=i;return n.useEffect(()=>{t&&t(oe)},[oe,t]),n.useEffect(()=>{if(i){const I=window.matchMedia("(hover: hover) and (pointer: fine) and (min-width: 1024px)").matches?p:u;setTimeout(()=>{var z;if((z=I.current)==null||z.focus(),I.current){const X=I.current.value.length;I.current.setSelectionRange(X,X)}},50)}},[i]),n.useEffect(()=>{if(!i)return;const b=I=>{I.key==="Escape"&&(I.preventDefault(),I.stopPropagation(),m())};return window.addEventListener("keydown",b,!0),()=>window.removeEventListener("keydown",b,!0)},[i]),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"px-4 md:pl-2 md:pr-4 pt-4 pb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Tunetuna"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:async()=>{const b=de.getState(),{isShuffleAllActive:I,isShuffleGenreActive:z}=b;if(!(s||I||z)){w(!0);try{await L()}catch(X){be.error("Home shuffle button - shuffleAllSongs failed:",X),be.error("Shuffle all failed:",X)}finally{w(!1)}}},disabled:s,className:"w-10 h-10 flex items-center justify-center text-white hover:bg-zinc-800 rounded-full transition-colors disabled:opacity-50","aria-label":"Shuffle all songs",children:s?e.jsx("div",{className:"w-5 h-5 border-2 border-zinc-400 border-t-white rounded-full animate-spin"}):e.jsx(We,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>a(!0),className:"w-10 h-10 flex items-center justify-center text-white hover:bg-zinc-800 rounded-full transition-colors","aria-label":"Search",children:e.jsx(it,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>V("/settings"),className:"w-10 h-10 flex items-center justify-center text-white hover:bg-zinc-800 rounded-full transition-colors","aria-label":"Settings",children:e.jsx(rt,{className:"w-5 h-5"})})]})]})}),e.jsx(Ze,{isOpen:i,onClose:m,title:r,searchQuery:$,onSearchChange:pe,onClearSearch:B,isLoading:P,results:T,sections:ot,filterConfig:{showGenreFilter:!0,showYearFilter:!0,showGroupingFilters:!0},filterState:{selectedGenres:D,yearRange:Q,selectedGroupings:J},onOpenFilterSheet:O,groupingCategories:v,onOpenGroupingFilterSheet:y,onArtistClick:ie,onAlbumClick:j,onSongClick:H,onPlaylistClick:M,onPlayAllSongs:xe,onAddSongsToQueue:re,isQueueSidebarOpen:G,desktopSearchInputRef:p,mobileSearchInputRef:u}),l==="genre"&&e.jsx(Ae,{isOpen:x,onClose:()=>d(!1),filterType:"genre",genres:h,selectedValues:D,onApply:S}),l==="year"&&e.jsx(Ae,{isOpen:x,onClose:()=>d(!1),filterType:"year",availableYears:A,yearRange:Q,onApplyYear:k}),l==="grouping"&&c&&e.jsx(Ae,{isOpen:x,onClose:()=>d(!1),filterType:"grouping",groupingCategory:c,selectedGroupingValues:J[c.key]||[],onApplyGrouping:q,groupingMatchMode:K[c.key]||"or",onGroupingMatchModeChange:ae})]})}function Ne({moodValue:t,moodName:r,albumId:i}){const a=ne(),{recordMoodAccess:u}=_(),p=()=>{u(t),a(`/mood/${encodeURIComponent(t)}`)};return e.jsxs("button",{onClick:p,className:"bg-zinc-800/50 rounded border border-zinc-700/50 hover:bg-zinc-800 transition-colors group text-left flex items-center w-full h-11 overflow-hidden",children:[i&&e.jsx("div",{className:"h-full flex-shrink-0 hidden md:block",children:e.jsx(Ce,{src:U.getAlbumArtUrl(i,56),alt:"",className:"w-full h-full object-cover",showOutline:!1,rounded:""})}),e.jsx("div",{className:"text-sm font-medium text-white group-hover:text-[var(--accent-color)] transition-colors truncate py-2 pl-3",children:r})]})}function Le({children:t,className:r="",gap:i=12}){const a=n.useRef(null),[u,p]=n.useState(!1),[x,d]=n.useState(!1),[l,o]=n.useState(!1),c=()=>{if(!a.current)return;const{scrollLeft:h,scrollWidth:f,clientWidth:A}=a.current;p(h>0),d(h+A<f-1)};n.useEffect(()=>{c();const h=a.current;if(h)return h.addEventListener("scroll",c,{passive:!0}),window.addEventListener("resize",c),()=>{h.removeEventListener("scroll",c),window.removeEventListener("resize",c)}},[t]);const g=h=>{if(!a.current)return;const f=a.current,A=f.clientWidth+i;f.scrollBy({left:h==="left"?-A:A,behavior:"smooth"})};return e.jsxs("div",{className:"relative",onMouseEnter:()=>o(!0),onMouseLeave:()=>o(!1),children:[e.jsx("div",{ref:a,className:`overflow-x-auto scrollbar-hide ${r}`,style:{scrollbarWidth:"none",msOverflowStyle:"none"},children:t}),u&&l&&e.jsx("button",{onClick:()=>g("left"),className:"absolute left-0 top-1/2 -translate-y-1/2 z-10 w-10 h-10 flex items-center justify-center bg-black/70 hover:bg-black/90 rounded-full transition-colors","aria-label":"Scroll left",children:e.jsx(tt,{className:"w-6 h-6 text-white"})}),x&&l&&e.jsx("button",{onClick:()=>g("right"),className:"absolute right-0 top-1/2 -translate-y-1/2 z-10 w-10 h-10 flex items-center justify-center bg-black/70 hover:bg-black/90 rounded-full transition-colors","aria-label":"Scroll right",children:e.jsx(st,{className:"w-6 h-6 text-white"})}),e.jsx("style",{children:`
        .scrollbar-hide::-webkit-scrollbar {
          display: none;
        }
      `})]})}function dt(t){let r=0;for(let i=0;i<t.length;i++){const a=t.charCodeAt(i);r=(r<<5)-r+a,r=r&r}return r}function ut(t){const r=new Date().toISOString().split("T")[0];return dt(`${r}-${t}`)}function ft(t){return t?t.charAt(0).toUpperCase()+t.slice(1):""}function mt(t,r,i){const a=r.filter(l=>{var o;return(o=l.Grouping)==null?void 0:o.some(c=>c.toLowerCase()===`mood_${t.toLowerCase()}`)});if(a.length===0)return null;const u=a.filter(l=>l.AlbumId);if(u.length===0)return null;let p=u.filter(l=>!i.has(l.AlbumId));p.length===0&&(p=u);const x=ut(t),d=Math.abs(x)%p.length;return p[d].AlbumId}function ht(t,r){return[...t].sort((i,a)=>{const u=r[i.toLowerCase()]||0,p=r[a.toLowerCase()]||0;return u!==p?p-u:i.localeCompare(a)})}function $e(t,r){const i=Math.ceil(t.length/r),a=[];for(let u=0;u<i;u++)for(let p=0;p<r;p++){const x=p*i+u;x<t.length&&a.push(t[x])}return a}function pt(){const{songs:t,recentlyAccessedMoods:r}=_(),i=n.useRef(null),a=n.useMemo(()=>Te(t).find(l=>l.key==="mood"),[t]),u=n.useMemo(()=>{if(!a||a.values.length===0)return[];const d=ht(a.values,r),l=new Set;return d.map(o=>{const c=mt(o.toLowerCase(),t,l);return c&&l.add(c),{value:o.toLowerCase(),name:ft(o),albumId:c}})},[a,t,r]);if(u.length===0)return null;const p=6,x=[];for(let d=0;d<u.length;d+=p)x.push(u.slice(d,d+p));return e.jsxs("div",{className:"px-4 mb-12",children:[e.jsx("div",{className:"md:hidden",children:e.jsx("div",{ref:i,className:"overflow-x-auto snap-x snap-mandatory scrollbar-hide",style:{scrollbarWidth:"none",msOverflowStyle:"none"},children:e.jsx("div",{className:"flex gap-2",children:x.map((d,l)=>{const o=Math.ceil(d.length/3);return e.jsx("div",{className:"snap-start flex-shrink-0",style:{width:"calc(100% - 8px)"},children:e.jsx("div",{className:"grid grid-cols-3 gap-2",style:{gridTemplateRows:`repeat(${o}, minmax(0, 1fr))`},children:d.map(c=>e.jsx(Ne,{moodValue:c.value,moodName:c.name,albumId:c.albumId},c.value))})},l)})})})}),e.jsx("div",{className:"hidden md:block min-[1680px]:hidden",children:e.jsx(Le,{gap:8,children:e.jsx("div",{className:"grid grid-rows-2 grid-flow-col gap-2",style:{gridAutoColumns:"calc((100% - 24px) / 4)"},children:$e(u,2).map(d=>e.jsx(Ne,{moodValue:d.value,moodName:d.name,albumId:d.albumId},d.value))})})}),e.jsx("div",{className:"hidden min-[1680px]:block",children:e.jsx(Le,{gap:8,children:e.jsx("div",{className:"grid grid-rows-2 grid-flow-col gap-2",style:{gridAutoColumns:"calc((100% - 32px) / 5)"},children:$e(u,2).map(d=>e.jsx(Ne,{moodValue:d.value,moodName:d.name,albumId:d.albumId},d.value))})})}),e.jsx("style",{children:`
        .scrollbar-hide::-webkit-scrollbar {
          display: none;
        }
      `})]})}function ke(){return e.jsxs("div",{children:[e.jsx("div",{className:"aspect-square rounded bg-zinc-800 mb-2"}),e.jsx("div",{className:"h-3.5 bg-zinc-800 rounded w-3/4 mb-1.5"}),e.jsx("div",{className:"h-3 bg-zinc-800 rounded w-1/2"})]})}function xt(){return e.jsxs("div",{className:"px-4 mb-8 animate-pulse",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Recently Added"}),e.jsx("div",{className:"md:hidden",children:e.jsx("div",{className:"grid grid-cols-3 gap-3",children:[...Array(6)].map((t,r)=>e.jsx(ke,{},r))})}),e.jsx("div",{className:"hidden md:block min-[1680px]:hidden",children:e.jsx("div",{className:"grid grid-cols-4 gap-3",children:[...Array(8)].map((t,r)=>e.jsx(ke,{},r))})}),e.jsx("div",{className:"hidden min-[1680px]:block",children:e.jsx("div",{className:"grid grid-cols-5 gap-3",children:[...Array(10)].map((t,r)=>e.jsx(ke,{},r))})})]})}function Ie({album:t,onNavigate:r,onContextMenu:i}){var c,g,h,f,A,C,v,N,R,E,L,G;const a=ne(),[u,p]=n.useState(!1),x=n.useRef(!1),d=s=>{if(x.current){x.current=!1;return}r(t.Id)},l=s=>{s.preventDefault(),s.stopPropagation(),x.current=!0,i(t,"desktop",{x:s.clientX,y:s.clientY}),setTimeout(()=>{x.current=!1},300)},o=Ue({onLongPress:s=>{s.preventDefault(),x.current=!0,i(t,"mobile")},onClick:()=>{if(x.current){x.current=!1;return}d()}});return e.jsxs("button",{onClick:()=>{if(x.current){x.current=!1;return}d()},onContextMenu:l,...o,className:"text-left group",children:[e.jsx("div",{className:"aspect-square rounded overflow-hidden mb-2 bg-zinc-900 flex items-center justify-center",children:u?e.jsx(Me,{className:"w-12 h-12 text-gray-500"}):e.jsx(Ce,{src:U.getAlbumArtUrl(t.Id,474),alt:t.Name,className:"w-full h-full object-cover",showOutline:!0,rounded:"rounded",onError:()=>p(!0)})}),e.jsx("div",{className:"text-sm font-medium text-white truncate group-hover:text-[var(--accent-color)] transition-colors",children:t.Name}),e.jsx("div",{className:"text-xs text-gray-400 truncate",children:(g=(c=t.AlbumArtists)==null?void 0:c[0])!=null&&g.Id||(f=(h=t.ArtistItems)==null?void 0:h[0])!=null&&f.Id?e.jsx("span",{className:"clickable-text",onMouseDown:s=>s.stopPropagation(),onClick:s=>{var w,$;s.stopPropagation(),a(`/artist/${(($=(w=t.AlbumArtists)==null?void 0:w[0])==null?void 0:$.Id)||t.ArtistItems[0].Id}`)},children:t.AlbumArtist||((C=(A=t.AlbumArtists)==null?void 0:A[0])==null?void 0:C.Name)||((N=(v=t.ArtistItems)==null?void 0:v[0])==null?void 0:N.Name)||"Unknown Artist"}):t.AlbumArtist||((E=(R=t.AlbumArtists)==null?void 0:R[0])==null?void 0:E.Name)||((G=(L=t.ArtistItems)==null?void 0:L[0])==null?void 0:G.Name)||"Unknown Artist"})]})}function gt(){const{recentlyAdded:t,setRecentlyAdded:r,setLoading:i,loading:a}=_(),u=ne(),p=n.useRef(null),[x,d]=n.useState(!1),[l,o]=n.useState("mobile"),[c,g]=n.useState(null),[h,f]=n.useState(null);if(n.useEffect(()=>{(async()=>{i("recentlyAdded",!0);try{const N=await U.getRecentlyAdded(18);r(N.Items||[])}catch(N){be.error("Failed to load recently added:",N)}finally{i("recentlyAdded",!1)}})()},[r,i]),!t||t.length===0)return a.recentlyAdded?e.jsx(xt,{}):null;const A=6,C=[];for(let v=0;v<t.length;v+=A)C.push(t.slice(v,v+A));return e.jsxs("div",{className:"px-4 mb-8",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Recently Added"}),e.jsx("div",{className:"md:hidden",children:e.jsx("div",{ref:p,className:"overflow-x-auto snap-x snap-mandatory scrollbar-hide",style:{scrollbarWidth:"none",msOverflowStyle:"none"},children:e.jsx("div",{className:"flex gap-3",children:C.map((v,N)=>{const R=Math.ceil(v.length/3);return e.jsx("div",{className:"snap-start flex-shrink-0",style:{width:"calc(100% - 12px)"},children:e.jsx("div",{className:"grid grid-cols-3 gap-3",style:{gridTemplateRows:`repeat(${R}, minmax(0, 1fr))`},children:v.map(E=>e.jsx(Ie,{album:E,onNavigate:L=>u(`/album/${L}`),onContextMenu:(L,G,s)=>{f(L),o(G||"desktop"),g(s||null),d(!0)}},E.Id))})},N)})})})}),e.jsx("div",{className:"hidden md:block min-[1680px]:hidden",children:e.jsx("div",{className:"grid grid-cols-4 gap-3",children:t.slice(0,8).map(v=>e.jsx(Ie,{album:v,onNavigate:N=>u(`/album/${N}`),onContextMenu:(N,R,E)=>{f(N),o(R||"desktop"),g(E||null),d(!0)}},v.Id))})}),e.jsx("div",{className:"hidden min-[1680px]:block",children:e.jsx("div",{className:"grid grid-cols-5 gap-3",children:t.slice(0,10).map(v=>e.jsx(Ie,{album:v,onNavigate:N=>u(`/album/${N}`),onContextMenu:(N,R,E)=>{f(N),o(R||"desktop"),g(E||null),d(!0)}},v.Id))})}),e.jsx("style",{children:`
        .scrollbar-hide::-webkit-scrollbar {
          display: none;
        }
      `}),e.jsx(we,{item:h,itemType:"album",isOpen:x,onClose:()=>{d(!1),f(null)},zIndex:999999,mode:l,position:c||void 0})]})}function yt(){const[t,r]=n.useState(()=>_.persist.hasHydrated());return n.useEffect(()=>{if(_.persist.hasHydrated()){r(!0);return}return _.persist.onFinishHydration(()=>{r(!0)})},[]),t}function ce(t){return t.toLowerCase().replace(/[^a-z0-9]/g,"")}function ye(t){return t.replace(/\s*\(feat\..*?\)/gi,"").replace(/\s*\[feat\..*?\]/gi,"").replace(/\s*ft\..*$/gi,"").replace(/\s*\(with.*?\)/gi,"").replace(/\s*\[with.*?\]/gi,"").replace(/\s*\(explicit\)/gi,"").replace(/\s*\[explicit\]/gi,"").replace(/\s*\(deluxe.*?\)/gi,"").replace(/\s*\[deluxe.*?\]/gi,"").replace(/\s*-\s*single$/gi,"").replace(/\s*-\s*ep$/gi,"").trim()}function Fe(t){return t.split(/[,&]/)[0].replace(/\s*feat\..*$/gi,"").replace(/\s*ft\..*$/gi,"").replace(/\s*with\s+.*$/gi,"").trim()}function Be(){const t=_(l=>l.songs),r=_(l=>l.genreSongs),i=yt(),a=n.useMemo(()=>{var c,g;if(!i)return new Map;let l=t;if(l.length===0&&r){const h=new Set;l=Object.values(r).flat().filter(f=>h.has(f.Id)?!1:(h.add(f.Id),!0))}const o=new Map;for(const h of l){const f=ce(Fe(h.AlbumArtist||((g=(c=h.ArtistItems)==null?void 0:c[0])==null?void 0:g.Name)||""));f&&(o.has(f)||o.set(f,[]),o.get(f).push(h))}return o},[t,r,i]),u=l=>{const o=ce(Fe(l));if(!o)return null;if(a.has(o))return a.get(o);for(const[c,g]of a)if(c.includes(o)||o.includes(c))return g;return null};return{findSong:(l,o)=>{const c=u(o);if(!c)return null;const g=ce(ye(l));if(!g)return null;for(const h of c){const f=ce(ye(h.Name||""));if(f===g||f.includes(g)||g.includes(f))return h}return null},findAlbum:(l,o)=>{const c=u(o);if(!c)return null;const g=ce(ye(l));if(!g)return null;for(const h of c){if(!h.AlbumId||!h.Album)continue;const f=ce(ye(h.Album));if(f===g||f.includes(g)||g.includes(f))return{albumId:h.AlbumId,albumName:h.Album}}return null},findArtistImageUrl:l=>{var g,h,f;const o=u(l);return!o||o.length===0?null:((f=(h=(g=o[0])==null?void 0:g.ArtistItems)==null?void 0:h[0])==null?void 0:f.Id)||null},artistIndex:a}}function he({title:t,subtitle:r,subtitleParts:i,artworkUrl:a,fallbackArtworkUrl:u,secondFallbackUrl:p,rank:x,isCurrentTrack:d,isInLibrary:l,isMenuOpen:o,subtitleIcon:c,paddingRight:g=!1,imageLoading:h="lazy",onClick:f,onContextMenu:A,onLongPress:C,onExternalClick:v}){const[N,R]=n.useState(!1),[E,L]=n.useState(!1),[G,s]=n.useState(!1);n.useEffect(()=>{R(!1),L(!1),s(!1)},[a]);let w=a;G&&p?w=p:E&&u&&(w=u);const $=()=>{!E&&u?L(!0):!G&&p?s(!0):R(!0)},F=Ue({onLongPress:P=>{P.preventDefault(),C==null||C(P)},onClick:P=>f(P)});return e.jsxs("button",{onClick:P=>f(P),onContextMenu:A,...F,className:`w-full flex items-center gap-2 hover:bg-white/10 transition-colors group py-2.5 ${o?"bg-white/10":""} ${g?"pr-4":""}`,children:[e.jsx("div",{className:"w-12 h-12 rounded-sm overflow-hidden flex-shrink-0 bg-zinc-900 self-center flex items-center justify-center",children:N?e.jsx(Me,{className:"w-6 h-6 text-gray-500"}):e.jsx(Ce,{src:w,alt:t,className:"w-full h-full object-cover",showOutline:!0,rounded:"rounded-sm",loading:h,onError:$})}),e.jsxs("div",{className:"flex-1 min-w-0 text-left flex gap-3 items-baseline",children:[x!==void 0&&e.jsx("span",{className:"text-zinc-500 text-sm flex-shrink-0 w-5 text-right",children:x}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium truncate text-white group-hover:text-[var(--accent-color)] transition-colors",children:t}),e.jsxs("div",{className:"text-xs text-gray-400 flex items-center gap-1.5 min-w-0",children:[e.jsx("span",{className:"truncate",children:i?i.map((P,T)=>P.onClick?e.jsx("span",{className:"clickable-text",onMouseDown:D=>D.stopPropagation(),onClick:D=>{D.stopPropagation(),P.onClick(D)},children:P.text},T):e.jsx("span",{children:P.text},T)):r}),c&&e.jsx("span",{className:"flex-shrink-0",children:c})]})]})]}),!l&&v&&e.jsx("div",{onClick:P=>{P.stopPropagation(),v(P)},className:"flex-shrink-0 p-2 text-gray-400 hover:text-white cursor-pointer",children:e.jsx(nt,{className:"w-4 h-4"})})]})}function Pe(){return e.jsx("div",{className:"animate-pulse",children:[...Array(5)].map((t,r)=>e.jsxs("div",{className:"flex items-center gap-3 py-2.5",children:[e.jsx("div",{className:"w-12 h-12 rounded-sm bg-zinc-800"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-4 bg-zinc-800 rounded w-3/4 mb-1.5"}),e.jsx("div",{className:"h-3 bg-zinc-800 rounded w-1/2"})]})]},r))})}function bt(){const t=ne(),{playTrack:r}=de(),{feedTopSongs:i,feedLastUpdated:a,loading:u,setFeedTopSongs:p,setFeedLastUpdated:x,setLoading:d}=_(),{feedCountry:l,showTop10:o}=je(),{findSong:c}=Be(),[g,h]=n.useState(!1),[f,A]=n.useState("mobile"),[C,v]=n.useState(null),[N,R]=n.useState(null),[E,L]=n.useState(!1),[G,s]=n.useState(!1),[w,$]=n.useState(null),[F,P]=n.useState(null),[T,D]=n.useState(!1),[Z,Q]=n.useState("mobile"),[le,J]=n.useState(null),[ue,K]=n.useState(null),[ee,W]=n.useState(null),fe=n.useCallback(async(j=!1)=>{const H=Date.now();if(!(!j&&a&&H-a<Se)){d("feed",!0),s(!1);try{const M=await Xe(l,10);p(M),x(H)}catch(M){console.error("Failed to fetch top songs:",M),s(!0)}finally{d("feed",!1)}}},[l,a,p,x,d]);n.useEffect(()=>{if(o){const j=Date.now();(!a||j-a>=Se)&&fe(!0)}},[o,l]);const V=async(j,H,M)=>{if(H){const B=await U.getSongById(H.Id);B&&r(B)}else await te(j,M)},te=async(j,H)=>{const M=!window.matchMedia("(hover: hover) and (pointer: fine)").matches;A(M?"mobile":"desktop"),M||v({x:H.clientX,y:H.clientY}),$(j.name),P(j.id),L(!0),h(!0);try{const B=await ze(j.url);if(B&&Object.keys(B.linksByPlatform).length>0)R(B);else{const m=ve(j.artistName,j.name);R(m)}}catch{const B=ve(j.artistName,j.name);R(B)}finally{L(!1)}};if(!o)return null;const se=i.length>0,ie=u.feed&&!se&&!G;return e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-xl font-bold mb-2",children:"Top 10"}),ie?e.jsx(Pe,{}):se?e.jsx("div",{className:"space-y-0",children:i.map((j,H)=>{var S,k;const M=c(j.name,j.artistName),B=M!==null,m=(k=(S=M==null?void 0:M.ArtistItems)==null?void 0:S[0])==null?void 0:k.Id,O=B&&m?[{text:j.artistName,onClick:()=>t(`/artist/${m}`)}]:void 0;return e.jsx(he,{rank:H+1,title:j.name,subtitle:j.artistName,subtitleParts:O,artworkUrl:B&&M.AlbumId?U.getAlbumArtUrl(M.AlbumId,96):Qe(j.artworkUrl100,96),isInLibrary:B,isMenuOpen:ee===j.id||F===j.id&&g,onClick:y=>V(j,M,y),onContextMenu:async y=>{if(y.preventDefault(),M){const q=await U.getSongById(M.Id);q&&(K(q),W(j.id),Q("desktop"),J({x:y.clientX,y:y.clientY}),D(!0))}},onLongPress:async()=>{if(M){const y=await U.getSongById(M.Id);y&&(K(y),W(j.id),Q("mobile"),J(null),D(!0))}},onExternalClick:y=>te(j,y)},j.id)})}):e.jsx("div",{className:"py-8 text-left text-gray-500 text-sm",children:"Could not load charts"}),e.jsx(De,{isOpen:g,onClose:()=>{h(!1),R(null),P(null)},odesliData:N,loading:E,title:w||void 0,mode:f,position:C||void 0}),e.jsx(we,{item:ue,itemType:"song",isOpen:T,onClose:()=>{D(!1),K(null),W(null)},zIndex:99999,mode:Z,position:le||void 0})]})}function St(){const t=ne(),{playTrack:r}=de(),{feedNewReleases:i,feedLastUpdated:a,loading:u,setFeedNewReleases:p,setFeedLastUpdated:x,setLoading:d}=_(),{showNewReleases:l,muspyRssUrl:o}=je(),{findAlbum:c,findSong:g,findArtistImageUrl:h}=Be(),[f,A]=n.useState(!1),[C,v]=n.useState("mobile"),[N,R]=n.useState(null),[E,L]=n.useState(null),[G,s]=n.useState(!1),[w,$]=n.useState(!1),[F,P]=n.useState(null),[T,D]=n.useState(null),[Z,Q]=n.useState(!1),[le,J]=n.useState("mobile"),[ue,K]=n.useState(null),[ee,W]=n.useState(null),[fe,V]=n.useState(null),te=n.useCallback(async(m=!1)=>{if(!o)return;const O=Date.now();if(!(!m&&a&&O-a<Se)){d("feed",!0),$(!1);try{const S=await qe(o,10);p(S),x(O)}catch(S){console.error("Failed to fetch Muspy releases:",S),$(!0)}finally{d("feed",!1)}}},[o,a,p,x,d]);n.useEffect(()=>{if(l&&o){const m=Date.now();(!a||m-a>=Se)&&te(!0)}},[l,o]),n.useEffect(()=>{i.forEach(m=>{if(!m.id.startsWith("muspy-")){const O=new window.Image;O.src=Oe(m.id,250)}})},[i]);const se=n.useRef(new Set);n.useEffect(()=>{const m=async()=>{const O=i.filter(S=>S.id.startsWith("muspy-")&&!se.current.has(S.id));if(O.length!==0)for(const S of O){se.current.add(S.id);try{console.log(`[FeedSection] Searching MB for: ${S.title} - ${S.artistName}`);const k=await Je(S.artistName,S.title);if(k){console.log(`[FeedSection] Found MBID for "${S.title}": ${k.id} (${k.type})`);const q=_.getState().feedNewReleases.map(ae=>ae.id===S.id?{...ae,id:k.id,type:k.type}:ae);p(q)}else console.log(`[FeedSection] No MBID found for "${S.title}"`)}catch(k){console.error(`[FeedSection] Failed to search MB for "${S.title}":`,k)}}};i.length>0&&m()},[i,p]);const pe=async(m,O,S)=>{if(O)if(O.type==="song"){const k=await U.getSongById(O.song.Id);k&&r(k)}else t(`/album/${O.albumId}`);else await ie(m,S)},ie=async(m,O)=>{const S=!window.matchMedia("(hover: hover) and (pointer: fine)").matches;v(S?"mobile":"desktop"),S||R({x:O.clientX,y:O.clientY}),P(m.title),D(m.id),s(!0),A(!0);const k=m.mbUrl&&!m.id.startsWith("muspy-");try{let y=null;if(k&&(y=await ze(m.mbUrl)),y&&Object.keys(y.linksByPlatform).length>0)L(y);else{const q=ve(m.artistName,m.title);L(q)}}catch{const y=ve(m.artistName,m.title);L(y)}finally{s(!1)}};if(!l||!o)return null;const j=i.length>0,H=u.feed,M=!!o,B=H&&!j&&!w&&M;return e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-xl font-bold mb-2",children:"New Releases"}),B?e.jsx(Pe,{}):j?e.jsx("div",{className:"space-y-0",children:i.map(m=>{const O=m.type==="Single",S=O?g(m.title,m.artistName):null,k=S?null:c(m.title,m.artistName),y=S?{type:"song",song:S}:k?{type:"album",albumId:k.albumId}:null,q=y!==null,xe=!m.id.startsWith("muspy-")?Oe(m.id,250):null,re=h(m.artistName),oe=re?U.getArtistImageUrl(re,96):null,b=(y==null?void 0:y.type)==="song"&&(S!=null&&S.AlbumId)?U.getAlbumArtUrl(S.AlbumId,96):(y==null?void 0:y.type)==="album"&&(k!=null&&k.albumId)?U.getAlbumArtUrl(k.albumId,96):null;let I,z,X;xe?(I=xe,z=b||void 0,X=oe||void 0):b?(I=b,z=oe||void 0):I=oe||"";const Re=new Date(m.releaseDate),ge=!isNaN(Re.getTime())?Re.toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",Ge=ge?`${m.artistName} • ${ge}`:m.artistName,He=O?e.jsx(Ke,{className:"w-3 h-3"}):e.jsx(Me,{className:"w-3 h-3"}),Ye=q&&re?[{text:m.artistName,onClick:()=>t(`/artist/${re}`)},...ge?[{text:` • ${ge}`}]:[]]:void 0;return e.jsx(he,{title:m.title,subtitle:Ge,subtitleParts:Ye,subtitleIcon:He,artworkUrl:I,fallbackArtworkUrl:z,secondFallbackUrl:X,isInLibrary:q,imageLoading:"eager",isMenuOpen:fe===m.id||T===m.id&&f,onClick:Y=>pe(m,y,Y),onContextMenu:async Y=>{if(Y.preventDefault(),(y==null?void 0:y.type)==="song"&&S){const me=await U.getSongById(S.Id);me&&(W(me),V(m.id),J("desktop"),K({x:Y.clientX,y:Y.clientY}),Q(!0))}else if((y==null?void 0:y.type)==="album"&&k){const me=await U.getAlbumById(k.albumId);me&&(W(me),V(m.id),J("desktop"),K({x:Y.clientX,y:Y.clientY}),Q(!0))}},onLongPress:async()=>{if((y==null?void 0:y.type)==="song"&&S){const Y=await U.getSongById(S.Id);Y&&(W(Y),V(m.id),J("mobile"),K(null),Q(!0))}else if((y==null?void 0:y.type)==="album"&&k){const Y=await U.getAlbumById(k.albumId);Y&&(W(Y),V(m.id),J("mobile"),K(null),Q(!0))}},onExternalClick:Y=>ie(m,Y)},m.id)})}):M?e.jsx("div",{className:"py-8 text-left text-gray-500 text-sm",children:w?"Failed to load releases":"No new releases found"}):e.jsx("div",{className:"py-8 text-center text-gray-500 text-sm",children:"Configure Muspy RSS in settings"}),e.jsx(De,{isOpen:f,onClose:()=>{A(!1),L(null),D(null)},odesliData:E,loading:G,title:F||void 0,mode:C,position:N||void 0}),e.jsx(we,{item:ee,itemType:(ee==null?void 0:ee.Type)==="Audio"?"song":"album",isOpen:Z,onClose:()=>{Q(!1),W(null),V(null)},zIndex:99999,mode:le,position:ue||void 0})]})}function vt({twoColumns:t=!1}){const r=ne(),{recentlyPlayed:i,loading:a,setRecentlyPlayed:u,setLoading:p}=_(),{showRecentlyPlayed:x}=je(),{playTrack:d}=de(),l=Ve(),[o,c]=n.useState(!1),[g,h]=n.useState("mobile"),[f,A]=n.useState(null),[C,v]=n.useState(null);n.useEffect(()=>{x&&(async()=>{p("recentlyPlayed",!0);try{const w=await U.getRecentlyPlayed(10);u(w.Items||[])}catch(w){console.error(w)}finally{p("recentlyPlayed",!1)}})()},[x,u,p]);const N=s=>{d(s,i)},R=s=>{var P,T,D,Z;const w=[],$=s.AlbumArtist||((T=(P=s.ArtistItems)==null?void 0:P[0])==null?void 0:T.Name)||"Unknown Artist",F=(Z=(D=s.ArtistItems)==null?void 0:D[0])==null?void 0:Z.Id;return w.push({text:$,onClick:F?()=>r(`/artist/${F}`):void 0}),s.Album&&(w.push({text:" • "}),w.push({text:s.Album,onClick:s.AlbumId?()=>r(`/album/${s.AlbumId}`):void 0})),w};if(!x)return null;const E=i&&i.length>0,G=a.recentlyPlayed&&!E;return e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-xl font-bold mb-2",children:"Recently Played"}),G?e.jsx(Pe,{}):E?e.jsx("div",{className:t?"md:grid md:grid-cols-2 md:gap-3 min-[1680px]:block":"",children:t?e.jsxs(e.Fragment,{children:[e.jsx("div",{children:i.slice(0,5).map(s=>{var w,$;return e.jsx(he,{title:s.Name||"Unknown",subtitle:`${s.AlbumArtist||(($=(w=s.ArtistItems)==null?void 0:w[0])==null?void 0:$.Name)||"Unknown Artist"}${s.Album?` • ${s.Album}`:""}`,subtitleParts:R(s),artworkUrl:U.getAlbumArtUrl(s.AlbumId||s.Id,96),isCurrentTrack:(l==null?void 0:l.Id)===s.Id,isInLibrary:!0,isMenuOpen:(C==null?void 0:C.Id)===s.Id,paddingRight:!0,onClick:()=>N(s),onContextMenu:F=>{F.preventDefault(),v(s),h("desktop"),A({x:F.clientX,y:F.clientY}),c(!0)},onLongPress:()=>{v(s),h("mobile"),A(null),c(!0)}},s.Id)})}),e.jsx("div",{children:i.slice(5,10).map(s=>{var w,$;return e.jsx(he,{title:s.Name||"Unknown",subtitle:`${s.AlbumArtist||(($=(w=s.ArtistItems)==null?void 0:w[0])==null?void 0:$.Name)||"Unknown Artist"}${s.Album?` • ${s.Album}`:""}`,subtitleParts:R(s),artworkUrl:U.getAlbumArtUrl(s.AlbumId||s.Id,96),isCurrentTrack:(l==null?void 0:l.Id)===s.Id,isInLibrary:!0,isMenuOpen:(C==null?void 0:C.Id)===s.Id,paddingRight:!0,onClick:()=>N(s),onContextMenu:F=>{F.preventDefault(),v(s),h("desktop"),A({x:F.clientX,y:F.clientY}),c(!0)},onLongPress:()=>{v(s),h("mobile"),A(null),c(!0)}},s.Id)})})]}):i.map(s=>{var w,$;return e.jsx(he,{title:s.Name||"Unknown",subtitle:`${s.AlbumArtist||(($=(w=s.ArtistItems)==null?void 0:w[0])==null?void 0:$.Name)||"Unknown Artist"}${s.Album?` • ${s.Album}`:""}`,artworkUrl:U.getAlbumArtUrl(s.AlbumId||s.Id,96),isCurrentTrack:(l==null?void 0:l.Id)===s.Id,isInLibrary:!0,isMenuOpen:(C==null?void 0:C.Id)===s.Id,paddingRight:!0,onClick:()=>N(s),onContextMenu:F=>{F.preventDefault(),v(s),h("desktop"),A({x:F.clientX,y:F.clientY}),c(!0)},onLongPress:()=>{v(s),h("mobile"),A(null),c(!0)}},s.Id)})}):null,e.jsx(we,{item:C,itemType:"song",isOpen:o,onClose:()=>{c(!1),v(null)},zIndex:99999,mode:g,position:f||void 0})]})}function Pt(){const[t,r]=n.useState(!1),{recentlyAdded:i,recentlyPlayed:a,loading:u}=_(),{showMoodCards:p,showTop10:x,showNewReleases:d,showRecentlyPlayed:l,muspyRssUrl:o}=je(),c=n.useRef(!1),{isQueueSidebarOpen:g}=de();n.useEffect(()=>{(u.recentlyAdded||u.recentlyPlayed)&&(c.current=!0)},[u.recentlyAdded,u.recentlyPlayed]);const f=[x,d&&!!o,l].filter(Boolean).length,A=c.current&&!u.recentlyAdded&&!u.recentlyPlayed&&i.length===0&&a.length===0;return e.jsxs("div",{className:"pb-4",children:[e.jsx("div",{className:`fixed top-0 left-0 right-0 bg-black z-10 lg:left-16 transition-[left,right] duration-300 ${g?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top))"},children:e.jsx("div",{className:"max-w-[768px] min-[1680px]:max-w-[1080px] w-full mx-auto",children:e.jsx(ct,{onSearchStateChange:r})})}),e.jsx("div",{className:`fixed left-0 right-0 z-[60] lg:left-16 transition-[left,right] duration-300 ${g?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 4.5rem - 2px)",height:"24px",background:"linear-gradient(to bottom, rgba(0, 0, 0, 0.8), transparent)"}}),e.jsx("div",{className:t?"hidden [@media((hover:hover)_and_(pointer:fine)_and_(min-width:1024px))]:block":"",style:{paddingTop:"calc(env(safe-area-inset-top) + 4.5rem + 24px)"},children:e.jsxs("div",{className:"w-full",children:[p&&e.jsx(pt,{}),e.jsx("div",{className:"mt-4 pb-4",children:e.jsx(gt,{})}),f>0&&e.jsxs("div",{className:`
              mt-4 px-4
              ${f>=2?"md:grid md:gap-3":""}
              ${f===2?"md:grid-cols-2":""}
              ${f>=3?"md:grid-cols-2 min-[1680px]:grid-cols-3":""}
            `,children:[l&&e.jsx("div",{className:f===3?"md:col-span-2 min-[1680px]:col-span-1":"",children:e.jsx(vt,{twoColumns:f===3})}),x&&e.jsx("div",{children:e.jsx(bt,{})}),d&&e.jsx("div",{children:e.jsx(St,{})})]}),A&&e.jsx("div",{className:"flex items-center justify-center py-16 text-gray-400",children:e.jsx("p",{children:"No music found"})})]})})]})}export{Pt as default};
