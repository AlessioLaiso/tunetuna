import{c as De,r as l,u as _,a as W,b as ke,j as e,d as Le,S as _e,G as ge,e as z,P as pe,L as be,C as te,f as Y,U as ve,D as Q,g as Se,I as Ae}from"./index-CzUmNj2K.js";import{u as Ye,f as Ge,S as Z}from"./search-WNCQ_fRa.js";import{F as je}from"./FilterBottomSheet-Rx5t3k63.js";import{C as ye}from"./calendar-CaXzNkE7.js";/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ue=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],He=De("settings",Ue),ee=new Map;function we({artist:t,onClick:w,onContextMenu:o,contextMenuItemId:g}){var y,A;const[i,c]=l.useState(!1),n=l.useRef(!1),m=g===t.Id,[p,j]=l.useState(null);l.useEffect(()=>{var P;if((P=t.ImageTags)!=null&&P.Primary){j(null);return}const N=ee.get(t.Id);if(N!==void 0){j(N);return}let I=!1;return(async()=>{try{const{albums:x,songs:f}=await z.getArtistItems(t.Id),T=x[0],E=f.find(D=>D.AlbumId)||f[0],C=T||E,O=C?C.AlbumId||C.Id:null,b=O?z.getAlbumArtUrl(O,96):null;ee.set(t.Id,b),I||j(b)}catch(x){console.error("Failed to load fallback album art for artist (home search):",t.Id,x),ee.set(t.Id,null)}})(),()=>{I=!0}},[t.Id,t.ImageTags]);const d=N=>{if(m||n.current){n.current=!1;return}w(t.Id)},u=N=>{N.preventDefault(),N.stopPropagation(),n.current=!0,o(t,"artist","desktop",{x:N.clientX,y:N.clientY}),setTimeout(()=>{n.current=!1},300)},v=Y({onLongPress:N=>{N.preventDefault(),n.current=!0,o(t,"artist","mobile")},onClick:()=>{if(n.current){n.current=!1;return}d()}});return e.jsxs("button",{onClick:()=>{if(n.current){n.current=!1;return}d()},onContextMenu:u,...v,className:`w-full flex items-center gap-4 hover:bg-white/10 transition-colors text-left px-4 h-[72px] ${m?"bg-white/10":""}`,children:[e.jsx("div",{className:"w-12 h-12 rounded-full overflow-hidden flex-shrink-0 bg-zinc-900 flex items-center justify-center",children:i?e.jsx(ve,{className:"w-6 h-6 text-gray-500"}):(y=t.ImageTags)!=null&&y.Primary||p?e.jsx("img",{src:(A=t.ImageTags)!=null&&A.Primary?z.getArtistImageUrl(t.Id,96):p||"",alt:t.Name,className:"w-full h-full object-cover",onError:()=>c(!0),loading:"lazy"}):e.jsx(ve,{className:"w-6 h-6 text-gray-500"})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("div",{className:"text-base font-medium text-white truncate group-hover:text-[var(--accent-color)] transition-colors",children:t.Name})})]})}function Ne({album:t,onClick:w,onContextMenu:o,contextMenuItemId:g}){var u,v;const[i,c]=l.useState(!1),n=l.useRef(!1),m=g===t.Id,p=y=>{if(m||n.current){n.current=!1;return}w(t.Id)},j=y=>{y.preventDefault(),y.stopPropagation(),n.current=!0,o(t,"album","desktop",{x:y.clientX,y:y.clientY}),setTimeout(()=>{n.current=!1},300)},d=Y({onLongPress:y=>{y.preventDefault(),n.current=!0,o(t,"album","mobile")},onClick:()=>{if(n.current){n.current=!1;return}p()}});return e.jsxs("button",{onClick:()=>{if(n.current){n.current=!1;return}p()},onContextMenu:j,...d,className:"text-left group",children:[e.jsx("div",{className:"aspect-square rounded overflow-hidden mb-3 bg-zinc-900 shadow-lg relative flex items-center justify-center",children:i?e.jsx(Q,{className:"w-12 h-12 text-gray-500"}):e.jsxs(e.Fragment,{children:[e.jsx("img",{src:z.getAlbumArtUrl(t.Id,474),alt:t.Name,className:"w-full h-full object-cover",onError:()=>c(!0)}),e.jsx("div",{className:"absolute inset-0 pointer-events-none border border-white rounded",style:{borderColor:"rgba(255, 255, 255, 0.03)",borderWidth:"1px"}})]})}),e.jsx("div",{className:"text-sm font-semibold text-white truncate mb-1",children:t.Name}),e.jsx("div",{className:"text-xs text-gray-400 truncate",children:t.AlbumArtist||((v=(u=t.ArtistItems)==null?void 0:u[0])==null?void 0:v.Name)||"Unknown Artist"})]})}function Ce({song:t,onClick:w,onContextMenu:o,contextMenuItemId:g,showImage:i=!0}){var A,N;const c=Se(),n=l.useRef(!1),m=g===t.Id,[p,j]=l.useState(!1),d=I=>{const h=Math.floor(I/1e7),P=Math.floor(h/60),x=h%60;return`${P}:${x.toString().padStart(2,"0")}`},u=I=>{if(m||n.current){n.current=!1;return}w(t)},v=I=>{I.preventDefault(),I.stopPropagation(),n.current=!0,o(t,"song","desktop",{x:I.clientX,y:I.clientY}),setTimeout(()=>{n.current=!1},300)},y=Y({onLongPress:I=>{I.preventDefault(),n.current=!0,o(t,"song","mobile")},onClick:()=>{if(n.current){n.current=!1;return}u()}});return e.jsxs("button",{onClick:()=>{if(n.current){n.current=!1;return}u()},onContextMenu:v,...y,className:`w-full flex items-center gap-3 hover:bg-white/10 transition-colors group px-4 py-3 ${m?"bg-white/10":""}`,children:[e.jsx("div",{className:"w-12 h-12 rounded-sm overflow-hidden flex-shrink-0 bg-zinc-900 self-center relative flex items-center justify-center",children:p?e.jsx(Q,{className:"w-7 h-7 text-gray-500"}):e.jsxs(e.Fragment,{children:[e.jsx("img",{src:z.getAlbumArtUrl(t.AlbumId||t.Id,96),alt:t.Name,className:"w-full h-full object-cover",loading:"lazy",onError:()=>j(!0)}),e.jsx("div",{className:"absolute inset-0 pointer-events-none border border-white rounded-sm",style:{borderColor:"rgba(255, 255, 255, 0.03)",borderWidth:"1px"}})]})}),e.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[e.jsx("div",{className:`text-sm font-medium truncate transition-colors ${(c==null?void 0:c.Id)===t.Id?"text-[var(--accent-color)]":"text-white group-hover:text-[var(--accent-color)]"}`,children:t.Name}),e.jsxs("div",{className:"text-xs text-gray-400 truncate",children:[t.AlbumArtist||((N=(A=t.ArtistItems)==null?void 0:A[0])==null?void 0:N.Name)||"Unknown Artist",t.Album&&` • ${t.Album}`]})]}),t.RunTimeTicks&&e.jsx("div",{className:"text-xs text-gray-500 flex-shrink-0 text-right",children:d(t.RunTimeTicks)})]})}function We({onSearchStateChange:t,title:w="Search"}){const[o,g]=l.useState(""),[i,c]=l.useState(!1),[n,m]=l.useState(null),[p,j]=l.useState(!1),d=l.useRef(null),[u,v]=l.useState(!1),[y,A]=l.useState("mobile"),[N,I]=l.useState(null),[h,P]=l.useState(null),[x,f]=l.useState(null),T=l.useRef(null),E=l.useRef(null),[C,O]=l.useState([]),[b,D]=l.useState({min:null,max:null}),[se,X]=l.useState(!1),[ne,Me]=l.useState(null),{genres:Pe}=_(),[Te,le]=l.useState([]),[Be,re]=l.useState(!1),[ae,ie]=l.useState(45),{playAlbum:Ee,addToQueue:ze,playTrack:Re,shuffleAllSongs:$e,isQueueSidebarOpen:V}=W(),[L,B]=l.useState(!1);l.useEffect(()=>{if(L){const s=setTimeout(()=>{B(!1)},1e4);return()=>clearTimeout(s)}},[L]);const G=ke();l.useEffect(()=>{(async()=>{re(!0);try{const a=_.getState();if(a.years.length>0)le(a.years);else{const M=await z.getYears();le(M)}}catch(a){console.error("Failed to load filter values:",a)}finally{re(!1)}})()},[]);const oe=C.length>0||b.min!==null||b.max!==null;l.useEffect(()=>{d.current&&d.current.abort();const s=o.trim().length>0;if(s||oe){j(!0),d.current=new AbortController;const a=window.setTimeout(async()=>{var M,k,S,F;if(!((M=d.current)!=null&&M.signal.aborted))try{let R;s?R=await Ye(o,450):R=await Ge(450),(k=d.current)!=null&&k.signal.aborted||m(R)}catch(R){(S=d.current)!=null&&S.signal.aborted||(console.error("Search failed:",R),m(null))}finally{(F=d.current)!=null&&F.signal.aborted||j(!1)}},250);return()=>{window.clearTimeout(a),d.current&&d.current.abort()}}else d.current=null,m(null),j(!1)},[o,oe]),l.useEffect(()=>{ie(45)},[o,i,n==null?void 0:n.songs.length]),l.useEffect(()=>{var a;if(!i||!((a=n==null?void 0:n.songs)!=null&&a.length))return;const s=()=>{const M=window.scrollY||document.documentElement.scrollTop,k=window.innerHeight||document.documentElement.clientHeight,S=document.documentElement.scrollHeight;M+k*1.5>=S&&ie(F=>Math.min(F+45,n.songs.length))};return window.addEventListener("scroll",s,{passive:!0}),()=>window.removeEventListener("scroll",s)},[i,n==null?void 0:n.songs.length]);const r=l.useMemo(()=>{if(!n)return null;const s=k=>{if(b.min!==null||b.max!==null)return!1;if(C.length>0){const S=k.Genres||[];if(!C.some(R=>S.some(K=>K.toLowerCase()===R.toLowerCase())))return!1}return!0},a=k=>{if(C.length>0){const S=k.Genres||[];if(!C.some(R=>S.some(K=>K.toLowerCase()===R.toLowerCase())))return!1}if(b.min!==null||b.max!==null){const S=k.ProductionYear;if(!S||S<=0||b.min!==null&&S<b.min||b.max!==null&&S>b.max)return!1}return!0},M=k=>!(b.min!==null||b.max!==null||C.length>0);return{artists:n.artists.filter(s),albums:n.albums.filter(a),playlists:(n.playlists||[]).filter(M),songs:n.songs.filter(a)}},[n,C,b]),J=s=>{g(s),s.trim().length>0&&!i&&c(!0)},ce=s=>{G(`/artist/${s}`),c(!1),g(""),m(null)},de=s=>{G(`/album/${s}`),c(!1),g(""),m(null)},ue=s=>{Re(s,[s])},me=s=>{G(`/playlist/${s}`),c(!1),g(""),m(null)},$=(s,a,M="mobile",k)=>{P(s),f(a),A(M),I(k||null),v(!0)},q=()=>{g(""),m(null)},U=()=>{c(!1),g(""),m(null),O([]),D({min:null,max:null})},H=s=>{Me(s),X(!0)},Oe=s=>{O(s)},Fe=s=>{D(s)},he=s=>{s.preventDefault(),s.stopPropagation(),r!=null&&r.songs&&r.songs.length>0&&Ee(r.songs)},xe=s=>{s.preventDefault(),s.stopPropagation(),r!=null&&r.songs&&r.songs.length>0&&ze(r.songs)},fe=i;return l.useEffect(()=>{t&&t(fe)},[fe,t]),l.useEffect(()=>{if(i){const a=window.matchMedia("(hover: hover) and (pointer: fine) and (min-width: 1024px)").matches?E:T;setTimeout(()=>{var M;if((M=a.current)==null||M.focus(),a.current){const k=a.current.value.length;a.current.setSelectionRange(k,k)}},50)}},[i]),l.useEffect(()=>{if(!i)return;const s=a=>{a.key==="Escape"&&(a.preventDefault(),a.stopPropagation(),U())};return window.addEventListener("keydown",s,!0),()=>window.removeEventListener("keydown",s,!0)},[i]),l.useEffect(()=>()=>{d.current&&d.current.abort()},[]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"px-4 pt-4 pb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"text-lg font-semibold text-white",children:"Tunetuna"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:async()=>{const s=W.getState(),{isShuffleAllActive:a,isShuffleGenreActive:M,shuffle:k}=s;if(!(L||a||M)){B(!0);try{await $e()}catch(S){console.error("Home shuffle button - shuffleAllSongs failed:",S),console.error("Shuffle all failed:",S)}finally{B(!1)}}},disabled:L,className:"w-8 h-8 flex items-center justify-center text-white hover:bg-zinc-800 rounded-full transition-colors disabled:opacity-50","aria-label":"Shuffle all songs",children:L?e.jsx("div",{className:"w-4 h-4 border-2 border-zinc-400 border-t-white rounded-full animate-spin"}):e.jsx(_e,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>G("/settings"),className:"w-8 h-8 flex items-center justify-center text-white hover:bg-zinc-800 rounded-full transition-colors","aria-label":"Settings",children:e.jsx(He,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"relative",onClick:()=>c(!0),children:e.jsx(Z,{value:o,onChange:J,placeholder:"Search for artists, albums, songs...",showClearButton:o.trim().length>0,onClear:q})})]}),i&&Le.createPortal(e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden [@media((hover:hover)_and_(pointer:fine)_and_(min-width:1024px))]:block fixed inset-0 z-[9998] bg-black/50",onClick:U}),e.jsx("div",{className:`hidden [@media((hover:hover)_and_(pointer:fine)_and_(min-width:1024px))]:flex fixed top-0 left-16 z-[9999] justify-center pointer-events-none ${V?"":"right-0"}`,style:V?{right:"var(--sidebar-width)"}:void 0,children:e.jsxs("div",{className:"w-[768px] max-h-[80vh] overflow-y-auto bg-zinc-900 rounded-b-xl shadow-2xl pointer-events-auto border-l border-r border-b border-zinc-800",children:[e.jsxs("div",{className:"px-4 pt-4 pb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"text-lg font-semibold text-white",children:w}),e.jsx("button",{onClick:U,className:"px-3 py-1.5 text-white text-sm font-medium hover:bg-zinc-800 rounded-lg transition-colors",children:"Cancel"})]}),e.jsx(Z,{ref:E,value:o,onChange:J,placeholder:"Search for artists, albums, songs...",showClearButton:o.trim().length>0,onClear:q})]}),e.jsxs("div",{className:"flex items-center gap-3 px-4 pt-3 pb-4",children:[e.jsxs("button",{onClick:()=>H("genre"),className:`flex items-center gap-2 px-3 py-2 rounded-lg transition-colors ${C.length>0?"bg-[var(--accent-color)] text-white":"bg-white/10 text-white hover:bg-white/20"}`,"aria-label":"Filter by genre",children:[e.jsx(ge,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Genre"})]}),e.jsxs("button",{onClick:()=>H("year"),className:`flex items-center gap-2 px-3 py-2 rounded-lg transition-colors ${b.min!==null||b.max!==null?"bg-[var(--accent-color)] text-white":"bg-white/10 text-white hover:bg-white/20"}`,"aria-label":"Filter by year",children:[e.jsx(ye,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Year"})]})]}),e.jsx("div",{className:"px-4 pb-8",children:p?e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-zinc-800 border-t-[var(--accent-color)]"})}):r?e.jsxs("div",{className:"space-y-8",children:[r.artists.length>0&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Artists"}),e.jsx("div",{className:"space-y-0 -mx-4",children:r.artists.slice(0,5).map(s=>e.jsx(we,{artist:s,onClick:ce,onContextMenu:$,contextMenuItemId:(h==null?void 0:h.Id)||null},s.Id))})]}),r.albums.length>0&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Albums"}),e.jsx("div",{className:"grid grid-cols-3 md:grid-cols-4 gap-4",children:r.albums.slice(0,12).map(s=>e.jsx(Ne,{album:s,onClick:de,onContextMenu:$,contextMenuItemId:(h==null?void 0:h.Id)||null},s.Id))})]}),r.playlists&&r.playlists.length>0&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Playlists"}),e.jsx("div",{className:"space-y-0 -mx-4",children:r.playlists.map(s=>e.jsxs("button",{onClick:()=>me(s.Id),onContextMenu:a=>{a.preventDefault(),a.stopPropagation(),$(s,"playlist","desktop",{x:a.clientX,y:a.clientY})},className:"w-full flex items-center gap-3 hover:bg-white/10 transition-colors group px-4 py-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-sm overflow-hidden flex-shrink-0 bg-zinc-900 self-center",children:e.jsx("img",{src:z.getAlbumArtUrl(s.Id,96),alt:s.Name,className:"w-full h-full object-cover",loading:"lazy"})}),e.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[e.jsx("div",{className:"text-sm font-medium text-white truncate group-hover:text-[var(--accent-color)] transition-colors",children:s.Name}),e.jsx("div",{className:"text-xs text-gray-400 truncate",children:s.ChildCount?`${s.ChildCount} tracks`:"Playlist"})]})]},s.Id))})]}),r.songs.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"Songs"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:he,className:"w-10 h-10 flex items-center justify-center text-white hover:bg-white/10 rounded-lg transition-colors","aria-label":"Play all songs",children:e.jsx(pe,{className:"w-5 h-5"})}),e.jsx("button",{type:"button",onClick:xe,className:"w-10 h-10 flex items-center justify-center text-white hover:bg-white/10 rounded-lg transition-colors","aria-label":"Add all songs to queue",children:e.jsx(be,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"space-y-0 -mx-4",children:r.songs.map((s,a)=>e.jsx(Ce,{song:s,onClick:ue,onContextMenu:$,contextMenuItemId:(h==null?void 0:h.Id)||null,showImage:a<ae},s.Id))})]}),r.artists.length===0&&r.albums.length===0&&(!r.playlists||r.playlists.length===0)&&r.songs.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 text-gray-400",children:[e.jsx("div",{className:"text-lg mb-2",children:"No results found"}),e.jsx("div",{className:"text-sm",children:"Try a different search term"})]})]}):e.jsx("div",{className:"flex flex-col items-center justify-center py-16 text-gray-400"})})]})}),e.jsxs("div",{className:"fixed inset-0 bg-black z-[9999] overflow-y-scroll p-0 m-0 [@media((hover:hover)_and_(pointer:fine)_and_(min-width:1024px))]:hidden",children:[e.jsx("div",{className:"fixed top-0 left-0 right-0 bg-black z-50 pointer-events-none",style:{height:"env(safe-area-inset-top)",top:"var(--header-offset, 0px)"}}),e.jsx("div",{className:"fixed top-0 left-0 right-0 bg-black z-10 pt-0 pb-0 w-full m-0",style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top))",height:"76px"},children:e.jsx("div",{className:"max-w-[768px] mx-auto w-full",children:e.jsxs("div",{className:"flex items-center gap-3 pl-2 pr-4 pt-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(Z,{ref:T,value:o,onChange:J,showClearButton:o.trim().length>0,onClear:q})}),e.jsx("button",{onClick:U,className:"px-4 py-2 text-white text-sm font-medium hover:text-zinc-300 transition-colors whitespace-nowrap flex-shrink-0",children:"Cancel"})]})})}),e.jsxs("div",{className:"max-w-[768px] mx-auto w-full",style:{paddingTop:"calc(76px + env(safe-area-inset-top))"},children:[e.jsx("div",{className:"sticky bg-black z-10 pt-3 pb-4",style:{top:"calc(76px + env(safe-area-inset-top))"},children:e.jsxs("div",{className:"flex items-center gap-3 pl-2 pr-4",children:[e.jsxs("button",{onClick:()=>H("genre"),className:`flex items-center gap-2 px-3 py-2 rounded-lg transition-colors ${C.length>0?"bg-[var(--accent-color)] text-white":"bg-white/10 text-white hover:bg-white/20"}`,"aria-label":"Filter by genre",children:[e.jsx(ge,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Genre"})]}),e.jsxs("button",{onClick:()=>H("year"),className:`flex items-center gap-2 px-3 py-2 rounded-lg transition-colors ${b.min!==null||b.max!==null?"bg-[var(--accent-color)] text-white":"bg-white/10 text-white hover:bg-white/20"}`,"aria-label":"Filter by year",children:[e.jsx(ye,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Year"})]})]})}),e.jsx("div",{className:`fixed left-0 right-0 z-[60] lg:left-16 transition-[left,right] duration-300 ${V?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 76px + 4rem)",height:"24px",background:"linear-gradient(to bottom, rgba(0, 0, 0, 0.8), transparent)"}}),e.jsx("div",{className:"pb-32",style:{paddingTop:"40px"},children:p?e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-zinc-800 border-t-[var(--accent-color)]"})}):r?e.jsxs("div",{className:"space-y-8",children:[r.artists.length>0&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-4 pl-2 pr-4",children:"Artists"}),e.jsx("div",{className:"space-y-0",children:r.artists.slice(0,5).map(s=>e.jsx(we,{artist:s,onClick:ce,onContextMenu:$,contextMenuItemId:(h==null?void 0:h.Id)||null},s.Id))})]}),r.albums.length>0&&e.jsxs("div",{className:"pl-2 pr-4",children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Albums"}),e.jsx("div",{className:"grid grid-cols-3 md:grid-cols-4 gap-4",children:r.albums.slice(0,12).map(s=>e.jsx(Ne,{album:s,onClick:de,onContextMenu:$,contextMenuItemId:(h==null?void 0:h.Id)||null},s.Id))})]}),r.playlists&&r.playlists.length>0&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-4 pl-2 pr-4",children:"Playlists"}),e.jsx("div",{className:"space-y-0",children:r.playlists.map(s=>e.jsxs("button",{onClick:()=>me(s.Id),onContextMenu:a=>{a.preventDefault(),a.stopPropagation(),$(s,"playlist","desktop",{x:a.clientX,y:a.clientY})},className:"w-full flex items-center gap-3 hover:bg-white/10 transition-colors group px-4 py-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-sm overflow-hidden flex-shrink-0 bg-zinc-900 self-center",children:e.jsx("img",{src:z.getAlbumArtUrl(s.Id,96),alt:s.Name,className:"w-full h-full object-cover",loading:"lazy"})}),e.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[e.jsx("div",{className:"text-sm font-medium text-white truncate group-hover:text-[var(--accent-color)] transition-colors",children:s.Name}),e.jsx("div",{className:"text-xs text-gray-400 truncate",children:s.ChildCount?`${s.ChildCount} tracks`:"Playlist"})]})]},s.Id))})]}),r.songs.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 pl-2 pr-4",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"Songs"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:he,className:"w-10 h-10 flex items-center justify-center text-white hover:bg-white/10 rounded-lg transition-colors","aria-label":"Play all songs",children:e.jsx(pe,{className:"w-5 h-5"})}),e.jsx("button",{type:"button",onClick:xe,className:"w-10 h-10 flex items-center justify-center text-white hover:bg-white/10 rounded-lg transition-colors","aria-label":"Add all songs to queue",children:e.jsx(be,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"space-y-0",children:r.songs.map((s,a)=>e.jsx(Ce,{song:s,onClick:ue,onContextMenu:$,contextMenuItemId:(h==null?void 0:h.Id)||null,showImage:a<ae},s.Id))})]}),r.artists.length===0&&r.albums.length===0&&(!r.playlists||r.playlists.length===0)&&r.songs.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 text-gray-400 px-4",children:[e.jsx("div",{className:"text-lg mb-2",children:"No results found"}),e.jsx("div",{className:"text-sm",children:"Try a different search term"})]})]}):e.jsx("div",{className:"flex flex-col items-center justify-center py-16 text-gray-400 px-4"})})]})]}),e.jsx(te,{item:h,itemType:x,isOpen:u,onClose:()=>{v(!1),P(null),f(null)},zIndex:999999,mode:y,position:N||void 0})]}),document.body),ne==="genre"&&e.jsx(je,{isOpen:se,onClose:()=>X(!1),filterType:"genre",genres:Pe,selectedValues:C,onApply:Oe}),ne==="year"&&e.jsx(je,{isOpen:se,onClose:()=>X(!1),filterType:"year",availableYears:Te,yearRange:b,onApplyYear:Fe})]})}function Ie({album:t,onNavigate:w,onContextMenu:o}){var j,d;const[g,i]=l.useState(!1),c=l.useRef(!1),n=u=>{if(c.current){c.current=!1;return}w(t.Id)},m=u=>{u.preventDefault(),u.stopPropagation(),c.current=!0,o(t,"desktop",{x:u.clientX,y:u.clientY}),setTimeout(()=>{c.current=!1},300)},p=Y({onLongPress:u=>{u.preventDefault(),c.current=!0,o(t,"mobile")},onClick:()=>{if(c.current){c.current=!1;return}n()}});return e.jsxs("button",{onClick:()=>{if(c.current){c.current=!1;return}n()},onContextMenu:m,...p,className:"text-left group",children:[e.jsx("div",{className:"aspect-square rounded overflow-hidden mb-2 bg-zinc-900 flex items-center justify-center",children:g?e.jsx(Q,{className:"w-12 h-12 text-gray-500"}):e.jsx(Ae,{src:z.getAlbumArtUrl(t.Id,474),alt:t.Name,className:"w-full h-full object-cover",showOutline:!0,rounded:"rounded",onError:()=>i(!0)})}),e.jsx("div",{className:"text-sm font-medium text-white truncate",children:t.Name}),e.jsx("div",{className:"text-xs text-gray-400 truncate",children:t.AlbumArtist||((d=(j=t.ArtistItems)==null?void 0:j[0])==null?void 0:d.Name)||"Unknown Artist"})]})}function Qe(){const{recentlyAdded:t,setRecentlyAdded:w,setLoading:o}=_(),g=ke(),i=l.useRef(null),[c,n]=l.useState(0),[m,p]=l.useState(!1),[j,d]=l.useState("mobile"),[u,v]=l.useState(null),[y,A]=l.useState(null);l.useEffect(()=>{(async()=>{o("recentlyAdded",!0);try{const f=await z.getRecentlyAdded(18);w(f.Items||[])}catch(f){console.error("Failed to load recently added:",f)}finally{o("recentlyAdded",!1)}})()},[w,o]);const N=()=>{if(!i.current)return;const x=i.current,f=x.scrollLeft,T=x.clientWidth,E=Math.round(f/T);n(E)},I=x=>{if(!i.current)return;const f=i.current,T=f.clientWidth;f.scrollTo({left:x*T,behavior:"smooth"})};if(!t||t.length===0)return null;const h=6,P=[];for(let x=0;x<t.length;x+=h)P.push(t.slice(x,x+h));return e.jsxs("div",{className:"px-4 mb-8",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Recently Added"}),e.jsxs("div",{className:"md:hidden",children:[e.jsx("div",{ref:i,onScroll:N,className:"overflow-x-auto snap-x snap-mandatory scrollbar-hide",style:{scrollbarWidth:"none",msOverflowStyle:"none"},children:e.jsx("div",{className:"flex",style:{width:`${P.length*100}%`},children:P.map((x,f)=>{const T=Math.ceil(x.length/3);return e.jsx("div",{className:"snap-start flex-shrink-0 w-full",style:{width:`${100/P.length}%`},children:e.jsx("div",{className:"grid grid-cols-3 gap-3",style:{gridTemplateRows:`repeat(${T}, minmax(0, 1fr))`},children:x.map(E=>e.jsx(Ie,{album:E,onNavigate:C=>g(`/album/${C}`),onContextMenu:(C,O,b)=>{A(C),d(O||"desktop"),v(b||null),p(!0)}},E.Id))})},f)})})}),P.length>1&&e.jsx("div",{className:"flex justify-center gap-2 mt-4",children:P.map((x,f)=>e.jsx("button",{onClick:()=>I(f),className:`w-2 h-2 rounded-full transition-colors ${f===c?"bg-white":"bg-zinc-600"}`,"aria-label":`Go to page ${f+1}`},f))})]}),e.jsx("div",{className:"hidden md:block",children:e.jsx("div",{className:"grid grid-cols-4 gap-3",children:t.slice(0,8).map(x=>e.jsx(Ie,{album:x,onNavigate:f=>g(`/album/${f}`),onContextMenu:(f,T,E)=>{A(f),d(T||"desktop"),v(E||null),p(!0)}},x.Id))})}),e.jsx("style",{children:`
        .scrollbar-hide::-webkit-scrollbar {
          display: none;
        }
      `}),e.jsx(te,{item:y,itemType:"album",isOpen:m,onClose:()=>{p(!1),A(null)},zIndex:999999,mode:j,position:u||void 0})]})}function Xe({song:t,onClick:w,onContextMenu:o,contextMenuItemId:g}){var d,u;const i=Se(),[c,n]=l.useState(!1),m=g===t.Id,p=v=>{const y=Math.floor(v/1e7),A=Math.floor(y/60),N=y%60;return`${A}:${N.toString().padStart(2,"0")}`},j=Y({onLongPress:v=>{v.preventDefault(),o(t,"mobile")},onClick:()=>w(t)});return e.jsxs("button",{onClick:()=>w(t),onContextMenu:v=>{v.preventDefault(),o(t,"desktop",{x:v.clientX,y:v.clientY})},...j,className:`w-full flex items-center gap-3 hover:bg-white/10 transition-colors group px-4 py-3 ${m?"bg-white/10":""}`,children:[e.jsx("div",{className:"w-12 h-12 rounded-sm overflow-hidden flex-shrink-0 bg-zinc-900 self-center flex items-center justify-center",children:c?e.jsx(Q,{className:"w-7 h-7 text-gray-500"}):e.jsx(Ae,{src:z.getAlbumArtUrl(t.AlbumId||t.Id,96),alt:t.Name,className:"w-full h-full object-cover",showOutline:!0,rounded:"rounded-sm",onError:()=>n(!0)})}),e.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[e.jsx("div",{className:`text-sm font-medium truncate transition-colors ${(i==null?void 0:i.Id)===t.Id?"text-[var(--accent-color)]":"text-white group-hover:text-[var(--accent-color)]"}`,children:t.Name}),e.jsxs("div",{className:"text-xs text-gray-400 truncate",children:[t.AlbumArtist||((u=(d=t.ArtistItems)==null?void 0:d[0])==null?void 0:u.Name)||"Unknown Artist",t.Album&&` • ${t.Album}`]})]}),t.RunTimeTicks&&e.jsx("div",{className:"text-xs text-gray-500 flex-shrink-0 text-right",children:p(t.RunTimeTicks)})]})}function Ve(){const{recentlyPlayed:t}=_(),{playTrack:w}=W(),[o,g]=l.useState(!1),[i,c]=l.useState("mobile"),[n,m]=l.useState(null),[p,j]=l.useState(null),d=u=>{w(u,t)};return!t||t.length===0?null:e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-xl font-bold mb-2 px-4",children:"Recently Played"}),e.jsx("div",{className:"space-y-0",children:t.map(u=>e.jsx(Xe,{song:u,onClick:d,onContextMenu:(v,y,A)=>{j(v),c(y||"mobile"),m(A||null),g(!0)},contextMenuItemId:(p==null?void 0:p.Id)||null},u.Id))}),e.jsx(te,{item:p,itemType:"song",isOpen:o,onClose:()=>{g(!1),j(null)},zIndex:99999,mode:i,position:n||void 0})]})}function et(){const[t,w]=l.useState(!1),{recentlyAdded:o,recentlyPlayed:g,loading:i}=_(),c=l.useRef(!1),{isQueueSidebarOpen:n}=W();l.useEffect(()=>{(i.recentlyAdded||i.recentlyPlayed)&&(c.current=!0)},[i.recentlyAdded,i.recentlyPlayed]);const m=c.current&&!i.recentlyAdded&&!i.recentlyPlayed&&o.length===0&&g.length===0;return e.jsxs("div",{className:"pb-20",children:[e.jsx("div",{className:`fixed top-0 left-0 right-0 bg-black z-10 lg:left-16 transition-[left,right] duration-300 ${n?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top))"},children:e.jsx("div",{className:"max-w-[768px] mx-auto",children:e.jsx(We,{onSearchStateChange:w})})}),e.jsx("div",{className:`fixed left-0 right-0 z-[60] lg:left-16 transition-[left,right] duration-300 ${n?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 7.5rem - 2px)",height:"24px",background:"linear-gradient(to bottom, rgba(0, 0, 0, 0.8), transparent)"}}),e.jsx("div",{className:t?"hidden [@media((hover:hover)_and_(pointer:fine)_and_(min-width:1024px))]:block":"",style:{paddingTop:"calc(env(safe-area-inset-top) + 7.5rem + 24px)"},children:e.jsxs("div",{className:"max-w-[768px] mx-auto",children:[e.jsx(Qe,{}),e.jsx(Ve,{}),m&&e.jsx("div",{className:"flex items-center justify-center py-16 text-gray-400",children:e.jsx("p",{children:"No music found"})})]})})]})}export{et as default};
