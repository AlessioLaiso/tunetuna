import{c as oe,r as o,j as e,e as y,l as ce,f as ue,U as H,k as de,C as me,G as xe,P as he,L as fe,n as A}from"./index-D0jLw_Yc.js";/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],ge=oe("calendar",pe),B=o.forwardRef(({value:t,onChange:s,placeholder:c="Search...",debounceMs:r=150,showClearButton:u=!1,onClear:x},d)=>{const[n,f]=o.useState(t),a=o.useRef(s),i=o.useRef(null),m=h=>{i.current=h,typeof d=="function"?d(h):d&&(d.current=h)};return o.useEffect(()=>{a.current=s},[s]),o.useEffect(()=>{const h=setTimeout(()=>{a.current(n)},r);return()=>clearTimeout(h)},[n,r]),o.useEffect(()=>{t===""&&n!==""&&f(t)},[t]),e.jsxs("div",{className:"relative",children:[e.jsx("input",{ref:m,type:"text",value:n,onChange:h=>{f(h.target.value)},placeholder:c,className:"w-full px-4 py-2 pl-10 pr-10 bg-zinc-900 border border-zinc-800 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-[var(--accent-color)] focus:border-transparent"}),e.jsx("svg",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),e.jsx("button",{onClick:h=>{h.preventDefault(),h.stopPropagation(),f(""),x&&x(),setTimeout(()=>{var j;(j=i.current)==null||j.focus()},0)},className:`absolute right-3 top-1/2 transform -translate-y-1/2 w-5 h-5 transition-opacity ${u&&n?"text-gray-400 hover:text-white opacity-100 pointer-events-auto":"opacity-0 pointer-events-none"}`,"aria-label":"Clear search",type:"button",children:e.jsx("svg",{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",className:"w-full h-full",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})});B.displayName="SearchInput";const V=500,M=new Map,U=new Map;function K(){if(M.size>V){const t=Array.from(M.keys()).slice(0,M.size-V);for(const s of t)M.delete(s)}}async function be(t){if(M.has(t))return M.get(t)??null;if(U.has(t))return U.get(t);const s=(async()=>{try{const{albums:c,songs:r}=await y.getArtistItems(t),u=c[0],x=r.find(a=>a.AlbumId)||r[0],d=u||x,n=d?d.AlbumId||d.Id:null,f=n?y.getAlbumArtUrl(n,96):null;return M.set(t,f),K(),f}catch(c){return ce.error("Failed to load fallback album art for artist:",t,c),M.set(t,null),K(),null}finally{U.delete(t)}})();return U.set(t,s),s}function ve(t){return M.get(t)}const we=o.memo(function({artist:s,onClick:c,onContextMenu:r,contextMenuItemId:u}){var S;const[x,d]=o.useState(!1),n=o.useRef(!1),f=u===s.Id,[a,i]=o.useState(null);o.useEffect(()=>{var l;if((l=s.ImageTags)!=null&&l.Primary){i(null);return}const p=ve(s.Id);if(p!==void 0){i(p);return}let z=!1;return be(s.Id).then(N=>{z||i(N)}),()=>{z=!0}},[s.Id,s.ImageTags]);const m=p=>{if(f||n.current){p.preventDefault(),p.stopPropagation(),n.current=!1;return}c(s.Id)},h=p=>{p.preventDefault(),p.stopPropagation(),n.current=!0,r(s,"artist","desktop",{x:p.clientX,y:p.clientY}),setTimeout(()=>{n.current=!1},300)},j=ue({onLongPress:p=>{p.preventDefault(),n.current=!0,r(s,"artist","mobile")},onClick:m}),I=(S=s.ImageTags)!=null&&S.Primary?y.getArtistImageUrl(s.Id,96):a;return e.jsxs("button",{onClick:m,onContextMenu:h,...j,className:`w-full flex items-center gap-4 hover:bg-white/10 transition-colors text-left cursor-pointer px-4 h-[72px] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--accent-color)] focus-visible:ring-inset ${f?"bg-white/10":""}`,"aria-label":`Go to artist ${s.Name}`,children:[e.jsx("div",{className:"w-12 h-12 rounded-full overflow-hidden flex-shrink-0 bg-zinc-900 flex items-center justify-center",children:x?e.jsx(H,{className:"w-6 h-6 text-gray-500"}):I?e.jsx("img",{src:I,alt:s.Name,className:"w-full h-full object-cover",onError:()=>d(!0),loading:"lazy"}):e.jsx(H,{className:"w-6 h-6 text-gray-500"})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("div",{className:"text-base font-medium text-white truncate group-hover:text-[var(--accent-color)] transition-colors",children:s.Name})})]})});function ye({album:t,onClick:s,onContextMenu:c,contextMenuItemId:r}){var f,a;const u=o.useRef(!1),x=r===t.Id,d=i=>{if(x||u.current){i.preventDefault(),i.stopPropagation(),u.current=!1;return}s(t.Id)},n=i=>{i.preventDefault(),i.stopPropagation(),u.current=!0,c(t,"album","desktop",{x:i.clientX,y:i.clientY}),setTimeout(()=>{u.current=!1},300)};return e.jsxs("button",{onClick:d,onContextMenu:n,className:"text-left group",children:[e.jsxs("div",{className:"aspect-square rounded overflow-hidden mb-3 bg-zinc-900 shadow-lg relative flex items-center justify-center",children:[e.jsx("img",{src:y.getAlbumArtUrl(t.Id,474),alt:t.Name,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 pointer-events-none border border-white rounded",style:{borderColor:"rgba(255, 255, 255, 0.03)",borderWidth:"1px"}})]}),e.jsx("div",{className:"text-sm font-semibold text-white truncate mb-1",children:t.Name}),e.jsx("div",{className:"text-xs text-gray-400 truncate",children:t.AlbumArtist||((a=(f=t.ArtistItems)==null?void 0:f[0])==null?void 0:a.Name)||"Unknown Artist"})]})}function je({song:t,onClick:s,onContextMenu:c,contextMenuItemId:r,showImage:u=!0}){var i;const x=o.useRef(!1),d=r===t.Id,n=m=>{const h=Math.floor(m/1e7),j=Math.floor(h/60),I=h%60;return`${j}:${I.toString().padStart(2,"0")}`},f=m=>{if(d||x.current){m.preventDefault(),m.stopPropagation(),x.current=!1;return}s(t)},a=m=>{m.preventDefault(),m.stopPropagation(),x.current=!0,c(t,"song","desktop",{x:m.clientX,y:m.clientY}),setTimeout(()=>{x.current=!1},300)};return e.jsxs("button",{onClick:f,onContextMenu:a,className:`w-full flex items-center gap-3 hover:bg-white/10 transition-colors group px-4 py-3 ${d?"bg-white/10":""}`,children:[u&&e.jsx("div",{className:"w-12 h-12 rounded-sm overflow-hidden flex-shrink-0 bg-zinc-900 self-center",children:e.jsx("img",{src:y.getAlbumArtUrl(t.AlbumId||t.Id,96),alt:t.Name,className:"w-full h-full object-cover",loading:"lazy"})}),e.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[e.jsx("div",{className:"text-sm font-medium text-white truncate group-hover:text-[var(--accent-color)] transition-colors",children:t.Name}),e.jsx("div",{className:"text-xs text-gray-400 truncate",children:((i=t.ArtistItems)==null?void 0:i.map(m=>m.Name).join(", "))||t.AlbumArtist||"Unknown Artist"})]}),t.RunTimeTicks&&e.jsx("div",{className:"text-xs text-gray-500 flex-shrink-0",children:n(t.RunTimeTicks)})]})}function Ne({playlist:t,onClick:s,onContextMenu:c}){return e.jsxs("button",{onClick:()=>s(t.Id),onContextMenu:r=>{r.preventDefault(),r.stopPropagation(),c(t,"playlist","desktop",{x:r.clientX,y:r.clientY})},className:"w-full flex items-center gap-3 hover:bg-white/10 transition-colors group px-4 py-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-sm overflow-hidden flex-shrink-0 bg-zinc-900 self-center",children:e.jsx("img",{src:y.getAlbumArtUrl(t.Id,96),alt:t.Name,className:"w-full h-full object-cover",loading:"lazy"})}),e.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[e.jsx("div",{className:"text-sm font-medium text-white truncate group-hover:text-[var(--accent-color)] transition-colors",children:t.Name}),e.jsx("div",{className:"text-xs text-gray-400 truncate",children:t.ChildCount?`${t.ChildCount} tracks`:"Playlist"})]})]})}function Ae({isOpen:t,onClose:s,title:c="Search",searchQuery:r,onSearchChange:u,onClearSearch:x,isLoading:d,results:n,sections:f,filterConfig:a,filterState:i,onOpenFilterSheet:m,onArtistClick:h,onAlbumClick:j,onSongClick:I,onPlaylistClick:S,onPlayAllSongs:p,onAddSongsToQueue:z,visibleSongImageCount:l,isQueueSidebarOpen:N=!1,desktopSearchInputRef:R,mobileSearchInputRef:P}){const L=o.useRef(null),$=o.useRef(null),v=R||L,G=P||$,[Z,q]=o.useState(!1),[Q,ee]=o.useState("mobile"),[te,se]=o.useState(null),[k,X]=o.useState(null),[ne,W]=o.useState(null),D=(w,g,_,T)=>{X(w),W(g),ee(_),se(T||null),q(!0)};o.useEffect(()=>{var w,g;t&&(window.matchMedia("(hover: hover) and (pointer: fine) and (min-width: 1024px)").matches?(w=v.current)==null||w.focus():(g=G.current)==null||g.focus())},[t,v,G]),o.useEffect(()=>{if(!t)return;const w=g=>{g.key==="Escape"&&s()};return window.addEventListener("keydown",w,!0),()=>window.removeEventListener("keydown",w,!0)},[t,s]);const E=a.showGenreFilter||a.showYearFilter,re=n&&(n.artists.length>0||n.albums.length>0||n.songs.length>0||n.playlists&&n.playlists.length>0),le=(w,g)=>{if(!n)return null;const{type:_,limit:T}=w,Y=g?"":"-mx-4",F=g?"pl-2 pr-4":"";switch(_){case"artists":{const b=T?n.artists.slice(0,T):n.artists;return b.length===0?null:e.jsxs("div",{children:[e.jsx("h2",{className:`text-xl font-bold text-white mb-4 ${F}`,children:"Artists"}),e.jsx("div",{className:`space-y-0 ${Y}`,children:b.map(C=>e.jsx(we,{artist:C,onClick:h,onContextMenu:D,contextMenuItemId:(k==null?void 0:k.Id)||null},C.Id))})]},"artists")}case"albums":{const b=T?n.albums.slice(0,T):n.albums;return b.length===0?null:e.jsxs("div",{className:g?F:"",children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Albums"}),e.jsx("div",{className:"grid grid-cols-3 md:grid-cols-4 gap-4",children:b.map(C=>e.jsx(ye,{album:C,onClick:j,onContextMenu:D,contextMenuItemId:(k==null?void 0:k.Id)||null},C.Id))})]},"albums")}case"songs":return n.songs.length===0?null:e.jsxs("div",{children:[e.jsxs("div",{className:`flex items-center justify-between mb-4 ${F}`,children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"Songs"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:p,className:"w-10 h-10 flex items-center justify-center text-white hover:bg-white/10 rounded-lg transition-colors","aria-label":"Play all songs",children:e.jsx(he,{className:"w-5 h-5"})}),e.jsx("button",{type:"button",onClick:z,className:"w-10 h-10 flex items-center justify-center text-white hover:bg-white/10 rounded-lg transition-colors","aria-label":"Add all songs to queue",children:e.jsx(fe,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:`space-y-0 ${Y}`,children:n.songs.map((b,C)=>e.jsx(je,{song:b,onClick:I,onContextMenu:D,contextMenuItemId:(k==null?void 0:k.Id)||null,showImage:C<l},b.Id))})]},"songs");case"playlists":{const b=n.playlists;return!b||b.length===0?null:e.jsxs("div",{children:[e.jsx("h2",{className:`text-xl font-bold text-white mb-4 ${F}`,children:"Playlists"}),e.jsx("div",{className:`space-y-0 ${Y}`,children:b.map(C=>e.jsx(Ne,{playlist:C,onClick:S,onContextMenu:D},C.Id))})]},"playlists")}default:return null}},J=()=>E?e.jsxs(e.Fragment,{children:[a.showGenreFilter&&e.jsxs("button",{onClick:()=>m("genre"),className:`flex items-center gap-2 px-3 py-2 rounded-lg transition-colors ${i.selectedGenres.length>0?"bg-[var(--accent-color)] text-white":"bg-white/10 text-white hover:bg-white/20"}`,"aria-label":"Filter by genre",children:[e.jsx(xe,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Genre"})]}),a.showYearFilter&&e.jsxs("button",{onClick:()=>m("year"),className:`flex items-center gap-2 px-3 py-2 rounded-lg transition-colors ${i.yearRange.min!==null||i.yearRange.max!==null?"bg-[var(--accent-color)] text-white":"bg-white/10 text-white hover:bg-white/20"}`,"aria-label":"Filter by year",children:[e.jsx(ge,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Year"})]})]}):null,ae=()=>e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-zinc-800 border-t-[var(--accent-color)]"})}),ie=()=>e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 text-gray-400",children:[e.jsx("div",{className:"text-lg mb-2",children:"No results found"}),e.jsx("div",{className:"text-sm",children:"Try a different search term"})]}),O=w=>d?ae():n?re?e.jsx("div",{className:"space-y-8",children:f.map(g=>le(g,w))}):ie():e.jsx("div",{className:"flex flex-col items-center justify-center py-16 text-gray-400"});return t?de.createPortal(e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden [@media((hover:hover)_and_(pointer:fine)_and_(min-width:1024px))]:block fixed inset-0 z-[9998] bg-black/50",onClick:s}),e.jsx("div",{className:`hidden [@media((hover:hover)_and_(pointer:fine)_and_(min-width:1024px))]:flex fixed top-0 left-16 z-[9999] justify-center pointer-events-none ${N?"":"right-0"}`,style:N?{right:"var(--sidebar-width)"}:void 0,children:e.jsxs("div",{className:"w-[768px] max-h-[80vh] overflow-y-auto bg-zinc-900 rounded-b-xl shadow-2xl pointer-events-auto border-l border-r border-b border-zinc-800",children:[e.jsxs("div",{className:"px-4 pt-4 pb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"text-lg font-semibold text-white",children:c}),e.jsx("button",{onClick:s,className:"px-3 py-1.5 text-white text-sm font-medium hover:bg-zinc-800 rounded-lg transition-colors",children:"Cancel"})]}),e.jsx(B,{ref:v,value:r,onChange:u,placeholder:"Search for artists, albums, songs...",showClearButton:r.trim().length>0,onClear:x})]}),E&&e.jsx("div",{className:"flex items-center gap-3 px-4 pt-3 pb-4",children:J()}),e.jsx("div",{className:"px-4 pb-8",children:O(!1)})]})}),e.jsxs("div",{className:"fixed inset-0 bg-black z-[9999] overflow-y-scroll p-0 m-0 [@media((hover:hover)_and_(pointer:fine)_and_(min-width:1024px))]:hidden",children:[e.jsx("div",{className:"fixed top-0 left-0 right-0 bg-black z-50 pointer-events-none",style:{height:"env(safe-area-inset-top)",top:"var(--header-offset, 0px)"}}),e.jsx("div",{className:"fixed top-0 left-0 right-0 bg-black z-10 pt-0 pb-0 w-full m-0",style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top))",height:"76px"},children:e.jsx("div",{className:"max-w-[768px] mx-auto w-full",children:e.jsxs("div",{className:"flex items-center gap-3 pl-2 pr-4 pt-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(B,{ref:G,value:r,onChange:u,showClearButton:r.trim().length>0,onClear:x})}),e.jsx("button",{onClick:s,className:"px-4 py-2 text-white text-sm font-medium hover:text-zinc-300 transition-colors whitespace-nowrap flex-shrink-0",children:"Cancel"})]})})}),e.jsxs("div",{className:"max-w-[768px] mx-auto w-full",style:{paddingTop:"calc(76px + env(safe-area-inset-top))"},children:[E&&e.jsx("div",{className:"sticky bg-black z-10 pt-3 pb-4",style:{top:"calc(76px + env(safe-area-inset-top))"},children:e.jsx("div",{className:"flex items-center gap-3 pl-2 pr-4",children:J()})}),E&&e.jsx("div",{className:`fixed left-0 right-0 z-[60] lg:left-16 transition-[left,right] duration-300 ${N?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 76px + 4rem)",height:"24px",background:"linear-gradient(to bottom, rgba(0, 0, 0, 0.8), transparent)"}}),e.jsx("div",{className:"pb-32",style:{paddingTop:E?"40px":"16px"},children:O(!0)})]})]}),e.jsx(me,{item:k,itemType:ne,isOpen:Z,onClose:()=>{q(!1),X(null),W(null)},zIndex:999999,mode:Q,position:te||void 0})]}),document.body):null}async function Ie(t,s){var I,S,p,z;const c=await y.search(t,s);let r=((I=c.Songs)==null?void 0:I.Items)||[],u=((S=c.Albums)==null?void 0:S.Items)||[],x=((p=c.Artists)==null?void 0:p.Items)||[],d=((z=c.Playlists)==null?void 0:z.Items)||[];if(!(r.length>0||u.length>0||x.length>0||d.length>0)&&t.trim().length>0){const l=await ke(s);r=l.songs,u=l.albums,x=l.artists,d=l.playlists}const a=A(t).toLowerCase().trim(),i=r.filter(l=>{var P,L,$;if(A(l.Name||"").toLowerCase().includes(a))return!0;const R=[];return l.AlbumArtist&&R.push(A(l.AlbumArtist)),(P=l.AlbumArtists)!=null&&P.length&&R.push(...l.AlbumArtists.map(v=>A(v.Name||"")).filter(Boolean)),(L=l.ArtistItems)!=null&&L.length&&R.push(...l.ArtistItems.map(v=>A(v.Name||"")).filter(Boolean)),!!(R.some(v=>v.toLowerCase().includes(a))||($=l.Genres)!=null&&$.some(v=>A(v).toLowerCase().includes(a)))}),m=x.filter(l=>A(l.Name||"").toLowerCase().includes(a)),h=u.filter(l=>{var P,L;const N=A(l.Name||""),R=A(l.AlbumArtist||((L=(P=l.ArtistItems)==null?void 0:P[0])==null?void 0:L.Name)||"");return N.toLowerCase().includes(a)||R.toLowerCase().includes(a)}),j=d.filter(l=>A(l.Name||"").toLowerCase().includes(a));return{artists:m,albums:h,playlists:j,songs:i}}async function ke(t){const[s,c,r,u]=await Promise.all([y.getArtists({limit:t}),y.getAlbums({limit:t}),y.getPlaylists({limit:t}),y.getSongs({limit:t})]);return{artists:s.Items||[],albums:c.Items||[],playlists:r.Items||[],songs:u.Items||[]}}export{B as S,Ae as a,be as b,ke as f,ve as g,Ie as u};
