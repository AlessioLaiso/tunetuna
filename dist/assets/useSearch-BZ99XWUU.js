import{c as D,r as c,j as t,B as P,X as H,u as Q,l as T,p as K}from"./index-DNl72U49.js";import{u as Y,f as U}from"./search-2vD8kbIg.js";/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=[["path",{d:"M10 22a2 2 0 0 1-2-2",key:"i7yj1i"}],["path",{d:"M14 2a2 2 0 0 1 2 2",key:"170a0m"}],["path",{d:"M16 22h-2",key:"18d249"}],["path",{d:"M2 10V8",key:"7yj4fe"}],["path",{d:"M2 4a2 2 0 0 1 2-2",key:"ddgnws"}],["path",{d:"M20 8a2 2 0 0 1 2 2",key:"1770vt"}],["path",{d:"M22 14v2",key:"iot8ja"}],["path",{d:"M22 20a2 2 0 0 1-2 2",key:"qj8q6g"}],["path",{d:"M4 16a2 2 0 0 1-2-2",key:"1dnafg"}],["path",{d:"M8 10a2 2 0 0 1 2-2h5a1 1 0 0 1 1 1v5a2 2 0 0 1-2 2H9a1 1 0 0 1-1-1z",key:"ci6f0b"}],["path",{d:"M8 2h2",key:"1gmkwm"}]],J=D("squares-intersect",X);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=[["path",{d:"M4 16a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v3a1 1 0 0 0 1 1h3a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H10a2 2 0 0 1-2-2v-3a1 1 0 0 0-1-1z",key:"17jnth"}]],Z=D("squares-unite",W);function ne({isOpen:A,onClose:R,filterType:u,availableYears:a=[],yearRange:g={min:null,max:null},onApplyYear:I,genres:V=[],selectedValues:M=[],onApply:v,groupingCategory:o,selectedGroupingValues:N=[],onApplyGrouping:z,groupingMatchMode:x="or",onGroupingMatchModeChange:y}){const[s,L]=c.useState(g),[j,$]=c.useState(M),[b,F]=c.useState(N),f=c.useRef(null),p=c.useRef(null);c.useEffect(()=>{L(g)},[g.min,g.max]),c.useEffect(()=>{$(M)},[M.join(",")]),c.useEffect(()=>{F(N)},[N.join(",")]);const q=e=>{$(l=>l.includes(e)?l.filter(n=>n!==e):[...l,e])},E=e=>{F(l=>l.includes(e)?l.filter(n=>n!==e):[...l,e])},B=()=>{u==="year"&&I?I(s):u==="genre"&&v?v(j):u==="grouping"&&z&&o&&z(o.key,b),R()},O=()=>{u==="year"?(L({min:null,max:null}),I&&I({min:null,max:null})):u==="genre"?$([]):u==="grouping"&&(F([]),z&&o&&z(o.key,[])),R()},d=a.length>0?a[0]:1900,w=a.length>0?a[a.length-1]:new Date().getFullYear(),m=c.useRef(!1);c.useEffect(()=>{if(u==="year"&&A&&a.length>0){const e=m.current;m.current=!1,setTimeout(()=>{if(f.current){const n=s.min!==null?a.indexOf(s.min):0;if(n!==-1){const r=f.current.querySelector(`[data-year-index="${n}"]`);r&&r.scrollIntoView({behavior:e?"instant":"smooth",block:"center"})}}if(p.current){const n=s.max!==null?a.indexOf(s.max):a.length-1;if(n!==-1){const r=p.current.querySelector(`[data-year-index="${n}"]`);r&&r.scrollIntoView({behavior:e?"instant":"smooth",block:"center"})}}},e?350:50)}},[u,A,s.min,s.max,a]),c.useEffect(()=>{A&&(m.current=!0)},[A]);const h=(e,l)=>{L(n=>{if(e==="min"){const r=n.max!==null&&l>n.max?n.max:l;return setTimeout(()=>{const S=a.indexOf(r);if(S!==-1&&f.current){const k=f.current.querySelector(`[data-year-index="${S}"]`);k&&k.scrollIntoView({behavior:"smooth",block:"center"})}},50),{...n,min:r}}else{const r=n.min!==null&&l<n.min?n.min:l;return setTimeout(()=>{const S=a.indexOf(r);if(S!==-1&&p.current){const k=p.current.querySelector(`[data-year-index="${S}"]`);k&&k.scrollIntoView({behavior:"smooth",block:"center"})}},50),{...n,max:r}}})},i=(s.min===null||s.min===d)&&(s.max===null||s.max===w)&&g.min===null&&g.max===null;return t.jsx(P,{isOpen:A,onClose:R,zIndex:10001,children:t.jsxs("div",{className:"pb-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4 px-4",children:[t.jsxs("div",{className:"text-lg font-semibold text-white",children:["Filter by ",u==="genre"?"Genre":u==="year"?"Year":(o==null?void 0:o.name)||"Tag"]}),t.jsxs("div",{className:"flex items-center gap-2",children:[u==="grouping"&&o&&!o.isSingleValue&&t.jsxs("div",{className:"flex bg-white/10 rounded-lg p-0.5",children:[t.jsx("button",{onClick:()=>y==null?void 0:y(o.key,"or"),className:`p-1.5 rounded-md transition-colors ${x==="or"?"bg-white/20 text-white":"text-white/50 hover:text-white/80"}`,"aria-label":"Match any (OR)",title:"Match any",children:t.jsx(Z,{className:"w-4 h-4"})}),t.jsx("button",{onClick:()=>y==null?void 0:y(o.key,"and"),className:`p-1.5 rounded-md transition-colors ${x==="and"?"bg-white/20 text-white":"text-white/50 hover:text-white/80"}`,"aria-label":"Match all (AND)",title:"Match all",children:t.jsx(J,{className:"w-4 h-4"})})]}),t.jsx("button",{onClick:R,className:"w-8 h-8 flex items-center justify-center text-white hover:bg-white/10 rounded-full transition-colors","aria-label":"Close",children:t.jsx(H,{className:"w-5 h-5"})})]})]}),t.jsx("div",{className:"px-4 max-h-[75vh] overflow-y-auto overscroll-none touch-pan-y",children:u==="year"?t.jsx("div",{className:"space-y-6",children:t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsxs("div",{className:"flex-1 relative",children:[t.jsx("div",{className:"text-center text-sm text-gray-400 mb-2",children:"From"}),t.jsx("div",{ref:f,className:"h-64 overflow-y-auto scroll-smooth snap-y snap-mandatory py-[calc(50%-1.5rem)] overscroll-contain",children:a.length>0?a.map((e,l)=>{const n=s.min===e,r=s.max!==null&&e>s.max;return t.jsx("button",{"data-year-index":l,onClick:()=>h("min",e),disabled:r,className:`w-full py-3 px-4 text-center snap-center transition-colors ${n?"bg-[var(--accent-color)] text-white font-semibold rounded-lg":r?"text-gray-500 cursor-not-allowed":"text-white hover:bg-white/10"}`,children:e},e)}):t.jsx("div",{className:"text-center py-8 text-gray-400",children:t.jsx("div",{className:"text-sm",children:"No years available"})})}),t.jsx("div",{className:"absolute left-0 right-0 h-12 bg-gradient-to-b from-zinc-900 to-transparent pointer-events-none",style:{top:"1.75rem"}}),t.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-12 bg-gradient-to-t from-zinc-900 to-transparent pointer-events-none"})]}),t.jsxs("div",{className:"flex-1 relative",children:[t.jsx("div",{className:"text-center text-sm text-gray-400 mb-2",children:"To"}),t.jsx("div",{ref:p,className:"h-64 overflow-y-auto scroll-smooth snap-y snap-mandatory py-[calc(50%-1.5rem)] overscroll-contain",children:a.length>0?a.map((e,l)=>{const n=s.max===e,r=s.min!==null&&e<s.min;return t.jsx("button",{"data-year-index":l,onClick:()=>h("max",e),disabled:r,className:`w-full py-3 px-4 text-center snap-center transition-colors ${n?"bg-[var(--accent-color)] text-white font-semibold rounded-lg":r?"text-gray-500 cursor-not-allowed":"text-white hover:bg-white/10"}`,children:e},e)}):t.jsx("div",{className:"text-center py-8 text-gray-400",children:t.jsx("div",{className:"text-sm",children:"No years available"})})}),t.jsx("div",{className:"absolute left-0 right-0 h-14 bg-gradient-to-b from-zinc-900 via-zinc-900/80 to-transparent pointer-events-none",style:{top:"1.75rem"}}),t.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-14 bg-gradient-to-t from-zinc-900 via-zinc-900/80 to-transparent pointer-events-none"})]})]})}):u==="genre"?t.jsx("div",{className:"space-y-2",children:V.length>0?[...V].sort((e,l)=>(e.Name||"").localeCompare(l.Name||"")).map(e=>{const l=e.Name||"",n=j.includes(l);return t.jsxs("button",{onClick:()=>q(l),className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-white/10 transition-colors text-left",children:[t.jsx("div",{className:`w-5 h-5 rounded border-2 flex items-center justify-center transition-colors ${n?"bg-white border-white":"border-white/40 bg-transparent"}`,children:n&&t.jsx("svg",{className:"w-3 h-3 text-zinc-900",fill:"currentColor",viewBox:"0 0 20 20",children:t.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),t.jsx("span",{className:"text-white font-medium",children:l})]},e.Id)}):t.jsx("div",{className:"text-center py-8 text-gray-400",children:t.jsx("div",{className:"text-sm",children:"No genres available"})})}):u==="grouping"&&o?t.jsx("div",{className:"space-y-2",children:o.isSingleValue?t.jsxs(t.Fragment,{children:[t.jsxs("button",{onClick:()=>E("yes"),className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-white/10 transition-colors text-left",children:[t.jsx("div",{className:`w-5 h-5 rounded border-2 flex items-center justify-center transition-colors ${b.includes("yes")?"bg-white border-white":"border-white/40 bg-transparent"}`,children:b.includes("yes")&&t.jsx("svg",{className:"w-3 h-3 text-zinc-900",fill:"currentColor",viewBox:"0 0 20 20",children:t.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),t.jsx("span",{className:"text-white font-medium",children:o.name})]}),t.jsxs("button",{onClick:()=>E("no"),className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-white/10 transition-colors text-left",children:[t.jsx("div",{className:`w-5 h-5 rounded border-2 flex items-center justify-center transition-colors ${b.includes("no")?"bg-white border-white":"border-white/40 bg-transparent"}`,children:b.includes("no")&&t.jsx("svg",{className:"w-3 h-3 text-zinc-900",fill:"currentColor",viewBox:"0 0 20 20",children:t.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),t.jsxs("span",{className:"text-white font-medium",children:["Not ",o.name]})]})]}):o.values.length>0?o.values.map(e=>{const l=b.includes(e.toLowerCase());return t.jsxs("button",{onClick:()=>E(e.toLowerCase()),className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-white/10 transition-colors text-left",children:[t.jsx("div",{className:`w-5 h-5 rounded border-2 flex items-center justify-center transition-colors ${l?"bg-white border-white":"border-white/40 bg-transparent"}`,children:l&&t.jsx("svg",{className:"w-3 h-3 text-zinc-900",fill:"currentColor",viewBox:"0 0 20 20",children:t.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),t.jsx("span",{className:"text-white font-medium",children:e})]},e)}):t.jsx("div",{className:"text-center py-8 text-gray-400",children:t.jsx("div",{className:"text-sm",children:"No options available"})})}):t.jsx("div",{className:"text-center py-8 text-gray-400",children:t.jsx("div",{className:"text-sm",children:"No options available"})})}),t.jsxs("div",{className:"flex gap-3 mt-6 px-4",children:[t.jsx("button",{onClick:O,disabled:u==="year"&&i,className:"flex-1 px-4 py-3 bg-white/10 hover:bg-white/20 disabled:opacity-30 disabled:cursor-not-allowed text-white font-medium rounded-lg transition-colors",children:"Clear"}),t.jsx("button",{onClick:B,className:"flex-1 px-4 py-3 bg-white text-zinc-900 font-medium rounded-lg hover:bg-gray-100 transition-colors",children:"Apply"})]})]})})}function le(A={}){const{debounceMs:R=250,limit:u=450,includeYearFilter:a=!0}=A,[g,I]=c.useState(""),[V,M]=c.useState(!1),[v,o]=c.useState(null),N=c.useRef(null),z=Q(d=>d.songs),[x,y]=c.useState([]),[s,L]=c.useState({min:null,max:null}),[j,$]=c.useState({}),[b,F]=c.useState({}),f=Object.values(j).some(d=>d.length>0),p=a?x.length>0||s.min!==null||s.max!==null||f:x.length>0||f,q=c.useCallback(()=>{const d={};if(x.length>0&&(d.genres=x),a&&(s.min!==null||s.max!==null)){const w=new Date().getFullYear(),m=s.min??1900,h=s.max??w,i=[];for(let e=m;e<=h;e++)i.push(e);d.years=i}if(Object.keys(j).length>0){const w=[];for(const[m,h]of Object.entries(j)){if(h.length===0||h.some(e=>["yes","no"].includes(e)))continue;(b[m]||"or")==="and"?h.forEach(e=>w.push(`grouping:${m}_${e}`)):w.push(`grouping:${m}_${h[0]}`)}w.length>0&&(d.tags=w),f&&(d.hasGroupingFilters=!0)}return d.genres||d.years||d.tags||d.hasGroupingFilters?d:void 0},[x,s,a,j,b]);c.useEffect(()=>{N.current&&N.current.abort();const d=g.trim().length>0;if(d||p){if(!d&&f&&x.length===0&&!(a&&(s.min!==null||s.max!==null))&&z.length>0){const i=z.map(e=>({Id:e.Id,Name:e.Name,AlbumArtist:e.AlbumArtist,ArtistItems:e.ArtistItems,Album:e.Album,AlbumId:e.AlbumId,IndexNumber:e.IndexNumber,ProductionYear:e.ProductionYear,RunTimeTicks:e.RunTimeTicks,Genres:e.Genres,Grouping:e.Grouping,Type:"Audio"}));o({artists:[],albums:[],playlists:[],songs:i}),M(!1);return}M(!0);const m=new AbortController;N.current=m;const h=async()=>{if(!m.signal.aborted)try{const i=q();let e;d?e=await Y(g,u,i):e=await U(u,i),m.signal.aborted||o(e)}catch(i){m.signal.aborted||(T.error("Search failed:",i),o(null))}finally{m.signal.aborted||M(!1)}};if(R>0){const i=window.setTimeout(h,R);return()=>{window.clearTimeout(i),m.abort()}}else return h(),()=>{m.abort()}}else N.current=null,o(null),M(!1)},[g,x,s,j,p,f,a,R,u,q,z]),c.useEffect(()=>()=>{N.current&&N.current.abort()},[]);const E=c.useMemo(()=>{if(!v)return null;const d=h=>{if(a&&(s.min!==null||s.max!==null)||f)return!1;if(x.length>0){const i=h.Genres||[];if(!x.some(l=>i.some(n=>n.toLowerCase()===l.toLowerCase())))return!1}return!0},w=h=>{if(x.length>0){const i=h.Genres||[];if(!x.some(l=>i.some(n=>n.toLowerCase()===l.toLowerCase())))return!1}if(a&&(s.min!==null||s.max!==null)){const i=h.ProductionYear;if(!i||i<=0||s.min!==null&&i<s.min||s.max!==null&&i>s.max)return!1}if(f){const i=h.Grouping||[],e=new Map,l=new Set;i.forEach(n=>{const r=K(n);r&&(l.add(r.category),e.has(r.category)||e.set(r.category,new Set),r.value&&e.get(r.category).add(r.value))});for(const[n,r]of Object.entries(j)){if(r.length===0)continue;const S=r.includes("no"),k=r.includes("yes");if(S||k){const G=l.has(n);if(S&&!k&&G||k&&!S&&!G)return!1}else{const G=e.get(n);if(!G||G.size===0)return!1;if((b[n]||"or")==="and"){if(!r.every(C=>G.has(C.toLowerCase())))return!1}else if(!r.some(C=>G.has(C.toLowerCase())))return!1}}}return!0},m=h=>!(a&&(s.min!==null||s.max!==null)||x.length>0||f);return{artists:v.artists.filter(d),albums:v.albums.filter(w),playlists:(v.playlists||[]).filter(m),songs:v.songs.filter(w)}},[v,x,s,a,j,b,f]),B=c.useCallback(()=>{I(""),o(null)},[]),O=c.useCallback(()=>{I(""),o(null),y([]),L({min:null,max:null}),$({}),F({})},[]);return{searchQuery:g,setSearchQuery:I,isSearching:V,rawSearchResults:v,searchResults:E,selectedGenres:x,setSelectedGenres:y,yearRange:s,setYearRange:L,selectedGroupings:j,setSelectedGroupings:$,groupingMatchModes:b,setGroupingMatchModes:F,hasActiveFilters:p,clearSearch:B,clearAll:O}}export{ne as F,le as u};
