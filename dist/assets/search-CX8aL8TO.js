import{r as o,j as e,t as ue,v as de,f as F,e as R,U as O,E as me,C as xe,G as he,H as fe,L as pe,J as y}from"./index-Def-zOqH.js";import{C as ge,T as be,S as ve,G as we}from"./tag-Z6C-w5NC.js";import{P as je}from"./piano-GaLAw_6p.js";const B=o.forwardRef(({value:t,onChange:s,placeholder:u="Search...",debounceMs:a=150,showClearButton:x=!1,onClear:i},f)=>{const[n,b]=o.useState(t),l=o.useRef(s),d=o.useRef(null),c=r=>{d.current=r,typeof f=="function"?f(r):f&&(f.current=r)};return o.useEffect(()=>{l.current=s},[s]),o.useEffect(()=>{const r=setTimeout(()=>{l.current(n)},a);return()=>clearTimeout(r)},[n,a]),o.useEffect(()=>{t===""&&n!==""&&b(t)},[t]),e.jsxs("div",{className:"relative",children:[e.jsx("input",{ref:c,type:"text",value:n,onChange:r=>{b(r.target.value)},placeholder:u,className:"w-full px-4 py-2 pl-10 pr-10 bg-zinc-900 border border-zinc-800 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-[var(--accent-color)] focus:border-transparent"}),e.jsx("svg",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),e.jsx("button",{onClick:r=>{r.preventDefault(),r.stopPropagation(),b(""),i&&i(),setTimeout(()=>{var g;(g=d.current)==null||g.focus()},0)},className:`absolute right-3 top-1/2 transform -translate-y-1/2 w-5 h-5 transition-opacity ${x&&n?"text-gray-400 hover:text-white opacity-100 pointer-events-auto":"opacity-0 pointer-events-none"}`,"aria-label":"Clear search",type:"button",children:e.jsx("svg",{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",className:"w-full h-full",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})});B.displayName="SearchInput";const Ne=o.memo(function({artist:s,onClick:u,onContextMenu:a,contextMenuItemId:x}){var k;const[i,f]=o.useState(!1),n=o.useRef(!1),b=x===s.Id,[l,d]=o.useState(null);o.useEffect(()=>{var m;if((m=s.ImageTags)!=null&&m.Primary){d(null);return}const p=ue(s.Id);if(p!==void 0){d(p);return}let S=!1;return de(s.Id).then(M=>{S||d(M)}),()=>{S=!0}},[s.Id,s.ImageTags]);const c=p=>{if(b||n.current){p.preventDefault(),p.stopPropagation(),n.current=!1;return}u(s.Id)},r=p=>{p.preventDefault(),p.stopPropagation(),n.current=!0,a(s,"artist","desktop",{x:p.clientX,y:p.clientY}),setTimeout(()=>{n.current=!1},300)},g=F({onLongPress:p=>{p.preventDefault(),n.current=!0,a(s,"artist","mobile")},onClick:c}),w=(k=s.ImageTags)!=null&&k.Primary?R.getArtistImageUrl(s.Id,96):l;return e.jsxs("button",{onClick:c,onContextMenu:r,...g,className:`group w-full flex items-center gap-4 hover:bg-white/10 transition-colors text-left cursor-pointer px-4 h-[72px] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--accent-color)] focus-visible:ring-inset ${b?"bg-white/10":""}`,"aria-label":`Go to artist ${s.Name}`,children:[e.jsx("div",{className:"w-12 h-12 rounded-full overflow-hidden flex-shrink-0 bg-zinc-900 flex items-center justify-center",children:i?e.jsx(O,{className:"w-6 h-6 text-gray-500"}):w?e.jsx("img",{src:w,alt:s.Name,className:"w-full h-full object-cover",onError:()=>f(!0),loading:"lazy"}):e.jsx(O,{className:"w-6 h-6 text-gray-500"})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("div",{className:"text-base font-medium text-white truncate group-hover:text-[var(--accent-color)] transition-colors",children:s.Name})})]})});function ye({album:t,onClick:s,onContextMenu:u,contextMenuItemId:a}){var l,d;const x=o.useRef(!1),i=a===t.Id,f=c=>{if(i||x.current){c.preventDefault(),c.stopPropagation(),x.current=!1;return}s(t.Id)},n=c=>{c.preventDefault(),c.stopPropagation(),x.current=!0,u(t,"album","desktop",{x:c.clientX,y:c.clientY}),setTimeout(()=>{x.current=!1},300)},b=F({onLongPress:c=>{c.preventDefault(),x.current=!0,u(t,"album","mobile")}});return e.jsxs("button",{onClick:f,onContextMenu:n,className:"text-left group",...b,children:[e.jsxs("div",{className:"aspect-square rounded overflow-hidden mb-3 bg-zinc-900 shadow-lg relative flex items-center justify-center",children:[e.jsx("img",{src:R.getAlbumArtUrl(t.Id,474),alt:t.Name,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 pointer-events-none border border-white rounded",style:{borderColor:"rgba(255, 255, 255, 0.03)",borderWidth:"1px"}})]}),e.jsx("div",{className:"text-sm font-semibold text-white truncate mb-1 group-hover:text-[var(--accent-color)] transition-colors",children:t.Name}),e.jsx("div",{className:"text-xs text-gray-400 truncate",children:t.AlbumArtist||((d=(l=t.ArtistItems)==null?void 0:l[0])==null?void 0:d.Name)||"Unknown Artist"})]})}function ke({song:t,onClick:s,onContextMenu:u,contextMenuItemId:a,showImage:x=!0}){var c;const i=o.useRef(!1),f=a===t.Id,n=r=>{const g=Math.floor(r/1e7),w=Math.floor(g/60),k=g%60;return`${w}:${k.toString().padStart(2,"0")}`},b=r=>{if(f||i.current){r.preventDefault(),r.stopPropagation(),i.current=!1;return}s(t)},l=r=>{r.preventDefault(),r.stopPropagation(),i.current=!0,u(t,"song","desktop",{x:r.clientX,y:r.clientY}),setTimeout(()=>{i.current=!1},300)},d=F({onLongPress:r=>{r.preventDefault(),i.current=!0,u(t,"song","mobile")}});return e.jsxs("button",{onClick:b,onContextMenu:l,className:`w-full flex items-center gap-3 hover:bg-white/10 transition-colors group px-4 py-3 ${f?"bg-white/10":""}`,...d,children:[x&&e.jsx("div",{className:"w-12 h-12 rounded-sm overflow-hidden flex-shrink-0 bg-zinc-900 self-center",children:e.jsx("img",{src:R.getAlbumArtUrl(t.AlbumId||t.Id,96),alt:t.Name,className:"w-full h-full object-cover",loading:"lazy"})}),e.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[e.jsx("div",{className:"text-sm font-medium text-white truncate group-hover:text-[var(--accent-color)] transition-colors",children:t.Name}),e.jsx("div",{className:"text-xs text-gray-400 truncate",children:((c=t.ArtistItems)==null?void 0:c.map(r=>r.Name).join(", "))||t.AlbumArtist||"Unknown Artist"})]}),t.RunTimeTicks&&e.jsx("div",{className:"text-xs text-gray-500 flex-shrink-0",children:n(t.RunTimeTicks)})]})}function Ie({playlist:t,onClick:s,onContextMenu:u}){const a=o.useRef(!1),x=F({onLongPress:i=>{i.preventDefault(),a.current=!0,u(t,"playlist","mobile")}});return e.jsxs("button",{onClick:()=>{if(a.current){a.current=!1;return}s(t.Id)},onContextMenu:i=>{i.preventDefault(),i.stopPropagation(),a.current=!0,u(t,"playlist","desktop",{x:i.clientX,y:i.clientY}),setTimeout(()=>{a.current=!1},300)},className:"w-full flex items-center gap-3 hover:bg-white/10 transition-colors group px-4 py-3",...x,children:[e.jsx("div",{className:"w-12 h-12 rounded-sm overflow-hidden flex-shrink-0 bg-zinc-900 self-center",children:e.jsx("img",{src:R.getAlbumArtUrl(t.Id,96),alt:t.Name,className:"w-full h-full object-cover",loading:"lazy"})}),e.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[e.jsx("div",{className:"text-sm font-medium text-white truncate group-hover:text-[var(--accent-color)] transition-colors",children:t.Name}),e.jsx("div",{className:"text-xs text-gray-400 truncate",children:t.ChildCount?`${t.ChildCount} tracks`:"Playlist"})]})]})}const Ce=t=>{switch(t.toLowerCase()){case"language":return we;case"mood":return ve;case"instrumental":return je;default:return be}};function Me({isOpen:t,onClose:s,title:u="Search",searchQuery:a,onSearchChange:x,onClearSearch:i,isLoading:f,results:n,sections:b,filterConfig:l,filterState:d,onOpenFilterSheet:c,groupingCategories:r=[],onOpenGroupingFilterSheet:g,onArtistClick:w,onAlbumClick:k,onSongClick:p,onPlaylistClick:S,onPlayAllSongs:m,onAddSongsToQueue:M,isQueueSidebarOpen:I=!1,desktopSearchInputRef:T,mobileSearchInputRef:z}){const $=o.useRef(null),C=o.useRef(null),G=T||$,_=z||C,[Z,q]=o.useState(!1),[Q,H]=o.useState(!1);o.useEffect(()=>{if(t)H(!0),requestAnimationFrame(()=>{requestAnimationFrame(()=>{q(!0)})});else{q(!1);const h=setTimeout(()=>{H(!1)},200);return()=>clearTimeout(h)}},[t]);const[ee,J]=o.useState(!1),[te,se]=o.useState("mobile"),[ne,re]=o.useState(null),[N,W]=o.useState(null),[ae,V]=o.useState(null),D=(h,v,L,A)=>{W(h),V(v),se(L),re(A||null),J(!0)};o.useEffect(()=>{var h,v;t&&(window.matchMedia("(hover: hover) and (pointer: fine) and (min-width: 1024px)").matches?(h=G.current)==null||h.focus():(v=_.current)==null||v.focus())},[t,G,_]),o.useEffect(()=>{if(!t)return;const h=v=>{v.key==="Escape"&&s()};return window.addEventListener("keydown",h,!0),()=>window.removeEventListener("keydown",h,!0)},[t,s]);const U=l.showGenreFilter||l.showYearFilter||l.showGroupingFilters&&r.length>0,le=n&&(n.artists.length>0||n.albums.length>0||n.songs.length>0||n.playlists&&n.playlists.length>0),oe=(h,v)=>{if(!n)return null;const{type:L,limit:A}=h,Y=v?"":"-mx-4",E=v?"pl-2 pr-4":"";switch(L){case"artists":{const j=A?n.artists.slice(0,A):n.artists;return j.length===0?null:e.jsxs("div",{children:[e.jsx("h2",{className:`text-xl font-bold text-white mb-4 ${E}`,children:"Artists"}),e.jsx("div",{className:`space-y-0 ${Y}`,children:j.map(P=>e.jsx(Ne,{artist:P,onClick:w,onContextMenu:D,contextMenuItemId:(N==null?void 0:N.Id)||null},P.Id))})]},"artists")}case"albums":{const j=A?n.albums.slice(0,A):n.albums;return j.length===0?null:e.jsxs("div",{className:v?E:"",children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Albums"}),e.jsx("div",{className:"grid grid-cols-3 md:grid-cols-4 gap-4",children:j.map(P=>e.jsx(ye,{album:P,onClick:k,onContextMenu:D,contextMenuItemId:(N==null?void 0:N.Id)||null},P.Id))})]},"albums")}case"songs":return n.songs.length===0?null:e.jsxs("div",{children:[e.jsxs("div",{className:`flex items-center justify-between mb-4 ${E}`,children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"Songs"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:m,className:"w-10 h-10 flex items-center justify-center text-white hover:bg-white/10 rounded-lg transition-colors","aria-label":"Play all songs",children:e.jsx(fe,{className:"w-5 h-5"})}),e.jsx("button",{type:"button",onClick:M,className:"w-10 h-10 flex items-center justify-center text-white hover:bg-white/10 rounded-lg transition-colors","aria-label":"Add all songs to queue",children:e.jsx(pe,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:`space-y-0 ${Y}`,children:n.songs.map((j,P)=>e.jsx(ke,{song:j,onClick:p,onContextMenu:D,contextMenuItemId:(N==null?void 0:N.Id)||null,showImage:!0},j.Id))})]},"songs");case"playlists":{const j=n.playlists;return!j||j.length===0?null:e.jsxs("div",{children:[e.jsx("h2",{className:`text-xl font-bold text-white mb-4 ${E}`,children:"Playlists"}),e.jsx("div",{className:`space-y-0 ${Y}`,children:j.map(P=>e.jsx(Ie,{playlist:P,onClick:S,onContextMenu:D},P.Id))})]},"playlists")}default:return null}},X=()=>U?e.jsxs(e.Fragment,{children:[l.showGenreFilter&&e.jsxs("button",{onClick:()=>c("genre"),className:`flex items-center gap-2 px-3 py-2 rounded-lg transition-colors ${d.selectedGenres.length>0?"bg-[var(--accent-color)] text-white":"bg-white/10 text-white hover:bg-white/20"}`,"aria-label":"Filter by genre",children:[e.jsx(he,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Genre"})]}),l.showYearFilter&&e.jsxs("button",{onClick:()=>c("year"),className:`flex items-center gap-2 px-3 py-2 rounded-lg transition-colors ${d.yearRange.min!==null||d.yearRange.max!==null?"bg-[var(--accent-color)] text-white":"bg-white/10 text-white hover:bg-white/20"}`,"aria-label":"Filter by year",children:[e.jsx(ge,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Year"})]}),l.showGroupingFilters&&r.map(h=>{var A;const v=Ce(h.key),L=(((A=d.selectedGroupings[h.key])==null?void 0:A.length)||0)>0;return e.jsxs("button",{onClick:()=>g==null?void 0:g(h),className:`flex items-center gap-2 px-3 py-2 rounded-lg transition-colors ${L?"bg-[var(--accent-color)] text-white":"bg-white/10 text-white hover:bg-white/20"}`,"aria-label":`Filter by ${h.name}`,children:[e.jsx(v,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:h.name})]},h.key)})]}):null,ie=()=>e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-zinc-800 border-t-[var(--accent-color)]"})}),ce=()=>e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 text-gray-400",children:[e.jsx("div",{className:"text-lg mb-2",children:"No results found"}),e.jsx("div",{className:"text-sm",children:"Try a different search term"})]}),K=h=>f?ie():n?le?e.jsx("div",{className:"space-y-8",children:b.map(v=>oe(v,h))}):ce():e.jsx("div",{className:"flex flex-col items-center justify-center py-16 text-gray-400"});return Q?me.createPortal(e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`hidden [@media((hover:hover)_and_(pointer:fine)_and_(min-width:1024px))]:block fixed inset-0 z-[9998] bg-black/50 transition-opacity duration-200 ${Z?"opacity-100":"opacity-0"}`,onClick:s}),e.jsx("div",{className:`hidden [@media((hover:hover)_and_(pointer:fine)_and_(min-width:1024px))]:flex fixed top-0 left-16 z-[9999] justify-center pointer-events-none ${I?"":"right-0"}`,style:I?{right:"var(--sidebar-width)"}:void 0,children:e.jsxs("div",{className:"w-[768px] max-h-[80vh] bg-zinc-900 rounded-b-xl shadow-2xl pointer-events-auto border-l border-r border-b border-zinc-800 flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"sticky top-0 bg-zinc-900 z-10 px-4 pt-4 pb-4 border-b border-zinc-800 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"text-lg font-semibold text-white",children:u}),e.jsx("button",{onClick:s,className:"px-3 py-1.5 text-white text-sm font-medium hover:bg-zinc-800 rounded-lg transition-colors",children:"Cancel"})]}),e.jsx(B,{ref:G,value:a,onChange:x,placeholder:"Search for artists, albums, songs...",showClearButton:a.trim().length>0,onClear:i})]}),e.jsxs("div",{className:"overflow-y-auto flex-1 px-4 pb-8",children:[U&&e.jsx("div",{className:"flex flex-wrap items-center gap-3 pt-3 pb-4 mb-4",children:X()}),K(!1)]})]})}),e.jsxs("div",{className:"fixed inset-0 bg-black z-[9999] flex flex-col p-0 m-0 [@media((hover:hover)_and_(pointer:fine)_and_(min-width:1024px))]:hidden",children:[e.jsx("div",{className:"fixed top-0 left-0 right-0 bg-black z-50 pointer-events-none",style:{height:"env(safe-area-inset-top)",top:"var(--header-offset, 0px)"}}),e.jsx("div",{className:"sticky top-0 left-0 right-0 bg-black z-10 pt-0 pb-0 w-full m-0",style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top))"},children:e.jsx("div",{className:"max-w-[768px] mx-auto w-full",children:e.jsxs("div",{className:"flex items-center gap-3 pl-2 pr-4 pt-4 pb-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(B,{ref:_,value:a,onChange:x,showClearButton:a.trim().length>0,onClear:i})}),e.jsx("button",{onClick:s,className:"px-4 py-2 text-white text-sm font-medium hover:text-zinc-300 transition-colors whitespace-nowrap flex-shrink-0",children:"Cancel"})]})})}),e.jsx("div",{className:"overflow-y-auto flex-1",children:e.jsxs("div",{className:"max-w-[768px] mx-auto w-full",children:[U&&e.jsx("div",{className:"bg-black pt-3 pb-4",children:e.jsx("div",{className:"flex flex-wrap items-center gap-3 pl-2 pr-4",children:X()})}),e.jsx("div",{className:"pb-32 pt-4",children:K(!0)})]})})]}),e.jsx(xe,{item:N,itemType:ae,isOpen:ee,onClose:()=>{J(!1),W(null),V(null)},zIndex:999999,mode:te,position:ne||void 0})]}),document.body):null}async function Se(t,s,u){var w,k,p,S;const a=await R.search(t,s,u),x=((w=a.Songs)==null?void 0:w.Items)||[],i=((k=a.Albums)==null?void 0:k.Items)||[],f=((p=a.Artists)==null?void 0:p.Items)||[],n=((S=a.Playlists)==null?void 0:S.Items)||[],l=y(t).toLowerCase().trim(),d=x.filter(m=>{var T,z,$;if(y(m.Name||"").toLowerCase().includes(l))return!0;const I=[];return m.AlbumArtist&&I.push(y(m.AlbumArtist)),(T=m.AlbumArtists)!=null&&T.length&&I.push(...m.AlbumArtists.map(C=>y(C.Name||"")).filter(Boolean)),(z=m.ArtistItems)!=null&&z.length&&I.push(...m.ArtistItems.map(C=>y(C.Name||"")).filter(Boolean)),!!(I.some(C=>C.toLowerCase().includes(l))||($=m.Genres)!=null&&$.some(C=>y(C).toLowerCase().includes(l)))}),c=f.filter(m=>y(m.Name||"").toLowerCase().includes(l)),r=i.filter(m=>{var T,z;const M=y(m.Name||""),I=y(m.AlbumArtist||((z=(T=m.ArtistItems)==null?void 0:T[0])==null?void 0:z.Name)||"");return M.toLowerCase().includes(l)||I.toLowerCase().includes(l)}),g=n.filter(m=>y(m.Name||"").toLowerCase().includes(l));return{artists:c,albums:r,playlists:g,songs:d}}async function Te(t,s){var l,d,c,r;const u={};(l=s==null?void 0:s.genres)!=null&&l.length&&(u.genres=s.genres),(d=s==null?void 0:s.years)!=null&&d.length&&(u.years=s.years),(c=s==null?void 0:s.tags)!=null&&c.length&&(u.tags=s.tags);const a=((r=s==null?void 0:s.tags)==null?void 0:r.length)||(s==null?void 0:s.hasGroupingFilters),[x,i,f,n]=await Promise.all([a?Promise.resolve({Items:[]}):R.getArtists({limit:t}),a?Promise.resolve({Items:[]}):R.getAlbums({limit:t,...u}),a?Promise.resolve({Items:[]}):R.getPlaylists({limit:t}),R.getSongs({limit:a?5e3:t,...u})]),b=(n.Items||[]).map(g=>({...g,Grouping:(g.Tags||[]).filter(w=>w.startsWith("grouping:")).map(w=>w.replace("grouping:",""))}));return{artists:x.Items||[],albums:i.Items||[],playlists:f.Items||[],songs:b}}export{Me as S,Te as f,Se as u};
