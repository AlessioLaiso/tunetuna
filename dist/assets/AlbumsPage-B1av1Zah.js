import{b as ie,r as s,f as ke,j as t,I as Ee,e as G,C as ce,u,a as k,d as Oe,l as oe,w as Te}from"./index-BqlUlFYw.js";import{P as Le}from"./Pagination-BWQpVAcC.js";import{u as Re,F as ae}from"./useSearch-Bz6TDB_T.js";import{S as Fe}from"./search-S0JqVDxN.js";import{u as De}from"./useScrollLazyLoad-rGTv2u_A.js";import{A as _e}from"./arrow-up-down-BFyHYFTN.js";import"./chevron-right-BZQVcFbP.js";import"./tag-CErm2CJd.js";import"./piano-B1B2zYaT.js";function Ye({album:o,onContextMenu:d,contextMenuItemId:O,showImage:T=!0}){var I,N,f,v;const g=ie(),[y,S]=s.useState(!1),[L,A]=s.useState("mobile"),[R,l]=s.useState(null),a=s.useRef(!1),F=O===o.Id,j=r=>{if(a.current){r.preventDefault(),a.current=!1;return}g(`/album/${o.Id}`)},D=r=>{var m,p,h,b;r.preventDefault(),r.stopPropagation(),(p=(m=r.nativeEvent)==null?void 0:m.preventDefault)==null||p.call(m),(b=(h=r.nativeEvent)==null?void 0:h.stopImmediatePropagation)==null||b.call(h),a.current=!0,d?d(o,"album","desktop",{x:r.clientX,y:r.clientY}):(A("desktop"),l({x:r.clientX,y:r.clientY}),S(!0)),setTimeout(()=>{a.current=!1},300)},_=ke({onLongPress:r=>{r.preventDefault(),d?(a.current=!0,d(o,"album","mobile")):(a.current=!0,A("mobile"),l(null),S(!0))}});return t.jsxs(t.Fragment,{children:[t.jsxs("button",{onClick:r=>{if(y||a.current){r.preventDefault(),r.stopPropagation();return}j(r)},onContextMenu:r=>{D(r)},..._,className:`text-left group ${F?"ring-2 ring-blue-500":""}`,children:[t.jsx("div",{className:"aspect-square rounded overflow-hidden bg-zinc-900 relative flex items-center justify-center",children:T?t.jsx(Ee,{src:G.getAlbumArtUrl(o.Id,474),alt:o.Name,className:"w-full h-full object-cover",showOutline:!0,rounded:"rounded"}):t.jsx("div",{className:"w-full h-full bg-zinc-900"})}),t.jsx("div",{className:"text-sm font-medium text-white truncate group-hover:text-[var(--accent-color)] transition-colors",children:o.Name}),t.jsx("div",{className:"text-xs text-gray-400 truncate",children:(N=(I=o.ArtistItems)==null?void 0:I[0])!=null&&N.Id?t.jsx("span",{className:"clickable-text",onClick:r=>{r.stopPropagation(),g(`/artist/${o.ArtistItems[0].Id}`)},children:o.AlbumArtist||o.ArtistItems[0].Name||"Unknown Artist"}):o.AlbumArtist||((v=(f=o.ArtistItems)==null?void 0:f[0])==null?void 0:v.Name)||"Unknown Artist"})]}),t.jsx(ce,{item:o,itemType:"album",isOpen:y,onClose:()=>S(!1),mode:L,position:R||void 0})]})}const $e=[{type:"albums"},{type:"artists",limit:5},{type:"playlists"},{type:"songs"}],E=84,le=45,Be=45;function We(){const o=u(e=>e.albums),d=u(e=>e.setAlbums),O=u(e=>e.sortPreferences),T=u(e=>e.setSortPreference),g=u(e=>e.setLoading),y=u(e=>e.loading),S=u(e=>e.genres),L=k(e=>e.playTrack),A=k(e=>e.playAlbum),R=k(e=>e.addToQueue),[l,a]=s.useState(!1),[F,j]=s.useState(!1),[D,_]=s.useState("mobile"),[I,N]=s.useState(null),[f,v]=s.useState(null),[r,m]=s.useState(null),[p,h]=s.useState(0),[b,Q]=s.useState(0),[V,U]=s.useState(le),Y=ie(),[H,X]=Oe(),J=s.useRef(null),K=s.useRef(null),[W,$]=s.useState(!1),[q,ue]=s.useState(null),[de,Z]=s.useState([]),i=O.albums,w=s.useRef(!0),[fe,ee]=s.useState(!1),te=s.useRef(i),B=k(e=>e.isQueueSidebarOpen),{searchQuery:C,setSearchQuery:me,isSearching:pe,searchResults:c,selectedGenres:se,setSelectedGenres:he,yearRange:ne,setYearRange:z,clearSearch:P,clearAll:xe}=Re();s.useEffect(()=>{const e=H.get("year");if(e){const n=parseInt(e,10);!isNaN(n)&&n>0&&(z({min:n,max:n}),a(!0),X({},{replace:!0}))}},[H,X,z]),s.useEffect(()=>{(async()=>{try{const n=u.getState();if(n.years.length>0)Z(n.years);else{const x=await G.getYears();Z(x)}}catch(n){oe.error("Failed to load filter values:",n)}})()},[]),s.useEffect(()=>{if(l){const n=window.matchMedia("(hover: hover) and (pointer: fine) and (min-width: 1024px)").matches?K:J;setTimeout(()=>{var x;if((x=n.current)==null||x.focus(),n.current){const M=n.current.value.length;n.current.setSelectionRange(M,M)}},50)}},[l]),s.useEffect(()=>{if(!l)return;const e=n=>{n.key==="Escape"&&(n.preventDefault(),n.stopPropagation(),re())};return window.addEventListener("keydown",e,!0),()=>window.removeEventListener("keydown",e,!0)},[l]);const ge=e=>{me(e),e.trim().length>0&&!l&&a(!0)},ye=()=>{P()},re=()=>{a(!1),xe()},Se=e=>{ue(e),$(!0)},ve=e=>{he(e)},be=e=>{z(e)},Ce=e=>{Y(`/artist/${e}`),a(!1),P()},Ae=e=>{Y(`/album/${e}`),a(!1),P()},je=e=>{L(e,[e])},Ie=()=>{c!=null&&c.songs&&c.songs.length>0&&A(c.songs)},Ne=()=>{c!=null&&c.songs&&c.songs.length>0&&R(c.songs)},we=e=>{Y(`/playlist/${e}`),a(!1),P()},Pe=(e,n,x="mobile",M)=>{v(e),m(n),_(x),N(M||null),j(!0)};s.useEffect(()=>{const e=n=>{};return document.addEventListener("contextmenu",e,!0),()=>{document.removeEventListener("contextmenu",e,!0)}},[]),s.useEffect(()=>{C.trim()||h(0)},[i,C]),s.useEffect(()=>{U(le)},[p,o.length]),De({totalCount:o.length,visibleCount:V,increment:Be,setVisibleCount:U,threshold:1}),s.useEffect(()=>{C.trim()||(!w.current&&te.current!==i&&ee(!0),te.current=i,Me())},[p,i,C]),s.useEffect(()=>{w.current&&(w.current=!1)},[]);const Me=async()=>{g("albums",!0);try{const e={limit:E,startIndex:p*E};i==="RecentlyAdded"?(e.sortBy=["DateCreated"],e.sortOrder="Descending"):i==="Newest"?(e.sortBy=["ProductionYear","SortName"],e.sortOrder=["Descending","Ascending"]):(e.sortBy=["SortName"],e.sortOrder="Ascending");const n=await G.getAlbums(e);d(n.Items),Q(n.TotalRecordCount||0)}catch(e){oe.error("Failed to load albums:",e),d([]),Q(0)}finally{g("albums",!1),ee(!1)}};return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"pb-20",children:[t.jsx("div",{className:`fixed top-0 left-0 right-0 bg-black z-10 lg:left-16 transition-[left,right] duration-300 ${B?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top))"},children:t.jsx("div",{className:"max-w-[768px] mx-auto",children:t.jsxs("div",{className:"p-4 min-[780px]:px-[0.66rem]",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsx("h1",{className:"text-2xl font-bold text-white",children:"Albums"}),t.jsx("button",{onClick:()=>a(!0),className:"w-10 h-10 flex items-center justify-center text-white hover:bg-zinc-800 rounded-full transition-colors","aria-label":"Search",children:t.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})]}),!l&&t.jsxs("div",{className:"flex items-center justify-between gap-2",children:[t.jsxs("button",{onClick:()=>{T("albums",i==="RecentlyAdded"?"Alphabetical":i==="Alphabetical"?"Newest":"RecentlyAdded")},className:"text-sm text-gray-400 hover:text-white transition-colors flex items-center gap-1",children:[i==="RecentlyAdded"?"Recently Added":i==="Newest"?"Newest":"Alphabetically",t.jsx(_e,{className:"w-4 h-4"})]}),y.albums&&!w.current&&t.jsx("div",{className:"flex items-center",children:t.jsx(Te,{})})]})]})})}),t.jsx("div",{className:`fixed left-0 right-0 z-10 lg:left-16 transition-[left,right] duration-300 ${B?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 7rem - 8px)",height:"24px",background:"linear-gradient(to bottom, rgba(0, 0, 0, 0.8), transparent)"}}),t.jsx("div",{style:{paddingTop:"calc(env(safe-area-inset-top) + 7rem)"},onContextMenu:e=>{},children:t.jsx("div",{className:`${fe?"opacity-50 pointer-events-none":""} ${l?"hidden [@media((hover:hover)_and_(pointer:fine)_and_(min-width:1024px))]:block":""}`,onContextMenu:e=>{},children:o.length===0&&!y.albums?t.jsx("div",{className:"flex items-center justify-center py-16 text-gray-400",children:t.jsx("p",{children:"No albums found"})}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"p-4",children:t.jsx("div",{className:"grid grid-cols-3 md:grid-cols-4 gap-3",onContextMenu:e=>{},children:o.map((e,n)=>t.jsx(Ye,{album:e,onContextMenu:Pe,contextMenuItemId:(f==null?void 0:f.Id)||null,showImage:n<V},e.Id))})}),t.jsx(Le,{currentPage:p,totalPages:Math.ceil(b/E),onPageChange:h,itemsPerPage:E,totalItems:b})]})})})]}),t.jsx(Fe,{isOpen:l,onClose:re,title:"Search",searchQuery:C,onSearchChange:ge,onClearSearch:ye,isLoading:pe,results:c,sections:$e,filterConfig:{showGenreFilter:!0,showYearFilter:!0,showGroupingFilters:!1},filterState:{selectedGenres:se,yearRange:ne,selectedGroupings:{}},onOpenFilterSheet:Se,onArtistClick:Ce,onAlbumClick:Ae,onSongClick:je,onPlaylistClick:we,onPlayAllSongs:Ie,onAddSongsToQueue:Ne,isQueueSidebarOpen:B,desktopSearchInputRef:K,mobileSearchInputRef:J}),q==="genre"&&t.jsx(ae,{isOpen:W,onClose:()=>$(!1),filterType:"genre",genres:S,selectedValues:se,onApply:ve}),q==="year"&&t.jsx(ae,{isOpen:W,onClose:()=>$(!1),filterType:"year",availableYears:de,yearRange:ne,onApplyYear:be}),t.jsx(ce,{item:f,itemType:r,isOpen:F,onClose:()=>{j(!1),v(null),m(null)},zIndex:99999,mode:D,position:I||void 0})]})}export{We as default};
