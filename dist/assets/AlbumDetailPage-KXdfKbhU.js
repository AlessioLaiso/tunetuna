import{K as Ne,b as ae,a as re,i as le,r,j as e,w as Ce,l as q,e as I,I as Pe,Q as Se,E as Re,a8 as Me,C as ie,f as De,T as Ee}from"./index-BYKDqJ8o.js";import{A as Le}from"./arrow-left-BicF6vPH.js";import{E as Oe}from"./ellipsis-40ShD4hH.js";import{C as ze}from"./chevron-up-DStt2klM.js";function Fe({track:l,trackNumber:v,tracks:E,albumArtist:U,onClick:u,onContextMenu:L,contextMenuItemId:V}){var N;const n=V===l.Id,t=le(),Y=ae(),o=r.useRef(!1),h=r.useRef(!1),B=c=>{c.preventDefault(),c.stopPropagation(),o.current=!0,L(l,"desktop",{x:c.clientX,y:c.clientY}),setTimeout(()=>{o.current=!1},300)},O=De({onLongPress:c=>{c.preventDefault(),o.current=!0,L(l,"mobile")},onClick:()=>{if(o.current||h.current){o.current=!1,h.current=!1;return}u(l,E)}});return e.jsxs("button",{onClick:()=>{if(o.current||h.current){o.current=!1,h.current=!1;return}u(l,E)},onContextMenu:B,...O,className:`w-full flex items-baseline hover:bg-white/10 transition-colors group py-3 ${n?"bg-white/10":""}`,children:[e.jsx("span",{className:`text-sm w-6 text-right flex-shrink-0 mr-4 ${(t==null?void 0:t.Id)===l.Id?"text-[var(--accent-color)]":"text-gray-500"}`,children:v&&v>0?v:"-"}),e.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[e.jsx("div",{className:`text-sm font-medium truncate transition-colors ${(t==null?void 0:t.Id)===l.Id?"text-[var(--accent-color)]":"text-white group-hover:text-[var(--accent-color)]"}`,children:l.Name}),((N=l.ArtistItems)==null?void 0:N[0])&&l.ArtistItems[0].Name!==U&&e.jsx("div",{className:"text-xs text-gray-400 truncate",children:e.jsx("span",{className:"clickable-text",onPointerDown:c=>c.stopPropagation(),onMouseDown:c=>c.stopPropagation(),onTouchStart:c=>c.stopPropagation(),onClick:c=>{c.stopPropagation(),c.preventDefault(),h.current=!0,l.ArtistItems[0].Id&&Y(`/artist/${l.ArtistItems[0].Id}`),setTimeout(()=>{h.current=!1},300)},children:l.ArtistItems[0].Name})})]}),l.RunTimeTicks&&e.jsx("div",{className:"text-xs text-gray-500 flex-shrink-0 text-right mr-4",children:Ee(l.RunTimeTicks)})]})}function Ye(){const{id:l}=Ne(),v=ae(),{playAlbum:E,playTrack:U,isPlaying:u,play:L,pause:V}=re(),n=le(),[t,Y]=r.useState(null),[o,h]=r.useState([]),[B,O]=r.useState(!0),[N,c]=r.useState(!1),[C,J]=r.useState(!0),[oe,K]=r.useState(!1),[ce,ue]=r.useState("mobile"),[de,fe]=r.useState(null),[z,G]=r.useState(null),[me,T]=r.useState(!1),[xe,Z]=r.useState("mobile"),[he,_]=r.useState(null),[H,P]=r.useState(null),[k,S]=r.useState(!1),[j,F]=r.useState(!1),[X,p]=r.useState(!1),R=r.useRef(!1),M=r.useRef(!1),[ee,pe]=r.useState(!1),[ge,ve]=r.useState(0),W=r.useRef(0),b=r.useRef(null),y=r.useRef(0),D=r.useRef(!1),be=r.useRef(null),A=r.useRef(null),Ae=re(s=>s.isQueueSidebarOpen),te=r.useRef(!1);r.useEffect(()=>{const s=()=>{pe(window.innerWidth>=1280&&window.innerHeight>=1080)};return s(),window.addEventListener("resize",s),()=>window.removeEventListener("resize",s)},[]),r.useEffect(()=>{if(!l)return;let s=!0;return(async()=>{var m;O(!0);try{const a=await I.getAlbumTracks(l);if(!s)return;h(a);let f=await I.getAlbumById(l);if(!f){const ne=(await I.getAlbums({limit:1})).Items.find(ye=>ye.Id===l);ne&&(f=ne)}if(!s)return;f||a.length>0&&a[0].AlbumId===l&&(f={Id:l,Name:a[0].Album||"Unknown Album",AlbumArtist:a[0].AlbumArtist}),f&&(Y(f),J(!0));const w=((f==null?void 0:f.AlbumArtist)||"").toLowerCase()==="various artists",g=we(a,f);if(g&&!w)try{const x=await I.getArtistById(g);if(!s)return;(m=x==null?void 0:x.ImageTags)!=null&&m.Logo?(P(I.getImageUrl(g,"Logo")),S(!0)):(S(!1),P(null))}catch(x){if(!s)return;q.warn("Failed to load artist logo:",x),S(!1),P(null)}else S(!1),P(null)}catch(a){if(!s)return;q.error("Failed to load album data:",a)}finally{s&&O(!1)}})(),()=>{s=!1}},[l]),r.useEffect(()=>{const s=(n==null?void 0:n.AlbumId)===(t==null?void 0:t.Id)&&u,i=(t==null?void 0:t.Id)||null,m=A.current!==null&&A.current!==i;if(te.current!==s&&(R.current=!1),te.current=s,!C){F(!1),p(!1),A.current=i;return}s?((m||!D.current||!j)&&(F(!0),p(!1),D.current=!0),M.current=window.innerWidth>=560,R.current||(R.current=!0,setTimeout(()=>{(n==null?void 0:n.AlbumId)===(t==null?void 0:t.Id)&&u&&p(!0)},500)),A.current=i):D.current&&j&&!s?(R.current||(R.current=!0,p(!1)),A.current=i):D.current?(F(!1),p(!1),A.current=i):(F(!1),p(!1),D.current=!0,A.current=i)},[n==null?void 0:n.AlbumId,t==null?void 0:t.Id,u,j,C,X]),r.useEffect(()=>{const s=()=>{if((n==null?void 0:n.AlbumId)===(t==null?void 0:t.Id)&&u&&j){const m=window.innerWidth>=560;M.current=m,X&&(p(!1),setTimeout(()=>p(!0),10))}};return window.addEventListener("resize",s),()=>window.removeEventListener("resize",s)},[n==null?void 0:n.AlbumId,t==null?void 0:t.Id,u,j,X]),r.useEffect(()=>{if((n==null?void 0:n.AlbumId)===(t==null?void 0:t.Id)&&u){const i=m=>{y.current===0&&(y.current=m);const a=m-y.current,d=360/1e4;W.current=(W.current+d*a)%360,ve(W.current),y.current=m,b.current=requestAnimationFrame(i)};y.current=0,b.current=requestAnimationFrame(i)}else b.current&&(cancelAnimationFrame(b.current),b.current=null),y.current=0;return()=>{b.current&&cancelAnimationFrame(b.current)}},[n==null?void 0:n.AlbumId,t==null?void 0:t.Id,u]);const we=(s,i)=>{var m,a;if(i!=null&&i.AlbumArtists&&i.AlbumArtists.length>0)return i.AlbumArtists[0].Id;if(s.length>0){const d=(a=(m=s[0].ArtistItems)==null?void 0:m[0])==null?void 0:a.Id;if(d&&s.every(w=>{var g,x;return((x=(g=w.ArtistItems)==null?void 0:g[0])==null?void 0:x.Id)===d}))return d}return null},Ie=()=>{o.length>0&&E(o)},$=()=>{if(o.length>0){const s=o[0];if(s.ProductionYear&&s.ProductionYear>0)return s.ProductionYear.toString();if(s.PremiereDate){const i=new Date(s.PremiereDate).getFullYear();if(i>0)return i.toString()}}return null},se=()=>t!=null&&t.AlbumArtists&&t.AlbumArtists.length>0?t.AlbumArtists[0].Id:t!=null&&t.ArtistItems&&t.ArtistItems.length>0?t.ArtistItems[0].Id:o.length>0&&o[0].ArtistItems&&o[0].ArtistItems.length>0?o[0].ArtistItems[0].Id:null,Q=()=>{var s,i;return t.AlbumArtist||((i=(s=t.ArtistItems)==null?void 0:s[0])==null?void 0:i.Name)||null},je=()=>{const s=se();s&&v(`/artist/${s}`)};return B?e.jsx("div",{className:"pb-20",children:e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsx(Ce,{})})}):!t||o.length===0?e.jsx("div",{className:"pb-20",children:e.jsx("div",{className:"flex items-center justify-center h-screen text-gray-400",children:e.jsx("p",{children:"Album not found"})})}):e.jsxs("div",{className:"pb-20",style:{overflowX:"hidden",maxWidth:"100vw",width:"100%"},children:[e.jsx("div",{className:"fixed top-0 left-0 right-0 z-[55] pointer-events-none",style:{height:"env(safe-area-inset-top)",top:"var(--header-offset, 0px)",background:"transparent"}}),e.jsx("div",{className:"fixed top-0 left-0 right-0 z-10 pointer-events-none",style:{height:"calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 4rem)",top:"var(--header-offset, 0px)",background:`linear-gradient(to bottom,
            #000000 0%,
            #000000 calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 0.5rem),
            rgba(0, 0, 0, 0.95) calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 1rem),
            rgba(0, 0, 0, 0.85) calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 1.5rem),
            rgba(0, 0, 0, 0.7) calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 2rem),
            rgba(0, 0, 0, 0.5) calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 2.5rem),
            rgba(0, 0, 0, 0.3) calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 3rem),
            rgba(0, 0, 0, 0.15) calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 3.5rem),
            rgba(0, 0, 0, 0) calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 4rem)
          )`}}),e.jsx("div",{className:`fixed top-0 left-0 right-0 z-20 lg:left-16 transition-[left,right] duration-300 ${Ae?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top))"},children:e.jsx("div",{className:"max-w-[768px] mx-auto relative",children:e.jsxs("div",{className:"flex items-center justify-between gap-4 py-4 pl-3 pr-4 relative z-10",children:[e.jsx("button",{onClick:()=>v(-1),className:"text-white hover:text-zinc-300 transition-colors",children:e.jsx(Le,{className:"w-6 h-6"})}),t&&e.jsx("button",{onClick:s=>{if(window.innerWidth<768)Z("mobile"),_(null);else{const i=s.currentTarget.getBoundingClientRect();Z("desktop"),_({x:i.left+i.width/2,y:i.bottom+5})}T(!0)},className:"text-white hover:text-zinc-300 transition-colors",children:e.jsx(Oe,{className:"w-6 h-6"})})]})})}),e.jsxs("div",{style:{paddingTop:"calc(5rem + 12px - 48px)"},children:[e.jsxs("div",{className:"mb-6 px-4 pt-4",style:{overflow:"visible"},children:[C&&e.jsx("div",{className:"flex justify-center mb-6 relative",style:{overflowX:"visible",overflowY:"visible",paddingLeft:"16px",paddingRight:"16px"},children:e.jsxs("div",{ref:be,className:"relative",style:{overflow:"visible",width:ee?"360px":"256px",height:ee?"360px":"256px"},children:[e.jsx("div",{className:"absolute inset-0 rounded-full overflow-hidden",style:{opacity:j?1:0,zIndex:1,transform:(n==null?void 0:n.AlbumId)===t.Id&&u&&M.current?"translateX(calc(50% + 8px))":"translateX(0)",transition:"transform 500ms ease-in-out, opacity 300ms ease-in-out"},children:e.jsxs("div",{className:"w-full h-full",style:{transformOrigin:"center center",transform:`rotate(${ge}deg)`},children:[e.jsx("img",{src:"/assets/vinyl.png",alt:"Vinyl Record",className:"w-full h-full object-cover",onError:s=>{q.error("Failed to load vinyl image"),s.currentTarget.style.display="none"}}),(k&&H||C)&&e.jsx("div",{className:"absolute top-1/2 left-1/2 rounded-full",style:{width:"52%",height:"52%",backgroundColor:"#a1a1aa",transform:"translate(-50%, -50%)",transformOrigin:"center center"}}),k&&H?e.jsx("div",{className:"absolute top-1/2 left-1/2 rounded-full overflow-hidden flex items-center justify-center",style:{width:"47%",height:"47%",transform:"translate(-50%, -50%)",transformOrigin:"center center"},children:e.jsx("img",{src:H,alt:"Artist Logo",className:"w-full h-full object-contain",onError:()=>{S(!1),P(null)}})}):C?e.jsx("div",{className:"absolute top-1/2 left-1/2 rounded-full overflow-hidden flex items-center justify-center",style:{width:"52%",height:"52%",transform:"translate(-50%, -50%)",transformOrigin:"center center"},children:e.jsx("img",{src:I.getAlbumArtUrl(t.Id),alt:t.Name,className:"w-full h-full object-cover"})}):null]})}),e.jsx("div",{className:"absolute inset-0 rounded overflow-hidden bg-zinc-900 transition-all duration-500",style:{transform:(n==null?void 0:n.AlbumId)===t.Id&&u||X?M.current?"translateX(calc(-50% - 8px))":"translateX(calc(-100% - 24px))":"translateX(0)",opacity:1,transitionProperty:"transform",transitionDuration:"500ms",transitionTimingFunction:"ease-in-out",zIndex:10},children:e.jsx(Pe,{src:I.getAlbumArtUrl(t.Id),alt:t.Name,className:"w-full h-full object-cover",showOutline:!0,rounded:"rounded",onError:()=>J(!1)})})]})}),e.jsxs("div",{className:"w-full",children:[e.jsx("h2",{className:"text-4xl md:text-5xl font-bold mb-0.5 text-left break-words",children:t.Name}),e.jsxs("div",{className:"flex items-center justify-between gap-4 mt-2",children:[e.jsxs("div",{className:"text-gray-400 flex items-center gap-1.5",children:[Q()&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:je,className:`hover:text-white transition-colors ${se()?"cursor-pointer":"cursor-default"}`,children:Q()}),$()&&e.jsx("span",{children:"â€¢"})]}),$()&&e.jsx("button",{onClick:()=>v(`/albums?year=${$()}`),className:"hover:text-white transition-colors cursor-pointer",children:$()})]}),e.jsx("button",{onClick:()=>{(n==null?void 0:n.AlbumId)===t.Id&&u?V():(n==null?void 0:n.AlbumId)===t.Id&&!u?L():Ie()},className:"bg-white/10 hover:bg-white/20 text-white font-semibold py-1.5 px-3 rounded-full transition-all hover:scale-105 flex items-center gap-1.5 backdrop-blur-sm border border-white/20 flex-shrink-0",children:(n==null?void 0:n.AlbumId)===t.Id&&u?e.jsxs(e.Fragment,{children:[e.jsx(Se,{className:"w-3.5 h-3.5"}),"Pause"]}):e.jsxs(e.Fragment,{children:[e.jsx(Re,{className:"w-3.5 h-3.5"}),"Play"]})})]})]})]}),t.Overview&&e.jsx("div",{className:"mb-6 px-4",children:e.jsxs("div",{className:"text-white relative",children:[!N&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>c(!0),className:"flex-1 text-left min-w-0",children:e.jsx("p",{className:"text-sm text-gray-300 leading-relaxed line-clamp-2",children:t.Overview})}),e.jsx("button",{onClick:()=>c(!0),className:"flex-shrink-0 text-gray-400 hover:text-white transition-colors",children:e.jsx(Me,{className:"w-4 h-4"})})]}),N&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-300 leading-relaxed whitespace-pre-line",children:t.Overview}),e.jsxs("button",{onClick:()=>c(!1),className:"mt-2 flex items-center gap-1 text-sm text-gray-400 hover:text-white transition-colors ml-auto",children:["Show less",e.jsx(ze,{className:"w-4 h-4"})]})]})]})}),e.jsx("div",{children:e.jsx("div",{className:"space-y-0",children:(()=>{const s=new Map;o.forEach(a=>{const d=a.ParentIndexNumber??1;s.has(d)||s.set(d,[]),s.get(d).push(a)});const i=s.size>1;return Array.from(s.keys()).sort((a,d)=>a-d).map(a=>{const d=s.get(a);return e.jsxs("div",{children:[i&&e.jsxs("div",{className:`px-4 py-2 text-xs font-medium text-gray-400 uppercase tracking-wider ${a>1?"pt-4":""}`,children:["Disc ",a]}),d.map(f=>e.jsx(Fe,{track:f,trackNumber:f.IndexNumber??null,tracks:o,albumArtist:Q(),onClick:w=>U(w,o),onContextMenu:(w,g,x)=>{G(w),ue(g||"mobile"),fe(x||null),K(!0)},contextMenuItemId:(z==null?void 0:z.Id)||null},f.Id))]},a)})})()})})]}),e.jsx(ie,{item:z,itemType:"song",isOpen:oe,onClose:()=>{K(!1),G(null)},mode:ce,position:de||void 0}),e.jsx(ie,{item:t,itemType:"album",isOpen:me,onClose:()=>{T(!1)},mode:xe,position:he||void 0})]})}export{Ye as default};
