import{u as I,a as H,r as s,b as Fe,e as z,j as e,d as ze,h as De,G as $e,P as _e,L as He,C as Ye,f as pe,D as be}from"./index-C6qbJR4L.js";import{u as Ue,f as Be,S as Ve}from"./search-BgpX956b.js";import{S as Qe}from"./SearchArtistItem-Dqdwcn21.js";import{S as We}from"./SongItem-CxR4MxNB.js";import{P as Xe}from"./Pagination-C-0-M95r.js";import{F as fe}from"./FilterBottomSheet-qn78qf1j.js";import{A as Je}from"./arrow-up-down-9VykHRJE.js";import{C as qe}from"./calendar-qX2f8oCK.js";const Ke=s.memo(function({album:n,onClick:M,onContextMenu:k,contextMenuItemId:E}){var d,v,a,u;const[T,N]=s.useState(!1),y=s.useRef(!1),L=E===n.Id,O=s.useMemo(()=>z.getAlbumArtUrl(n.Id,474),[n.Id]),S=m=>{if(L||y.current){m.preventDefault(),m.stopPropagation(),y.current=!1;return}M(n.Id)},c=m=>{m.preventDefault(),m.stopPropagation(),y.current=!0,k(n,"album","desktop",{x:m.clientX,y:m.clientY}),setTimeout(()=>{y.current=!1},300)},b=pe({onLongPress:m=>{m.preventDefault(),y.current=!0,k(n,"album","mobile")},onClick:S});return e.jsxs("button",{onClick:S,onContextMenu:c,...b,className:"text-left group","aria-label":`Album: ${n.Name} by ${n.AlbumArtist||((v=(d=n.ArtistItems)==null?void 0:d[0])==null?void 0:v.Name)||"Unknown Artist"}`,children:[e.jsx("div",{className:"aspect-square rounded overflow-hidden mb-3 bg-zinc-900 shadow-lg relative flex items-center justify-center",children:T?e.jsx(be,{className:"w-12 h-12 text-gray-500"}):e.jsxs(e.Fragment,{children:[e.jsx("img",{src:O,alt:n.Name,className:"w-full h-full object-cover",onError:()=>N(!0)}),e.jsx("div",{className:"absolute inset-0 pointer-events-none border border-white rounded",style:{borderColor:"rgba(255, 255, 255, 0.03)",borderWidth:"1px"}})]})}),e.jsx("div",{className:"text-sm font-semibold text-white truncate mb-1",children:n.Name}),e.jsx("div",{className:"text-xs text-gray-400 truncate",children:n.AlbumArtist||((u=(a=n.ArtistItems)==null?void 0:a[0])==null?void 0:u.Name)||"Unknown Artist"})]})}),Ze=s.memo(function({song:n,onClick:M,onContextMenu:k,contextMenuItemId:E,showImage:T=!0}){var a,u,m,R;const N=s.useRef(!1),y=E===n.Id,[L,O]=s.useState(!1),S=s.useMemo(()=>z.getAlbumArtUrl(n.AlbumId||n.Id,96),[n.AlbumId,n.Id]),c=f=>{const D=Math.floor(f/1e7),U=Math.floor(D/60),B=D%60;return`${U}:${B.toString().padStart(2,"0")}`},b=f=>{if(y||N.current){f.preventDefault(),f.stopPropagation(),N.current=!1;return}M(n)},d=f=>{f.preventDefault(),f.stopPropagation(),N.current=!0,k(n,"song","desktop",{x:f.clientX,y:f.clientY}),setTimeout(()=>{N.current=!1},300)},v=pe({onLongPress:f=>{f.preventDefault(),N.current=!0,k(n,"song","mobile")},onClick:b});return e.jsxs("button",{onClick:b,onContextMenu:d,...v,className:`w-full flex items-center gap-3 hover:bg-white/10 transition-colors group px-4 py-3 ${y?"bg-white/10":""}`,"aria-label":`Play ${n.Name} by ${n.AlbumArtist||((u=(a=n.ArtistItems)==null?void 0:a[0])==null?void 0:u.Name)||"Unknown Artist"}`,children:[e.jsx("div",{className:"w-12 h-12 rounded-sm overflow-hidden flex-shrink-0 bg-zinc-900 self-center relative flex items-center justify-center",children:L?e.jsx(be,{className:"w-7 h-7 text-gray-500"}):e.jsxs(e.Fragment,{children:[e.jsx("img",{src:S,alt:n.Name,className:"w-full h-full object-cover",loading:"lazy",onError:()=>O(!0)}),e.jsx("div",{className:"absolute inset-0 pointer-events-none border border-white rounded-sm",style:{borderColor:"rgba(255, 255, 255, 0.03)",borderWidth:"1px"}})]})}),e.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[e.jsx("div",{className:"text-sm font-medium text-white truncate group-hover:text-[var(--accent-color)] transition-colors",children:n.Name}),e.jsxs("div",{className:"text-xs text-gray-400 truncate",children:[n.AlbumArtist||((R=(m=n.ArtistItems)==null?void 0:m[0])==null?void 0:R.Name)||"Unknown Artist",n.Album&&` â€¢ ${n.Album}`]})]}),n.RunTimeTicks&&e.jsx("div",{className:"text-xs text-gray-500 flex-shrink-0 text-right",children:c(n.RunTimeTicks)})]})}),Y=90,xe=45,et=45,ge=45,tt=45;function dt(){const A=I(t=>t.songs),n=I(t=>t.setSongs),M=I(t=>t.sortPreferences),k=I(t=>t.setSortPreference),E=I(t=>t.setLoading),T=I(t=>t.loading),N=I(t=>t.genres),y=H(t=>t.playTrack),L=H(t=>t.playAlbum),O=H(t=>t.addToQueue),S=H(t=>t.isQueueSidebarOpen),[c,b]=s.useState(""),[d,v]=s.useState(!1),[a,u]=s.useState(null),[m,R]=s.useState(!1),[f,D]=s.useState("mobile"),[U,B]=s.useState(null),[x,J]=s.useState(null),[ve,q]=s.useState(null),[je,V]=s.useState(!1),p=s.useRef(null),[$,K]=s.useState(0),[Z,ee]=s.useState(0),Q=Fe(),G=s.useRef(null),te=s.useRef(null),[w,se]=s.useState([]),[o,ne]=s.useState({min:null,max:null}),[re,W]=s.useState(!1),[le,ye]=s.useState(null),[Ne,ae]=s.useState([]),C=M.songs,_=s.useRef(!0),[we,oe]=s.useState(!1),ie=s.useRef(C),[Se,ce]=s.useState(xe),[de,ue]=s.useState(ge);s.useEffect(()=>{(async()=>{try{const r=I.getState();if(r.years.length>0)ae(r.years);else{const g=await z.getYears();ae(g)}}catch(r){console.error("Failed to load filter values:",r)}})()},[]);const me=w.length>0||o.min!==null||o.max!==null;s.useEffect(()=>{p.current&&p.current.abort();const t=c.trim().length>0;if(t||me){V(!0),p.current=new AbortController;const r=window.setTimeout(async()=>{var g,h,i,P;if(!((g=p.current)!=null&&g.signal.aborted))try{let j;t?j=await Ue(c,450):j=await Be(450),(h=p.current)!=null&&h.signal.aborted||u(j)}catch(j){(i=p.current)!=null&&i.signal.aborted||(console.error("Search failed:",j),u(null))}finally{(P=p.current)!=null&&P.signal.aborted||V(!1)}},250);return()=>{window.clearTimeout(r),p.current&&p.current.abort()}}else p.current=null,u(null),V(!1)},[c,me]);const l=s.useMemo(()=>{if(!a)return null;const t=h=>{if(o.min!==null||o.max!==null)return!1;if(w.length>0){const i=h.Genres||[];if(!w.some(j=>i.some(X=>X.toLowerCase()===j.toLowerCase())))return!1}return!0},r=h=>{if(w.length>0){const i=h.Genres||[];if(!w.some(j=>i.some(X=>X.toLowerCase()===j.toLowerCase())))return!1}if(o.min!==null||o.max!==null){const i=h.ProductionYear;if(!i||i<=0||o.min!==null&&i<o.min||o.max!==null&&i>o.max)return!1}return!0},g=h=>!(o.min!==null||o.max!==null||w.length>0);return{songs:a.songs.filter(r),artists:a.artists.filter(t),albums:a.albums.filter(r),playlists:(a.playlists||[]).filter(g)}},[a,w,o]);s.useEffect(()=>{var t;if(d&&((t=G.current)==null||t.focus(),G.current)){const r=G.current.value.length;G.current.setSelectionRange(r,r)}},[d]),s.useEffect(()=>()=>{p.current&&p.current.abort()},[]);const Ce=t=>{b(t),t.trim().length>0&&!d&&v(!0)},Ie=()=>{b(""),u(null)},Ae=()=>{v(!1),b(""),u(null),se([]),ne({min:null,max:null})},he=t=>{ye(t),W(!0)},ke=t=>{se(t)},Ee=t=>{ne(t)},Pe=t=>{Q(`/artist/${t}`),v(!1),b(""),u(null)},Me=t=>{Q(`/album/${t}`),v(!1),b(""),u(null)},Te=t=>{y(t,[t])},Le=t=>{t.preventDefault(),t.stopPropagation(),l!=null&&l.songs&&l.songs.length>0&&L(l.songs)},Oe=t=>{t.preventDefault(),t.stopPropagation(),l!=null&&l.songs&&l.songs.length>0&&O(l.songs)},Re=t=>{Q(`/playlist/${t}`),v(!1),b(""),u(null)},F=(t,r,g="mobile",h)=>{J(t),q(r),D(g),B(h||null),R(!0)};s.useEffect(()=>{c.trim()||K(0)},[C,c]),s.useEffect(()=>{ue(ge)},[c,d,a==null?void 0:a.songs.length]),s.useEffect(()=>{var g;const t=te.current;if(!d||!t||!((g=a==null?void 0:a.songs)!=null&&g.length))return;const r=()=>{const h=t.scrollTop,i=t.clientHeight,P=t.scrollHeight;h+i*1.5>=P&&ue(j=>Math.min(j+tt,a.songs.length))};return t.addEventListener("scroll",r,{passive:!0}),()=>t.removeEventListener("scroll",r)},[d,a==null?void 0:a.songs.length,de]),s.useEffect(()=>{ce(xe)},[$,A.length]),s.useEffect(()=>{const t=()=>{const r=window.scrollY||document.documentElement.scrollTop,g=window.innerHeight||document.documentElement.clientHeight,h=document.documentElement.scrollHeight;r+g*1.5>=h&&ce(i=>Math.min(i+et,A.length))};return window.addEventListener("scroll",t,{passive:!0}),()=>window.removeEventListener("scroll",t)},[A.length]),s.useEffect(()=>{c.trim()||(!_.current&&ie.current!==C&&oe(!0),ie.current=C,Ge())},[$,C,c]),s.useEffect(()=>{_.current&&(_.current=!1)},[]);const Ge=async()=>{E("songs",!0);try{const t={limit:Y,startIndex:$*Y};C==="RecentlyAdded"?(t.sortBy=["DateCreated"],t.sortOrder="Descending"):(t.sortBy=["SortName"],t.sortOrder="Ascending");const r=await z.getSongs(t);n(r.Items),ee(r.TotalRecordCount||0)}catch(t){console.error("Failed to load songs:",t),n([]),ee(0)}finally{E("songs",!1),oe(!1)}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"pb-20",children:[e.jsx("div",{className:`fixed top-0 left-0 right-0 bg-black z-10 lg:left-16 transition-[left,right] duration-300 ${S?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top))"},children:e.jsx("div",{className:"max-w-[768px] mx-auto",children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Songs"}),e.jsx("button",{onClick:()=>v(!0),className:"w-10 h-10 flex items-center justify-center text-white hover:bg-zinc-800 rounded-full transition-colors","aria-label":"Search",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})]}),!d&&e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("button",{onClick:()=>k("songs",C==="RecentlyAdded"?"Alphabetical":"RecentlyAdded"),className:"text-sm text-gray-400 hover:text-white transition-colors flex items-center gap-1",children:[C==="RecentlyAdded"?"Recently Added":"Alphabetically",e.jsx(Je,{className:"w-4 h-4"})]}),T.songs&&!_.current&&e.jsx("div",{className:"flex items-center",children:e.jsx(De,{})})]})]})})}),e.jsx("div",{className:`fixed left-0 right-0 z-10 lg:left-16 transition-[left,right] duration-300 ${S?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 7rem - 8px)",height:"24px",background:"linear-gradient(to bottom, rgba(0, 0, 0, 0.8), transparent)"}}),e.jsx("div",{style:{paddingTop:"calc(env(safe-area-inset-top) + 7rem)"},children:!d&&e.jsx("div",{className:we?"opacity-50 pointer-events-none":"",children:A.length===0&&!T.songs?e.jsx("div",{className:"flex items-center justify-center py-16 text-gray-400",children:e.jsx("p",{children:"No songs found"})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-0",children:A.map((t,r)=>e.jsx(We,{song:t,showImage:r<Se,onContextMenu:F,contextMenuItemId:(x==null?void 0:x.Id)||null},t.Id))}),e.jsx(Xe,{currentPage:$,totalPages:Math.ceil(Z/Y),onPageChange:K,itemsPerPage:Y,totalItems:Z})]})})})]}),d&&ze.createPortal(e.jsx(e.Fragment,{children:e.jsxs("div",{ref:te,className:"fixed inset-0 bg-black z-[9999] overflow-y-auto p-0 m-0",children:[e.jsx("div",{className:"fixed top-0 left-0 right-0 bg-black z-50 pointer-events-none",style:{height:"env(safe-area-inset-top)",top:"var(--header-offset, 0px)"}}),e.jsx("div",{className:"fixed top-0 left-0 right-0 bg-black z-10 pt-0 pb-0 w-full m-0",style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top))",height:"76px"},children:e.jsx("div",{className:"max-w-[768px] mx-auto w-full",children:e.jsxs("div",{className:"flex items-center gap-3 px-4 pt-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(Ve,{ref:G,value:c,onChange:Ce,showClearButton:c.trim().length>0,onClear:Ie})}),e.jsx("button",{onClick:Ae,className:"px-4 py-2 text-white text-sm font-medium hover:text-zinc-300 transition-colors whitespace-nowrap flex-shrink-0",children:"Cancel"})]})})}),e.jsxs("div",{className:"max-w-[768px] mx-auto w-full",style:{paddingTop:"calc(52px + env(safe-area-inset-top))"},children:[e.jsx("div",{className:"sticky bg-black z-10 pt-3 pb-4",style:{top:"calc(76px + env(safe-area-inset-top))"},children:e.jsxs("div",{className:"flex items-center gap-3 px-4",children:[e.jsxs("button",{onClick:()=>he("genre"),className:`flex items-center gap-2 px-3 py-2 rounded-lg transition-colors ${w.length>0?"bg-[var(--accent-color)] text-white":"bg-white/10 text-white hover:bg-white/20"}`,"aria-label":"Filter by genre",children:[e.jsx($e,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Genre"})]}),e.jsxs("button",{onClick:()=>he("year"),className:`flex items-center gap-2 px-3 py-2 rounded-lg transition-colors ${o.min!==null||o.max!==null?"bg-[var(--accent-color)] text-white":"bg-white/10 text-white hover:bg-white/20"}`,"aria-label":"Filter by year",children:[e.jsx(qe,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Year"})]})]})}),e.jsx("div",{className:`fixed left-0 right-0 z-[60] lg:left-16 transition-[left,right] duration-300 ${S?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 76px + 4rem)",height:"24px",background:"linear-gradient(to bottom, rgba(0, 0, 0, 0.8), transparent)"}}),e.jsx("div",{className:"pb-32",style:{paddingTop:"40px"},children:je?e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-zinc-800 border-t-[var(--accent-color)]"})}):l?e.jsxs("div",{className:"space-y-8",children:[l.songs.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 px-4",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"Songs"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:Le,className:"w-10 h-10 flex items-center justify-center text-white hover:bg-white/10 rounded-lg transition-colors","aria-label":"Play all songs",children:e.jsx(_e,{className:"w-5 h-5"})}),e.jsx("button",{type:"button",onClick:Oe,className:"w-10 h-10 flex items-center justify-center text-white hover:bg-white/10 rounded-lg transition-colors","aria-label":"Add all songs to queue",children:e.jsx(He,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"space-y-0",children:l.songs.map((t,r)=>e.jsx(Ze,{song:t,onClick:Te,onContextMenu:F,contextMenuItemId:(x==null?void 0:x.Id)||null,showImage:r<de},t.Id))})]}),l.artists.length>0&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-4 px-4",children:"Artists"}),e.jsx("div",{className:"space-y-0",children:l.artists.slice(0,5).map(t=>e.jsx(Qe,{artist:t,onClick:Pe,onContextMenu:F,contextMenuItemId:(x==null?void 0:x.Id)||null},t.Id))})]}),l.albums.length>0&&e.jsxs("div",{className:"px-4",children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Albums"}),e.jsx("div",{className:"grid grid-cols-3 gap-4",children:l.albums.slice(0,12).map(t=>e.jsx(Ke,{album:t,onClick:Me,onContextMenu:F,contextMenuItemId:(x==null?void 0:x.Id)||null},t.Id))})]}),l.playlists&&l.playlists.length>0&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-4 px-4",children:"Playlists"}),e.jsx("div",{className:"space-y-0",children:l.playlists.map(t=>e.jsxs("button",{onClick:()=>Re(t.Id),onContextMenu:r=>{r.preventDefault(),r.stopPropagation(),F(t,"playlist","desktop",{x:r.clientX,y:r.clientY})},className:"w-full flex items-center gap-3 hover:bg-white/10 transition-colors group px-4 py-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-sm overflow-hidden flex-shrink-0 bg-zinc-900 self-center",children:e.jsx("img",{src:z.getAlbumArtUrl(t.Id,96),alt:t.Name,className:"w-full h-full object-cover",loading:"lazy"})}),e.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[e.jsx("div",{className:"text-sm font-medium text-white truncate group-hover:text-[var(--accent-color)] transition-colors",children:t.Name}),e.jsx("div",{className:"text-xs text-gray-400 truncate",children:t.ChildCount?`${t.ChildCount} tracks`:"Playlist"})]})]},t.Id))})]}),l.artists.length===0&&l.albums.length===0&&(!l.playlists||l.playlists.length===0)&&l.songs.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 text-gray-400 px-4",children:[e.jsx("div",{className:"text-lg mb-2",children:"No results found"}),e.jsx("div",{className:"text-sm",children:"Try a different search term"})]})]}):e.jsx("div",{className:"flex flex-col items-center justify-center py-16 text-gray-400 px-4"})})]})]})}),document.body),le==="genre"&&e.jsx(fe,{isOpen:re,onClose:()=>W(!1),filterType:"genre",genres:N,selectedValues:w,onApply:ke}),le==="year"&&e.jsx(fe,{isOpen:re,onClose:()=>W(!1),filterType:"year",availableYears:Ne,yearRange:o,onApplyYear:Ee}),e.jsx(Ye,{item:x,itemType:ve,isOpen:m,onClose:()=>{R(!1),J(null),q(null)},zIndex:99999,mode:f,position:U||void 0})]})}export{dt as default};
