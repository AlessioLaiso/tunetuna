import{c as P,K as je,b as ve,a as ee,i as Ne,h as ye,u as we,r as o,Y as ke,j as e,w as Me,e as N,I as Ce,Q as Se,H as Ie,U as Ae,D as $e,R as Te,G as De,a6 as te,a7 as Pe,a5 as se,y as ae,C as Fe,l as ze}from"./index-Def-zOqH.js";import{A as Le}from"./arrow-left-7VMywoCX.js";import{E as Ge}from"./ellipsis-CqmsnN94.js";import{C as Re}from"./clock-Cupj8OS0.js";import{C as Ee,T as le,S as Oe,G as Ye}from"./tag-Z6C-w5NC.js";import{P as ie}from"./piano-GaLAw_6p.js";/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Be=[["path",{d:"M4 6.835V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.706.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2h-.343",key:"1vfytu"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M2 19a2 2 0 0 1 4 0v1a2 2 0 0 1-4 0v-4a6 6 0 0 1 12 0v4a2 2 0 0 1-4 0v-1a2 2 0 0 1 4 0",key:"1etmh7"}]],He=P("file-headphone",Be);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]],Ue=P("folder-open",_e);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const We=[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]],Ve=P("hash",We),Je=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function Qe(r){const l=[],c=new Date,i=r?new Date(r):new Date(c.getFullYear(),0,1);let d=new Date(i.getFullYear(),i.getMonth(),1);for(;d<=c;){const m=`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}`;l.push({value:m}),d.setMonth(d.getMonth()+1)}return l.reverse()}function qe(r){const l=new Date,c=`${l.getFullYear()}-${String(l.getMonth()+1).padStart(2,"0")}`;if(!r)return{from:c,to:c};const i=new Date(l);i.setMonth(i.getMonth()-11);const d=new Date(r),m=d>i?d:i;return{from:`${m.getFullYear()}-${String(m.getMonth()+1).padStart(2,"0")}`,to:c}}function ne(r){const[l,c]=r.split("-").map(Number);return`${Je[c-1]} ${l}`}function re(r){return r?r.charAt(0).toUpperCase()+r.slice(1):""}function Ke(r){const l=new Map;return r.forEach(c=>{const i=c.trim().toLowerCase();if(!i)return;const d=i.indexOf("_");if(d===-1)l.has(i)||l.set(i,[]);else{const m=i.substring(0,d),u=i.substring(d+1);l.has(m)||l.set(m,[]),l.get(m).push({display:re(u),raw:u})}}),Array.from(l.entries()).map(([c,i])=>({key:c,category:re(c),values:i}))}function Xe(r){switch(r.toLowerCase()){case"language":return Ye;case"mood":return Oe;case"instrumental":return ie;default:return le}}function rt(){var q,K,X,Z;const{id:r}=je(),l=ve(),{playTrack:c,isPlaying:i,play:d,pause:m}=ee(),u=Ne(),oe=ee(t=>t.isQueueSidebarOpen),{pageVisibility:g}=ye(),{genres:ce}=we(),[s,de]=o.useState(null),[xe,F]=o.useState(!0),[j,me]=o.useState(null),[A,z]=o.useState(!0),[$,L]=o.useState(!0),[v,G]=o.useState(!0),[ue,R]=o.useState(!1),[he,E]=o.useState("mobile"),[pe,O]=o.useState(null),{fetchEvents:Y,oldestEventTs:y,initializeOldestTs:B,pendingEvents:T}=ke(),[H,ge]=o.useState(null),[w,_]=o.useState(""),[k,U]=o.useState(""),M=o.useMemo(()=>{const t=[y,...T.map(a=>a.ts)].filter(a=>a!==null);return t.length>0?Math.min(...t):null},[y,T]),W=o.useMemo(()=>Qe(M),[M]);o.useEffect(()=>{g.stats&&y===null&&B()},[g.stats,y,B]),o.useEffect(()=>{if(!g.stats)return;const{from:t,to:a}=qe(M);_(t),U(a)},[M,g.stats]),o.useEffect(()=>{if(!g.stats||!w||!k||!r)return;(async()=>{const[a,n]=w.split("-").map(Number),[x,h]=k.split("-").map(Number),b=new Date(a,n-1,1).getTime(),C=new Date(x,h,0,23,59,59,999).getTime(),S=(await Y(b,C)).filter(I=>I.songId===r).length;ge(S)})()},[g.stats,w,k,r,Y,T.length]),o.useEffect(()=>{if(!r)return;let t=!0;return(async()=>{F(!0),z(!0);try{const[n,x]=await Promise.all([N.getSongById(r),N.getLyrics(r)]);if(!t)return;n&&(de(n),L(!!n.AlbumId)),me(x)}catch(n){if(!t)return;ze.error("Failed to load song data:",n)}finally{t&&(F(!1),z(!1))}})(),()=>{t=!1}},[r]);const fe=t=>{const a=ce.find(n=>{var x;return((x=n.Name)==null?void 0:x.toLowerCase())===t.toLowerCase()});return(a==null?void 0:a.Id)||null},V=(u==null?void 0:u.Id)===(s==null?void 0:s.Id)&&i,J=o.useMemo(()=>{let t=s==null?void 0:s.Grouping;return(!t||t.length===0)&&(s!=null&&s.Tags)&&(t=s.Tags.filter(a=>a.startsWith("grouping:")).map(a=>a.replace("grouping:",""))),!t||t.length===0?[]:Ke(t)},[s==null?void 0:s.Grouping,s==null?void 0:s.Tags]);if(xe)return e.jsx("div",{className:"pb-20",children:e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsx(Me,{})})});if(!s)return e.jsx("div",{className:"pb-20",children:e.jsx("div",{className:"flex items-center justify-center h-screen text-gray-400",children:e.jsx("p",{children:"Song not found"})})});const Q=((K=(q=s.ArtistItems)==null?void 0:q[0])==null?void 0:K.Name)||s.AlbumArtist||null,p=((Z=(X=s.ArtistItems)==null?void 0:X[0])==null?void 0:Z.Id)||null;return e.jsxs("div",{className:"pb-20",children:[e.jsx("div",{className:`fixed top-0 left-0 right-0 z-[60] lg:left-16 transition-[left,right] duration-300 ${oe?"sidebar-open-right-offset":""}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top))"},children:e.jsx("div",{className:"max-w-[768px] mx-auto",children:e.jsxs("div",{className:"relative flex items-center justify-between gap-4 py-4 pl-3 pr-4",children:[e.jsx("button",{onClick:()=>l(-1),className:"text-white hover:text-zinc-300 transition-colors z-10",children:e.jsx(Le,{className:"w-6 h-6"})}),e.jsx("button",{onClick:t=>{if(window.innerWidth<768)E("mobile"),O(null);else{const a=t.currentTarget.getBoundingClientRect();E("desktop"),O({x:a.left+a.width/2,y:a.bottom+5})}R(!0)},className:"text-white hover:text-zinc-300 transition-colors z-10",children:e.jsx(Ge,{className:"w-6 h-6"})})]})})}),e.jsxs("div",{className:"relative z-30 w-screen",style:{marginTop:"calc(-1 * env(safe-area-inset-top))",marginLeft:"calc(50% - 50vw)",marginRight:"calc(50% - 50vw)"},children:[v&&p&&e.jsxs("div",{className:"relative w-full min-h-64 md:min-h-80 bg-black",style:{paddingTop:"env(safe-area-inset-top)"},children:[e.jsx("div",{className:"w-full h-64 md:hidden",children:$&&s.AlbumId?e.jsx("img",{src:N.getAlbumArtUrl(s.AlbumId),alt:"",className:"w-full h-full object-cover",onError:()=>G(!1)}):e.jsx("div",{className:"w-full h-full bg-zinc-900"})}),e.jsx("div",{className:"hidden md:block w-full h-80",children:e.jsx("img",{src:N.getArtistBackdropUrl(p,1920),alt:"",className:"w-full h-full object-cover object-[center_20%]",onError:()=>G(!1)})}),e.jsx("div",{className:"absolute inset-x-0 top-0 bottom-[-1px] bg-gradient-to-b from-transparent via-black/60 to-black pointer-events-none"})]}),e.jsx("div",{className:`left-0 right-0 ${v&&p?"absolute":"relative"} ${v&&p?"pt-16":"pt-12"}`,style:v&&p?{bottom:"-28px",paddingBottom:"1.5rem"}:{},children:e.jsxs("div",{className:"max-w-[768px] mx-auto px-4 flex items-end gap-6 md:grid md:grid-cols-3 md:gap-4",children:[$&&s.AlbumId&&e.jsx("div",{className:"hidden md:block md:col-span-1",children:e.jsx("div",{className:"aspect-square rounded overflow-hidden bg-zinc-900 flex items-center justify-center",children:e.jsx(Ce,{src:N.getAlbumArtUrl(s.AlbumId),alt:s.Name,className:"w-full h-full object-cover",showOutline:!0,rounded:"rounded",onError:()=>L(!1)})})}),e.jsx("div",{className:`flex-1 min-w-0 pb-2 ${$?"md:col-span-2":"md:col-span-3"}`,children:e.jsxs("div",{className:"mb-4 mt-4",children:[e.jsx("h1",{className:"text-4xl md:text-5xl font-bold text-white mb-2 break-words",children:s.Name}),e.jsx("div",{className:"flex items-center justify-end gap-4 mt-2",children:e.jsx("button",{onClick:()=>{V?m():(u==null?void 0:u.Id)===s.Id?d():c(s)},className:"bg-white/10 hover:bg-white/20 text-white font-semibold py-1.5 px-3 rounded-full transition-all hover:scale-105 flex items-center gap-1.5 backdrop-blur-sm border border-white/20 flex-shrink-0",children:V?e.jsxs(e.Fragment,{children:[e.jsx(Se,{className:"w-3.5 h-3.5"}),"Pause"]}):e.jsxs(e.Fragment,{children:[e.jsx(Ie,{className:"w-3.5 h-3.5"}),"Play"]})})})]})})]})})]}),e.jsx("div",{className:`${v&&p?"pt-3 md:pt-7":"pt-3"}`,children:e.jsx("div",{className:"px-4 mt-2",children:e.jsxs("div",{className:"grid gap-x-3 gap-y-6 items-start",style:{gridTemplateColumns:"auto auto 1fr"},children:[Q&&e.jsx(f,{icon:Ae,label:"Artist",value:Q,onClick:p?()=>l(`/artist/${p}`):void 0}),s.Album&&e.jsx(f,{icon:$e,label:"Album",value:s.Album,onClick:s.AlbumId?()=>l(`/album/${s.AlbumId}`):void 0}),s.IndexNumber!=null&&e.jsx(f,{icon:Ve,label:s.ParentIndexNumber!=null&&s.ParentIndexNumber>1?`Disc ${s.ParentIndexNumber}, Track`:"Track",value:String(s.IndexNumber)}),s.RunTimeTicks!=null&&e.jsx(f,{icon:Re,label:"Duration",value:Te(s.RunTimeTicks)}),s.ProductionYear!=null&&e.jsx(f,{icon:Ee,label:"Year",value:String(s.ProductionYear),onClick:()=>l(`/songs?year=${s.ProductionYear}`)}),s.Genres&&s.Genres.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(De,{className:"w-4 h-4 text-gray-400 flex-shrink-0 mt-1"}),e.jsx("span",{className:"text-gray-400 text-base flex-shrink-0 truncate",style:{maxWidth:"128px"},children:s.Genres.length===1?"Genre":"Genres"}),e.jsx("div",{className:"flex flex-wrap gap-x-1",children:s.Genres.map((t,a)=>e.jsxs("span",{children:[e.jsx("button",{onClick:()=>{const n=fe(t);n&&l(`/genre/${encodeURIComponent(n)}`)},className:"text-base text-white hover:text-gray-300 transition-colors",children:t}),a<s.Genres.length-1&&e.jsx("span",{className:"text-white",children:", "})]},t))})]}),J.filter(({values:t})=>t.length>0).map(({key:t,category:a,values:n})=>{const x=Xe(t);return e.jsxs(te.Fragment,{children:[e.jsx(x,{className:"w-4 h-4 text-gray-400 flex-shrink-0 mt-1"}),e.jsx("span",{className:"text-gray-400 text-base flex-shrink-0 truncate",style:{maxWidth:"128px"},children:a}),e.jsx("div",{className:"flex flex-wrap gap-x-1",children:n.map((h,b)=>e.jsxs("span",{children:[e.jsx("button",{onClick:()=>l(t==="mood"?`/mood/${h.raw}`:`/songs?grouping=${t}_${h.raw}`),className:"text-base text-white hover:text-gray-300 transition-colors",children:h.display}),b<n.length-1&&e.jsx("span",{className:"text-white",children:", "})]},h.raw))})]},t)}),(()=>{const t=J.filter(({values:n})=>n.length===0);if(t.length===0)return null;let a=le;return t.length===1&&t[0].key.toLowerCase()==="instrumental"&&(a=ie),e.jsxs(te.Fragment,{children:[e.jsx(a,{className:"w-4 h-4 text-gray-400 flex-shrink-0 mt-1"}),e.jsx("span",{className:"text-gray-400 text-base flex-shrink-0 truncate",style:{maxWidth:"128px"},children:"Tag"}),e.jsx("div",{className:"flex flex-wrap gap-x-1",children:t.map((n,x)=>e.jsxs("span",{children:[e.jsx("button",{onClick:()=>l(`/songs?grouping=${n.key}`),className:"text-base text-white hover:text-gray-300 transition-colors",children:n.category}),x<t.length-1&&e.jsx("span",{className:"text-white",children:", "})]},n.key))})]})})(),g.stats&&e.jsxs(e.Fragment,{children:[e.jsx(Pe,{className:"w-4 h-4 text-gray-400 flex-shrink-0 mt-1"}),e.jsx("span",{className:"text-gray-400 text-base flex-shrink-0 truncate",style:{maxWidth:"128px"},children:"Streams"}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"text-base text-white",children:H!==null?`${H}`:"..."}),e.jsxs("div",{className:"flex gap-1.5 items-center",children:[e.jsxs("div",{className:"relative",children:[e.jsx("select",{value:w,onChange:t=>_(t.target.value),className:"appearance-none bg-zinc-800 text-white rounded-lg px-2 py-1 pr-6 text-xs font-medium cursor-pointer hover:bg-zinc-700 transition-colors",children:W.map(t=>e.jsx("option",{value:t.value,children:ne(t.value)},t.value))}),e.jsx(se,{className:"absolute right-1 top-1/2 -translate-y-1/2 w-3.5 h-3.5 text-zinc-400 pointer-events-none"})]}),e.jsx("span",{className:"text-zinc-400 text-xs",children:"to"}),e.jsxs("div",{className:"relative",children:[e.jsx("select",{value:k,onChange:t=>U(t.target.value),className:"appearance-none bg-zinc-800 text-white rounded-lg px-2 py-1 pr-6 text-xs font-medium cursor-pointer hover:bg-zinc-700 transition-colors",children:W.map(t=>e.jsx("option",{value:t.value,children:ne(t.value)},t.value))}),e.jsx(se,{className:"absolute right-1 top-1/2 -translate-y-1/2 w-3.5 h-3.5 text-zinc-400 pointer-events-none"})]})]})]})]}),s.Path&&e.jsx(f,{icon:Ue,label:"Path",value:s.Path}),(()=>{var x,h,b,C,D,S,I;const t=(b=(h=(x=s.MediaSources)==null?void 0:x[0])==null?void 0:h.MediaStreams)==null?void 0:b.find(be=>be.Type==="Audio"),a=(D=(C=s.MediaSources)==null?void 0:C[0])==null?void 0:D.Container;if(!t&&!a)return null;const n=[];return t!=null&&t.Codec&&n.push(t.Codec.toUpperCase()),t!=null&&t.BitDepth&&(t!=null&&t.SampleRate)?n.push(`${t.BitDepth}-bit / ${(t.SampleRate/1e3).toFixed(1)} kHz`):t!=null&&t.SampleRate&&n.push(`${(t.SampleRate/1e3).toFixed(1)} kHz`),t!=null&&t.BitRate?n.push(`${Math.round(t.BitRate/1e3)} kbps`):(I=(S=s.MediaSources)==null?void 0:S[0])!=null&&I.Bitrate&&n.push(`${Math.round(s.MediaSources[0].Bitrate/1e3)} kbps`),t!=null&&t.Channels&&n.push(t.Channels===1?"Mono":t.Channels===2?"Stereo":`${t.Channels}ch`),n.length===0&&a&&n.push(a.toUpperCase()),n.length===0?null:e.jsx(f,{icon:He,label:"Format",value:n.join(" Â· ")})})(),(A||j)&&e.jsxs(e.Fragment,{children:[e.jsx(ae,{className:"w-4 h-4 text-gray-400 flex-shrink-0 mt-1 hidden md:block"}),e.jsx("span",{className:"text-gray-400 text-base flex-shrink-0 truncate hidden md:block",style:{maxWidth:"128px"},children:"Lyrics"}),e.jsx("div",{className:"hidden md:block",children:A?e.jsx("span",{className:"text-base text-white/50",children:"Loading..."}):j?e.jsx("div",{className:"text-white whitespace-pre-line text-base",children:j.split(`
`).map((t,a)=>e.jsx("div",{className:"mb-1 leading-relaxed",children:t},a))}):null}),e.jsxs("div",{className:"md:hidden",style:{gridColumn:"1 / -1"},children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(ae,{className:"w-4 h-4 text-gray-400 flex-shrink-0"}),e.jsx("span",{className:"text-gray-400 text-base",children:"Lyrics"})]}),A?e.jsx("div",{className:"text-base text-white/50 pl-7",children:"Loading..."}):j?e.jsx("div",{className:"text-white whitespace-pre-line text-base pl-7",children:j.split(`
`).map((t,a)=>e.jsx("div",{className:"mb-1 leading-relaxed",children:t},a))}):null]})]})]})})}),e.jsx(Fe,{item:s,itemType:"song",isOpen:ue,onClose:()=>R(!1),mode:he,position:pe||void 0})]})}function f({icon:r,label:l,value:c,onClick:i}){return e.jsxs(e.Fragment,{children:[e.jsx(r,{className:"w-4 h-4 text-gray-400 flex-shrink-0 mt-1"}),e.jsx("span",{className:"text-gray-400 text-base flex-shrink-0 truncate",style:{maxWidth:"128px"},children:l}),i?e.jsx("button",{onClick:i,className:"text-base text-white hover:text-gray-300 transition-colors text-left break-all",children:c}):e.jsx("span",{className:"text-base text-white break-all",children:c})]})}export{rt as default};
