import{c as Fe,r as t,u as Y,g as Ee,a as de,b as ne,d as Ye,j as e,S as _e,l as be,e as $,I as Ie,C as ve,f as Te,D as Ce,h as je,i as We,F as Se,k as Ve,m as Xe,P as Ue,n as Qe,o as Re,p as De,q as we,s as qe,M as Je}from"./index-CGRvUryl.js";import{S as Ke}from"./search-CLKUzEQC.js";import{u as Ze,F as Ne}from"./useSearch-BXbJ8ylv.js";import{C as et,a as tt}from"./chevron-right-CLb5gNRg.js";import{E as st}from"./ellipsis-BwAsU9Jn.js";import"./tag-qu5Bmic4.js";import"./piano-D_6wLoPK.js";/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nt=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],lt=Fe("search",nt);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const it=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],at=Fe("settings",it),rt=[{type:"artists",limit:5},{type:"albums",limit:12},{type:"playlists"},{type:"songs"}];function ot({onSearchStateChange:s,title:d="Search"}){const[a,i]=t.useState(!1),m=t.useRef(null),x=t.useRef(null),[p,f]=t.useState(!1),[l,o]=t.useState(null),[r,b]=t.useState(null),{genres:c,songs:h}=Y(),[w,v]=t.useState([]),N=t.useMemo(()=>Ee(h),[h]),{playAlbum:E,addToQueue:O,playTrack:T,shuffleAllSongs:B,isQueueSidebarOpen:W}=de(),[n,A]=t.useState(!1),{searchQuery:F,setSearchQuery:R,isSearching:M,searchResults:L,selectedGenres:U,setSelectedGenres:Z,yearRange:Q,setYearRange:le,selectedGroupings:J,setSelectedGroupings:ue,groupingMatchModes:K,setGroupingMatchModes:ee,clearSearch:_,clearAll:fe}=Ze({debounceMs:300});t.useEffect(()=>{if(n){const y=setTimeout(()=>{A(!1)},1e4);return()=>clearTimeout(y)}},[n]);const V=ne(),[te,se]=Ye();t.useEffect(()=>{const y=te.get("yearMin"),I=te.get("yearMax"),D=te.get("genre");let X=!1;(y||I)&&(le({min:y?parseInt(y,10):null,max:I?parseInt(I,10):null}),X=!0),D&&(Z([D]),X=!0),X&&(i(!0),se({},{replace:!0}))},[]),t.useEffect(()=>{(async()=>{try{const I=Y.getState();if(I.years.length>0)v(I.years);else{const D=await $.getYears();v(D)}}catch(I){be.error("Failed to load filter values:",I)}})()},[]);const pe=y=>{R(y),y.trim().length>0&&!a&&i(!0)},ie=y=>{V(`/artist/${y}`),i(!1),_()},j=y=>{V(`/album/${y}`),i(!1),_()},G=y=>{T(y,[y])},C=y=>{V(`/playlist/${y}`),i(!1),_()},z=()=>{_()},u=()=>{i(!1),fe()},P=y=>{o(y),f(!0)},S=y=>{Z(y)},k=y=>{le(y)},g=y=>{b(y),o("grouping"),f(!0)},q=(y,I)=>{ue(D=>({...D,[y]:I}))},ae=(y,I)=>{ee(D=>({...D,[y]:I}))},xe=()=>{L!=null&&L.songs&&L.songs.length>0&&E(L.songs)},re=()=>{L!=null&&L.songs&&L.songs.length>0&&O(L.songs)},oe=a;return t.useEffect(()=>{s&&s(oe)},[oe,s]),t.useEffect(()=>{if(a){const I=window.matchMedia("(hover: hover) and (pointer: fine) and (min-width: 1024px)").matches?x:m;setTimeout(()=>{var D;if((D=I.current)==null||D.focus(),I.current){const X=I.current.value.length;I.current.setSelectionRange(X,X)}},50)}},[a]),t.useEffect(()=>{if(!a)return;const y=I=>{I.key==="Escape"&&(I.preventDefault(),I.stopPropagation(),u())};return window.addEventListener("keydown",y,!0),()=>window.removeEventListener("keydown",y,!0)},[a]),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"px-4 md:pl-2 md:pr-4 pt-4 pb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Tunetuna"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:async()=>{const y=de.getState(),{isShuffleAllActive:I,isShuffleGenreActive:D}=y;if(!(n||I||D)){A(!0);try{await B()}catch(X){be.error("Home shuffle button - shuffleAllSongs failed:",X),be.error("Shuffle all failed:",X)}finally{A(!1)}}},disabled:n,className:"w-10 h-10 flex items-center justify-center text-white hover:bg-zinc-800 rounded-full transition-colors disabled:opacity-50","aria-label":"Shuffle all songs",children:n?e.jsx("div",{className:"w-5 h-5 border-2 border-zinc-400 border-t-white rounded-full animate-spin"}):e.jsx(_e,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>i(!0),className:"w-10 h-10 flex items-center justify-center text-white hover:bg-zinc-800 rounded-full transition-colors","aria-label":"Search",children:e.jsx(lt,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>V("/settings"),className:"w-10 h-10 flex items-center justify-center text-white hover:bg-zinc-800 rounded-full transition-colors","aria-label":"Settings",children:e.jsx(at,{className:"w-5 h-5"})})]})]})}),e.jsx(Ke,{isOpen:a,onClose:u,title:d,searchQuery:F,onSearchChange:pe,onClearSearch:z,isLoading:M,results:L,sections:rt,filterConfig:{showGenreFilter:!0,showYearFilter:!0,showGroupingFilters:!0},filterState:{selectedGenres:U,yearRange:Q,selectedGroupings:J},onOpenFilterSheet:P,groupingCategories:N,onOpenGroupingFilterSheet:g,onArtistClick:ie,onAlbumClick:j,onSongClick:G,onPlaylistClick:C,onPlayAllSongs:xe,onAddSongsToQueue:re,isQueueSidebarOpen:W,desktopSearchInputRef:x,mobileSearchInputRef:m}),l==="genre"&&e.jsx(Ne,{isOpen:p,onClose:()=>f(!1),filterType:"genre",genres:c,selectedValues:U,onApply:S}),l==="year"&&e.jsx(Ne,{isOpen:p,onClose:()=>f(!1),filterType:"year",availableYears:w,yearRange:Q,onApplyYear:k}),l==="grouping"&&r&&e.jsx(Ne,{isOpen:p,onClose:()=>f(!1),filterType:"grouping",groupingCategory:r,selectedGroupingValues:J[r.key]||[],onApplyGrouping:q,groupingMatchMode:K[r.key]||"or",onGroupingMatchModeChange:ae})]})}function Ae({moodValue:s,moodName:d,albumId:a}){const i=ne(),{recordMoodAccess:m}=Y(),x=()=>{m(s),i(`/mood/${encodeURIComponent(s)}`)};return e.jsxs("button",{onClick:x,className:"bg-zinc-800/50 rounded border border-zinc-700/50 hover:bg-zinc-800 transition-colors group text-left flex items-center w-full h-11 overflow-hidden",children:[a&&e.jsx("div",{className:"h-full flex-shrink-0 hidden md:block",children:e.jsx(Ie,{src:$.getAlbumArtUrl(a,56),alt:"",className:"w-full h-full object-cover",showOutline:!1,rounded:""})}),e.jsx("div",{className:"text-sm font-medium text-white group-hover:text-[var(--accent-color)] transition-colors truncate py-2 pl-3",children:d})]})}function Oe({children:s,className:d="",gap:a=12}){const i=t.useRef(null),[m,x]=t.useState(!1),[p,f]=t.useState(!1),[l,o]=t.useState(!1),r=()=>{if(!i.current)return;const{scrollLeft:c,scrollWidth:h,clientWidth:w}=i.current;x(c>0),f(c+w<h-1)};t.useEffect(()=>{r();const c=i.current;if(c)return c.addEventListener("scroll",r,{passive:!0}),window.addEventListener("resize",r),()=>{c.removeEventListener("scroll",r),window.removeEventListener("resize",r)}},[s]);const b=c=>{if(!i.current)return;const h=i.current,w=h.clientWidth+a;h.scrollBy({left:c==="left"?-w:w,behavior:"smooth"})};return e.jsxs("div",{className:"relative",onMouseEnter:()=>o(!0),onMouseLeave:()=>o(!1),children:[e.jsx("div",{ref:i,className:`overflow-x-auto scrollbar-hide ${d}`,style:{scrollbarWidth:"none",msOverflowStyle:"none"},children:s}),m&&l&&e.jsx("button",{onClick:()=>b("left"),className:"absolute left-0 top-1/2 -translate-y-1/2 z-10 w-10 h-10 flex items-center justify-center bg-black/70 hover:bg-black/90 rounded-full transition-colors","aria-label":"Scroll left",children:e.jsx(et,{className:"w-6 h-6 text-white"})}),p&&l&&e.jsx("button",{onClick:()=>b("right"),className:"absolute right-0 top-1/2 -translate-y-1/2 z-10 w-10 h-10 flex items-center justify-center bg-black/70 hover:bg-black/90 rounded-full transition-colors","aria-label":"Scroll right",children:e.jsx(tt,{className:"w-6 h-6 text-white"})}),e.jsx("style",{children:`
        .scrollbar-hide::-webkit-scrollbar {
          display: none;
        }
      `})]})}function ct(s){let d=0;for(let a=0;a<s.length;a++){const i=s.charCodeAt(a);d=(d<<5)-d+i,d=d&d}return d}function dt(s){const d=new Date().toISOString().split("T")[0];return ct(`${d}-${s}`)}function ut(s){return s?s.charAt(0).toUpperCase()+s.slice(1):""}function ft(s,d,a){const i=d.filter(l=>{var o;return(o=l.Grouping)==null?void 0:o.some(r=>r.toLowerCase()===`mood_${s.toLowerCase()}`)});if(i.length===0)return null;const m=i.filter(l=>l.AlbumId);if(m.length===0)return null;let x=m.filter(l=>!a.has(l.AlbumId));x.length===0&&(x=m);const p=dt(s),f=Math.abs(p)%x.length;return x[f].AlbumId}function mt(s,d){return[...s].sort((a,i)=>{const m=d[a.toLowerCase()]||0,x=d[i.toLowerCase()]||0;return m!==x?x-m:a.localeCompare(i)})}function Le(s,d){const a=Math.ceil(s.length/d),i=[];for(let m=0;m<a;m++)for(let x=0;x<d;x++){const p=x*a+m;p<s.length&&i.push(s[p])}return i}function ht(){const{songs:s,recentlyAccessedMoods:d}=Y(),a=t.useRef(null),i=t.useMemo(()=>Ee(s).find(l=>l.key==="mood"),[s]),m=t.useMemo(()=>{if(!i||i.values.length===0)return[];const f=mt(i.values,d),l=new Set;return f.map(o=>{const r=ft(o.toLowerCase(),s,l);return r&&l.add(r),{value:o.toLowerCase(),name:ut(o),albumId:r}})},[i,s,d]);if(m.length===0)return null;const x=6,p=[];for(let f=0;f<m.length;f+=x)p.push(m.slice(f,f+x));return e.jsxs("div",{className:"px-4 mb-12",children:[e.jsx("div",{className:"md:hidden",children:e.jsx("div",{ref:a,className:"overflow-x-auto snap-x snap-mandatory scrollbar-hide",style:{scrollbarWidth:"none",msOverflowStyle:"none"},children:e.jsx("div",{className:"flex gap-2",children:p.map((f,l)=>{const o=Math.ceil(f.length/3);return e.jsx("div",{className:"snap-start flex-shrink-0",style:{width:"calc(100% - 8px)"},children:e.jsx("div",{className:"grid grid-cols-3 gap-2",style:{gridTemplateRows:`repeat(${o}, minmax(0, 1fr))`},children:f.map(r=>e.jsx(Ae,{moodValue:r.value,moodName:r.name,albumId:r.albumId},r.value))})},l)})})})}),e.jsx("div",{className:"hidden md:block min-[1680px]:hidden",children:e.jsx(Oe,{gap:8,children:e.jsx("div",{className:"grid grid-rows-2 grid-flow-col gap-2",style:{gridAutoColumns:"calc((100% - 24px) / 4)"},children:Le(m,2).map(f=>e.jsx(Ae,{moodValue:f.value,moodName:f.name,albumId:f.albumId},f.value))})})}),e.jsx("div",{className:"hidden min-[1680px]:block",children:e.jsx(Oe,{gap:8,children:e.jsx("div",{className:"grid grid-rows-2 grid-flow-col gap-2",style:{gridAutoColumns:"calc((100% - 32px) / 5)"},children:Le(m,2).map(f=>e.jsx(Ae,{moodValue:f.value,moodName:f.name,albumId:f.albumId},f.value))})})}),e.jsx("style",{children:`
        .scrollbar-hide::-webkit-scrollbar {
          display: none;
        }
      `})]})}function ke({album:s,onNavigate:d,onContextMenu:a}){var r,b,c,h;const i=ne(),[m,x]=t.useState(!1),p=t.useRef(!1),f=w=>{if(p.current){p.current=!1;return}d(s.Id)},l=w=>{w.preventDefault(),w.stopPropagation(),p.current=!0,a(s,"desktop",{x:w.clientX,y:w.clientY}),setTimeout(()=>{p.current=!1},300)},o=Te({onLongPress:w=>{w.preventDefault(),p.current=!0,a(s,"mobile")},onClick:()=>{if(p.current){p.current=!1;return}f()}});return e.jsxs("button",{onClick:()=>{if(p.current){p.current=!1;return}f()},onContextMenu:l,...o,className:"text-left group",children:[e.jsx("div",{className:"aspect-square rounded overflow-hidden mb-2 bg-zinc-900 flex items-center justify-center",children:m?e.jsx(Ce,{className:"w-12 h-12 text-gray-500"}):e.jsx(Ie,{src:$.getAlbumArtUrl(s.Id,474),alt:s.Name,className:"w-full h-full object-cover",showOutline:!0,rounded:"rounded",onError:()=>x(!0)})}),e.jsx("div",{className:"text-sm font-medium text-white truncate group-hover:text-[var(--accent-color)] transition-colors",children:s.Name}),e.jsx("div",{className:"text-xs text-gray-400 truncate",children:(b=(r=s.ArtistItems)==null?void 0:r[0])!=null&&b.Id?e.jsx("span",{className:"clickable-text",onMouseDown:w=>w.stopPropagation(),onClick:w=>{w.stopPropagation(),i(`/artist/${s.ArtistItems[0].Id}`)},children:s.AlbumArtist||s.ArtistItems[0].Name||"Unknown Artist"}):s.AlbumArtist||((h=(c=s.ArtistItems)==null?void 0:c[0])==null?void 0:h.Name)||"Unknown Artist"})]})}function pt(){const{recentlyAdded:s,setRecentlyAdded:d,setLoading:a}=Y(),i=ne(),m=t.useRef(null),[x,p]=t.useState(!1),[f,l]=t.useState("mobile"),[o,r]=t.useState(null),[b,c]=t.useState(null);if(t.useEffect(()=>{(async()=>{a("recentlyAdded",!0);try{const N=await $.getRecentlyAdded(18);d(N.Items||[])}catch(N){be.error("Failed to load recently added:",N)}finally{a("recentlyAdded",!1)}})()},[d,a]),!s||s.length===0)return null;const h=6,w=[];for(let v=0;v<s.length;v+=h)w.push(s.slice(v,v+h));return e.jsxs("div",{className:"px-4 mb-8",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Recently Added"}),e.jsx("div",{className:"md:hidden",children:e.jsx("div",{ref:m,className:"overflow-x-auto snap-x snap-mandatory scrollbar-hide",style:{scrollbarWidth:"none",msOverflowStyle:"none"},children:e.jsx("div",{className:"flex gap-3",children:w.map((v,N)=>{const E=Math.ceil(v.length/3);return e.jsx("div",{className:"snap-start flex-shrink-0",style:{width:"calc(100% - 12px)"},children:e.jsx("div",{className:"grid grid-cols-3 gap-3",style:{gridTemplateRows:`repeat(${E}, minmax(0, 1fr))`},children:v.map(O=>e.jsx(ke,{album:O,onNavigate:T=>i(`/album/${T}`),onContextMenu:(T,B,W)=>{c(T),l(B||"desktop"),r(W||null),p(!0)}},O.Id))})},N)})})})}),e.jsx("div",{className:"hidden md:block min-[1680px]:hidden",children:e.jsx("div",{className:"grid grid-cols-4 gap-3",children:s.slice(0,8).map(v=>e.jsx(ke,{album:v,onNavigate:N=>i(`/album/${N}`),onContextMenu:(N,E,O)=>{c(N),l(E||"desktop"),r(O||null),p(!0)}},v.Id))})}),e.jsx("div",{className:"hidden min-[1680px]:block",children:e.jsx("div",{className:"grid grid-cols-5 gap-3",children:s.slice(0,10).map(v=>e.jsx(ke,{album:v,onNavigate:N=>i(`/album/${N}`),onContextMenu:(N,E,O)=>{c(N),l(E||"desktop"),r(O||null),p(!0)}},v.Id))})}),e.jsx("style",{children:`
        .scrollbar-hide::-webkit-scrollbar {
          display: none;
        }
      `}),e.jsx(ve,{item:b,itemType:"album",isOpen:x,onClose:()=>{p(!1),c(null)},zIndex:999999,mode:f,position:o||void 0})]})}function xt(){const[s,d]=t.useState(()=>Y.persist.hasHydrated());return t.useEffect(()=>{if(Y.persist.hasHydrated()){d(!0);return}return Y.persist.onFinishHydration(()=>{d(!0)})},[]),s}function ce(s){return s.toLowerCase().replace(/[^a-z0-9]/g,"")}function ye(s){return s.replace(/\s*\(feat\..*?\)/gi,"").replace(/\s*\[feat\..*?\]/gi,"").replace(/\s*ft\..*$/gi,"").replace(/\s*\(with.*?\)/gi,"").replace(/\s*\[with.*?\]/gi,"").replace(/\s*\(explicit\)/gi,"").replace(/\s*\[explicit\]/gi,"").replace(/\s*\(deluxe.*?\)/gi,"").replace(/\s*\[deluxe.*?\]/gi,"").replace(/\s*-\s*single$/gi,"").replace(/\s*-\s*ep$/gi,"").trim()}function $e(s){return s.split(/[,&]/)[0].replace(/\s*feat\..*$/gi,"").replace(/\s*ft\..*$/gi,"").replace(/\s*with\s+.*$/gi,"").trim()}function ze(){const s=Y(l=>l.songs),d=Y(l=>l.genreSongs),a=xt(),i=t.useMemo(()=>{var r,b;if(!a)return new Map;let l=s;if(l.length===0&&d){const c=new Set;l=Object.values(d).flat().filter(h=>c.has(h.Id)?!1:(c.add(h.Id),!0))}const o=new Map;for(const c of l){const h=ce($e(c.AlbumArtist||((b=(r=c.ArtistItems)==null?void 0:r[0])==null?void 0:b.Name)||""));h&&(o.has(h)||o.set(h,[]),o.get(h).push(c))}return o},[s,d,a]),m=l=>{const o=ce($e(l));if(!o)return null;if(i.has(o))return i.get(o);for(const[r,b]of i)if(r.includes(o)||o.includes(r))return b;return null};return{findSong:(l,o)=>{const r=m(o);if(!r)return null;const b=ce(ye(l));if(!b)return null;for(const c of r){const h=ce(ye(c.Name||""));if(h===b||h.includes(b)||b.includes(h))return c}return null},findAlbum:(l,o)=>{const r=m(o);if(!r)return null;const b=ce(ye(l));if(!b)return null;for(const c of r){if(!c.AlbumId||!c.Album)continue;const h=ce(ye(c.Album));if(h===b||h.includes(b)||b.includes(h))return{albumId:c.AlbumId,albumName:c.Album}}return null},findArtistImageUrl:l=>{var b,c,h;const o=m(l);return!o||o.length===0?null:((h=(c=(b=o[0])==null?void 0:b.ArtistItems)==null?void 0:c[0])==null?void 0:h.Id)||null},artistIndex:i}}function he({title:s,subtitle:d,subtitleParts:a,artworkUrl:i,fallbackArtworkUrl:m,secondFallbackUrl:x,rank:p,isCurrentTrack:f,isInLibrary:l,isMenuOpen:o,subtitleIcon:r,paddingRight:b=!1,imageLoading:c="lazy",onClick:h,onContextMenu:w,onLongPress:v,onExternalClick:N}){const[E,O]=t.useState(!1),[T,B]=t.useState(!1),[W,n]=t.useState(!1);t.useEffect(()=>{O(!1),B(!1),n(!1)},[i]);let A=i;W&&x?A=x:T&&m&&(A=m);const F=()=>{!T&&m?B(!0):!W&&x?n(!0):O(!0)},R=Te({onLongPress:M=>{M.preventDefault(),v==null||v(M)},onClick:M=>h(M)});return e.jsxs("button",{onClick:M=>h(M),onContextMenu:w,...R,className:`w-full flex items-center gap-2 hover:bg-white/10 transition-colors group py-2.5 ${o?"bg-white/10":""} ${b?"pr-4":""}`,children:[e.jsx("div",{className:"w-12 h-12 rounded-sm overflow-hidden flex-shrink-0 bg-zinc-900 self-center flex items-center justify-center",children:E?e.jsx(Ce,{className:"w-6 h-6 text-gray-500"}):e.jsx(Ie,{src:A,alt:s,className:"w-full h-full object-cover",showOutline:!0,rounded:"rounded-sm",loading:c,onError:F})}),e.jsxs("div",{className:"flex-1 min-w-0 text-left flex gap-3 items-baseline",children:[p!==void 0&&e.jsx("span",{className:"text-zinc-500 text-sm flex-shrink-0 w-5 text-right",children:p}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium truncate text-white group-hover:text-[var(--accent-color)] transition-colors",children:s}),e.jsxs("div",{className:"text-xs text-gray-400 flex items-center gap-1.5 min-w-0",children:[e.jsx("span",{className:"truncate",children:a?a.map((M,L)=>M.onClick?e.jsx("span",{className:"clickable-text",onMouseDown:U=>U.stopPropagation(),onClick:U=>{U.stopPropagation(),M.onClick(U)},children:M.text},L):e.jsx("span",{children:M.text},L)):d}),r&&e.jsx("span",{className:"flex-shrink-0",children:r})]})]})]}),!l&&N&&e.jsx("div",{onClick:M=>{M.stopPropagation(),N(M)},className:"flex-shrink-0 p-2 text-gray-400 hover:text-white cursor-pointer",children:e.jsx(st,{className:"w-4 h-4"})})]})}function Me(){return e.jsx("div",{className:"animate-pulse",children:[...Array(5)].map((s,d)=>e.jsxs("div",{className:"flex items-center gap-3 py-2.5",children:[e.jsx("div",{className:"w-12 h-12 rounded-sm bg-zinc-800"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-4 bg-zinc-800 rounded w-3/4 mb-1.5"}),e.jsx("div",{className:"h-3 bg-zinc-800 rounded w-1/2"})]})]},d))})}function gt(){const s=ne(),{playTrack:d}=de(),{feedTopSongs:a,feedLastUpdated:i,loading:m,setFeedTopSongs:x,setFeedLastUpdated:p,setLoading:f}=Y(),{feedCountry:l,showTop10:o}=je(),{findSong:r}=ze(),[b,c]=t.useState(!1),[h,w]=t.useState("mobile"),[v,N]=t.useState(null),[E,O]=t.useState(null),[T,B]=t.useState(!1),[W,n]=t.useState(!1),[A,F]=t.useState(null),[R,M]=t.useState(null),[L,U]=t.useState(!1),[Z,Q]=t.useState("mobile"),[le,J]=t.useState(null),[ue,K]=t.useState(null),[ee,_]=t.useState(null),fe=t.useCallback(async(j=!1)=>{const G=Date.now();if(!(!j&&i&&G-i<Se)){f("feed",!0),n(!1);try{const C=await Ve(l,10);x(C),p(G)}catch(C){console.error("Failed to fetch top songs:",C),n(!0)}finally{f("feed",!1)}}},[l,i,x,p,f]);t.useEffect(()=>{if(o){const j=Date.now();(!i||j-i>=Se)&&fe(!0)}},[o,l]);const V=async(j,G,C)=>{if(G){const z=await $.getSongById(G.Id);z&&d(z)}else await te(j,C)},te=async(j,G)=>{const C=!window.matchMedia("(hover: hover) and (pointer: fine)").matches;w(C?"mobile":"desktop"),C||N({x:G.clientX,y:G.clientY}),F(j.name),M(j.id),B(!0),c(!0);try{const z=await De(j.url);if(z&&Object.keys(z.linksByPlatform).length>0)O(z);else{const u=we(j.artistName,j.name);O(u)}}catch{const z=we(j.artistName,j.name);O(z)}finally{B(!1)}};if(!o)return null;const se=a.length>0,ie=m.feed&&!se&&!W;return e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-xl font-bold mb-2",children:"Top 10"}),ie?e.jsx(Me,{}):se?e.jsx("div",{className:"space-y-0",children:a.map((j,G)=>{var S,k;const C=r(j.name,j.artistName),z=C!==null,u=(k=(S=C==null?void 0:C.ArtistItems)==null?void 0:S[0])==null?void 0:k.Id,P=z&&u?[{text:j.artistName,onClick:()=>s(`/artist/${u}`)}]:void 0;return e.jsx(he,{rank:G+1,title:j.name,subtitle:j.artistName,subtitleParts:P,artworkUrl:z&&C.AlbumId?$.getAlbumArtUrl(C.AlbumId,96):Xe(j.artworkUrl100,96),isInLibrary:z,isMenuOpen:ee===j.id||R===j.id&&b,onClick:g=>V(j,C,g),onContextMenu:async g=>{if(g.preventDefault(),C){const q=await $.getSongById(C.Id);q&&(K(q),_(j.id),Q("desktop"),J({x:g.clientX,y:g.clientY}),U(!0))}},onLongPress:async()=>{if(C){const g=await $.getSongById(C.Id);g&&(K(g),_(j.id),Q("mobile"),J(null),U(!0))}},onExternalClick:g=>te(j,g)},j.id)})}):e.jsx("div",{className:"py-8 text-left text-gray-500 text-sm",children:"Could not load charts"}),e.jsx(Ue,{isOpen:b,onClose:()=>{c(!1),O(null),M(null)},odesliData:E,loading:T,title:A||void 0,mode:h,position:v||void 0}),e.jsx(ve,{item:ue,itemType:"song",isOpen:L,onClose:()=>{U(!1),K(null),_(null)},zIndex:99999,mode:Z,position:le||void 0})]})}function yt(){const s=ne(),{playTrack:d}=de(),{feedNewReleases:a,feedLastUpdated:i,loading:m,setFeedNewReleases:x,setFeedLastUpdated:p,setLoading:f}=Y(),{showNewReleases:l,muspyRssUrl:o}=je(),{findAlbum:r,findSong:b,findArtistImageUrl:c}=ze(),[h,w]=t.useState(!1),[v,N]=t.useState("mobile"),[E,O]=t.useState(null),[T,B]=t.useState(null),[W,n]=t.useState(!1),[A,F]=t.useState(!1),[R,M]=t.useState(null),[L,U]=t.useState(null),[Z,Q]=t.useState(!1),[le,J]=t.useState("mobile"),[ue,K]=t.useState(null),[ee,_]=t.useState(null),[fe,V]=t.useState(null),te=t.useCallback(async(u=!1)=>{if(!o)return;const P=Date.now();if(!(!u&&i&&P-i<Se)){f("feed",!0),F(!1);try{const S=await Qe(o,10);x(S),p(P)}catch(S){console.error("Failed to fetch Muspy releases:",S),F(!0)}finally{f("feed",!1)}}},[o,i,x,p,f]);t.useEffect(()=>{if(l&&o){const u=Date.now();(!i||u-i>=Se)&&te(!0)}},[l,o]),t.useEffect(()=>{a.forEach(u=>{if(!u.id.startsWith("muspy-")){const P=new window.Image;P.src=Re(u.id,250)}})},[a]);const se=t.useRef(new Set);t.useEffect(()=>{const u=async()=>{const P=a.filter(S=>S.id.startsWith("muspy-")&&!se.current.has(S.id));if(P.length!==0)for(const S of P){se.current.add(S.id);try{console.log(`[FeedSection] Searching MB for: ${S.title} - ${S.artistName}`);const k=await qe(S.artistName,S.title);if(k){console.log(`[FeedSection] Found MBID for "${S.title}": ${k.id} (${k.type})`);const q=Y.getState().feedNewReleases.map(ae=>ae.id===S.id?{...ae,id:k.id,type:k.type}:ae);x(q)}else console.log(`[FeedSection] No MBID found for "${S.title}"`)}catch(k){console.error(`[FeedSection] Failed to search MB for "${S.title}":`,k)}}};a.length>0&&u()},[a,x]);const pe=async(u,P,S)=>{if(P)if(P.type==="song"){const k=await $.getSongById(P.song.Id);k&&d(k)}else s(`/album/${P.albumId}`);else await ie(u,S)},ie=async(u,P)=>{const S=!window.matchMedia("(hover: hover) and (pointer: fine)").matches;N(S?"mobile":"desktop"),S||O({x:P.clientX,y:P.clientY}),M(u.title),U(u.id),n(!0),w(!0);const k=u.mbUrl&&!u.id.startsWith("muspy-");try{let g=null;if(k&&(g=await De(u.mbUrl)),g&&Object.keys(g.linksByPlatform).length>0)B(g);else{const q=we(u.artistName,u.title);B(q)}}catch{const g=we(u.artistName,u.title);B(g)}finally{n(!1)}};if(!l||!o)return null;const j=a.length>0,G=m.feed,C=!!o,z=G&&!j&&!A&&C;return e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-xl font-bold mb-2",children:"New Releases"}),z?e.jsx(Me,{}):j?e.jsx("div",{className:"space-y-0",children:a.map(u=>{const P=u.type==="Single",S=P?b(u.title,u.artistName):null,k=S?null:r(u.title,u.artistName),g=S?{type:"song",song:S}:k?{type:"album",albumId:k.albumId}:null,q=g!==null,xe=!u.id.startsWith("muspy-")?Re(u.id,250):null,re=c(u.artistName),oe=re?$.getArtistImageUrl(re,96):null,y=(g==null?void 0:g.type)==="song"&&(S!=null&&S.AlbumId)?$.getAlbumArtUrl(S.AlbumId,96):(g==null?void 0:g.type)==="album"&&(k!=null&&k.albumId)?$.getAlbumArtUrl(k.albumId,96):null;let I,D,X;xe?(I=xe,D=y||void 0,X=oe||void 0):y?(I=y,D=oe||void 0):I=oe||"";const Pe=new Date(u.releaseDate),ge=!isNaN(Pe.getTime())?Pe.toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",Be=ge?`${u.artistName} • ${ge}`:u.artistName,Ge=P?e.jsx(Je,{className:"w-3 h-3"}):e.jsx(Ce,{className:"w-3 h-3"}),He=q&&re?[{text:u.artistName,onClick:()=>s(`/artist/${re}`)},...ge?[{text:` • ${ge}`}]:[]]:void 0;return e.jsx(he,{title:u.title,subtitle:Be,subtitleParts:He,subtitleIcon:Ge,artworkUrl:I,fallbackArtworkUrl:D,secondFallbackUrl:X,isInLibrary:q,imageLoading:"eager",isMenuOpen:fe===u.id||L===u.id&&h,onClick:H=>pe(u,g,H),onContextMenu:async H=>{if(H.preventDefault(),(g==null?void 0:g.type)==="song"&&S){const me=await $.getSongById(S.Id);me&&(_(me),V(u.id),J("desktop"),K({x:H.clientX,y:H.clientY}),Q(!0))}else if((g==null?void 0:g.type)==="album"&&k){const me=await $.getAlbumById(k.albumId);me&&(_(me),V(u.id),J("desktop"),K({x:H.clientX,y:H.clientY}),Q(!0))}},onLongPress:async()=>{if((g==null?void 0:g.type)==="song"&&S){const H=await $.getSongById(S.Id);H&&(_(H),V(u.id),J("mobile"),K(null),Q(!0))}else if((g==null?void 0:g.type)==="album"&&k){const H=await $.getAlbumById(k.albumId);H&&(_(H),V(u.id),J("mobile"),K(null),Q(!0))}},onExternalClick:H=>ie(u,H)},u.id)})}):C?e.jsx("div",{className:"py-8 text-left text-gray-500 text-sm",children:A?"Failed to load releases":"No new releases found"}):e.jsx("div",{className:"py-8 text-center text-gray-500 text-sm",children:"Configure Muspy RSS in settings"}),e.jsx(Ue,{isOpen:h,onClose:()=>{w(!1),B(null),U(null)},odesliData:T,loading:W,title:R||void 0,mode:v,position:E||void 0}),e.jsx(ve,{item:ee,itemType:(ee==null?void 0:ee.Type)==="Audio"?"song":"album",isOpen:Z,onClose:()=>{Q(!1),_(null),V(null)},zIndex:99999,mode:le,position:ue||void 0})]})}function bt({twoColumns:s=!1}){const d=ne(),{recentlyPlayed:a,loading:i,setRecentlyPlayed:m,setLoading:x}=Y(),{showRecentlyPlayed:p}=je(),{playTrack:f}=de(),l=We(),[o,r]=t.useState(!1),[b,c]=t.useState("mobile"),[h,w]=t.useState(null),[v,N]=t.useState(null);t.useEffect(()=>{p&&(async()=>{x("recentlyPlayed",!0);try{const A=await $.getRecentlyPlayed(10);m(A.Items||[])}catch(A){console.error(A)}finally{x("recentlyPlayed",!1)}})()},[p,m,x]);const E=n=>{f(n,a)},O=n=>{var M,L,U,Z;const A=[],F=n.AlbumArtist||((L=(M=n.ArtistItems)==null?void 0:M[0])==null?void 0:L.Name)||"Unknown Artist",R=(Z=(U=n.ArtistItems)==null?void 0:U[0])==null?void 0:Z.Id;return A.push({text:F,onClick:R?()=>d(`/artist/${R}`):void 0}),n.Album&&(A.push({text:" • "}),A.push({text:n.Album,onClick:n.AlbumId?()=>d(`/album/${n.AlbumId}`):void 0})),A};if(!p)return null;const T=a&&a.length>0,W=i.recentlyPlayed&&!T;return e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-xl font-bold mb-2",children:"Recently Played"}),W?e.jsx(Me,{}):T?e.jsx("div",{className:s?"md:grid md:grid-cols-2 md:gap-3 min-[1680px]:block":"",children:s?e.jsxs(e.Fragment,{children:[e.jsx("div",{children:a.slice(0,5).map(n=>{var A,F;return e.jsx(he,{title:n.Name||"Unknown",subtitle:`${n.AlbumArtist||((F=(A=n.ArtistItems)==null?void 0:A[0])==null?void 0:F.Name)||"Unknown Artist"}${n.Album?` • ${n.Album}`:""}`,subtitleParts:O(n),artworkUrl:$.getAlbumArtUrl(n.AlbumId||n.Id,96),isCurrentTrack:(l==null?void 0:l.Id)===n.Id,isInLibrary:!0,isMenuOpen:(v==null?void 0:v.Id)===n.Id,paddingRight:!0,onClick:()=>E(n),onContextMenu:R=>{R.preventDefault(),N(n),c("desktop"),w({x:R.clientX,y:R.clientY}),r(!0)},onLongPress:()=>{N(n),c("mobile"),w(null),r(!0)}},n.Id)})}),e.jsx("div",{children:a.slice(5,10).map(n=>{var A,F;return e.jsx(he,{title:n.Name||"Unknown",subtitle:`${n.AlbumArtist||((F=(A=n.ArtistItems)==null?void 0:A[0])==null?void 0:F.Name)||"Unknown Artist"}${n.Album?` • ${n.Album}`:""}`,subtitleParts:O(n),artworkUrl:$.getAlbumArtUrl(n.AlbumId||n.Id,96),isCurrentTrack:(l==null?void 0:l.Id)===n.Id,isInLibrary:!0,isMenuOpen:(v==null?void 0:v.Id)===n.Id,paddingRight:!0,onClick:()=>E(n),onContextMenu:R=>{R.preventDefault(),N(n),c("desktop"),w({x:R.clientX,y:R.clientY}),r(!0)},onLongPress:()=>{N(n),c("mobile"),w(null),r(!0)}},n.Id)})})]}):a.map(n=>{var A,F;return e.jsx(he,{title:n.Name||"Unknown",subtitle:`${n.AlbumArtist||((F=(A=n.ArtistItems)==null?void 0:A[0])==null?void 0:F.Name)||"Unknown Artist"}${n.Album?` • ${n.Album}`:""}`,artworkUrl:$.getAlbumArtUrl(n.AlbumId||n.Id,96),isCurrentTrack:(l==null?void 0:l.Id)===n.Id,isInLibrary:!0,isMenuOpen:(v==null?void 0:v.Id)===n.Id,paddingRight:!0,onClick:()=>E(n),onContextMenu:R=>{R.preventDefault(),N(n),c("desktop"),w({x:R.clientX,y:R.clientY}),r(!0)},onLongPress:()=>{N(n),c("mobile"),w(null),r(!0)}},n.Id)})}):null,e.jsx(ve,{item:v,itemType:"song",isOpen:o,onClose:()=>{r(!1),N(null)},zIndex:99999,mode:b,position:h||void 0})]})}function Ct(){const[s,d]=t.useState(!1),{recentlyAdded:a,recentlyPlayed:i,loading:m}=Y(),{showMoodCards:x,showTop10:p,showNewReleases:f,showRecentlyPlayed:l,muspyRssUrl:o}=je(),r=t.useRef(!1),{isQueueSidebarOpen:b}=de();t.useEffect(()=>{(m.recentlyAdded||m.recentlyPlayed)&&(r.current=!0)},[m.recentlyAdded,m.recentlyPlayed]);const h=[p,f&&!!o,l].filter(Boolean).length,w=r.current&&!m.recentlyAdded&&!m.recentlyPlayed&&a.length===0&&i.length===0;return e.jsxs("div",{className:"pb-4",children:[e.jsx("div",{className:`fixed top-0 left-0 right-0 bg-black z-10 lg:left-16 transition-[left,right] duration-300 ${b?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top))"},children:e.jsx("div",{className:"max-w-[768px] min-[1680px]:max-w-[1080px] w-full mx-auto",children:e.jsx(ot,{onSearchStateChange:d})})}),e.jsx("div",{className:`fixed left-0 right-0 z-[60] lg:left-16 transition-[left,right] duration-300 ${b?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 4.5rem - 2px)",height:"24px",background:"linear-gradient(to bottom, rgba(0, 0, 0, 0.8), transparent)"}}),e.jsx("div",{className:s?"hidden [@media((hover:hover)_and_(pointer:fine)_and_(min-width:1024px))]:block":"",style:{paddingTop:"calc(env(safe-area-inset-top) + 4.5rem + 24px)"},children:e.jsxs("div",{className:"w-full",children:[x&&e.jsx(ht,{}),e.jsx("div",{className:"mt-4 pb-4",children:e.jsx(pt,{})}),h>0&&e.jsxs("div",{className:`
              mt-4 px-4
              ${h>=2?"md:grid md:gap-3":""}
              ${h===2?"md:grid-cols-2":""}
              ${h>=3?"md:grid-cols-2 min-[1680px]:grid-cols-3":""}
            `,children:[l&&e.jsx("div",{className:h===3?"md:col-span-2 min-[1680px]:col-span-1":"",children:e.jsx(bt,{twoColumns:h===3})}),p&&e.jsx("div",{children:e.jsx(gt,{})}),f&&e.jsx("div",{children:e.jsx(yt,{})})]}),w&&e.jsx("div",{className:"flex items-center justify-center py-16 text-gray-400",children:e.jsx("p",{children:"No music found"})})]})})]})}export{Ct as default};
