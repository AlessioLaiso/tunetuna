import{v as Z,w as ee,b as te,a as A,u as se,k as z,r as i,p as ne,j as e,x as le,S as ie,P as oe,C as L,e as M,l as ae,f as re,I as ce,y as ue}from"./index-DNl72U49.js";import{A as de}from"./arrow-left-C0ChbjKv.js";import{E as me}from"./ellipsis-Bzo-o42r.js";const O=45,D=45;function he({track:t,index:p,tracks:g,onClick:y,onContextMenu:b,contextMenuItemId:I}){var u,m;const j=I===t.Id,x=z(),a=i.useRef(!1),v=s=>{s.preventDefault(),s.stopPropagation(),a.current=!0,b(t,"desktop",{x:s.clientX,y:s.clientY}),setTimeout(()=>{a.current=!1},300)},N=re({onLongPress:s=>{s.preventDefault(),a.current=!0,b(t,"mobile")},onClick:()=>{if(a.current){a.current=!1;return}y(t,g)}});return e.jsxs("button",{onClick:()=>{if(a.current){a.current=!1;return}y(t,g)},onContextMenu:v,...N,className:`w-full flex items-center gap-3 hover:bg-white/10 transition-colors group px-4 py-3 ${j?"bg-white/10":""}`,children:[e.jsx("div",{className:"w-12 h-12 rounded-sm overflow-hidden flex-shrink-0 bg-zinc-900 self-center",children:e.jsx(ce,{src:M.getAlbumArtUrl(t.AlbumId||t.Id,96),alt:t.Name,className:"w-full h-full object-cover",showOutline:!0,rounded:"rounded-sm"})}),e.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[e.jsx("div",{className:`text-sm font-medium truncate transition-colors ${(x==null?void 0:x.Id)===t.Id?"text-[var(--accent-color)]":"text-white group-hover:text-[var(--accent-color)]"}`,children:t.Name}),e.jsxs("div",{className:"text-xs text-gray-400 truncate",children:[t.AlbumArtist||((m=(u=t.ArtistItems)==null?void 0:u[0])==null?void 0:m.Name)||"Unknown Artist",t.Album&&` â€¢ ${t.Album}`]})]}),t.RunTimeTicks&&e.jsx("div",{className:"text-xs text-gray-500 flex-shrink-0 text-right",children:ue(t.RunTimeTicks)})]})}function xe(t){return t?t.charAt(0).toUpperCase()+t.slice(1):""}function ye(){const{id:t,moodValue:p}=Z(),g=ee(),y=te(),{playAlbum:b,playTrack:I,isPlaying:j,shuffleArtist:x}=A(),{songs:a,recordMoodAccess:v}=se(),N=z(),[u,m]=i.useState(null),[s,S]=i.useState([]),[F,T]=i.useState(!0),[$,E]=i.useState(!1),[w,k]=i.useState(null),[B,G]=i.useState("mobile"),[U,V]=i.useState(null),[_,R]=i.useState(!1),[K,Q]=i.useState("mobile"),[Y,J]=i.useState(null),[C,P]=i.useState(O),W=A(o=>o.isQueueSidebarOpen),h=g.pathname.startsWith("/mood/");i.useEffect(()=>{if(h&&p){const l=decodeURIComponent(p).toLowerCase();v(l);const c=a.filter(n=>!n.Grouping||n.Grouping.length===0?!1:n.Grouping.some(d=>{const f=ne(d);return f&&f.category==="mood"&&f.value===l}));m({Id:`mood-${l}`,Name:xe(l),Type:"Mood"});const r=[...c].sort((n,d)=>(n.Name||"").localeCompare(d.Name||"")).map(n=>({Id:n.Id,Name:n.Name,AlbumArtist:n.AlbumArtist,ArtistItems:n.ArtistItems,Album:n.Album,AlbumId:n.AlbumId,RunTimeTicks:n.RunTimeTicks,Type:"Audio"}));S(r),T(!1);return}if(!t)return;(async()=>{T(!0);try{const l=await M.getAlbumTracks(t);S(l);const r=(await M.getPlaylists({limit:1e3})).Items.find(n=>n.Id===t);r?m(r):l.length>0&&m({Id:t,Name:"Playlist",Type:"Playlist"})}catch(l){ae.error("Failed to load playlist data:",l)}finally{T(!1)}})()},[t,h,p,v,a]),i.useEffect(()=>{P(O)},[s.length]),i.useEffect(()=>{const o=()=>{const r=window.scrollY||document.documentElement.scrollTop,n=window.innerHeight||document.documentElement.clientHeight,d=document.documentElement.scrollHeight;r+n*1.5>=d&&P(f=>Math.min(f+D,s.length))},c=setTimeout(()=>{const r=window.innerHeight||document.documentElement.clientHeight;document.documentElement.scrollHeight<=r&&C<s.length&&P(d=>Math.min(d+D,s.length))},100);return window.addEventListener("scroll",o,{passive:!0}),()=>{window.removeEventListener("scroll",o),clearTimeout(c)}},[s.length,C]);const X=()=>{s.length>0&&b(s)},q=()=>{s.length>0&&x(s)},H=()=>!s.length||!N?!1:s.some(o=>o.Id===N.Id);return F?e.jsx("div",{className:"pb-20",children:e.jsx("div",{className:"flex items-center justify-center h-screen text-gray-400",children:e.jsx("p",{children:"Loading..."})})}):!u||s.length===0?e.jsx("div",{className:"pb-20",children:e.jsx("div",{className:"flex items-center justify-center h-screen text-gray-400",children:e.jsx("p",{children:h?"No songs found for this mood":"Playlist not found"})})}):e.jsxs("div",{className:"pb-20",children:[e.jsx("div",{className:`fixed top-0 left-0 right-0 bg-black z-10 lg:left-16 transition-[left,right] duration-300 ${W?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top))"},children:e.jsx("div",{className:"max-w-[768px] mx-auto",children:e.jsxs("div",{className:"flex items-center justify-between gap-4 pl-3 pr-4",style:{paddingTop:"calc(1rem + 8px)",paddingBottom:"1rem"},children:[e.jsx("button",{onClick:()=>y(-1),className:"text-white hover:text-zinc-300 transition-colors",children:e.jsx(de,{className:"w-6 h-6"})}),u&&!h&&e.jsx("button",{onClick:o=>{const l=o.currentTarget.getBoundingClientRect();Q("desktop"),J({x:l.left+l.width/2,y:l.bottom+5}),R(!0)},className:"text-white hover:text-zinc-300 transition-colors",children:e.jsx(me,{className:"w-6 h-6"})})]})})}),e.jsxs("div",{className:"pt-20",children:[e.jsx("div",{className:"mb-6 px-4 pt-4",children:e.jsxs("div",{className:"w-full",children:[e.jsx("h2",{className:"text-4xl md:text-5xl font-bold mb-0.5 text-left break-words",children:u.Name}),e.jsxs("div",{className:"flex items-center justify-between gap-4 mt-2",children:[e.jsxs("div",{className:"text-gray-400",children:[s.length," ",s.length===1?"track":"tracks"]}),e.jsx("button",{onClick:H()&&j?()=>A.getState().pause():h?q:X,className:"bg-white/10 hover:bg-white/20 text-white font-semibold py-1.5 px-3 rounded-full transition-all hover:scale-105 flex items-center gap-1.5 backdrop-blur-sm border border-white/20 flex-shrink-0",children:H()&&j?e.jsxs(e.Fragment,{children:[e.jsx(le,{className:"w-3.5 h-3.5"}),"Pause"]}):h?e.jsxs(e.Fragment,{children:[e.jsx(ie,{className:"w-3.5 h-3.5"}),"Shuffle"]}):e.jsxs(e.Fragment,{children:[e.jsx(oe,{className:"w-3.5 h-3.5"}),"Play"]})})]})]})}),e.jsx("div",{children:e.jsx("div",{className:"space-y-0",children:s.slice(0,C).map((o,l)=>e.jsx(he,{track:o,index:l,tracks:s,onClick:c=>I(c,s),onContextMenu:(c,r,n)=>{k(c),G(r||"mobile"),V(n||null),E(!0)},contextMenuItemId:(w==null?void 0:w.Id)||null},o.Id))})})]}),e.jsx(L,{item:w,itemType:"song",isOpen:$,onClose:()=>{E(!1),k(null)},mode:B,position:U||void 0}),e.jsx(L,{item:u,itemType:"playlist",isOpen:_,onClose:()=>{R(!1)},mode:K,position:Y||void 0})]})}export{ye as default};
