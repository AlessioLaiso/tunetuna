import{k as be,b as je,a as k,g as ee,r as l,j as e,h as Ae,e as b,I as ye,l as we,P as Ie,s as Ne,C as T,f as Ce}from"./index-scgXBtC7.js";import{A as Se}from"./arrow-left-CXDjeGBi.js";import{E as Pe}from"./ellipsis-Ca9L3Qdt.js";import{C as Re}from"./chevron-up-DVHtpv9O.js";function Me({track:a,trackNumber:h,tracks:M,onClick:D,onContextMenu:c,contextMenuItemId:X}){const U=X===a.Id,s=ee(),t=l.useRef(!1),Y=f=>{const y=Math.floor(f/1e7),O=Math.floor(y/60),w=y%60;return`${O}:${w.toString().padStart(2,"0")}`},u=f=>{f.preventDefault(),f.stopPropagation(),t.current=!0,c(a,"desktop",{x:f.clientX,y:f.clientY}),setTimeout(()=>{t.current=!1},300)},B=Ce({onLongPress:f=>{f.preventDefault(),t.current=!0,c(a,"mobile")},onClick:()=>{if(t.current){t.current=!1;return}D(a,M)}});return e.jsxs("button",{onClick:()=>{if(t.current){t.current=!1;return}D(a,M)},onContextMenu:u,...B,className:`w-full flex items-baseline hover:bg-white/10 transition-colors group py-3 ${U?"bg-white/10":""}`,children:[e.jsx("span",{className:`text-sm w-6 text-right flex-shrink-0 mr-4 ${(s==null?void 0:s.Id)===a.Id?"text-[var(--accent-color)]":"text-gray-500"}`,children:h&&h>0?h:"-"}),e.jsx("div",{className:"flex-1 min-w-0 text-left",children:e.jsx("div",{className:`text-sm font-medium truncate transition-colors ${(s==null?void 0:s.Id)===a.Id?"text-[var(--accent-color)]":"text-white group-hover:text-[var(--accent-color)]"}`,children:a.Name})}),a.RunTimeTicks&&e.jsx("div",{className:"text-xs text-gray-500 flex-shrink-0 text-right mr-4",children:Y(a.RunTimeTicks)})]})}function Fe(){const{id:a}=be(),h=je(),{playAlbum:M,playTrack:D,isPlaying:c,play:X,pause:U}=k(),s=ee(),[t,Y]=l.useState(null),[u,B]=l.useState([]),[f,y]=l.useState(!0),[O,w]=l.useState(!1),[I,W]=l.useState(!0),[te,q]=l.useState(!1),[se,ne]=l.useState("mobile"),[re,le]=l.useState(null),[E,Q]=l.useState(null),[ae,J]=l.useState(!1),[ie,oe]=l.useState("mobile"),[ce,ue]=l.useState(null),[G,N]=l.useState(null),[de,C]=l.useState(!1),[j,z]=l.useState(!1),[F,x]=l.useState(!1),S=l.useRef(!1),P=l.useRef(!1),[fe,me]=l.useState(0),H=l.useRef(0),p=l.useRef(null),A=l.useRef(0),R=l.useRef(!1),xe=l.useRef(null),g=l.useRef(null),he=k(n=>n.isQueueSidebarOpen),K=l.useRef(!1);l.useEffect(()=>{if(!a)return;(async()=>{var r;y(!0);try{const o=await b.getAlbumTracks(a);B(o);let i=await b.getAlbumById(a);if(!i){const $=(await b.getAlbums({limit:1})).Items.find(V=>V.Id===a);$&&(i=$)}i||o.length>0&&o[0].AlbumId===a&&(i={Id:a,Name:o[0].Album||"Unknown Album",AlbumArtist:o[0].AlbumArtist}),i&&(Y(i),W(!0));const v=pe(o,i);if(v)try{const m=await b.getArtistById(v);(r=m==null?void 0:m.ImageTags)!=null&&r.Logo?(N(b.getImageUrl(v,"Logo")),C(!0)):(C(!1),N(null))}catch(m){console.warn("Failed to load artist logo:",m),C(!1),N(null)}else C(!1),N(null)}catch(o){console.error("Failed to load album data:",o)}finally{y(!1)}})()},[a]),l.useEffect(()=>{const n=(s==null?void 0:s.AlbumId)===(t==null?void 0:t.Id)&&c,r=(t==null?void 0:t.Id)||null,o=g.current!==null&&g.current!==r;if(K.current!==n&&(S.current=!1),K.current=n,!I){z(!1),x(!1),g.current=r;return}n?((o||!R.current||!j)&&(z(!0),x(!1),R.current=!0),P.current=window.innerWidth>=560,S.current||(S.current=!0,setTimeout(()=>{(s==null?void 0:s.AlbumId)===(t==null?void 0:t.Id)&&c&&x(!0)},500)),g.current=r):R.current&&j&&!n?(S.current||(S.current=!0,x(!1)),g.current=r):R.current?(z(!1),x(!1),g.current=r):(z(!1),x(!1),R.current=!0,g.current=r)},[s==null?void 0:s.AlbumId,t==null?void 0:t.Id,c,j,I,F]),l.useEffect(()=>{const n=()=>{if((s==null?void 0:s.AlbumId)===(t==null?void 0:t.Id)&&c&&j){const o=window.innerWidth>=560;P.current=o,F&&(x(!1),setTimeout(()=>x(!0),10))}};return window.addEventListener("resize",n),()=>window.removeEventListener("resize",n)},[s==null?void 0:s.AlbumId,t==null?void 0:t.Id,c,j,F]),l.useEffect(()=>{if((s==null?void 0:s.AlbumId)===(t==null?void 0:t.Id)&&c){const r=o=>{A.current===0&&(A.current=o);const d=o-A.current,i=360/1e4;H.current=(H.current+i*d)%360,me(H.current),A.current=o,p.current=requestAnimationFrame(r)};A.current=0,p.current=requestAnimationFrame(r)}else p.current&&(cancelAnimationFrame(p.current),p.current=null),A.current=0;return()=>{p.current&&cancelAnimationFrame(p.current)}},[s==null?void 0:s.AlbumId,t==null?void 0:t.Id,c]);const pe=(n,r)=>n.length>0&&n[0].ArtistItems&&n[0].ArtistItems.length>0?n[0].ArtistItems[0].Id:r!=null&&r.ArtistItems&&r.ArtistItems.length>0?r.ArtistItems[0].Id:null,ge=()=>{u.length>0&&M(u)},L=()=>{if(u.length>0){const n=u[0];if(n.ProductionYear&&n.ProductionYear>0)return n.ProductionYear.toString();if(n.PremiereDate){const r=new Date(n.PremiereDate).getFullYear();if(r>0)return r.toString()}}return null},Z=()=>u.length>0&&u[0].ArtistItems&&u[0].ArtistItems.length>0?u[0].ArtistItems[0].Id:t!=null&&t.ArtistItems&&t.ArtistItems.length>0?t.ArtistItems[0].Id:null,_=()=>{var n,r;return t.AlbumArtist||((r=(n=t.ArtistItems)==null?void 0:n[0])==null?void 0:r.Name)||null},ve=()=>{const n=Z();n&&h(`/artist/${n}`)};return f?e.jsx("div",{className:"pb-20",children:e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsx(Ae,{})})}):!t||u.length===0?e.jsx("div",{className:"pb-20",children:e.jsx("div",{className:"flex items-center justify-center h-screen text-gray-400",children:e.jsx("p",{children:"Album not found"})})}):e.jsxs("div",{className:"pb-20",style:{overflowX:"hidden",maxWidth:"100vw",width:"100%"},children:[e.jsx("div",{className:"fixed top-0 left-0 right-0 z-[55] pointer-events-none",style:{height:"env(safe-area-inset-top)",top:"var(--header-offset, 0px)",background:"transparent"}}),e.jsx("div",{className:"fixed top-0 left-0 right-0 z-10 pointer-events-none",style:{height:"calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 4rem)",top:"var(--header-offset, 0px)",background:`linear-gradient(to bottom,
            #000000 0%,
            #000000 calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 0.5rem),
            rgba(0, 0, 0, 0.95) calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 1rem),
            rgba(0, 0, 0, 0.85) calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 1.5rem),
            rgba(0, 0, 0, 0.7) calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 2rem),
            rgba(0, 0, 0, 0.5) calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 2.5rem),
            rgba(0, 0, 0, 0.3) calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 3rem),
            rgba(0, 0, 0, 0.15) calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 3.5rem),
            rgba(0, 0, 0, 0) calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 4rem)
          )`}}),e.jsx("div",{className:`fixed top-0 left-0 right-0 z-20 lg:left-16 transition-[left,right] duration-300 ${he?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top))"},children:e.jsx("div",{className:"max-w-[768px] mx-auto relative",children:e.jsxs("div",{className:"flex items-center justify-between gap-4 p-4 relative z-10",children:[e.jsx("button",{onClick:()=>h(-1),className:"text-white hover:text-zinc-300 transition-colors",children:e.jsx(Se,{className:"w-6 h-6"})}),t&&e.jsx("button",{onClick:n=>{const r=n.currentTarget.getBoundingClientRect();oe("desktop"),ue({x:r.left+r.width/2,y:r.bottom+5}),J(!0)},className:"text-white hover:text-zinc-300 transition-colors",children:e.jsx(Pe,{className:"w-6 h-6"})})]})})}),e.jsxs("div",{style:{paddingTop:"calc(5rem + 12px - 48px)"},children:[e.jsxs("div",{className:"mb-6 px-4 pt-4",style:{overflow:"visible"},children:[I&&e.jsx("div",{className:"flex justify-center mb-6 relative",style:{overflowX:"visible",overflowY:"visible",paddingLeft:"16px",paddingRight:"16px"},children:e.jsxs("div",{ref:xe,className:"w-64 h-64 relative",style:{overflow:"visible"},children:[e.jsx("div",{className:"absolute inset-0 rounded-full overflow-hidden",style:{opacity:j?1:0,zIndex:1,transform:(s==null?void 0:s.AlbumId)===t.Id&&c&&P.current?"translateX(calc(50% + 8px))":"translateX(0)",transition:"transform 500ms ease-in-out, opacity 300ms ease-in-out"},children:e.jsxs("div",{className:"w-full h-full",style:{transformOrigin:"center center",transform:`rotate(${fe}deg)`},children:[e.jsx("img",{src:"/assets/vinyl.png",alt:"Vinyl Record",className:"w-full h-full object-cover",onError:n=>{console.error("Failed to load vinyl image"),n.currentTarget.style.display="none"}}),e.jsx("div",{className:"absolute top-1/2 left-1/2 rounded-full",style:{width:"52%",height:"52%",backgroundColor:"#a1a1aa",transform:"translate(-50%, -50%)",transformOrigin:"center center"}}),de&&G?e.jsx("div",{className:"absolute top-1/2 left-1/2 rounded-full overflow-hidden flex items-center justify-center",style:{width:"47%",height:"47%",transform:"translate(-50%, -50%)",transformOrigin:"center center"},children:e.jsx("img",{src:G,alt:"Artist Logo",className:"w-full h-full object-contain",onError:()=>{C(!1),N(null)}})}):I?e.jsx("div",{className:"absolute top-1/2 left-1/2 rounded-full overflow-hidden flex items-center justify-center",style:{width:"52%",height:"52%",transform:"translate(-50%, -50%)",transformOrigin:"center center"},children:e.jsx("img",{src:b.getAlbumArtUrl(t.Id),alt:t.Name,className:"w-full h-full object-cover"})}):null]})}),e.jsx("div",{className:"absolute inset-0 rounded overflow-hidden bg-zinc-900 transition-all duration-500",style:{transform:(s==null?void 0:s.AlbumId)===t.Id&&c||F?P.current?"translateX(calc(-50% - 8px))":"translateX(calc(-100% - 24px))":"translateX(0)",opacity:1,transitionProperty:"transform",transitionDuration:"500ms",transitionTimingFunction:"ease-in-out",zIndex:10},children:e.jsx(ye,{src:b.getAlbumArtUrl(t.Id),alt:t.Name,className:"w-full h-full object-cover",showOutline:!0,rounded:"rounded",onError:()=>W(!1)})})]})}),e.jsxs("div",{className:"w-full",children:[e.jsx("h2",{className:"text-4xl md:text-5xl font-bold mb-0.5 text-left break-words",children:t.Name}),e.jsxs("div",{className:"flex items-center justify-between gap-4 mt-2",children:[e.jsxs("div",{className:"text-gray-400 flex items-center gap-1.5",children:[_()&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:ve,className:`hover:text-white transition-colors ${Z()?"cursor-pointer":"cursor-default"}`,children:_()}),L()&&e.jsx("span",{children:"â€¢"})]}),L()&&e.jsx("button",{onClick:()=>h(`/albums?year=${L()}`),className:"hover:text-white transition-colors cursor-pointer",children:L()})]}),e.jsx("button",{onClick:()=>{(s==null?void 0:s.AlbumId)===t.Id&&c?U():(s==null?void 0:s.AlbumId)===t.Id&&!c?X():ge()},className:"bg-white/10 hover:bg-white/20 text-white font-semibold py-1.5 px-3 rounded-full transition-all hover:scale-105 flex items-center gap-1.5 backdrop-blur-sm border border-white/20 flex-shrink-0",children:(s==null?void 0:s.AlbumId)===t.Id&&c?e.jsxs(e.Fragment,{children:[e.jsx(we,{className:"w-3.5 h-3.5"}),"Pause"]}):e.jsxs(e.Fragment,{children:[e.jsx(Ie,{className:"w-3.5 h-3.5"}),"Play"]})})]})]})]}),t.Overview&&e.jsx("div",{className:"mb-6 px-4",children:e.jsxs("div",{className:"text-white relative",children:[!O&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>w(!0),className:"flex-1 text-left min-w-0",children:e.jsx("p",{className:"text-sm text-gray-300 leading-relaxed line-clamp-2",children:t.Overview})}),e.jsx("button",{onClick:()=>w(!0),className:"flex-shrink-0 text-gray-400 hover:text-white transition-colors",children:e.jsx(Ne,{className:"w-4 h-4"})})]}),O&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-300 leading-relaxed whitespace-pre-line",children:t.Overview}),e.jsxs("button",{onClick:()=>w(!1),className:"mt-2 flex items-center gap-1 text-sm text-gray-400 hover:text-white transition-colors ml-auto",children:["Show less",e.jsx(Re,{className:"w-4 h-4"})]})]})]})}),e.jsx("div",{children:e.jsx("div",{className:"space-y-0",children:(()=>{const n=new Map;u.forEach(d=>{const i=d.ParentIndexNumber??1;n.has(i)||n.set(i,[]),n.get(i).push(d)});const r=n.size>1;return Array.from(n.keys()).sort((d,i)=>d-i).map(d=>{const i=n.get(d);return e.jsxs("div",{children:[r&&e.jsxs("div",{className:`px-4 py-2 text-xs font-medium text-gray-400 uppercase tracking-wider ${d>1?"pt-4":""}`,children:["Disc ",d]}),i.map(v=>e.jsx(Me,{track:v,trackNumber:v.IndexNumber??null,tracks:u,onClick:m=>D(m,u),onContextMenu:(m,$,V)=>{Q(m),ne($||"mobile"),le(V||null),q(!0)},contextMenuItemId:(E==null?void 0:E.Id)||null},v.Id))]},d)})})()})})]}),e.jsx(T,{item:E,itemType:"song",isOpen:te,onClose:()=>{q(!1),Q(null)},mode:se,position:re||void 0}),e.jsx(T,{item:t,itemType:"album",isOpen:ae,onClose:()=>{J(!1)},mode:ie,position:ce||void 0})]})}export{Fe as default};
