import{k as je,b as Ae,a as k,h as ee,r,j as e,i as ye,f as j,I as we,l as Ie,P as Ne,t as Ce,C as T,g as Se}from"./index-BHM1sJpC.js";import{A as Pe}from"./arrow-left-ZsZXFCTu.js";import{E as Re}from"./ellipsis-DiwGS6kI.js";import{C as Me}from"./chevron-up-D0Vudww5.js";function De({track:i,trackNumber:p,tracks:D,onClick:O,onContextMenu:o,contextMenuItemId:U}){const Y=U===i.Id,n=ee(),t=r.useRef(!1),B=m=>{const w=Math.floor(m/1e7),E=Math.floor(w/60),I=w%60;return`${E}:${I.toString().padStart(2,"0")}`},c=m=>{m.preventDefault(),m.stopPropagation(),t.current=!0,o(i,"desktop",{x:m.clientX,y:m.clientY}),setTimeout(()=>{t.current=!1},300)},H=Se({onLongPress:m=>{m.preventDefault(),t.current=!0,o(i,"mobile")},onClick:()=>{if(t.current){t.current=!1;return}O(i,D)}});return e.jsxs("button",{onClick:()=>{if(t.current){t.current=!1;return}O(i,D)},onContextMenu:c,...H,className:`w-full flex items-baseline hover:bg-white/10 transition-colors group py-3 ${Y?"bg-white/10":""}`,children:[e.jsx("span",{className:`text-sm w-6 text-right flex-shrink-0 mr-4 ${(n==null?void 0:n.Id)===i.Id?"text-[var(--accent-color)]":"text-gray-500"}`,children:p&&p>0?p:"-"}),e.jsx("div",{className:"flex-1 min-w-0 text-left",children:e.jsx("div",{className:`text-sm font-medium truncate transition-colors ${(n==null?void 0:n.Id)===i.Id?"text-[var(--accent-color)]":"text-white group-hover:text-[var(--accent-color)]"}`,children:i.Name})}),i.RunTimeTicks&&e.jsx("div",{className:"text-xs text-gray-500 flex-shrink-0 text-right mr-4",children:B(i.RunTimeTicks)})]})}function Le(){const{id:i}=je(),p=Ae(),{playAlbum:D,playTrack:O,isPlaying:o,play:U,pause:Y}=k(),n=ee(),[t,B]=r.useState(null),[c,H]=r.useState([]),[m,w]=r.useState(!0),[E,I]=r.useState(!1),[N,W]=r.useState(!0),[te,q]=r.useState(!1),[se,ne]=r.useState("mobile"),[re,le]=r.useState(null),[z,Q]=r.useState(null),[ae,J]=r.useState(!1),[ie,oe]=r.useState("mobile"),[ce,ue]=r.useState(null),[G,C]=r.useState(null),[de,S]=r.useState(!1),[A,F]=r.useState(!1),[L,x]=r.useState(!1),P=r.useRef(!1),R=r.useRef(!1),[fe,me]=r.useState(0),V=r.useRef(0),g=r.useRef(null),y=r.useRef(0),M=r.useRef(!1),xe=r.useRef(null),v=r.useRef(null),he=k(s=>s.isQueueSidebarOpen),K=r.useRef(!1);r.useEffect(()=>{if(!i)return;let s=!0;return(async()=>{var u;w(!0);try{const a=await j.getAlbumTracks(i);if(!s)return;H(a);let f=await j.getAlbumById(i);if(!f){const X=(await j.getAlbums({limit:1})).Items.find(be=>be.Id===i);X&&(f=X)}if(!s)return;f||a.length>0&&a[0].AlbumId===i&&(f={Id:i,Name:a[0].Album||"Unknown Album",AlbumArtist:a[0].AlbumArtist}),f&&(B(f),W(!0));const b=pe(a,f);if(b)try{const h=await j.getArtistById(b);if(!s)return;(u=h==null?void 0:h.ImageTags)!=null&&u.Logo?(C(j.getImageUrl(b,"Logo")),S(!0)):(S(!1),C(null))}catch(h){if(!s)return;console.warn("Failed to load artist logo:",h),S(!1),C(null)}else S(!1),C(null)}catch(a){if(!s)return;console.error("Failed to load album data:",a)}finally{s&&w(!1)}})(),()=>{s=!1}},[i]),r.useEffect(()=>{const s=(n==null?void 0:n.AlbumId)===(t==null?void 0:t.Id)&&o,l=(t==null?void 0:t.Id)||null,u=v.current!==null&&v.current!==l;if(K.current!==s&&(P.current=!1),K.current=s,!N){F(!1),x(!1),v.current=l;return}s?((u||!M.current||!A)&&(F(!0),x(!1),M.current=!0),R.current=window.innerWidth>=560,P.current||(P.current=!0,setTimeout(()=>{(n==null?void 0:n.AlbumId)===(t==null?void 0:t.Id)&&o&&x(!0)},500)),v.current=l):M.current&&A&&!s?(P.current||(P.current=!0,x(!1)),v.current=l):M.current?(F(!1),x(!1),v.current=l):(F(!1),x(!1),M.current=!0,v.current=l)},[n==null?void 0:n.AlbumId,t==null?void 0:t.Id,o,A,N,L]),r.useEffect(()=>{const s=()=>{if((n==null?void 0:n.AlbumId)===(t==null?void 0:t.Id)&&o&&A){const u=window.innerWidth>=560;R.current=u,L&&(x(!1),setTimeout(()=>x(!0),10))}};return window.addEventListener("resize",s),()=>window.removeEventListener("resize",s)},[n==null?void 0:n.AlbumId,t==null?void 0:t.Id,o,A,L]),r.useEffect(()=>{if((n==null?void 0:n.AlbumId)===(t==null?void 0:t.Id)&&o){const l=u=>{y.current===0&&(y.current=u);const a=u-y.current,d=360/1e4;V.current=(V.current+d*a)%360,me(V.current),y.current=u,g.current=requestAnimationFrame(l)};y.current=0,g.current=requestAnimationFrame(l)}else g.current&&(cancelAnimationFrame(g.current),g.current=null),y.current=0;return()=>{g.current&&cancelAnimationFrame(g.current)}},[n==null?void 0:n.AlbumId,t==null?void 0:t.Id,o]);const pe=(s,l)=>s.length>0&&s[0].ArtistItems&&s[0].ArtistItems.length>0?s[0].ArtistItems[0].Id:l!=null&&l.ArtistItems&&l.ArtistItems.length>0?l.ArtistItems[0].Id:null,ge=()=>{c.length>0&&D(c)},$=()=>{if(c.length>0){const s=c[0];if(s.ProductionYear&&s.ProductionYear>0)return s.ProductionYear.toString();if(s.PremiereDate){const l=new Date(s.PremiereDate).getFullYear();if(l>0)return l.toString()}}return null},Z=()=>c.length>0&&c[0].ArtistItems&&c[0].ArtistItems.length>0?c[0].ArtistItems[0].Id:t!=null&&t.ArtistItems&&t.ArtistItems.length>0?t.ArtistItems[0].Id:null,_=()=>{var s,l;return t.AlbumArtist||((l=(s=t.ArtistItems)==null?void 0:s[0])==null?void 0:l.Name)||null},ve=()=>{const s=Z();s&&p(`/artist/${s}`)};return m?e.jsx("div",{className:"pb-20",children:e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsx(ye,{})})}):!t||c.length===0?e.jsx("div",{className:"pb-20",children:e.jsx("div",{className:"flex items-center justify-center h-screen text-gray-400",children:e.jsx("p",{children:"Album not found"})})}):e.jsxs("div",{className:"pb-20",style:{overflowX:"hidden",maxWidth:"100vw",width:"100%"},children:[e.jsx("div",{className:"fixed top-0 left-0 right-0 z-[55] pointer-events-none",style:{height:"env(safe-area-inset-top)",top:"var(--header-offset, 0px)",background:"transparent"}}),e.jsx("div",{className:"fixed top-0 left-0 right-0 z-10 pointer-events-none",style:{height:"calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 4rem)",top:"var(--header-offset, 0px)",background:`linear-gradient(to bottom,
            #000000 0%,
            #000000 calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 0.5rem),
            rgba(0, 0, 0, 0.95) calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 1rem),
            rgba(0, 0, 0, 0.85) calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 1.5rem),
            rgba(0, 0, 0, 0.7) calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 2rem),
            rgba(0, 0, 0, 0.5) calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 2.5rem),
            rgba(0, 0, 0, 0.3) calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 3rem),
            rgba(0, 0, 0, 0.15) calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 3.5rem),
            rgba(0, 0, 0, 0) calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 4rem)
          )`}}),e.jsx("div",{className:`fixed top-0 left-0 right-0 z-20 lg:left-16 transition-[left,right] duration-300 ${he?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top))"},children:e.jsx("div",{className:"max-w-[768px] mx-auto relative",children:e.jsxs("div",{className:"flex items-center justify-between gap-4 p-4 relative z-10",children:[e.jsx("button",{onClick:()=>p(-1),className:"text-white hover:text-zinc-300 transition-colors",children:e.jsx(Pe,{className:"w-6 h-6"})}),t&&e.jsx("button",{onClick:s=>{const l=s.currentTarget.getBoundingClientRect();oe("desktop"),ue({x:l.left+l.width/2,y:l.bottom+5}),J(!0)},className:"text-white hover:text-zinc-300 transition-colors",children:e.jsx(Re,{className:"w-6 h-6"})})]})})}),e.jsxs("div",{style:{paddingTop:"calc(5rem + 12px - 48px)"},children:[e.jsxs("div",{className:"mb-6 px-4 pt-4",style:{overflow:"visible"},children:[N&&e.jsx("div",{className:"flex justify-center mb-6 relative",style:{overflowX:"visible",overflowY:"visible",paddingLeft:"16px",paddingRight:"16px"},children:e.jsxs("div",{ref:xe,className:"w-64 h-64 relative",style:{overflow:"visible"},children:[e.jsx("div",{className:"absolute inset-0 rounded-full overflow-hidden",style:{opacity:A?1:0,zIndex:1,transform:(n==null?void 0:n.AlbumId)===t.Id&&o&&R.current?"translateX(calc(50% + 8px))":"translateX(0)",transition:"transform 500ms ease-in-out, opacity 300ms ease-in-out"},children:e.jsxs("div",{className:"w-full h-full",style:{transformOrigin:"center center",transform:`rotate(${fe}deg)`},children:[e.jsx("img",{src:"/assets/vinyl.png",alt:"Vinyl Record",className:"w-full h-full object-cover",onError:s=>{console.error("Failed to load vinyl image"),s.currentTarget.style.display="none"}}),e.jsx("div",{className:"absolute top-1/2 left-1/2 rounded-full",style:{width:"52%",height:"52%",backgroundColor:"#a1a1aa",transform:"translate(-50%, -50%)",transformOrigin:"center center"}}),de&&G?e.jsx("div",{className:"absolute top-1/2 left-1/2 rounded-full overflow-hidden flex items-center justify-center",style:{width:"47%",height:"47%",transform:"translate(-50%, -50%)",transformOrigin:"center center"},children:e.jsx("img",{src:G,alt:"Artist Logo",className:"w-full h-full object-contain",onError:()=>{S(!1),C(null)}})}):N?e.jsx("div",{className:"absolute top-1/2 left-1/2 rounded-full overflow-hidden flex items-center justify-center",style:{width:"52%",height:"52%",transform:"translate(-50%, -50%)",transformOrigin:"center center"},children:e.jsx("img",{src:j.getAlbumArtUrl(t.Id),alt:t.Name,className:"w-full h-full object-cover"})}):null]})}),e.jsx("div",{className:"absolute inset-0 rounded overflow-hidden bg-zinc-900 transition-all duration-500",style:{transform:(n==null?void 0:n.AlbumId)===t.Id&&o||L?R.current?"translateX(calc(-50% - 8px))":"translateX(calc(-100% - 24px))":"translateX(0)",opacity:1,transitionProperty:"transform",transitionDuration:"500ms",transitionTimingFunction:"ease-in-out",zIndex:10},children:e.jsx(we,{src:j.getAlbumArtUrl(t.Id),alt:t.Name,className:"w-full h-full object-cover",showOutline:!0,rounded:"rounded",onError:()=>W(!1)})})]})}),e.jsxs("div",{className:"w-full",children:[e.jsx("h2",{className:"text-4xl md:text-5xl font-bold mb-0.5 text-left break-words",children:t.Name}),e.jsxs("div",{className:"flex items-center justify-between gap-4 mt-2",children:[e.jsxs("div",{className:"text-gray-400 flex items-center gap-1.5",children:[_()&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:ve,className:`hover:text-white transition-colors ${Z()?"cursor-pointer":"cursor-default"}`,children:_()}),$()&&e.jsx("span",{children:"â€¢"})]}),$()&&e.jsx("button",{onClick:()=>p(`/albums?year=${$()}`),className:"hover:text-white transition-colors cursor-pointer",children:$()})]}),e.jsx("button",{onClick:()=>{(n==null?void 0:n.AlbumId)===t.Id&&o?Y():(n==null?void 0:n.AlbumId)===t.Id&&!o?U():ge()},className:"bg-white/10 hover:bg-white/20 text-white font-semibold py-1.5 px-3 rounded-full transition-all hover:scale-105 flex items-center gap-1.5 backdrop-blur-sm border border-white/20 flex-shrink-0",children:(n==null?void 0:n.AlbumId)===t.Id&&o?e.jsxs(e.Fragment,{children:[e.jsx(Ie,{className:"w-3.5 h-3.5"}),"Pause"]}):e.jsxs(e.Fragment,{children:[e.jsx(Ne,{className:"w-3.5 h-3.5"}),"Play"]})})]})]})]}),t.Overview&&e.jsx("div",{className:"mb-6 px-4",children:e.jsxs("div",{className:"text-white relative",children:[!E&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>I(!0),className:"flex-1 text-left min-w-0",children:e.jsx("p",{className:"text-sm text-gray-300 leading-relaxed line-clamp-2",children:t.Overview})}),e.jsx("button",{onClick:()=>I(!0),className:"flex-shrink-0 text-gray-400 hover:text-white transition-colors",children:e.jsx(Ce,{className:"w-4 h-4"})})]}),E&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-300 leading-relaxed whitespace-pre-line",children:t.Overview}),e.jsxs("button",{onClick:()=>I(!1),className:"mt-2 flex items-center gap-1 text-sm text-gray-400 hover:text-white transition-colors ml-auto",children:["Show less",e.jsx(Me,{className:"w-4 h-4"})]})]})]})}),e.jsx("div",{children:e.jsx("div",{className:"space-y-0",children:(()=>{const s=new Map;c.forEach(a=>{const d=a.ParentIndexNumber??1;s.has(d)||s.set(d,[]),s.get(d).push(a)});const l=s.size>1;return Array.from(s.keys()).sort((a,d)=>a-d).map(a=>{const d=s.get(a);return e.jsxs("div",{children:[l&&e.jsxs("div",{className:`px-4 py-2 text-xs font-medium text-gray-400 uppercase tracking-wider ${a>1?"pt-4":""}`,children:["Disc ",a]}),d.map(f=>e.jsx(De,{track:f,trackNumber:f.IndexNumber??null,tracks:c,onClick:b=>O(b,c),onContextMenu:(b,h,X)=>{Q(b),ne(h||"mobile"),le(X||null),q(!0)},contextMenuItemId:(z==null?void 0:z.Id)||null},f.Id))]},a)})})()})})]}),e.jsx(T,{item:z,itemType:"song",isOpen:te,onClose:()=>{q(!1),Q(null)},mode:se,position:re||void 0}),e.jsx(T,{item:t,itemType:"album",isOpen:ae,onClose:()=>{J(!1)},mode:ie,position:ce||void 0})]})}export{Le as default};
