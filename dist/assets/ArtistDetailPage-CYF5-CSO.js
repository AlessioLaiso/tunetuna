import{k as ye,b as Se,a as ee,g as re,r as a,j as e,h as Ce,I as T,e as w,l as Ee,S as Pe,q as ke,P as Me,L as De,C as te,f as le,D as Le}from"./index-AOm-apGX.js";import{A as Te}from"./arrow-left-BIDXRYXM.js";import{E as Oe}from"./ellipsis-DFqsty-7.js";import{C as ze}from"./chevron-up-NlVw99oX.js";import{A as He}from"./arrow-up-down-CX2ufI1q.js";const se=45,Be=45,ne=45,Re=45;function Ye({album:i,year:g,onNavigate:b,onContextMenu:y,showImage:S=!0}){const[E,P]=a.useState(!1),h=a.useRef(!1),s=o=>{if(h.current){o.preventDefault(),o.stopPropagation(),h.current=!1;return}b(i.Id)},k=o=>{o.preventDefault(),o.stopPropagation(),h.current=!0,y(i,"desktop",{x:o.clientX,y:o.clientY}),setTimeout(()=>{h.current=!1},100)},u=le({onLongPress:o=>{o.preventDefault(),h.current=!0,y(i,"mobile")},onClick:s});return e.jsxs("button",{onClick:s,onContextMenu:k,...u,className:"text-left group",children:[e.jsx("div",{className:"aspect-square rounded overflow-hidden mb-2 bg-zinc-900 flex items-center justify-center",children:E?e.jsx(Le,{className:"w-12 h-12 text-gray-500"}):S?e.jsx(T,{src:w.getAlbumArtUrl(i.Id,474),alt:i.Name,className:"w-full h-full object-cover",showOutline:!0,rounded:"rounded",onError:()=>P(!0)}):e.jsx("div",{className:"w-full h-full bg-zinc-900"})}),e.jsx("div",{className:"text-sm font-medium text-white truncate",children:i.Name}),g&&e.jsx("div",{className:"text-xs text-gray-400 truncate",children:g})]})}function Fe({song:i,album:g,year:b,onClick:y,onContextMenu:S,contextMenuItemId:E,showImage:P=!0}){const h=E===i.Id,s=re(),k=o=>{const p=Math.floor(o/1e7),O=Math.floor(p/60),z=p%60;return`${O}:${z.toString().padStart(2,"0")}`},u=le({onLongPress:o=>{o.preventDefault(),S(i,"mobile")},onClick:()=>y(i)});return e.jsxs("button",{onClick:()=>y(i),onContextMenu:o=>{o.preventDefault(),S(i,"desktop",{x:o.clientX,y:o.clientY})},...u,className:`w-full flex items-center gap-3 hover:bg-white/10 transition-colors group px-4 py-3 ${h?"bg-white/10":""}`,children:[e.jsx("div",{className:"w-12 h-12 rounded-sm overflow-hidden flex-shrink-0 bg-zinc-900 self-center flex items-center justify-center",children:P?e.jsx(T,{src:w.getAlbumArtUrl(i.AlbumId||i.Id,96),alt:i.Name,className:"w-full h-full object-cover",showOutline:!0,rounded:"rounded-sm"}):e.jsx("div",{className:"w-full h-full bg-zinc-900"})}),e.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[e.jsx("div",{className:`text-sm font-medium truncate transition-colors ${(s==null?void 0:s.Id)===i.Id?"text-[var(--accent-color)]":"text-white group-hover:text-[var(--accent-color)]"}`,children:i.Name}),(g||b)&&e.jsxs("div",{className:"text-xs text-gray-400 flex items-center gap-1 min-w-0",children:[g&&e.jsx("span",{className:"truncate",children:g}),g&&b&&e.jsx("span",{className:"flex-shrink-0",children:"•"}),b&&e.jsx("span",{className:"flex-shrink-0",children:b})]})]}),i.RunTimeTicks&&e.jsx("div",{className:"text-xs text-gray-500 flex-shrink-0 text-right",children:k(i.RunTimeTicks)})]})}function Xe(){var Z;const{id:i}=ye(),g=Se(),{playAlbum:b,playTrack:y,isPlaying:S,pause:E,addToQueue:P}=ee(),h=re(),[s,k]=a.useState(null),[u,o]=a.useState([]),[p,O]=a.useState([]),[z,H]=a.useState(!0),[U,B]=a.useState(!1),[$e,M]=a.useState(!0),[C,R]=a.useState(!0),[ae,Y]=a.useState(!1),[ie,_]=a.useState("mobile"),[oe,q]=a.useState(null),[D,F]=a.useState(null),[ce,$]=a.useState(null),[ue,V]=a.useState(!1),[de,me]=a.useState("mobile"),[he,xe]=a.useState(null),[L,fe]=a.useState("Alphabetical"),[ge,Q]=a.useState(se),[pe,G]=a.useState(ne),J=a.useRef(null),ve=ee(t=>t.isQueueSidebarOpen);a.useEffect(()=>{const t=document.querySelector(".main-scrollable");t&&t.scrollTo({top:0,behavior:"auto"})},[i]);const X=t=>t.toLowerCase().replace(/[_\*\-\.]/g,"").trim();a.useEffect(()=>{if(!i)return;(async()=>{var r;H(!0);try{let n=await w.getArtistById(i);if(!n){const x=(await w.getArtists({limit:1e3})).Items.find(v=>v.Id===i);x&&(n=x)}if(!n){H(!1);return}k(n),R(!0);const c=await w.getArtistItems(i);if(c.albums.length===0&&c.songs.length===0&&n.Name){const m=X(n.Name),v=((r=(await w.search(n.Name,50)).Artists)==null?void 0:r.Items)||[];for(const f of v)if(f.Id!==i&&X(f.Name)===m){const I=await w.getArtistItems(f.Id);if(I.albums.length>0||I.songs.length>0){g(`/artist/${f.Id}`,{replace:!0});return}}}const d=[...c.albums].sort((m,x)=>{const v=m.ProductionYear||(m.PremiereDate?new Date(m.PremiereDate).getFullYear():0);return(x.ProductionYear||(x.PremiereDate?new Date(x.PremiereDate).getFullYear():0))-v});o(d),O(c.songs)}catch(l){console.error("Failed to load artist data:",l)}finally{H(!1)}})()},[i,g]),a.useEffect(()=>{if(!(s!=null&&s.Overview))return;M(!0);let t=null,r=null,l=null,n=!1;const c=()=>{const x=J.current;if(!x||!(s!=null&&s.Overview)){M(!1);return}const v=window.getComputedStyle(x);let f=parseFloat(v.lineHeight||"0");if((!Number.isFinite(f)||f===0)&&(f=parseFloat(v.fontSize||"16")*1.5),f===0){M(!1);return}const I=x.scrollHeight;if(I===0&&!n){n=!0,d();return}const Ie=Math.round(I/f)>2;M(Ie)},d=()=>{t!==null&&cancelAnimationFrame(t),r!==null&&clearTimeout(r),t=requestAnimationFrame(()=>{r=window.setTimeout(c,0)}),l!==null&&clearTimeout(l),l=window.setTimeout(()=>{n=!1,c()},300)},m=()=>{n=!1,d()};return d(),window.addEventListener("resize",m),()=>{t!==null&&cancelAnimationFrame(t),r!==null&&clearTimeout(r),l!==null&&clearTimeout(l),window.removeEventListener("resize",m)}},[s==null?void 0:s.Overview]),a.useEffect(()=>{Q(se)},[u.length]),a.useEffect(()=>{G(ne)},[p.length]);const N=a.useCallback(()=>{const t=window.scrollY||document.documentElement.scrollTop,r=window.innerHeight||document.documentElement.clientHeight,l=document.documentElement.scrollHeight;t+r*1>=l&&G(n=>Math.min(n+Re,p.length))},[p.length]);a.useEffect(()=>(document.addEventListener("scroll",N,{passive:!0,capture:!0}),window.addEventListener("scroll",N,{passive:!0}),document.addEventListener("touchmove",N,{passive:!0}),document.addEventListener("touchend",N,{passive:!0}),()=>{document.removeEventListener("scroll",N,{capture:!0}),window.removeEventListener("scroll",N),document.removeEventListener("touchmove",N),document.removeEventListener("touchend",N)}),[N]);const j=a.useCallback(()=>{const t=window.pageYOffset||document.documentElement.scrollTop||window.scrollY||0,r=window.innerHeight||document.documentElement.clientHeight,l=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight);t+r*1>=l&&Q(n=>Math.min(n+Be,u.length))},[u.length]);a.useEffect(()=>(document.addEventListener("scroll",j,{passive:!0,capture:!0}),window.addEventListener("scroll",j,{passive:!0}),document.addEventListener("touchmove",j,{passive:!0}),document.addEventListener("touchend",j,{passive:!0}),()=>{document.removeEventListener("scroll",j,{capture:!0}),window.removeEventListener("scroll",j),document.removeEventListener("touchmove",j),document.removeEventListener("touchend",j)}),[j]);const we=()=>{if(A.length>0){const t=[...A].sort(()=>Math.random()-.5);b(t)}},K=t=>t.ProductionYear?t.ProductionYear.toString():t.PremiereDate?new Date(t.PremiereDate).getFullYear().toString():null,be=t=>{const r=t.Album||null;let l=null;if(t.AlbumId){const n=u.find(c=>c.Id===t.AlbumId);n&&(l=K(n))}return{album:r,year:l}},W=t=>{if(t.AlbumId){const r=u.find(l=>l.Id===t.AlbumId);if(r)return r.ProductionYear||(r.PremiereDate?new Date(r.PremiereDate).getFullYear():0)}return t.ProductionYear||(t.PremiereDate?new Date(t.PremiereDate).getFullYear():0)},A=a.useMemo(()=>{if(L==="Alphabetical")return[...p].sort((l,n)=>{const c=l.Name||"",d=n.Name||"";return c.localeCompare(d)});const t=(l,n,c)=>{const d=W(l),m=W(n),x=l.AlbumId||"",v=n.AlbumId||"";if(d!==m)return c?m-d:d-m;if(x!==v)return x.localeCompare(v);const f=l.IndexNumber||0,I=n.IndexNumber||0;return f!==I?f-I:(l.Name||"").localeCompare(n.Name||"")},r=L==="Newest";return[...p].sort((l,n)=>t(l,n,r))},[p,L,u]),Ne=t=>{t.preventDefault(),t.stopPropagation(),A.length>0&&b(A)},je=t=>{t.preventDefault(),t.stopPropagation(),A.length>0&&P(A)},Ae=()=>{fe(t=>t==="Alphabetical"?"Newest":t==="Newest"?"Oldest":"Alphabetical")};return z?e.jsx("div",{className:"pb-20",children:e.jsx("div",{className:"flex items-center justify-center h-screen text-gray-400",children:e.jsx(Ce,{})})}):s?e.jsxs("div",{className:"pb-20",children:[e.jsx("div",{className:`fixed top-0 left-0 right-0 z-[60] lg:left-16 transition-[left,right] duration-300 ${ve?"sidebar-open-right-offset":""}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top))"},children:e.jsx("div",{className:"max-w-[768px] mx-auto",children:e.jsxs("div",{className:"relative flex items-center justify-between gap-4 p-4",children:[e.jsx("button",{onClick:()=>g(-1),className:"text-white hover:text-zinc-300 transition-colors z-10",children:e.jsx(Te,{className:"w-6 h-6"})}),s&&e.jsx("button",{onClick:t=>{const r=t.currentTarget.getBoundingClientRect();me("desktop"),xe({x:r.left+r.width/2,y:r.bottom+5}),V(!0)},className:"text-white hover:text-zinc-300 transition-colors z-10",children:e.jsx(Oe,{className:"w-6 h-6"})})]})})}),e.jsxs("div",{className:"relative z-30 w-screen",style:{marginTop:"calc(-1 * env(safe-area-inset-top))",marginLeft:"calc(50% - 50vw)",marginRight:"calc(50% - 50vw)"},children:[C&&e.jsxs("div",{className:"relative w-full min-h-64 md:min-h-80 bg-black",style:{paddingTop:"env(safe-area-inset-top)"},children:[e.jsx("div",{className:"w-full flex items-center justify-center md:hidden",children:e.jsx(T,{src:w.getArtistImageUrl(s.Id),alt:s.Name,className:"w-full h-auto object-contain",onError:()=>R(!1)})}),e.jsx("div",{className:"hidden md:block w-full h-80",children:e.jsx("img",{src:w.getArtistBackdropUrl(s.Id),alt:s.Name,className:"w-full h-full object-cover",onError:()=>R(!1)})}),e.jsx("div",{className:"absolute inset-x-0 top-0 bottom-[-1px] bg-gradient-to-b from-transparent via-black/60 to-black pointer-events-none"})]}),e.jsx("div",{className:`left-0 right-0 ${C?"absolute":"relative"} ${C?"pt-16":"pt-12"}`,style:C?{bottom:"-28px",paddingBottom:"1.5rem"}:{},children:e.jsxs("div",{className:"max-w-[768px] mx-auto px-4 flex items-end gap-6 md:grid md:grid-cols-3 md:gap-4",children:[C&&e.jsx("div",{className:"hidden md:block md:col-span-1",children:e.jsx("div",{className:"aspect-square rounded overflow-hidden bg-zinc-900 flex items-center justify-center",children:e.jsx(T,{src:w.getArtistImageUrl(s.Id),alt:s.Name,className:"w-full h-full object-cover",showOutline:!0,rounded:"rounded"})})}),e.jsx("div",{className:`flex-1 min-w-0 pb-2 ${C?"md:col-span-2":"md:col-span-3"}`,children:e.jsxs("div",{className:"mb-4 mt-4",children:[e.jsx("h1",{className:"text-4xl md:text-5xl font-bold text-white mb-2 break-words",children:s.Name}),e.jsxs("div",{className:"flex items-center justify-between gap-4 mt-2",children:[e.jsxs("p",{className:"text-sm text-gray-300",children:[u.length," ",u.length===1?"album":"albums"," • ",A.length," ",A.length===1?"song":"songs"]}),e.jsx("button",{onClick:()=>{var r;h&&S&&(((r=h.ArtistItems)==null?void 0:r.some(l=>l.Id===i))||h.AlbumArtist===(s==null?void 0:s.Name))?E():we()},className:"bg-white/10 hover:bg-white/20 text-white font-semibold py-1.5 px-3 rounded-full transition-all hover:scale-105 flex items-center gap-1.5 backdrop-blur-sm border border-white/20 flex-shrink-0",children:h&&S&&((Z=h.ArtistItems)!=null&&Z.some(t=>t.Id===i)||h.AlbumArtist===(s==null?void 0:s.Name))?e.jsxs(e.Fragment,{children:[e.jsx(Ee,{className:"w-3.5 h-3.5"}),"Pause"]}):e.jsxs(e.Fragment,{children:[e.jsx(Pe,{className:"w-3.5 h-3.5"}),"Shuffle"]})})]})]})})]})})]}),e.jsxs("div",{className:"pt-3 md:pt-7",children:[s.Overview&&e.jsx("div",{className:"mb-6 -mt-4 px-4",children:e.jsxs("div",{className:"text-white relative",children:[e.jsx("p",{ref:J,className:"text-sm text-gray-300 leading-relaxed absolute opacity-0 pointer-events-none -z-10",children:s.Overview}),!U&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>B(!0),className:"flex-1 text-left min-w-0",children:e.jsx("p",{className:"text-sm text-gray-300 leading-relaxed line-clamp-2",children:s.Overview})}),e.jsx("button",{onClick:()=>B(!0),className:"flex-shrink-0 text-gray-400 hover:text-white transition-colors",children:e.jsx(ke,{className:"w-4 h-4"})})]}),U&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-300 leading-relaxed whitespace-pre-line",children:s.Overview}),e.jsxs("button",{onClick:()=>B(!1),className:"mt-2 flex items-center gap-1 text-sm text-gray-400 hover:text-white transition-colors ml-auto",children:["Show less",e.jsx(ze,{className:"w-4 h-4"})]})]})]})}),u.length>0&&e.jsxs("div",{className:"mb-10 px-4",children:[e.jsxs("h2",{className:"text-2xl font-bold text-white mb-4",children:["Albums (",u.length,")"]}),e.jsx("div",{className:"grid grid-cols-3 md:grid-cols-4 gap-4",children:u.map((t,r)=>{const l=K(t);return e.jsx(Ye,{album:t,year:l,onNavigate:n=>g(`/album/${n}`),onContextMenu:(n,c,d)=>{F(n),$("album"),_(c||"mobile"),q(d||null),Y(!0)},showImage:r<ge},t.Id)})})]}),p.length>0&&e.jsxs("div",{id:"songs-section",children:[e.jsxs("div",{className:"px-4 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h2",{className:"text-2xl font-bold text-white",children:["Songs (",p.length,")"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:Ne,className:"w-10 h-10 flex items-center justify-center text-white hover:bg-white/10 rounded-lg transition-colors","aria-label":"Play all songs",children:e.jsx(Me,{className:"w-5 h-5"})}),e.jsx("button",{type:"button",onClick:je,className:"w-10 h-10 flex items-center justify-center text-white hover:bg-white/10 rounded-lg transition-colors","aria-label":"Add all songs to queue",children:e.jsx(De,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"mt-1",children:e.jsxs("button",{type:"button",onClick:Ae,className:"text-sm text-gray-400 hover:text-white transition-colors flex items-center gap-1",children:[L,e.jsx(He,{className:"w-4 h-4"})]})})]}),e.jsx("div",{className:"space-y-0",children:A.map((t,r)=>{const{album:l,year:n}=be(t);return e.jsx(Fe,{song:t,album:l,year:n,onClick:y,onContextMenu:(c,d,m)=>{F(c),$("song"),_(d||"mobile"),q(m||null),Y(!0)},contextMenuItemId:(D==null?void 0:D.Id)||null,showImage:r<pe},t.Id)})})]})]}),e.jsx(te,{item:D,itemType:ce,isOpen:ae,onClose:()=>{Y(!1),F(null),$(null)},zIndex:99999,mode:ie,position:oe||void 0}),e.jsx(te,{item:s,itemType:"artist",isOpen:ue,onClose:()=>{V(!1)},mode:de,position:he||void 0})]}):e.jsx("div",{className:"pb-20",children:e.jsx("div",{className:"flex items-center justify-center h-screen text-gray-400",children:e.jsx("p",{children:"Artist not found on the Jellyfin server"})})})}export{Xe as default};
