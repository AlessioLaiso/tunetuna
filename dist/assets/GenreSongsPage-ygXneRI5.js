import{K as Se,b as ve,a as Y,i as Ae,u as we,Y as Ie,r as l,j as e,w as ye,S as Pe,E as Ce,H as Me,C as De,e as D,l as W,f as Ee,D as ke,I as Ge}from"./index-CGRvUryl.js";import{u as Z}from"./useScrollLazyLoad-Cgh5pZ3-.js";import{S as Le}from"./SongItem-0LAdyBrX.js";import{P as Te}from"./Pagination-BqnPUhVO.js";import{A as B}from"./arrow-left-CwuGyWtl.js";import{A as Ye}from"./arrow-up-down-Oh2KK2ce.js";import"./chevron-right-CLb5gNRg.js";const ee=45,Be=45,M=84,te=45,Oe=45;function ze({album:f,onNavigate:m,onContextMenu:N,showImage:E=!0}){var v,A;const[O,z]=l.useState(!1),p=l.useRef(!1),k=g=>{g.preventDefault(),g.stopPropagation(),p.current=!0,N(f,"desktop",{x:g.clientX,y:g.clientY}),setTimeout(()=>{p.current=!1},300)},G=Ee({onLongPress:g=>{g.preventDefault(),p.current=!0,N(f,"mobile")},onClick:()=>{if(p.current){p.current=!1;return}m(f.Id)}});return e.jsxs("button",{onClick:()=>{if(p.current){p.current=!1;return}m(f.Id)},onContextMenu:k,...G,className:"text-left group",children:[e.jsx("div",{className:"aspect-square rounded overflow-hidden mb-2 bg-zinc-900 flex items-center justify-center",children:O?e.jsx(ke,{className:"w-12 h-12 text-gray-500"}):E?e.jsx(Ge,{src:D.getAlbumArtUrl(f.Id,474),alt:f.Name,className:"w-full h-full object-cover",showOutline:!0,rounded:"rounded",onError:()=>z(!0)}):e.jsx("div",{className:"w-full h-full bg-zinc-900"})}),e.jsx("div",{className:"text-sm font-medium text-white truncate",children:f.Name}),e.jsx("div",{className:"text-xs text-gray-400 truncate",children:f.AlbumArtist||((A=(v=f.ArtistItems)==null?void 0:v[0])==null?void 0:A.Name)||"Unknown Artist"})]})}function qe(){const{id:f}=Se(),m=f?decodeURIComponent(f):void 0,N=ve(),{playAlbum:E,toggleShuffle:O,isPlaying:z,pause:p,shuffleGenreSongs:k,addToQueue:G}=Y();Ae();const{genres:v,genreSongs:A,setGenreSongs:g}=we(),{state:F}=Ie(),[d,_]=l.useState(null),[h,U]=l.useState([]),[se,w]=l.useState(!0),[re,V]=l.useState(!1),[ne,ae]=l.useState("mobile"),[le,ie]=l.useState(null),[oe,R]=l.useState(null),[ce,$]=l.useState(null),[Q,q]=l.useState(ee),[H,J]=l.useState(te),[ue,me]=l.useState(0),[I,L]=l.useState(!1),[y,de]=l.useState("Alphabetical"),[T,K]=l.useState(0),P=Y(t=>t.isQueueSidebarOpen);l.useEffect(()=>{if(I){const t=setTimeout(()=>{L(!1)},1e4);return()=>clearTimeout(t)}},[I]),l.useEffect(()=>{F==="success"&&m&&me(t=>t+1)},[F,m]),l.useEffect(()=>{if(!m)return;let t=!0;return(async()=>{const s=A[m];if(s&&s.length>0){let n=v;if(n.length===0&&(n=await D.getGenres()),!t)return;const a=n.find(i=>i.Id===m);a&&_(a),U(s),w(!1);return}w(!0);try{let n=v;if(n.length===0&&(n=await D.getGenres()),!t)return;const a=n.find(o=>o.Id===m);if(!a){w(!1);return}_(a);const i=a.Name;if(!i){w(!1);return}const u=await D.getGenreSongs(m,i);if(!t)return;g(m,u),U(u)}catch(n){if(!t)return;W.error("Failed to load genre songs:",n)}finally{t&&w(!1)}})(),()=>{t=!1}},[m,v,A,g,ue]);const fe=async()=>{if(h.length>0&&(d!=null&&d.Id)&&(d!=null&&d.Name)&&!I){const t=Y.getState(),{isShuffleAllActive:r,isShuffleGenreActive:s,shuffle:n}=t;if(r||s)return;L(!0);try{await k(d.Id,d.Name)}catch(a){W.error("Failed to shuffle genre:",a)}finally{L(!1)}}},c=l.useMemo(()=>{const t=new Map;return h.forEach(r=>{if(r.AlbumId&&r.Album&&!t.has(r.AlbumId)){const s={Id:r.AlbumId,Name:r.Album,AlbumArtist:r.AlbumArtist,ArtistItems:r.ArtistItems,ProductionYear:r.ProductionYear,PremiereDate:r.PremiereDate};t.set(r.AlbumId,s)}}),Array.from(t.values()).sort((r,s)=>{const n=r.ProductionYear||(r.PremiereDate?new Date(r.PremiereDate).getFullYear():0),a=s.ProductionYear||(s.PremiereDate?new Date(s.PremiereDate).getFullYear():0);if(n!==a)return a-n;const i=r.Name||"",u=s.Name||"";return i.localeCompare(u)})},[h]),b=c.length>84,he=l.useMemo(()=>{if(!b)return c;const t=T*M,r=t+M;return c.slice(t,r)},[c,T,b]);l.useMemo(()=>{const t=new Map;h.forEach(s=>{var u,o;const n=s.AlbumArtist||((o=(u=s.ArtistItems)==null?void 0:u[0])==null?void 0:o.Name)||"Unknown Artist",a=s.AlbumId||"no-album";t.has(n)||t.set(n,new Map);const i=t.get(n);i.has(a)||i.set(a,[]),i.get(a).push(s)});const r=[];return t.forEach((s,n)=>{const a=[];s.forEach((i,u)=>{var S;const o=[...i].sort((C,be)=>{const Ne=C.IndexNumber||0,je=be.IndexNumber||0;return Ne-je}),x=((S=o[0])==null?void 0:S.Album)||"Unknown Album";a.push({albumId:u,albumName:x,songs:o})}),a.sort((i,u)=>{const o=i.songs[0],x=u.songs[0],S=(o==null?void 0:o.ProductionYear)||(o!=null&&o.PremiereDate?new Date(o.PremiereDate).getFullYear():0),C=(x==null?void 0:x.ProductionYear)||(x!=null&&x.PremiereDate?new Date(x.PremiereDate).getFullYear():0);return S!==C?C-S:i.albumName.localeCompare(u.albumName)}),r.push({artist:n,albums:a})}),r.sort((s,n)=>s.artist.localeCompare(n.artist)),r},[h]);const X=(t,r)=>{const s=r.find(a=>a.Id===t.AlbumId);if(s){const a=s.ProductionYear||(s.PremiereDate?new Date(s.PremiereDate).getFullYear():0);return s.PremiereDate?new Date(s.PremiereDate).getTime():a*1e4}const n=t.ProductionYear||(t.PremiereDate?new Date(t.PremiereDate).getFullYear():0);return t.PremiereDate?new Date(t.PremiereDate).getTime():n*1e4},j=l.useMemo(()=>y==="Alphabetical"?[...h].sort((t,r)=>{const s=t.Name||"",n=r.Name||"";return s.localeCompare(n)}):[...h].sort((t,r)=>{const s=X(t,c),n=X(r,c);if(s!==n)return y==="Newest"?n-s:s-n;const a=t.Album||"",i=r.Album||"";if(a!==i)return a.localeCompare(i);const u=t.IndexNumber||0,o=r.IndexNumber||0;if(u!==o)return u-o;const x=t.Name||"",S=r.Name||"";return x.localeCompare(S)}),[h,y,c]),xe=()=>{de(t=>t==="Alphabetical"?"Newest":t==="Newest"?"Oldest":"Alphabetical")},ge=()=>{j.length>0&&E(j)},pe=()=>{j.length>0&&G(j)};return l.useEffect(()=>{b||q(ee)},[c.length,b]),l.useEffect(()=>{K(0)},[m]),l.useEffect(()=>{J(te)},[j.length]),Z({totalCount:j.length,visibleCount:H,increment:Oe,setVisibleCount:J,threshold:1}),Z({totalCount:c.length,visibleCount:Q,increment:Be,setVisibleCount:q,threshold:1,enabled:!b}),se?e.jsxs("div",{className:"pb-20",children:[e.jsx("div",{className:`fixed top-0 left-0 right-0 bg-black z-10 lg:left-16 transition-[left,right] duration-300 ${P?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top))"},children:e.jsx("div",{className:"max-w-[768px] mx-auto",children:e.jsxs("div",{className:"flex items-center gap-4 py-4 pl-3 pr-4",children:[e.jsx("button",{onClick:()=>N(-1),className:"text-white hover:text-zinc-300 transition-colors",children:e.jsx(B,{className:"w-6 h-6"})}),e.jsx("h1",{className:"text-xl font-bold flex-1 truncate",children:(d==null?void 0:d.Name)||""}),e.jsx("div",{className:"flex items-center",children:e.jsx(ye,{})})]})})}),e.jsx("div",{className:"pt-20",children:e.jsx("div",{className:"flex items-center justify-center h-screen text-gray-400"})})]}):!d||h.length===0?e.jsxs("div",{className:"pb-20",children:[e.jsx("div",{className:`fixed top-0 left-0 right-0 bg-black z-10 lg:left-16 transition-[left,right] duration-300 ${P?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top))"},children:e.jsx("div",{className:"max-w-[768px] mx-auto",children:e.jsxs("div",{className:"flex items-center gap-4 py-4 pl-3 pr-4",children:[e.jsx("button",{onClick:()=>N(-1),className:"text-white hover:text-zinc-300 transition-colors",children:e.jsx(B,{className:"w-6 h-6"})}),e.jsx("h1",{className:"text-xl font-bold flex-1 truncate",children:"Genre"})]})})}),e.jsx("div",{className:"pt-20",children:e.jsx("div",{className:"flex items-center justify-center h-screen text-gray-400",children:e.jsx("p",{children:"Genre not found or no songs available"})})})]}):e.jsxs("div",{className:"pb-20",children:[e.jsx("div",{className:`fixed top-0 left-0 right-0 bg-black z-10 lg:left-16 transition-[left,right] duration-300 ${P?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top))"},children:e.jsx("div",{className:"max-w-[768px] mx-auto",children:e.jsxs("div",{className:"flex items-center gap-4 py-4 pl-3 pr-4",children:[e.jsx("button",{onClick:()=>N(-1),className:"text-white hover:text-zinc-300 transition-colors",children:e.jsx(B,{className:"w-6 h-6"})}),e.jsx("h1",{className:"text-xl font-bold flex-1 truncate",children:d.Name}),e.jsx("button",{onClick:fe,disabled:I,className:"w-8 h-8 flex items-center justify-center text-white hover:bg-zinc-800 rounded-full transition-colors disabled:opacity-50","aria-label":"Shuffle genre songs",children:I?e.jsx("div",{className:"w-4 h-4 border-2 border-zinc-400 border-t-white rounded-full animate-spin"}):e.jsx(Pe,{className:"w-5 h-5"})})]})})}),e.jsx("div",{className:`fixed left-0 right-0 z-[60] lg:left-16 transition-[left,right] duration-300 ${P?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 5rem - 16px)",height:"24px",background:"linear-gradient(to bottom, rgba(0, 0, 0, 0.8), transparent)"}}),e.jsxs("div",{style:{paddingTop:"calc(env(safe-area-inset-top) + 5rem)"},children:[c.length>0&&e.jsxs("div",{className:"mb-10 px-4 pt-4",children:[e.jsxs("h2",{className:"text-xl font-bold text-white mb-4",children:["Albums (",c.length,")"]}),e.jsx("div",{className:"grid grid-cols-3 md:grid-cols-4 gap-4",children:(b?he:c).map((t,r)=>e.jsx(ze,{album:t,onNavigate:s=>N(`/album/${s}`),onContextMenu:(s,n,a)=>{R(s),$("album"),ae(n||"mobile"),ie(a||null),V(!0)},showImage:b?!0:r<Q},t.Id))})]}),b&&c.length>0&&e.jsx("div",{className:"-mt-10 mb-10",children:e.jsx(Te,{currentPage:T,totalPages:Math.ceil(c.length/M),onPageChange:K,itemsPerPage:M,totalItems:c.length})}),h.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"px-4 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h2",{className:"text-2xl font-bold text-white",children:["Songs (",h.length,")"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:ge,className:"w-10 h-10 flex items-center justify-center text-white hover:bg-white/10 rounded-full transition-colors","aria-label":"Play all songs",children:e.jsx(Ce,{className:"w-5 h-5"})}),e.jsx("button",{type:"button",onClick:pe,className:"w-10 h-10 flex items-center justify-center text-white hover:bg-white/10 rounded-full transition-colors","aria-label":"Add all songs to queue",children:e.jsx(Me,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"mt-1",children:e.jsxs("button",{type:"button",onClick:xe,className:"text-sm text-gray-400 hover:text-white transition-colors flex items-center gap-1",children:[y,e.jsx(Ye,{className:"w-4 h-4"})]})})]}),e.jsx("div",{className:"space-y-0",children:j.map((t,r)=>{const s=r<H;return e.jsx(Le,{song:t,showImage:s},t.Id)})})]})]}),e.jsx(De,{item:oe,itemType:ce,isOpen:re,onClose:()=>{V(!1),R(null),$(null)},mode:ne,position:le||void 0})]})}export{qe as default};
