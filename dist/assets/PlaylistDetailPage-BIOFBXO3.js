import{c as Ie,K as Pe,N as je,b as Z,a as $,u as W,i as ee,r as n,e as g,l as H,O as V,x as Ne,j as e,w as we,I as te,Q as Ce,S as Ae,E as Te,C as X,f as Se,T as Me,V as ke}from"./index-BYKDqJ8o.js";import{u as Oe}from"./useScrollLazyLoad-D8jCAwog.js";import{A as De}from"./arrow-left-BicF6vPH.js";import{E as Ee}from"./ellipsis-40ShD4hH.js";import{A as Le}from"./arrow-up-down-BsayAhDf.js";/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fe=[["path",{d:"M16 5H3",key:"m91uny"}],["path",{d:"M11 12H3",key:"51ecnj"}],["path",{d:"M16 19H3",key:"zzsher"}],["path",{d:"M21 12h-6",key:"bt1uis"}]],ze=Ie("list-minus",Fe),Y=45,Re=45;function Ue({track:t,index:f,tracks:T,onClick:S,onContextMenu:M,contextMenuItemId:z,reorderable:N,onReorderDragStart:w,onReorderDragEnd:P,onReorderDrop:y,onDragEnterRow:b,isDragOver:v}){var D,E;const I=Z(),p=z===t.Id,h=ee(),x=n.useRef(!1),C=a=>{a.preventDefault(),a.stopPropagation(),x.current=!0,M(t,"desktop",{x:a.clientX,y:a.clientY}),setTimeout(()=>{x.current=!1},300)},R=Se({onLongPress:a=>{a.preventDefault(),x.current=!0,M(t,"mobile")},onClick:()=>{if(x.current){x.current=!1;return}S(t,T)}}),k=n.useCallback(a=>{a.preventDefault(),a.dataTransfer.dropEffect="move"},[]),j=n.useCallback(a=>{a.preventDefault(),b==null||b(f)},[b,f]),O=n.useCallback(a=>{y==null||y(a,f)},[y,f]);return e.jsxs("div",{className:`relative w-full flex items-center gap-3 hover:bg-white/10 transition-colors group px-4 py-3 cursor-pointer ${p?"bg-white/10":""}`,onClick:()=>{if(x.current){x.current=!1;return}S(t,T)},onContextMenu:C,...R,...N?{onDragOver:k,onDragEnter:j,onDrop:O}:{},children:[v&&e.jsx("div",{className:"absolute left-3 right-3 top-0 h-0.5 bg-[var(--accent-color)] rounded-full pointer-events-none"}),e.jsx("div",{className:"playlist-drag-art w-12 h-12 rounded-sm overflow-hidden flex-shrink-0 bg-zinc-900 self-center",children:e.jsx(te,{src:g.getAlbumArtUrl(t.AlbumId||t.Id,96),alt:t.Name,className:"w-full h-full object-cover",showOutline:!0,rounded:"rounded-sm"})}),e.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[e.jsx("div",{className:`text-sm font-medium truncate transition-colors ${(h==null?void 0:h.Id)===t.Id?"text-[var(--accent-color)]":"text-white group-hover:text-[var(--accent-color)]"}`,children:t.Name}),e.jsxs("div",{className:"text-xs text-gray-400 truncate",children:[(E=(D=t.ArtistItems)==null?void 0:D[0])!=null&&E.Id?e.jsx("span",{className:"clickable-text",onMouseDown:a=>a.stopPropagation(),onClick:a=>{a.stopPropagation(),I(`/artist/${t.ArtistItems[0].Id}`)},children:t.ArtistItems[0].Name||t.AlbumArtist||"Unknown Artist"}):t.AlbumArtist||"Unknown Artist",t.Album&&e.jsxs(e.Fragment,{children:[" â€¢ ",t.AlbumId?e.jsx("span",{className:"clickable-text",onMouseDown:a=>a.stopPropagation(),onClick:a=>{a.stopPropagation(),I(`/album/${t.AlbumId}`)},children:t.Album}):t.Album]})]})]}),t.RunTimeTicks&&e.jsx("div",{className:"text-xs text-gray-500 flex-shrink-0 text-right",children:Me(t.RunTimeTicks)}),N&&e.jsx("button",{draggable:!0,onMouseDown:a=>a.stopPropagation(),onTouchStart:a=>a.stopPropagation(),onDragStart:a=>{a.stopPropagation(),w==null||w(a,f)},onDragEnd:a=>{a.stopPropagation(),P==null||P()},className:"text-gray-500 hover:text-zinc-300 transition-colors p-2 cursor-grab active:cursor-grabbing focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--accent-color)] rounded","aria-label":"Drag to reorder",children:e.jsx(ke,{className:"w-4 h-4"})})]})}function Be(t){return t?t.charAt(0).toUpperCase()+t.slice(1):""}function Qe(){const{id:t,moodValue:f}=Pe(),T=je(),S=Z(),{playAlbum:M,playTrack:z,isPlaying:N,shuffleArtist:w}=$(),P=W(s=>s.songs),y=W(s=>s.recordMoodAccess),b=ee(),[v,I]=n.useState(null),[p,h]=n.useState([]),[x,C]=n.useState(!0),[R,k]=n.useState(!1),[j,O]=n.useState(null),[D,E]=n.useState("mobile"),[a,se]=n.useState(null),[ae,G]=n.useState(!1),[le,ne]=n.useState("mobile"),[re,ie]=n.useState(null),[K,Q]=n.useState(Y),[L,oe]=n.useState("PlaylistOrder"),[ce,U]=n.useState(!1),[q,ue]=n.useState(0),de=$(s=>s.isQueueSidebarOpen),[me,B]=n.useState(null),[_e,_]=n.useState(null),F=n.useRef(null),pe=n.useCallback((s,l)=>{s.dataTransfer.effectAllowed="move",s.dataTransfer.setData("text/plain",l.toString()),_(l),F.current=l;const i=s.currentTarget,o=i==null?void 0:i.closest(".playlist-track-row");if(o&&s.dataTransfer.setDragImage){const c=o.querySelector(".playlist-drag-art")??o,d=c.getBoundingClientRect();s.dataTransfer.setDragImage(c,d.width/2,d.height/2)}},[]),he=n.useCallback(()=>{_(null),B(null),F.current=null},[]),fe=n.useCallback(async(s,l)=>{s.preventDefault();const i=s.dataTransfer.getData("text/plain")||s.dataTransfer.getData("text/html"),o=parseInt(i,10);if(B(null),_(null),F.current=null,Number.isNaN(o)||o===l)return;h(c=>{const d=[...c],[A]=d.splice(o,1);return d.splice(l,0,A),d});const r=p[o];if(t&&(r!=null&&r.PlaylistItemId))try{await g.movePlaylistItem(t,r.PlaylistItemId,l)}catch(c){H.error("Failed to reorder playlist item:",c),V.getState().addToast("Failed to reorder track","error",3e3),h(d=>{const A=[...d],[ve]=A.splice(l,1);return A.splice(o,0,ve),A})}},[p,t]),xe=n.useCallback(s=>{F.current!=null&&B(s)},[]),u=T.pathname.startsWith("/mood/");n.useEffect(()=>{if(u||!t)return;const s=()=>{(async()=>{var i;try{const o=await g.getPlaylistItems(t);h(o);const c=(await g.getPlaylists({limit:1e3})).Items.find(d=>d.Id===t);c&&(I(c),U(!!((i=c.ImageTags)!=null&&i.Primary)),ue(Date.now()))}catch(o){H.error("Failed to refresh playlist data:",o)}})()};return window.addEventListener("playlistUpdated",s),()=>window.removeEventListener("playlistUpdated",s)},[t,u]);const ge=async(s,l)=>{if(!(!t||!("PlaylistItemId"in l)||!l.PlaylistItemId))try{await g.removeItemsFromPlaylist(t,[l.PlaylistItemId]),V.getState().addToast("Removed from playlist","success",2e3),h(i=>i.filter(o=>o.PlaylistItemId!==l.PlaylistItemId))}catch{V.getState().addToast("Failed to remove track","error",3e3)}};n.useEffect(()=>{if(u&&f){const l=decodeURIComponent(f).toLowerCase();y(l);const i=P.filter(r=>!r.Grouping||r.Grouping.length===0?!1:r.Grouping.some(c=>{const d=Ne(c);return d&&d.category==="mood"&&d.value===l}));I({Id:`mood-${l}`,Name:Be(l),Type:"Mood"});const o=[...i].sort((r,c)=>(r.Name||"").localeCompare(c.Name||"")).map(r=>({Id:r.Id,Name:r.Name,AlbumArtist:r.AlbumArtist,ArtistItems:r.ArtistItems,Album:r.Album,AlbumId:r.AlbumId,RunTimeTicks:r.RunTimeTicks,Type:"Audio"}));h(o),C(!1);return}if(!t)return;(async()=>{var l;C(!0);try{const i=await g.getPlaylistItems(t);h(i);const r=(await g.getPlaylists({limit:1e3})).Items.find(c=>c.Id===t);r?(I(r),U(!!((l=r.ImageTags)!=null&&l.Primary))):i.length>0&&I({Id:t,Name:"Playlist",Type:"Playlist"})}catch(i){H.error("Failed to load playlist data:",i)}finally{C(!1)}})()},[t,u,f,y,P]),n.useEffect(()=>{Q(Y)},[p.length]),Oe({totalCount:p.length,visibleCount:K,increment:Re,setVisibleCount:Q,threshold:1.5});const m=n.useMemo(()=>u?p:L==="Alphabetical"?[...p].sort((s,l)=>(s.Name||"").localeCompare(l.Name||"")):p,[p,L,u]),ye=()=>{m.length>0&&M(m)},be=()=>{m.length>0&&w(m)},J=()=>!m.length||!b?!1:m.some(s=>s.Id===b.Id);return x?e.jsx("div",{className:"pb-20",children:e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsx(we,{})})}):v?e.jsxs("div",{className:"pb-20",children:[e.jsx("div",{className:`fixed top-0 left-0 right-0 bg-black z-10 lg:left-16 transition-[left,right] duration-300 ${de?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top))"},children:e.jsx("div",{className:"max-w-[768px] mx-auto",children:e.jsxs("div",{className:"flex items-center justify-between gap-4 pl-3 pr-4",style:{paddingTop:"calc(1rem + 8px)",paddingBottom:"1rem"},children:[e.jsx("button",{onClick:()=>S(-1),className:"text-white hover:text-zinc-300 transition-colors",children:e.jsx(De,{className:"w-6 h-6"})}),!u&&e.jsx("button",{onClick:s=>{const l=s.currentTarget.getBoundingClientRect();ne("desktop"),ie({x:l.left+l.width/2,y:l.bottom+5}),G(!0)},className:"text-white hover:text-zinc-300 transition-colors",children:e.jsx(Ee,{className:"w-6 h-6"})})]})})}),e.jsxs("div",{className:"pt-20",children:[e.jsxs("div",{className:"mb-6 px-4 pt-4",children:[ce&&e.jsx("div",{className:"flex justify-center mb-6",children:e.jsx("div",{className:"w-64 h-64 rounded overflow-hidden bg-zinc-900",children:e.jsx(te,{src:g.getImageUrl(v.Id,"Primary",474)+(q?`&cb=${q}`:""),alt:v.Name,className:"w-full h-full object-cover",showOutline:!0,rounded:"rounded",onError:()=>U(!1)})})}),e.jsxs("div",{className:"w-full",children:[e.jsx("h2",{className:"text-4xl md:text-5xl font-bold mb-0.5 text-left break-words",children:v.Name}),m.length>0&&e.jsxs("div",{className:"flex items-center justify-between gap-4 mt-2",children:[e.jsxs("div",{className:"text-gray-400",children:[m.length," ",m.length===1?"track":"tracks"]}),e.jsx("button",{onClick:J()&&N?()=>$.getState().pause():u?be:ye,className:"bg-white/10 hover:bg-white/20 text-white font-semibold py-1.5 px-3 rounded-full transition-all hover:scale-105 flex items-center gap-1.5 backdrop-blur-sm border border-white/20 flex-shrink-0",children:J()&&N?e.jsxs(e.Fragment,{children:[e.jsx(Ce,{className:"w-3.5 h-3.5"}),"Pause"]}):u?e.jsxs(e.Fragment,{children:[e.jsx(Ae,{className:"w-3.5 h-3.5"}),"Shuffle"]}):e.jsxs(e.Fragment,{children:[e.jsx(Te,{className:"w-3.5 h-3.5"}),"Play"]})})]})]})]}),m.length===0?e.jsx("div",{className:"flex items-center justify-center px-8 pt-24",children:e.jsx("p",{className:"text-gray-400 text-center",children:"Long press or right click on songs and albums to add them to playlists"})}):e.jsxs(e.Fragment,{children:[!u&&e.jsx("div",{className:"px-4 mb-1",children:e.jsxs("button",{type:"button",onClick:()=>oe(s=>s==="PlaylistOrder"?"Alphabetical":"PlaylistOrder"),className:"text-sm text-gray-400 hover:text-white transition-colors flex items-center gap-1",children:[L==="PlaylistOrder"?"Playlist Order":"Alphabetically",e.jsx(Le,{className:"w-4 h-4"})]})}),e.jsx("div",{children:e.jsx("div",{className:"space-y-0",children:m.slice(0,K).map((s,l)=>e.jsx("div",{className:"playlist-track-row",children:e.jsx(Ue,{track:s,index:l,tracks:m,onClick:i=>z(i,m),onContextMenu:(i,o,r)=>{O(i),E(o||"mobile"),se(r||null),k(!0)},contextMenuItemId:(j==null?void 0:j.Id)||null,reorderable:L==="PlaylistOrder"&&!u,onReorderDragStart:pe,onReorderDragEnd:he,onReorderDrop:fe,onDragEnterRow:xe,isDragOver:me===l})},s.Id))})})]})]}),e.jsx(X,{item:j,itemType:"song",isOpen:R,onClose:()=>{k(!1),O(null)},mode:D,position:a||void 0,extraActions:u?void 0:[{id:"removeFromPlaylist",label:"Remove from Playlist",icon:ze}],onExtraAction:u?void 0:ge}),e.jsx(X,{item:v,itemType:"playlist",isOpen:ae,onClose:()=>{G(!1)},mode:le,position:re||void 0})]}):e.jsx("div",{className:"pb-20",children:e.jsx("div",{className:"flex items-center justify-center h-screen text-gray-400",children:e.jsx("p",{children:u?"No songs found for this mood":"Playlist not found"})})})}export{Qe as default};
