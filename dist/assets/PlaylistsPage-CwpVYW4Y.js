import{b as X,r as n,f as $,j as e,I as xe,e as P,C as q,u as me,a as W,d as fe,h as he,P as ge,L as pe,U as Y,D as V}from"./index-AOm-apGX.js";import{u as ve,S as be}from"./search-tT2_0xD9.js";import{A as je}from"./arrow-up-down-CX2ufI1q.js";function ye({playlist:s}){const I=X(),[h,v]=n.useState(!1),[A,g]=n.useState("mobile"),[c,j]=n.useState(null),u=n.useRef(!1),d=a=>{if(u.current){a.preventDefault(),u.current=!1;return}I(`/playlist/${s.Id}`)},p=$({onLongPress:a=>{a.preventDefault(),u.current=!0,g("mobile"),j(null),v(!0)}}),y=a=>{a.preventDefault(),a.stopPropagation(),u.current=!0,g("desktop"),j({x:a.clientX,y:a.clientY}),v(!0),setTimeout(()=>{u.current=!1},300)};return e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:a=>{if(h||u.current){a.preventDefault(),a.stopPropagation();return}d(a)},onContextMenu:y,...p,className:"w-full flex items-center gap-3 hover:bg-white/10 transition-colors group px-4 py-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-sm overflow-hidden flex-shrink-0 bg-zinc-900 self-center",children:e.jsx(xe,{src:P.getAlbumArtUrl(s.Id,96),alt:s.Name,className:"w-full h-full object-cover",showOutline:!0,rounded:"rounded-sm"})}),e.jsxs("div",{className:"flex-1 min-w-0 text-left flex flex-col justify-center",children:[e.jsx("div",{className:"text-sm font-medium text-white truncate group-hover:text-[var(--accent-color)] transition-colors",children:s.Name}),e.jsx("div",{className:"text-xs text-gray-400 truncate",children:s.ChildCount?`${s.ChildCount} tracks`:"Playlist"})]})]}),e.jsx(q,{item:s,itemType:"playlist",isOpen:h,onClose:()=>v(!1),mode:A,position:c||void 0})]})}const H=new Map;function Ne({artist:s,onClick:I,onContextMenu:h,contextMenuItemId:v}){var x,k;const[A,g]=n.useState(!1),c=n.useRef(!1),j=v===s.Id,[u,d]=n.useState(null);n.useEffect(()=>{var m;if((m=s.ImageTags)!=null&&m.Primary){d(null);return}const r=H.get(s.Id);if(r!==void 0){d(r);return}let b=!1;return(async()=>{try{const{albums:N,songs:o}=await P.getArtistItems(s.Id),w=N[0],U=o.find(z=>z.AlbumId)||o[0],M=w||U,f=M?M.AlbumId||M.Id:null,O=f?P.getAlbumArtUrl(f,96):null;H.set(s.Id,O),b||d(O)}catch(N){console.error("Failed to load fallback album art for artist (playlists search):",s.Id,N),H.set(s.Id,null)}})(),()=>{b=!0}},[s.Id,s.ImageTags]);const p=r=>{if(j||c.current){r.preventDefault(),r.stopPropagation(),c.current=!1;return}I(s.Id)},y=r=>{r.preventDefault(),r.stopPropagation(),c.current=!0,h(s,"artist"),setTimeout(()=>{c.current=!1},300)},a=$({onLongPress:r=>{r.preventDefault(),c.current=!0,h(s,"artist")},onClick:p});return e.jsxs("button",{onClick:p,onContextMenu:y,...a,className:`w-full flex items-center gap-4 hover:bg-white/10 transition-colors text-left px-4 h-[72px] ${j?"bg-white/10":""}`,children:[e.jsx("div",{className:"w-12 h-12 rounded-full overflow-hidden flex-shrink-0 bg-zinc-900 flex items-center justify-center",children:A?e.jsx(Y,{className:"w-6 h-6 text-gray-500"}):(x=s.ImageTags)!=null&&x.Primary||u?e.jsx("img",{src:(k=s.ImageTags)!=null&&k.Primary?P.getArtistImageUrl(s.Id,96):u||"",alt:s.Name,className:"w-full h-full object-cover",onError:()=>g(!0),loading:"lazy"}):e.jsx(Y,{className:"w-6 h-6 text-gray-500"})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("div",{className:"text-base font-medium text-white truncate group-hover:text-[var(--accent-color)] transition-colors",children:s.Name})})]})}function we({album:s,onClick:I,onContextMenu:h,contextMenuItemId:v}){var y,a;const[A,g]=n.useState(!1),c=n.useRef(!1),j=v===s.Id,u=x=>{if(j||c.current){x.preventDefault(),x.stopPropagation(),c.current=!1;return}I(s.Id)},d=x=>{x.preventDefault(),x.stopPropagation(),c.current=!0,h(s,"album"),setTimeout(()=>{c.current=!1},300)},p=$({onLongPress:x=>{x.preventDefault(),c.current=!0,h(s,"album")},onClick:u});return e.jsxs("button",{onClick:u,onContextMenu:d,...p,className:"text-left group",children:[e.jsx("div",{className:"aspect-square rounded overflow-hidden mb-3 bg-zinc-900 shadow-lg relative flex items-center justify-center",children:A?e.jsx(V,{className:"w-12 h-12 text-gray-500"}):e.jsxs(e.Fragment,{children:[e.jsx("img",{src:P.getAlbumArtUrl(s.Id,474),alt:s.Name,className:"w-full h-full object-cover",onError:()=>g(!0)}),e.jsx("div",{className:"absolute inset-0 pointer-events-none border border-white rounded",style:{borderColor:"rgba(255, 255, 255, 0.03)",borderWidth:"1px"}})]})}),e.jsx("div",{className:"text-sm font-semibold text-white truncate mb-1",children:s.Name}),e.jsx("div",{className:"text-xs text-gray-400 truncate",children:s.AlbumArtist||((a=(y=s.ArtistItems)==null?void 0:y[0])==null?void 0:a.Name)||"Unknown Artist"})]})}function Ce({song:s,onClick:I,onContextMenu:h,contextMenuItemId:v,showImage:A=!0}){var x,k;const g=n.useRef(!1),c=v===s.Id,[j,u]=n.useState(!1),d=r=>{const b=Math.floor(r/1e7),S=Math.floor(b/60),m=b%60;return`${S}:${m.toString().padStart(2,"0")}`},p=r=>{if(c||g.current){r.preventDefault(),r.stopPropagation(),g.current=!1;return}I(s)},y=r=>{r.preventDefault(),r.stopPropagation(),g.current=!0,h(s,"song"),setTimeout(()=>{g.current=!1},300)},a=$({onLongPress:r=>{r.preventDefault(),g.current=!0,h(s,"song")},onClick:p});return e.jsxs("button",{onClick:p,onContextMenu:y,...a,className:`w-full flex items-center gap-3 hover:bg-white/10 transition-colors group px-4 py-3 ${c?"bg-white/10":""}`,children:[e.jsx("div",{className:"w-12 h-12 rounded-sm overflow-hidden flex-shrink-0 bg-zinc-900 self-center relative flex items-center justify-center",children:j?e.jsx(V,{className:"w-7 h-7 text-gray-500"}):e.jsxs(e.Fragment,{children:[e.jsx("img",{src:P.getAlbumArtUrl(s.AlbumId||s.Id,96),alt:s.Name,className:"w-full h-full object-cover",loading:"lazy",onError:()=>u(!0)}),e.jsx("div",{className:"absolute inset-0 pointer-events-none border border-white rounded-sm",style:{borderColor:"rgba(255, 255, 255, 0.03)",borderWidth:"1px"}})]})}),e.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[e.jsx("div",{className:"text-sm font-medium text-white truncate group-hover:text-[var(--accent-color)] transition-colors",children:s.Name}),e.jsxs("div",{className:"text-xs text-gray-400 truncate",children:[s.AlbumArtist||((k=(x=s.ArtistItems)==null?void 0:x[0])==null?void 0:k.Name)||"Unknown Artist",s.Album&&` â€¢ ${s.Album}`]})]}),s.RunTimeTicks&&e.jsx("div",{className:"text-xs text-gray-500 flex-shrink-0 text-right",children:d(s.RunTimeTicks)})]})}function Ae(){const[s,I]=n.useState([]),[h,v]=n.useState(!0),{sortPreferences:A,setSortPreference:g}=me(),{playTrack:c,playAlbum:j,addToQueue:u}=W(),d=A.playlists,p=n.useRef(!0),[y,a]=n.useState(!1),x=n.useRef(d),k=X(),r=n.useRef(null),[b,S]=n.useState(""),[m,N]=n.useState(!1),[o,w]=n.useState(null),[U,M]=n.useState(!1),f=n.useRef(null),[O,z]=n.useState(!1),[C,Q]=n.useState(null),[G,B]=n.useState(null),[K,Z]=n.useState("mobile"),[_,ee]=n.useState(null),[te,J]=n.useState(45),F=W(t=>t.isQueueSidebarOpen);n.useEffect(()=>{m||(!p.current&&x.current!==d&&a(!0),x.current=d,se())},[d,m]),n.useEffect(()=>{p.current&&(p.current=!1)},[]),n.useEffect(()=>{if(f.current&&f.current.abort(),b.trim()){M(!0),f.current=new AbortController;const t=window.setTimeout(async()=>{var i,T,E,L;if(!((i=f.current)!=null&&i.signal.aborted))try{const D=await ve(b,450);(T=f.current)!=null&&T.signal.aborted||w(D)}catch(D){(E=f.current)!=null&&E.signal.aborted||(console.error("Search failed:",D),w(null))}finally{(L=f.current)!=null&&L.signal.aborted||M(!1)}},250);return()=>{window.clearTimeout(t),f.current&&f.current.abort()}}else f.current=null,w(null),M(!1)},[b]),n.useEffect(()=>{J(45)},[b,m,o==null?void 0:o.songs.length]),n.useEffect(()=>{var i;if(!m||!((i=o==null?void 0:o.songs)!=null&&i.length))return;const t=()=>{const T=window.scrollY||document.documentElement.scrollTop,E=window.innerHeight||document.documentElement.clientHeight,L=document.documentElement.scrollHeight;T+E*1.5>=L&&J(D=>Math.min(D+45,o.songs.length))};return window.addEventListener("scroll",t,{passive:!0}),()=>window.removeEventListener("scroll",t)},[m,o==null?void 0:o.songs.length]),n.useEffect(()=>{var t;if(m&&((t=r.current)==null||t.focus(),r.current)){const i=r.current.value.length;r.current.setSelectionRange(i,i)}},[m]),n.useEffect(()=>()=>{f.current&&f.current.abort()},[]);const se=async()=>{v(!0);try{const t={limit:100};d==="RecentlyAdded"?(t.sortBy=["DateCreated"],t.sortOrder="Descending"):(t.sortBy=["SortName"],t.sortOrder="Ascending");const i=await P.getPlaylists(t);I(i.Items)}catch(t){console.error("Failed to load playlists:",t)}finally{v(!1),a(!1)}},ne=t=>{S(t),t.trim().length>0&&!m&&N(!0)},re=()=>{S(""),w(null)},le=()=>{N(!1),S(""),w(null)},ae=t=>{k(`/artist/${t}`),N(!1),S(""),w(null)},oe=t=>{k(`/album/${t}`),N(!1),S(""),w(null)},ie=t=>{c(t,[t])},ce=t=>{t.preventDefault(),t.stopPropagation(),l!=null&&l.songs&&l.songs.length>0&&j(l.songs)},de=t=>{t.preventDefault(),t.stopPropagation(),l!=null&&l.songs&&l.songs.length>0&&u(l.songs)},ue=t=>{k(`/playlist/${t}`),N(!1),S(""),w(null)},R=(t,i,T="mobile",E)=>{Q(t),B(i),Z(T),ee(E||null),z(!0)},l=n.useMemo(()=>o?{playlists:o.playlists||[],artists:o.artists||[],albums:o.albums||[],songs:o.songs||[]}:null,[o]);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"pb-20",children:[e.jsx("div",{className:`fixed top-0 left-0 right-0 bg-black z-10 lg:left-16 transition-[left,right] duration-300 ${F?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top))"},children:e.jsx("div",{className:"max-w-[768px] mx-auto",children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Playlists"}),e.jsx("button",{onClick:()=>N(!0),className:"w-10 h-10 flex items-center justify-center text-white hover:bg-zinc-800 rounded-full transition-colors","aria-label":"Search",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})]}),!m&&e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("button",{onClick:()=>g("playlists",d==="RecentlyAdded"?"Alphabetical":"RecentlyAdded"),className:"text-sm text-gray-400 hover:text-white transition-colors flex items-center gap-1",children:[d==="RecentlyAdded"?"Recently Added":"Alphabetically",e.jsx(je,{className:"w-4 h-4"})]}),h&&!p.current&&e.jsx("div",{className:"flex items-center",children:e.jsx(he,{})})]})]})})}),e.jsx("div",{className:`fixed left-0 right-0 z-10 lg:left-16 transition-[left,right] duration-300 ${F?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 7rem - 8px)",height:"24px",background:"linear-gradient(to bottom, rgba(0, 0, 0, 0.8), transparent)"}}),e.jsx("div",{style:{paddingTop:"calc(env(safe-area-inset-top) + 7rem)"},children:!m&&e.jsx("div",{className:y?"opacity-50 pointer-events-none":"",children:s.length===0&&!h?e.jsx("div",{className:"flex items-center justify-center py-16 text-gray-400",children:e.jsx("p",{children:"No playlists found"})}):e.jsx("div",{className:"space-y-0",children:s.map(t=>e.jsx(ye,{playlist:t},t.Id))})})})]}),m&&fe.createPortal(e.jsx(e.Fragment,{children:e.jsxs("div",{className:"fixed inset-0 bg-black z-[9999] overflow-y-auto p-0 m-0",children:[e.jsx("div",{className:"fixed top-0 left-0 right-0 bg-black z-50 pointer-events-none",style:{height:"env(safe-area-inset-top)",top:"var(--header-offset, 0px)"}}),e.jsx("div",{className:"fixed top-0 left-0 right-0 bg-black z-10 pt-0 pb-0 w-full m-0",style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top))",height:"76px"},children:e.jsx("div",{className:"max-w-[768px] mx-auto w-full",children:e.jsxs("div",{className:"flex items-center gap-3 px-4 pt-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(be,{ref:r,value:b,onChange:ne,showClearButton:b.trim().length>0,onClear:re})}),e.jsx("button",{onClick:le,className:"px-4 py-2 text-white text-sm font-medium hover:text-zinc-300 transition-colors whitespace-nowrap flex-shrink-0",children:"Cancel"})]})})}),e.jsx("div",{className:`fixed left-0 right-0 z-[60] lg:left-16 transition-[left,right] duration-300 ${F?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 76px)",height:"24px",background:"linear-gradient(to bottom, rgba(0, 0, 0, 0.8), transparent)"}}),e.jsx("div",{className:"max-w-[768px] mx-auto w-full",style:{paddingTop:"calc(52px + env(safe-area-inset-top))"},children:e.jsx("div",{className:"pb-32 pt-4",children:U?e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-zinc-800 border-t-[var(--accent-color)]"})}):l?e.jsxs("div",{className:"space-y-8",children:[l.playlists.length>0&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-4 px-4",children:"Playlists"}),e.jsx("div",{className:"space-y-0",children:l.playlists.map(t=>e.jsxs("button",{onClick:()=>ue(t.Id),onContextMenu:i=>{i.preventDefault(),i.stopPropagation(),R(t,"playlist","desktop",{x:i.clientX,y:i.clientY})},className:"w-full flex items-center gap-3 hover:bg-white/10 transition-colors group px-4 py-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-sm overflow-hidden flex-shrink-0 bg-zinc-900 self-center",children:e.jsx("img",{src:P.getAlbumArtUrl(t.Id,96),alt:t.Name,className:"w-full h-full object-cover",loading:"lazy"})}),e.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[e.jsx("div",{className:"text-sm font-medium text-white truncate group-hover:text-[var(--accent-color)] transition-colors",children:t.Name}),e.jsx("div",{className:"text-xs text-gray-400 truncate",children:t.ChildCount?`${t.ChildCount} tracks`:"Playlist"})]})]},t.Id))})]}),l.artists.length>0&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-4 px-4",children:"Artists"}),e.jsx("div",{className:"space-y-0",children:l.artists.slice(0,5).map(t=>e.jsx(Ne,{artist:t,onClick:ae,onContextMenu:R,contextMenuItemId:(C==null?void 0:C.Id)||null},t.Id))})]}),l.albums.length>0&&e.jsxs("div",{className:"px-4",children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Albums"}),e.jsx("div",{className:"grid grid-cols-3 gap-4",children:l.albums.slice(0,12).map(t=>e.jsx(we,{album:t,onClick:oe,onContextMenu:R,contextMenuItemId:(C==null?void 0:C.Id)||null},t.Id))})]}),l.songs.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 px-4",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"Songs"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:ce,className:"w-10 h-10 flex items-center justify-center text-white hover:bg-white/10 rounded-lg transition-colors","aria-label":"Play all songs",children:e.jsx(ge,{className:"w-5 h-5"})}),e.jsx("button",{type:"button",onClick:de,className:"w-10 h-10 flex items-center justify-center text-white hover:bg-white/10 rounded-lg transition-colors","aria-label":"Add all songs to queue",children:e.jsx(pe,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"space-y-0",children:l.songs.map((t,i)=>e.jsx(Ce,{song:t,onClick:ie,onContextMenu:R,contextMenuItemId:(C==null?void 0:C.Id)||null,showImage:i<te},t.Id))})]}),l.playlists.length===0&&l.artists.length===0&&l.albums.length===0&&l.songs.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 text-gray-400 px-4",children:[e.jsx("div",{className:"text-lg mb-2",children:"No results found"}),e.jsx("div",{className:"text-sm",children:"Try a different search term"})]})]}):e.jsx("div",{className:"flex flex-col items-center justify-center py-16 text-gray-400 px-4"})})})]})}),document.body),e.jsx(q,{item:C,itemType:G,isOpen:O,onClose:()=>{z(!1),Q(null),B(null)},zIndex:99999,mode:K,position:_||void 0})]})}export{Ae as default};
