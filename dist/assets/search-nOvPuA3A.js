import{r as o,j as e,m as ce,n as ue,f as de,e as M,U as K,s as me,C as xe,G as he,P as fe,L as pe,t as y}from"./index-CYP8MbMQ.js";import{C as ge,T as be,S as ve,G as we}from"./tag-Cl7DAqNB.js";import{P as je}from"./piano-C8jGzXQo.js";const Y=o.forwardRef(({value:t,onChange:s,placeholder:m="Search...",debounceMs:r=150,showClearButton:h=!1,onClear:x},f)=>{const[n,g]=o.useState(t),a=o.useRef(s),l=o.useRef(null),i=c=>{l.current=c,typeof f=="function"?f(c):f&&(f.current=c)};return o.useEffect(()=>{a.current=s},[s]),o.useEffect(()=>{const c=setTimeout(()=>{a.current(n)},r);return()=>clearTimeout(c)},[n,r]),o.useEffect(()=>{t===""&&n!==""&&g(t)},[t]),e.jsxs("div",{className:"relative",children:[e.jsx("input",{ref:i,type:"text",value:n,onChange:c=>{g(c.target.value)},placeholder:m,className:"w-full px-4 py-2 pl-10 pr-10 bg-zinc-900 border border-zinc-800 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-[var(--accent-color)] focus:border-transparent"}),e.jsx("svg",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),e.jsx("button",{onClick:c=>{c.preventDefault(),c.stopPropagation(),g(""),x&&x(),setTimeout(()=>{var b;(b=l.current)==null||b.focus()},0)},className:`absolute right-3 top-1/2 transform -translate-y-1/2 w-5 h-5 transition-opacity ${h&&n?"text-gray-400 hover:text-white opacity-100 pointer-events-auto":"opacity-0 pointer-events-none"}`,"aria-label":"Clear search",type:"button",children:e.jsx("svg",{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",className:"w-full h-full",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})});Y.displayName="SearchInput";const Ne=o.memo(function({artist:s,onClick:m,onContextMenu:r,contextMenuItemId:h}){var R;const[x,f]=o.useState(!1),n=o.useRef(!1),g=h===s.Id,[a,l]=o.useState(null);o.useEffect(()=>{var u;if((u=s.ImageTags)!=null&&u.Primary){l(null);return}const p=ce(s.Id);if(p!==void 0){l(p);return}let S=!1;return ue(s.Id).then(P=>{S||l(P)}),()=>{S=!0}},[s.Id,s.ImageTags]);const i=p=>{if(g||n.current){p.preventDefault(),p.stopPropagation(),n.current=!1;return}m(s.Id)},c=p=>{p.preventDefault(),p.stopPropagation(),n.current=!0,r(s,"artist","desktop",{x:p.clientX,y:p.clientY}),setTimeout(()=>{n.current=!1},300)},b=de({onLongPress:p=>{p.preventDefault(),n.current=!0,r(s,"artist","mobile")},onClick:i}),w=(R=s.ImageTags)!=null&&R.Primary?M.getArtistImageUrl(s.Id,96):a;return e.jsxs("button",{onClick:i,onContextMenu:c,...b,className:`group w-full flex items-center gap-4 hover:bg-white/10 transition-colors text-left cursor-pointer px-4 h-[72px] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--accent-color)] focus-visible:ring-inset ${g?"bg-white/10":""}`,"aria-label":`Go to artist ${s.Name}`,children:[e.jsx("div",{className:"w-12 h-12 rounded-full overflow-hidden flex-shrink-0 bg-zinc-900 flex items-center justify-center",children:x?e.jsx(K,{className:"w-6 h-6 text-gray-500"}):w?e.jsx("img",{src:w,alt:s.Name,className:"w-full h-full object-cover",onError:()=>f(!0),loading:"lazy"}):e.jsx(K,{className:"w-6 h-6 text-gray-500"})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("div",{className:"text-base font-medium text-white truncate group-hover:text-[var(--accent-color)] transition-colors",children:s.Name})})]})});function ye({album:t,onClick:s,onContextMenu:m,contextMenuItemId:r}){var g,a;const h=o.useRef(!1),x=r===t.Id,f=l=>{if(x||h.current){l.preventDefault(),l.stopPropagation(),h.current=!1;return}s(t.Id)},n=l=>{l.preventDefault(),l.stopPropagation(),h.current=!0,m(t,"album","desktop",{x:l.clientX,y:l.clientY}),setTimeout(()=>{h.current=!1},300)};return e.jsxs("button",{onClick:f,onContextMenu:n,className:"text-left group",children:[e.jsxs("div",{className:"aspect-square rounded overflow-hidden mb-3 bg-zinc-900 shadow-lg relative flex items-center justify-center",children:[e.jsx("img",{src:M.getAlbumArtUrl(t.Id,474),alt:t.Name,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 pointer-events-none border border-white rounded",style:{borderColor:"rgba(255, 255, 255, 0.03)",borderWidth:"1px"}})]}),e.jsx("div",{className:"text-sm font-semibold text-white truncate mb-1 group-hover:text-[var(--accent-color)] transition-colors",children:t.Name}),e.jsx("div",{className:"text-xs text-gray-400 truncate",children:t.AlbumArtist||((a=(g=t.ArtistItems)==null?void 0:g[0])==null?void 0:a.Name)||"Unknown Artist"})]})}function ke({song:t,onClick:s,onContextMenu:m,contextMenuItemId:r,showImage:h=!0}){var l;const x=o.useRef(!1),f=r===t.Id,n=i=>{const c=Math.floor(i/1e7),b=Math.floor(c/60),w=c%60;return`${b}:${w.toString().padStart(2,"0")}`},g=i=>{if(f||x.current){i.preventDefault(),i.stopPropagation(),x.current=!1;return}s(t)},a=i=>{i.preventDefault(),i.stopPropagation(),x.current=!0,m(t,"song","desktop",{x:i.clientX,y:i.clientY}),setTimeout(()=>{x.current=!1},300)};return e.jsxs("button",{onClick:g,onContextMenu:a,className:`w-full flex items-center gap-3 hover:bg-white/10 transition-colors group px-4 py-3 ${f?"bg-white/10":""}`,children:[h&&e.jsx("div",{className:"w-12 h-12 rounded-sm overflow-hidden flex-shrink-0 bg-zinc-900 self-center",children:e.jsx("img",{src:M.getAlbumArtUrl(t.AlbumId||t.Id,96),alt:t.Name,className:"w-full h-full object-cover",loading:"lazy"})}),e.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[e.jsx("div",{className:"text-sm font-medium text-white truncate group-hover:text-[var(--accent-color)] transition-colors",children:t.Name}),e.jsx("div",{className:"text-xs text-gray-400 truncate",children:((l=t.ArtistItems)==null?void 0:l.map(i=>i.Name).join(", "))||t.AlbumArtist||"Unknown Artist"})]}),t.RunTimeTicks&&e.jsx("div",{className:"text-xs text-gray-500 flex-shrink-0",children:n(t.RunTimeTicks)})]})}function Ie({playlist:t,onClick:s,onContextMenu:m}){return e.jsxs("button",{onClick:()=>s(t.Id),onContextMenu:r=>{r.preventDefault(),r.stopPropagation(),m(t,"playlist","desktop",{x:r.clientX,y:r.clientY})},className:"w-full flex items-center gap-3 hover:bg-white/10 transition-colors group px-4 py-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-sm overflow-hidden flex-shrink-0 bg-zinc-900 self-center",children:e.jsx("img",{src:M.getAlbumArtUrl(t.Id,96),alt:t.Name,className:"w-full h-full object-cover",loading:"lazy"})}),e.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[e.jsx("div",{className:"text-sm font-medium text-white truncate group-hover:text-[var(--accent-color)] transition-colors",children:t.Name}),e.jsx("div",{className:"text-xs text-gray-400 truncate",children:t.ChildCount?`${t.ChildCount} tracks`:"Playlist"})]})]})}const Ce=t=>{switch(t.toLowerCase()){case"language":return we;case"mood":return ve;case"instrumental":return je;default:return be}};function Re({isOpen:t,onClose:s,title:m="Search",searchQuery:r,onSearchChange:h,onClearSearch:x,isLoading:f,results:n,sections:g,filterConfig:a,filterState:l,onOpenFilterSheet:i,groupingCategories:c=[],onOpenGroupingFilterSheet:b,onArtistClick:w,onAlbumClick:R,onSongClick:p,onPlaylistClick:S,onPlayAllSongs:u,onAddSongsToQueue:P,isQueueSidebarOpen:k=!1,desktopSearchInputRef:T,mobileSearchInputRef:z}){const $=o.useRef(null),I=o.useRef(null),D=T||$,G=z||I,[Z,B]=o.useState(!1),[O,q]=o.useState(!1);o.useEffect(()=>{if(t)q(!0),requestAnimationFrame(()=>{requestAnimationFrame(()=>{B(!0)})});else{B(!1);const d=setTimeout(()=>{q(!1)},200);return()=>clearTimeout(d)}},[t]);const[Q,W]=o.useState(!1),[ee,te]=o.useState("mobile"),[se,ne]=o.useState(null),[N,V]=o.useState(null),[re,X]=o.useState(null),E=(d,v,L,C)=>{V(d),X(v),te(L),ne(C||null),W(!0)};o.useEffect(()=>{var d,v;t&&(window.matchMedia("(hover: hover) and (pointer: fine) and (min-width: 1024px)").matches?(d=D.current)==null||d.focus():(v=G.current)==null||v.focus())},[t,D,G]),o.useEffect(()=>{if(!t)return;const d=v=>{v.key==="Escape"&&s()};return window.addEventListener("keydown",d,!0),()=>window.removeEventListener("keydown",d,!0)},[t,s]);const _=a.showGenreFilter||a.showYearFilter||a.showGroupingFilters&&c.length>0,ae=n&&(n.artists.length>0||n.albums.length>0||n.songs.length>0||n.playlists&&n.playlists.length>0),le=(d,v)=>{if(!n)return null;const{type:L,limit:C}=d,U=v?"":"-mx-4",F=v?"pl-2 pr-4":"";switch(L){case"artists":{const j=C?n.artists.slice(0,C):n.artists;return j.length===0?null:e.jsxs("div",{children:[e.jsx("h2",{className:`text-xl font-bold text-white mb-4 ${F}`,children:"Artists"}),e.jsx("div",{className:`space-y-0 ${U}`,children:j.map(A=>e.jsx(Ne,{artist:A,onClick:w,onContextMenu:E,contextMenuItemId:(N==null?void 0:N.Id)||null},A.Id))})]},"artists")}case"albums":{const j=C?n.albums.slice(0,C):n.albums;return j.length===0?null:e.jsxs("div",{className:v?F:"",children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Albums"}),e.jsx("div",{className:"grid grid-cols-3 md:grid-cols-4 gap-4",children:j.map(A=>e.jsx(ye,{album:A,onClick:R,onContextMenu:E,contextMenuItemId:(N==null?void 0:N.Id)||null},A.Id))})]},"albums")}case"songs":return n.songs.length===0?null:e.jsxs("div",{children:[e.jsxs("div",{className:`flex items-center justify-between mb-4 ${F}`,children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"Songs"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:u,className:"w-10 h-10 flex items-center justify-center text-white hover:bg-white/10 rounded-lg transition-colors","aria-label":"Play all songs",children:e.jsx(fe,{className:"w-5 h-5"})}),e.jsx("button",{type:"button",onClick:P,className:"w-10 h-10 flex items-center justify-center text-white hover:bg-white/10 rounded-lg transition-colors","aria-label":"Add all songs to queue",children:e.jsx(pe,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:`space-y-0 ${U}`,children:n.songs.map((j,A)=>e.jsx(ke,{song:j,onClick:p,onContextMenu:E,contextMenuItemId:(N==null?void 0:N.Id)||null,showImage:!0},j.Id))})]},"songs");case"playlists":{const j=n.playlists;return!j||j.length===0?null:e.jsxs("div",{children:[e.jsx("h2",{className:`text-xl font-bold text-white mb-4 ${F}`,children:"Playlists"}),e.jsx("div",{className:`space-y-0 ${U}`,children:j.map(A=>e.jsx(Ie,{playlist:A,onClick:S,onContextMenu:E},A.Id))})]},"playlists")}default:return null}},J=()=>_?e.jsxs(e.Fragment,{children:[a.showGenreFilter&&e.jsxs("button",{onClick:()=>i("genre"),className:`flex items-center gap-2 px-3 py-2 rounded-lg transition-colors ${l.selectedGenres.length>0?"bg-[var(--accent-color)] text-white":"bg-white/10 text-white hover:bg-white/20"}`,"aria-label":"Filter by genre",children:[e.jsx(he,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Genre"})]}),a.showYearFilter&&e.jsxs("button",{onClick:()=>i("year"),className:`flex items-center gap-2 px-3 py-2 rounded-lg transition-colors ${l.yearRange.min!==null||l.yearRange.max!==null?"bg-[var(--accent-color)] text-white":"bg-white/10 text-white hover:bg-white/20"}`,"aria-label":"Filter by year",children:[e.jsx(ge,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Year"})]}),a.showGroupingFilters&&c.map(d=>{var C;const v=Ce(d.key),L=(((C=l.selectedGroupings[d.key])==null?void 0:C.length)||0)>0;return e.jsxs("button",{onClick:()=>b==null?void 0:b(d),className:`flex items-center gap-2 px-3 py-2 rounded-lg transition-colors ${L?"bg-[var(--accent-color)] text-white":"bg-white/10 text-white hover:bg-white/20"}`,"aria-label":`Filter by ${d.name}`,children:[e.jsx(v,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:d.name})]},d.key)})]}):null,oe=()=>e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-zinc-800 border-t-[var(--accent-color)]"})}),ie=()=>e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 text-gray-400",children:[e.jsx("div",{className:"text-lg mb-2",children:"No results found"}),e.jsx("div",{className:"text-sm",children:"Try a different search term"})]}),H=d=>f?oe():n?ae?e.jsx("div",{className:"space-y-8",children:g.map(v=>le(v,d))}):ie():e.jsx("div",{className:"flex flex-col items-center justify-center py-16 text-gray-400"});return O?me.createPortal(e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`hidden [@media((hover:hover)_and_(pointer:fine)_and_(min-width:1024px))]:block fixed inset-0 z-[9998] bg-black/50 transition-opacity duration-200 ${Z?"opacity-100":"opacity-0"}`,onClick:s}),e.jsx("div",{className:`hidden [@media((hover:hover)_and_(pointer:fine)_and_(min-width:1024px))]:flex fixed top-0 left-16 z-[9999] justify-center pointer-events-none ${k?"":"right-0"}`,style:k?{right:"var(--sidebar-width)"}:void 0,children:e.jsxs("div",{className:"w-[768px] max-h-[80vh] bg-zinc-900 rounded-b-xl shadow-2xl pointer-events-auto border-l border-r border-b border-zinc-800 flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"sticky top-0 bg-zinc-900 z-10 px-4 pt-4 pb-4 border-b border-zinc-800 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"text-lg font-semibold text-white",children:m}),e.jsx("button",{onClick:s,className:"px-3 py-1.5 text-white text-sm font-medium hover:bg-zinc-800 rounded-lg transition-colors",children:"Cancel"})]}),e.jsx(Y,{ref:D,value:r,onChange:h,placeholder:"Search for artists, albums, songs...",showClearButton:r.trim().length>0,onClear:x})]}),e.jsxs("div",{className:"overflow-y-auto flex-1 px-4 pb-8",children:[_&&e.jsx("div",{className:"flex flex-wrap items-center gap-3 pt-3 pb-4 mb-4",children:J()}),H(!1)]})]})}),e.jsxs("div",{className:"fixed inset-0 bg-black z-[9999] flex flex-col p-0 m-0 [@media((hover:hover)_and_(pointer:fine)_and_(min-width:1024px))]:hidden",children:[e.jsx("div",{className:"fixed top-0 left-0 right-0 bg-black z-50 pointer-events-none",style:{height:"env(safe-area-inset-top)",top:"var(--header-offset, 0px)"}}),e.jsx("div",{className:"sticky top-0 left-0 right-0 bg-black z-10 pt-0 pb-0 w-full m-0",style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top))"},children:e.jsx("div",{className:"max-w-[768px] mx-auto w-full",children:e.jsxs("div",{className:"flex items-center gap-3 pl-2 pr-4 pt-4 pb-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(Y,{ref:G,value:r,onChange:h,showClearButton:r.trim().length>0,onClear:x})}),e.jsx("button",{onClick:s,className:"px-4 py-2 text-white text-sm font-medium hover:text-zinc-300 transition-colors whitespace-nowrap flex-shrink-0",children:"Cancel"})]})})}),e.jsx("div",{className:"overflow-y-auto flex-1",children:e.jsxs("div",{className:"max-w-[768px] mx-auto w-full",children:[_&&e.jsx("div",{className:"bg-black pt-3 pb-4",children:e.jsx("div",{className:"flex flex-wrap items-center gap-3 pl-2 pr-4",children:J()})}),e.jsx("div",{className:"pb-32 pt-4",children:H(!0)})]})})]}),e.jsx(xe,{item:N,itemType:re,isOpen:Q,onClose:()=>{W(!1),V(null),X(null)},zIndex:999999,mode:ee,position:se||void 0})]}),document.body):null}async function Se(t,s,m){var w,R,p,S;const r=await M.search(t,s,m),h=((w=r.Songs)==null?void 0:w.Items)||[],x=((R=r.Albums)==null?void 0:R.Items)||[],f=((p=r.Artists)==null?void 0:p.Items)||[],n=((S=r.Playlists)==null?void 0:S.Items)||[],a=y(t).toLowerCase().trim(),l=h.filter(u=>{var T,z,$;if(y(u.Name||"").toLowerCase().includes(a))return!0;const k=[];return u.AlbumArtist&&k.push(y(u.AlbumArtist)),(T=u.AlbumArtists)!=null&&T.length&&k.push(...u.AlbumArtists.map(I=>y(I.Name||"")).filter(Boolean)),(z=u.ArtistItems)!=null&&z.length&&k.push(...u.ArtistItems.map(I=>y(I.Name||"")).filter(Boolean)),!!(k.some(I=>I.toLowerCase().includes(a))||($=u.Genres)!=null&&$.some(I=>y(I).toLowerCase().includes(a)))}),i=f.filter(u=>y(u.Name||"").toLowerCase().includes(a)),c=x.filter(u=>{var T,z;const P=y(u.Name||""),k=y(u.AlbumArtist||((z=(T=u.ArtistItems)==null?void 0:T[0])==null?void 0:z.Name)||"");return P.toLowerCase().includes(a)||k.toLowerCase().includes(a)}),b=n.filter(u=>y(u.Name||"").toLowerCase().includes(a));return{artists:i,albums:c,playlists:b,songs:l}}async function Te(t,s){var a,l,i,c;const m={};(a=s==null?void 0:s.genres)!=null&&a.length&&(m.genres=s.genres),(l=s==null?void 0:s.years)!=null&&l.length&&(m.years=s.years),(i=s==null?void 0:s.tags)!=null&&i.length&&(m.tags=s.tags);const r=((c=s==null?void 0:s.tags)==null?void 0:c.length)||(s==null?void 0:s.hasGroupingFilters),[h,x,f,n]=await Promise.all([r?Promise.resolve({Items:[]}):M.getArtists({limit:t}),r?Promise.resolve({Items:[]}):M.getAlbums({limit:t,...m}),r?Promise.resolve({Items:[]}):M.getPlaylists({limit:t}),M.getSongs({limit:r?5e3:t,...m})]),g=(n.Items||[]).map(b=>({...b,Grouping:(b.Tags||[]).filter(w=>w.startsWith("grouping:")).map(w=>w.replace("grouping:",""))}));return{artists:h.Items||[],albums:x.Items||[],playlists:f.Items||[],songs:g}}export{Re as S,Te as f,Se as u};
