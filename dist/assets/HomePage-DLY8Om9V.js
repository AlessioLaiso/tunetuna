import{c as Ie,r as t,u as O,a as te,b as ye,d as Fe,j as e,S as _e,l as me,e as q,C as he,f as Pe,D as Re,I as ze,A as Be,g as De,B as He,h as pe,i as qe,F as fe}from"./index-BtrRwJyr.js";import{S as Ve}from"./search-BiHio9im.js";import{u as Ye,F as je}from"./useSearch-DUqSA7R9.js";import{E as We}from"./ellipsis-CDeSzYin.js";/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ge=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],Xe=Ie("search",Ge);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qe=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Ze=Ie("settings",Qe),Je=[{type:"artists",limit:5},{type:"albums",limit:12},{type:"playlists"},{type:"songs"}];function Ke({onSearchStateChange:l,title:a="Search"}){const[s,i]=t.useState(!1),m=t.useRef(null),S=t.useRef(null),[y,j]=t.useState(!1),[o,c]=t.useState(null),{genres:f}=O(),[d,u]=t.useState([]),{playAlbum:r,addToQueue:b,playTrack:$,shuffleAllSongs:w,isQueueSidebarOpen:k}=te(),[N,p]=t.useState(!1),{searchQuery:x,setSearchQuery:R,isSearching:A,searchResults:C,selectedGenres:F,setSelectedGenres:_,yearRange:B,setYearRange:V,clearSearch:U,clearAll:X}=Ye({debounceMs:0});t.useEffect(()=>{if(N){const g=setTimeout(()=>{p(!1)},1e4);return()=>clearTimeout(g)}},[N]);const L=ye(),[D,H]=Fe();t.useEffect(()=>{const g=D.get("yearMin"),n=D.get("yearMax"),I=D.get("genre");let h=!1;(g||n)&&(V({min:g?parseInt(g,10):null,max:n?parseInt(n,10):null}),h=!0),I&&(_([I]),h=!0),h&&(i(!0),H({},{replace:!0}))},[]),t.useEffect(()=>{(async()=>{try{const n=O.getState();if(n.years.length>0)u(n.years);else{const I=await q.getYears();u(I)}}catch(n){me.error("Failed to load filter values:",n)}})()},[]);const Y=g=>{R(g),g.trim().length>0&&!s&&i(!0)},J=g=>{L(`/artist/${g}`),i(!1),U()},W=g=>{L(`/album/${g}`),i(!1),U()},Q=g=>{$(g,[g])},se=g=>{L(`/playlist/${g}`),i(!1),U()},G=()=>{U()},K=()=>{i(!1),X()},ne=g=>{c(g),j(!0)},le=g=>{_(g)},v=g=>{V(g)},T=()=>{C!=null&&C.songs&&C.songs.length>0&&r(C.songs)},z=()=>{C!=null&&C.songs&&C.songs.length>0&&b(C.songs)},E=s;return t.useEffect(()=>{l&&l(E)},[E,l]),t.useEffect(()=>{if(s){const n=window.matchMedia("(hover: hover) and (pointer: fine) and (min-width: 1024px)").matches?S:m;setTimeout(()=>{var I;if((I=n.current)==null||I.focus(),n.current){const h=n.current.value.length;n.current.setSelectionRange(h,h)}},50)}},[s]),t.useEffect(()=>{if(!s)return;const g=n=>{n.key==="Escape"&&(n.preventDefault(),n.stopPropagation(),K())};return window.addEventListener("keydown",g,!0),()=>window.removeEventListener("keydown",g,!0)},[s]),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"pl-2 pr-4 pt-4 pb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Tunetuna"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:async()=>{const g=te.getState(),{isShuffleAllActive:n,isShuffleGenreActive:I}=g;if(!(N||n||I)){p(!0);try{await w()}catch(h){me.error("Home shuffle button - shuffleAllSongs failed:",h),me.error("Shuffle all failed:",h)}finally{p(!1)}}},disabled:N,className:"w-10 h-10 flex items-center justify-center text-white hover:bg-zinc-800 rounded-full transition-colors disabled:opacity-50","aria-label":"Shuffle all songs",children:N?e.jsx("div",{className:"w-5 h-5 border-2 border-zinc-400 border-t-white rounded-full animate-spin"}):e.jsx(_e,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>i(!0),className:"w-10 h-10 flex items-center justify-center text-white hover:bg-zinc-800 rounded-full transition-colors","aria-label":"Search",children:e.jsx(Xe,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>L("/settings"),className:"w-10 h-10 flex items-center justify-center text-white hover:bg-zinc-800 rounded-full transition-colors","aria-label":"Settings",children:e.jsx(Ze,{className:"w-5 h-5"})})]})]})}),e.jsx(Ve,{isOpen:s,onClose:K,title:a,searchQuery:x,onSearchChange:Y,onClearSearch:G,isLoading:A,results:C,sections:Je,filterConfig:{showGenreFilter:!0,showYearFilter:!0},filterState:{selectedGenres:F,yearRange:B},onOpenFilterSheet:ne,onArtistClick:J,onAlbumClick:W,onSongClick:Q,onPlaylistClick:se,onPlayAllSongs:T,onAddSongsToQueue:z,isQueueSidebarOpen:k,desktopSearchInputRef:S,mobileSearchInputRef:m}),o==="genre"&&e.jsx(je,{isOpen:y,onClose:()=>j(!1),filterType:"genre",genres:f,selectedValues:F,onApply:le}),o==="year"&&e.jsx(je,{isOpen:y,onClose:()=>j(!1),filterType:"year",availableYears:d,yearRange:B,onApplyYear:v})]})}function ge({album:l,onNavigate:a,onContextMenu:s}){var c,f;const[i,m]=t.useState(!1),S=t.useRef(!1),y=d=>{if(S.current){S.current=!1;return}a(l.Id)},j=d=>{d.preventDefault(),d.stopPropagation(),S.current=!0,s(l,"desktop",{x:d.clientX,y:d.clientY}),setTimeout(()=>{S.current=!1},300)},o=Pe({onLongPress:d=>{d.preventDefault(),S.current=!0,s(l,"mobile")},onClick:()=>{if(S.current){S.current=!1;return}y()}});return e.jsxs("button",{onClick:()=>{if(S.current){S.current=!1;return}y()},onContextMenu:j,...o,className:"text-left group",children:[e.jsx("div",{className:"aspect-square rounded overflow-hidden mb-2 bg-zinc-900 flex items-center justify-center",children:i?e.jsx(Re,{className:"w-12 h-12 text-gray-500"}):e.jsx(ze,{src:q.getAlbumArtUrl(l.Id,474),alt:l.Name,className:"w-full h-full object-cover",showOutline:!0,rounded:"rounded",onError:()=>m(!0)})}),e.jsx("div",{className:"text-sm font-medium text-white truncate",children:l.Name}),e.jsx("div",{className:"text-xs text-gray-400 truncate",children:l.AlbumArtist||((f=(c=l.ArtistItems)==null?void 0:c[0])==null?void 0:f.Name)||"Unknown Artist"})]})}function et(){const{recentlyAdded:l,setRecentlyAdded:a,setLoading:s}=O(),i=ye(),m=t.useRef(null),[S,y]=t.useState(0),[j,o]=t.useState(!1),[c,f]=t.useState("mobile"),[d,u]=t.useState(null),[r,b]=t.useState(null);t.useEffect(()=>{(async()=>{s("recentlyAdded",!0);try{const x=await q.getRecentlyAdded(18);a(x.Items||[])}catch(x){me.error("Failed to load recently added:",x)}finally{s("recentlyAdded",!1)}})()},[a,s]);const $=()=>{if(!m.current)return;const p=m.current,x=p.scrollLeft,R=p.clientWidth,A=Math.round(x/R);y(A)},w=p=>{if(!m.current)return;const x=m.current,R=x.clientWidth;x.scrollTo({left:p*R,behavior:"smooth"})};if(!l||l.length===0)return null;const k=6,N=[];for(let p=0;p<l.length;p+=k)N.push(l.slice(p,p+k));return e.jsxs("div",{className:"px-4 mb-8",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Recently Added"}),e.jsxs("div",{className:"md:hidden",children:[e.jsx("div",{ref:m,onScroll:$,className:"overflow-x-auto snap-x snap-mandatory scrollbar-hide",style:{scrollbarWidth:"none",msOverflowStyle:"none"},children:e.jsx("div",{className:"flex",style:{width:`${N.length*100}%`},children:N.map((p,x)=>{const R=Math.ceil(p.length/3);return e.jsx("div",{className:"snap-start flex-shrink-0 w-full",style:{width:`${100/N.length}%`},children:e.jsx("div",{className:"grid grid-cols-3 gap-3",style:{gridTemplateRows:`repeat(${R}, minmax(0, 1fr))`},children:p.map(A=>e.jsx(ge,{album:A,onNavigate:C=>i(`/album/${C}`),onContextMenu:(C,F,_)=>{b(C),f(F||"desktop"),u(_||null),o(!0)}},A.Id))})},x)})})}),N.length>1&&e.jsx("div",{className:"flex justify-center gap-2 mt-4",children:N.map((p,x)=>e.jsx("button",{onClick:()=>w(x),className:`w-2 h-2 rounded-full transition-colors ${x===S?"bg-white":"bg-zinc-600"}`,"aria-label":`Go to page ${x+1}`},x))})]}),e.jsx("div",{className:"hidden md:block min-[1680px]:hidden",children:e.jsx("div",{className:"grid grid-cols-4 gap-3",children:l.slice(0,8).map(p=>e.jsx(ge,{album:p,onNavigate:x=>i(`/album/${x}`),onContextMenu:(x,R,A)=>{b(x),f(R||"desktop"),u(A||null),o(!0)}},p.Id))})}),e.jsx("div",{className:"hidden min-[1680px]:block",children:e.jsx("div",{className:"grid grid-cols-5 gap-3",children:l.slice(0,10).map(p=>e.jsx(ge,{album:p,onNavigate:x=>i(`/album/${x}`),onContextMenu:(x,R,A)=>{b(x),f(R||"desktop"),u(A||null),o(!0)}},p.Id))})}),e.jsx("style",{children:`
        .scrollbar-hide::-webkit-scrollbar {
          display: none;
        }
      `}),e.jsx(he,{item:r,itemType:"album",isOpen:j,onClose:()=>{o(!1),b(null)},zIndex:999999,mode:c,position:d||void 0})]})}const tt="https://rss.marketingtools.apple.com",st="https://musicbrainz.org/ws/2",nt=`${Be}/${De} (https://github.com/AlessioLaiso/tunetuna)`,lt="https://coverartarchive.org",rt="https://api.song.link/v1-alpha.1";let Ne=0;const Me=1100;async function it(l="gb",a=10){const s=`${tt}/api/v2/${l}/music/most-played/${a}/songs.json`,i=await fetch(s);if(!i.ok)throw new Error(`Apple Music RSS failed: ${i.status}`);return(await i.json()).feed.results}function at(l,a=300){return l.replace(/\d+x\d+/,`${a}x${a}`)}async function ot(){const a=Date.now()-Ne;a<Me&&await new Promise(s=>setTimeout(s,Me-a)),Ne=Date.now()}async function ct(l,a){await ot();const s=`releasegroup:"${a}" AND artist:"${l}"`,i=new URLSearchParams({query:s,fmt:"json",limit:"1"}),m=await fetch(`${st}/release-group/?${i}`,{headers:{"User-Agent":nt,Accept:"application/json"}});if(!m.ok)throw new Error(`MusicBrainz search failed: ${m.status}`);const y=(await m.json())["release-groups"]||[];return y.length===0?null:{id:y[0].id,type:y[0]["primary-type"]||"Album"}}function $e(l,a=500){return`${lt}/release-group/${l}/front-${a}`}async function Te(l,a){const s=new URLSearchParams({url:l});try{const i=await fetch(`${rt}/links?${s}`);if(!i.ok){if(i.status===404)return null;throw new Error(`Odesli API failed: ${i.status}`)}return await i.json()}catch{return null}}async function dt(l,a=10){if(!l)return[];const s=`https://api.allorigins.win/raw?url=${encodeURIComponent(l)}`;console.log("[Muspy] Fetching from:",s);const i=await fetch(s);if(!i.ok)throw new Error(`Muspy RSS failed: ${i.status}`);const m=await i.text();console.log("[Muspy] Response length:",m.length,"First 500 chars:",m.substring(0,500));const y=new DOMParser().parseFromString(m,"text/xml"),j=y.querySelector("parsererror");j&&console.error("[Muspy] XML parse error:",j.textContent);const o=y.querySelectorAll("entry");console.log("[Muspy] Found",o.length,"entries");const c=[];return o.forEach((f,d)=>{var U,X,L,D,H,Y;if(d>=a)return;const u=((U=f.querySelector("title"))==null?void 0:U.textContent)||"",r=f.querySelector('link[rel="alternate"]')||f.querySelector("link"),b=(r==null?void 0:r.getAttribute("href"))||(r==null?void 0:r.textContent)||"",$=((X=f.querySelector("summary"))==null?void 0:X.textContent)||((L=f.querySelector("content"))==null?void 0:L.textContent)||"",w=((D=f.querySelector("updated"))==null?void 0:D.textContent)||((H=f.querySelector("published"))==null?void 0:H.textContent)||"";(Y=f.querySelector("id"))!=null&&Y.textContent;const k=/[a-fA-F0-9]{8}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{12}/i,p=f.outerHTML.match(k),x=p?p[0]:`muspy-${d}`,R=$.match(/\((Single|Album|EP)\)/i),A=R?R[1]:"Album",C=u.split(" - "),F=C.length>1?C[0].trim():$,_=C.length>1?C.slice(1).join(" - ").trim():u;let B="";if(w)try{B=new Date(w).toISOString().split("T")[0]}catch{B=w}const V=x.startsWith("muspy-")?b:`https://musicbrainz.org/release-group/${x}`;c.push({id:x,title:_,artistName:F,releaseDate:B,type:A,artworkUrl:x.startsWith("muspy-")?void 0:$e(x,500),mbUrl:V})}),c}const ut=[{id:"spotify",name:"Spotify",icon:"spotify"},{id:"appleMusic",name:"Apple Music",icon:"apple"},{id:"youtube",name:"YouTube",icon:"youtube"},{id:"youtubeMusic",name:"YouTube Music",icon:"youtube"},{id:"tidal",name:"Tidal",icon:"tidal"},{id:"deezer",name:"Deezer",icon:"deezer"},{id:"amazonMusic",name:"Amazon Music",icon:"amazon"},{id:"soundcloud",name:"SoundCloud",icon:"soundcloud"}];function Ae(l,a){const s=encodeURIComponent(`${l} ${a}`);return{entityUniqueId:"search",userCountry:"US",pageUrl:`https://www.google.com/search?q=${s}`,linksByPlatform:{spotify:{url:`https://open.spotify.com/search/${s}`},appleMusic:{url:`https://music.apple.com/search?term=${s}`},youtube:{url:`https://www.youtube.com/results?search_query=${s}`},youtubeMusic:{url:`https://music.youtube.com/search?q=${s}`},tidal:{url:`https://listen.tidal.com/search?q=${s}`},deezer:{url:`https://www.deezer.com/search/${s}`},amazonMusic:{url:`https://music.amazon.com/search/${s}`}}}}const Ce={spotify:e.jsx("svg",{viewBox:"0 0 24 24",className:"w-5 h-5",fill:"currentColor",children:e.jsx("path",{d:"M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.66 0 12 0zm5.521 17.34c-.24.359-.66.48-1.021.24-2.82-1.74-6.36-2.101-10.561-1.141-.418.122-.779-.179-.899-.539-.12-.421.18-.78.54-.9 4.56-1.021 8.52-.6 11.64 1.32.42.18.479.659.301 1.02zm1.44-3.3c-.301.42-.841.6-1.262.3-3.239-1.98-8.159-2.58-11.939-1.38-.479.12-1.02-.12-1.14-.6-.12-.48.12-1.021.6-1.141C9.6 9.9 15 10.561 18.72 12.84c.361.181.54.78.241 1.2zm.12-3.36C15.24 8.4 8.82 8.16 5.16 9.301c-.6.179-1.2-.181-1.38-.721-.18-.601.18-1.2.72-1.381 4.26-1.26 11.28-1.02 15.721 1.621.539.3.719 1.02.419 1.56-.299.421-1.02.599-1.559.3z"})}),appleMusic:e.jsx("svg",{viewBox:"0 0 24 24",className:"w-5 h-5",fill:"currentColor",children:e.jsx("path",{d:"M23.994 6.124a9.23 9.23 0 00-.24-2.19c-.317-1.31-1.062-2.31-2.18-3.043a5.022 5.022 0 00-1.877-.726 10.496 10.496 0 00-1.564-.15c-.04-.003-.083-.01-.124-.013H5.986c-.152.01-.303.017-.455.026-.747.043-1.49.123-2.193.4-1.336.53-2.3 1.452-2.865 2.78-.192.448-.292.925-.363 1.408-.056.392-.088.785-.1 1.18 0 .032-.007.062-.01.093v12.223c.01.14.017.283.027.424.05.815.154 1.624.497 2.373.65 1.42 1.738 2.353 3.234 2.802.42.127.856.187 1.293.228.555.053 1.11.06 1.667.06h11.03a12.5 12.5 0 001.57-.1c.822-.106 1.596-.35 2.296-.81a5.046 5.046 0 001.88-2.207c.186-.42.293-.87.37-1.324.113-.675.138-1.358.137-2.04-.002-3.8 0-7.595-.003-11.393zm-6.423 3.99v5.712c0 .417-.058.827-.244 1.206-.29.59-.76.962-1.388 1.14-.35.1-.706.157-1.07.173-.95.045-1.773-.6-1.943-1.536a1.88 1.88 0 011.038-2.022c.323-.16.67-.25 1.018-.324.378-.082.758-.153 1.134-.24.274-.063.457-.23.51-.516a.904.904 0 00.02-.193c0-1.815 0-3.63-.002-5.443a.725.725 0 00-.026-.185c-.04-.15-.15-.243-.304-.234-.16.01-.318.035-.475.066-.76.15-1.52.303-2.28.456l-2.326.47-1.374.278c-.016.003-.032.01-.048.013-.277.077-.377.203-.39.49-.002.042 0 .086 0 .13-.002 2.602 0 5.204-.003 7.805 0 .42-.047.836-.215 1.227-.278.64-.77 1.04-1.434 1.233-.35.1-.71.16-1.075.172-.96.036-1.755-.6-1.92-1.544-.14-.812.23-1.685 1.154-2.075.357-.15.73-.232 1.108-.31.287-.06.575-.116.86-.177.383-.083.583-.323.6-.714v-.15c0-2.96 0-5.922.002-8.883 0-.123.013-.25.042-.37.07-.285.273-.448.546-.518.255-.065.515-.112.774-.165.733-.15 1.466-.296 2.2-.444l2.27-.46c.67-.134 1.34-.27 2.01-.403.22-.043.443-.088.664-.106.31-.025.523.17.554.482.008.073.012.148.012.223.002 1.91.002 3.822 0 5.732z"})}),youtube:e.jsx("svg",{viewBox:"0 0 24 24",className:"w-5 h-5",fill:"currentColor",children:e.jsx("path",{d:"M23.498 6.186a3.016 3.016 0 00-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 00.502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 002.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 002.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"})}),youtubeMusic:e.jsx("svg",{viewBox:"0 0 24 24",className:"w-5 h-5",fill:"currentColor",children:e.jsx("path",{d:"M12 0C5.376 0 0 5.376 0 12s5.376 12 12 12 12-5.376 12-12S18.624 0 12 0zm0 19.104c-3.924 0-7.104-3.18-7.104-7.104S8.076 4.896 12 4.896s7.104 3.18 7.104 7.104-3.18 7.104-7.104 7.104zm0-13.332c-3.432 0-6.228 2.796-6.228 6.228S8.568 18.228 12 18.228s6.228-2.796 6.228-6.228S15.432 5.772 12 5.772zM9.684 15.54V8.46L15.816 12l-6.132 3.54z"})}),tidal:e.jsx("svg",{viewBox:"0 0 24 24",className:"w-5 h-5",fill:"currentColor",children:e.jsx("path",{d:"M12.012 3.992L8.008 7.996 4.004 3.992 0 7.996 4.004 12l4.004-4.004L12.012 12l4.004-4.004L20.02 12l4.004-4.004-4.004-4.004-4.004 4.004-4.004-4.004zM12.012 12.012L8.008 16.02l4.004 4.004 4.004-4.004-4.004-4.008z"})}),deezer:e.jsx("svg",{viewBox:"0 0 24 24",className:"w-5 h-5",fill:"currentColor",children:e.jsx("path",{d:"M18.81 4.16v3.03H24V4.16h-5.19zM6.27 8.38v3.027h5.189V8.38h-5.19zm12.54 0v3.027H24V8.38h-5.19zM6.27 12.594v3.027h5.189v-3.027h-5.19zm6.27 0v3.027h5.19v-3.027h-5.19zm6.27 0v3.027H24v-3.027h-5.19zM0 16.81v3.029h5.19v-3.03H0zm6.27 0v3.029h5.189v-3.03h-5.19zm6.27 0v3.029h5.19v-3.03h-5.19zm6.27 0v3.029H24v-3.03h-5.19z"})}),amazonMusic:e.jsx("svg",{viewBox:"0 0 24 24",className:"w-5 h-5",fill:"currentColor",children:e.jsx("path",{d:"M.045 18.02c.072-.116.187-.124.348-.022 3.636 2.11 7.594 3.166 11.87 3.166 2.852 0 5.668-.533 8.447-1.595l.315-.118c.138-.053.209-.073.315-.073.186 0 .27.089.27.267 0 .178-.089.355-.267.533l-.178.178c-2.852 2.346-6.22 3.52-10.106 3.52-4.24 0-7.942-1.192-11.107-3.574-.168-.133-.217-.244-.217-.333 0-.089.044-.133.133-.178zm21.243-3.928c-.236-.178-.712-.267-1.424-.267-.712 0-1.598.178-2.665.533-1.067.356-2.134.89-3.201 1.602-.178.089-.267.178-.267.267s.089.133.267.133c.089 0 .178-.044.267-.089l.356-.178c1.156-.533 2.223-.8 3.2-.8.979 0 1.469.267 1.469.8 0 .356-.178.712-.534 1.068-.356.355-.89.711-1.6 1.066l-.535.267c-.356.178-.534.356-.534.534 0 .133.089.2.267.2.089 0 .178-.022.267-.067l.445-.222c1.6-.8 2.756-1.424 3.467-1.869.712-.444 1.068-.889 1.068-1.333 0-.445-.178-.712-.534-.978-.356-.267-.978-.4-1.868-.4zm-6.844-7.11c0-1.067-.267-1.957-.8-2.67-.533-.711-1.422-1.066-2.666-1.066-1.244 0-2.223.355-2.933 1.066-.712.712-1.156 1.78-1.334 3.2h7.733v-.533zm3.911 1.956H8.045c.089 1.422.445 2.489 1.067 3.2.622.712 1.511 1.067 2.666 1.067.89 0 1.69-.178 2.4-.533.712-.356 1.334-.89 1.868-1.6.178-.178.356-.267.534-.267.178 0 .267.089.267.267 0 .178-.089.356-.267.533-.622.8-1.422 1.423-2.4 1.868-.978.445-2.044.667-3.2.667-1.778 0-3.2-.533-4.267-1.6-1.067-1.066-1.6-2.577-1.6-4.533 0-1.956.533-3.467 1.6-4.533 1.067-1.067 2.489-1.6 4.267-1.6 1.778 0 3.111.445 4 1.334.89.889 1.334 2.177 1.334 3.866v1.067c0 .266-.089.4-.267.4l-.089-.003z"})}),soundcloud:e.jsx("svg",{viewBox:"0 0 24 24",className:"w-5 h-5",fill:"currentColor",children:e.jsx("path",{d:"M1.175 12.225c-.051 0-.094.046-.101.1l-.233 2.154.233 2.105c.007.058.05.098.101.098.05 0 .09-.04.099-.098l.255-2.105-.27-2.154c-.009-.06-.048-.1-.098-.1m-.899.828c-.06 0-.091.037-.104.094L0 14.479l.165 1.308c.014.057.045.094.09.094s.089-.037.099-.094l.19-1.308-.19-1.334c-.01-.057-.045-.09-.09-.09m1.83-1.229c-.061 0-.12.045-.12.104l-.21 2.563.225 2.458c0 .06.045.104.106.104.061 0 .12-.044.12-.104l.24-2.458-.24-2.563c0-.06-.045-.104-.12-.104m.945-.089c-.075 0-.135.06-.15.135l-.193 2.64.21 2.544c.016.077.075.138.149.138.075 0 .135-.061.15-.138l.225-2.545-.225-2.64c-.015-.074-.06-.135-.135-.135m1.065.42c-.09 0-.149.075-.164.164l-.158 2.255.18 2.46c.015.09.074.165.164.165.089 0 .149-.075.164-.165l.209-2.46-.209-2.255c-.015-.09-.075-.164-.164-.164m.944-.54c-.104 0-.194.09-.209.195l-.149 2.81.164 2.445c.015.105.09.195.194.195.104 0 .195-.09.21-.195l.18-2.445-.18-2.81c-.015-.105-.09-.195-.194-.195m1.076-.505c-.119 0-.21.09-.225.21l-.135 3.3.149 2.4c.015.12.105.21.225.21.12 0 .21-.09.225-.21l.165-2.4-.165-3.3c-.015-.12-.105-.21-.225-.21m1.064-.54c-.135 0-.239.105-.254.24l-.12 3.825.135 2.354c.015.135.12.24.255.24.12 0 .24-.105.255-.24l.149-2.354-.149-3.825c-.015-.135-.12-.24-.255-.24m1.109-.27c-.015-.15-.135-.255-.27-.255-.15 0-.255.105-.27.255l-.12 4.08.12 2.31c.015.15.12.255.27.255.149 0 .255-.105.27-.255l.134-2.31-.134-4.08m.494 6.645c.015.165.135.284.285.284.149 0 .27-.12.284-.284l.121-2.325-.12-5.175c-.015-.165-.135-.285-.285-.285-.149 0-.27.12-.284.285l-.107 5.175.106 2.325m1.184-6.18c-.165 0-.3.135-.314.3l-.091 3.855.105 2.31c.015.165.135.3.3.3.164 0 .284-.135.299-.3l.12-2.31-.12-3.855c-.015-.165-.135-.3-.3-.3m1.199-.075c-.18 0-.314.135-.329.315l-.09 3.915.104 2.295c.015.18.135.315.315.315s.314-.135.314-.315l.12-2.295-.12-3.915c-.015-.18-.149-.315-.314-.315m1.139-.195c-.195 0-.345.149-.359.345l-.075 4.11.09 2.265c.014.195.149.345.344.345.195 0 .345-.15.359-.345l.105-2.265-.105-4.095c-.014-.195-.164-.36-.359-.36m1.305 0c-.209 0-.359.164-.374.359l-.074 4.095.089 2.25c.015.21.165.375.375.375.194 0 .359-.165.374-.375l.09-2.25-.09-4.095c-.015-.209-.165-.359-.375-.359m1.289.015c-.225 0-.39.18-.39.405l-.06 4.065.075 2.235c.016.225.166.39.391.39.225 0 .391-.165.406-.39l.09-2.235-.091-4.065c-.014-.24-.18-.405-.405-.405m1.35.09c-.24 0-.42.18-.42.42l-.045 3.975.06 2.205c.015.24.18.42.42.42.24 0 .404-.18.42-.42l.075-2.205-.075-3.975c-.015-.24-.18-.42-.42-.42m1.33.135c-.256 0-.435.194-.45.435l-.046 3.825.061 2.175c.015.255.195.45.435.45.256 0 .436-.195.45-.45l.076-2.175-.076-3.825c-.014-.255-.194-.435-.45-.435m1.453-.09c-.27 0-.48.21-.48.465l-.03 3.915.03 2.145c.015.27.21.465.48.465.27 0 .48-.195.48-.465l.045-2.145-.045-3.915c0-.255-.21-.465-.48-.465m1.444.285c-.285 0-.495.225-.51.495l-.015 3.645.03 2.13c.015.285.225.51.51.51.27 0 .494-.225.51-.51l.03-2.13-.03-3.645c-.016-.285-.225-.495-.51-.495m3.39.465c-.165-.045-.345-.075-.51-.075-.18 0-.345.015-.51.045-.044-.9-.39-1.695-.945-2.34-.556-.645-1.35-1.08-2.31-1.215-.27-.045-.405-.165-.405-.405V6.54c0-1.305-.465-2.415-1.395-3.345C19.2 2.265 18.09 1.8 16.77 1.8c-1.155 0-2.16.375-3.045 1.095-.885.72-1.44 1.635-1.68 2.745-.165-.03-.315-.045-.45-.045-1.35 0-2.355.93-2.355 2.115 0 .24.03.465.075.69-.645.12-1.17.435-1.59.945-.42.51-.63 1.095-.63 1.755 0 .75.255 1.38.765 1.89s1.14.765 1.89.765h10.53c.93 0 1.695-.285 2.31-.855.615-.57.93-1.29.93-2.145 0-.855-.3-1.575-.9-2.16-.6-.585-1.335-.885-2.205-.9"})})};function mt(){return e.jsx("div",{className:"animate-pulse space-y-0",children:[...Array(4)].map((l,a)=>e.jsxs("div",{className:"flex items-center gap-3 px-4 py-2.5",children:[e.jsx("div",{className:"w-5 h-5 rounded bg-zinc-700"}),e.jsx("div",{className:"h-4 bg-zinc-700 rounded w-24"})]},a))})}function Le({isOpen:l,onClose:a,odesliData:s,loading:i=!1,title:m,mode:S="mobile",position:y,zIndex:j=99999}){if(!l)return null;const o=s?ut.filter(r=>s.linksByPlatform[r.id]):[],c=r=>{if(!s)return;const b=s.linksByPlatform[r];b!=null&&b.url&&window.open(b.url,"_blank","noopener,noreferrer"),a()},d=(()=>{if(m)return m;if(!(s!=null&&s.entitiesByUniqueId))return"Loading...";const r=Object.values(s.entitiesByUniqueId);for(const b of r)if(b.title)return b.title;return"Loading..."})(),u=i||!s||o.length===0;if(S==="desktop"){const b=u?4:o.length,$=Math.min(400,b*44+48);let w=(y==null?void 0:y.x)||100,k=(y==null?void 0:y.y)||100;return w+220>window.innerWidth&&(w=window.innerWidth-220-10),k+$>window.innerHeight&&(k=window.innerHeight-$-10),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0",onClick:a,style:{zIndex:j-1}}),e.jsxs("div",{className:"fixed bg-zinc-900 border border-zinc-700 rounded-lg shadow-2xl py-2 min-w-[200px]",style:{left:w,top:k,zIndex:j},onClick:N=>N.stopPropagation(),children:[e.jsx("div",{className:"px-4 pb-2 mb-1 border-b border-zinc-700",children:e.jsx("div",{className:"text-sm font-medium text-white truncate",children:d})}),u?e.jsx(mt,{}):e.jsx("div",{className:"space-y-0",children:o.map(N=>e.jsxs("button",{onClick:()=>c(N.id),className:"w-full flex items-center gap-3 px-4 py-2.5 hover:bg-zinc-800 transition-colors text-left",children:[e.jsx("span",{className:"text-white flex-shrink-0",children:Ce[N.id]||e.jsx("span",{className:"w-5 h-5 flex items-center justify-center text-xs",children:"ðŸŽµ"})}),e.jsx("span",{className:"flex-1 text-sm text-white",children:N.name})]},N.id))})]})]})}return e.jsx(He,{isOpen:l,onClose:a,zIndex:j,children:e.jsxs("div",{className:"pb-6",children:[e.jsx("div",{className:"mb-4 ml-4",children:e.jsx("div",{className:"text-lg font-semibold text-white break-words",children:d})}),u?e.jsx("div",{className:"animate-pulse space-y-1",children:[...Array(4)].map((r,b)=>e.jsxs("div",{className:"flex items-center gap-4 pl-4 pr-4 py-3",children:[e.jsx("div",{className:"w-5 h-5 rounded bg-zinc-700"}),e.jsx("div",{className:"h-4 bg-zinc-700 rounded w-28"})]},b))}):e.jsx("div",{className:"space-y-1",children:o.map(r=>e.jsxs("button",{onClick:()=>c(r.id),className:"w-full flex items-center gap-4 pl-4 pr-4 py-3 rounded-lg hover:bg-white/10 transition-colors",children:[e.jsx("span",{className:"text-white",children:Ce[r.id]||e.jsx("span",{className:"w-5 h-5 flex items-center justify-center text-xs",children:"ðŸŽµ"})}),e.jsx("span",{className:"flex-1 text-left text-white font-medium",children:r.name})]},r.id))})]})})}function ft(){const[l,a]=t.useState(()=>O.persist.hasHydrated());return t.useEffect(()=>{if(O.persist.hasHydrated()){a(!0);return}return O.persist.onFinishHydration(()=>{a(!0)})},[]),l}function ee(l){return l.toLowerCase().replace(/[^a-z0-9]/g,"")}function ue(l){return l.replace(/\s*\(feat\..*?\)/gi,"").replace(/\s*\[feat\..*?\]/gi,"").replace(/\s*ft\..*$/gi,"").replace(/\s*\(with.*?\)/gi,"").replace(/\s*\[with.*?\]/gi,"").replace(/\s*\(explicit\)/gi,"").replace(/\s*\[explicit\]/gi,"").replace(/\s*\(deluxe.*?\)/gi,"").replace(/\s*\[deluxe.*?\]/gi,"").replace(/\s*-\s*single$/gi,"").replace(/\s*-\s*ep$/gi,"").trim()}function ke(l){return l.split(/[,&]/)[0].replace(/\s*feat\..*$/gi,"").replace(/\s*ft\..*$/gi,"").replace(/\s*with\s+.*$/gi,"").trim()}function Ee(){const l=O(o=>o.songs),a=O(o=>o.genreSongs),s=ft(),i=t.useMemo(()=>{var f,d;if(!s)return new Map;let o=l;if(o.length===0&&a){const u=new Set;o=Object.values(a).flat().filter(r=>u.has(r.Id)?!1:(u.add(r.Id),!0))}const c=new Map;for(const u of o){const r=ee(ke(u.AlbumArtist||((d=(f=u.ArtistItems)==null?void 0:f[0])==null?void 0:d.Name)||""));r&&(c.has(r)||c.set(r,[]),c.get(r).push(u))}return c},[l,a,s]),m=o=>{const c=ee(ke(o));if(!c)return null;if(i.has(c))return i.get(c);for(const[f,d]of i)if(f.includes(c)||c.includes(f))return d;return null};return{findSong:(o,c)=>{const f=m(c);if(!f)return null;const d=ee(ue(o));if(!d)return null;for(const u of f){const r=ee(ue(u.Name||""));if(r===d||r.includes(d)||d.includes(r))return u}return null},findAlbum:(o,c)=>{const f=m(c);if(!f)return null;const d=ee(ue(o));if(!d)return null;for(const u of f){if(!u.AlbumId||!u.Album)continue;const r=ee(ue(u.Album));if(r===d||r.includes(d)||d.includes(r))return{albumId:u.AlbumId,albumName:u.Album}}return null},findArtistImageUrl:o=>{var d,u,r;const c=m(o);return!c||c.length===0?null:((r=(u=(d=c[0])==null?void 0:d.ArtistItems)==null?void 0:u[0])==null?void 0:r.Id)||null},artistIndex:i}}function Se({title:l,subtitle:a,artworkUrl:s,fallbackArtworkUrl:i,secondFallbackUrl:m,rank:S,isCurrentTrack:y,isInLibrary:j,isMenuOpen:o,onClick:c,onContextMenu:f,onLongPress:d,onExternalClick:u}){const[r,b]=t.useState(!1),[$,w]=t.useState(!1),[k,N]=t.useState(!1);t.useEffect(()=>{b(!1),w(!1),N(!1)},[s]);let p=s;k&&m?p=m:$&&i&&(p=i);const x=()=>{!$&&i?w(!0):!k&&m?N(!0):b(!0)},R=Pe({onLongPress:A=>{A.preventDefault(),d==null||d(A)},onClick:A=>c(A)});return e.jsxs("button",{onClick:A=>c(A),onContextMenu:f,...R,className:`w-full flex items-center gap-3 hover:bg-white/10 transition-colors group px-4 py-2.5 ${o?"bg-white/10":""}`,children:[e.jsx("div",{className:"w-12 h-12 rounded-sm overflow-hidden flex-shrink-0 bg-zinc-900 self-center flex items-center justify-center",children:r?e.jsx(Re,{className:"w-6 h-6 text-gray-500"}):e.jsx(ze,{src:p,alt:l,className:"w-full h-full object-cover",showOutline:!0,rounded:"rounded-sm",onError:x})}),e.jsxs("div",{className:"flex-1 min-w-0 text-left flex gap-3 items-baseline",children:[S!==void 0&&e.jsx("span",{className:"text-zinc-500 text-sm flex-shrink-0",children:S}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium truncate text-white group-hover:text-[var(--accent-color)] transition-colors",children:l}),e.jsx("div",{className:"text-xs text-gray-400 truncate",children:a})]})]}),!j&&u&&e.jsx("div",{onClick:A=>{A.stopPropagation(),u(A)},className:"flex-shrink-0 p-2 text-gray-400 hover:text-white cursor-pointer",children:e.jsx(We,{className:"w-4 h-4"})})]})}function Oe(){return e.jsx("div",{className:"animate-pulse",children:[...Array(5)].map((l,a)=>e.jsxs("div",{className:"flex items-center gap-3 px-4 py-2.5",children:[e.jsx("div",{className:"w-12 h-12 rounded-sm bg-zinc-800"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-4 bg-zinc-800 rounded w-3/4 mb-1.5"}),e.jsx("div",{className:"h-3 bg-zinc-800 rounded w-1/2"})]})]},a))})}function ht(){const{playTrack:l}=te(),{feedTopSongs:a,feedLastUpdated:s,loading:i,setFeedTopSongs:m,setFeedLastUpdated:S,setLoading:y}=O(),{feedCountry:j,showTop10:o}=pe(),{findSong:c}=Ee(),[f,d]=t.useState(!1),[u,r]=t.useState("mobile"),[b,$]=t.useState(null),[w,k]=t.useState(null),[N,p]=t.useState(!1),[x,R]=t.useState(!1),[A,C]=t.useState(null),[F,_]=t.useState(null),[B,V]=t.useState(!1),[U,X]=t.useState("mobile"),[L,D]=t.useState(null),[H,Y]=t.useState(null),[J,W]=t.useState(null),Q=t.useCallback(async(v=!1)=>{const T=Date.now();if(!(!v&&s&&T-s<fe)){y("feed",!0),R(!1);try{const z=await it(j,10);m(z),S(T)}catch(z){console.error("Failed to fetch top songs:",z),R(!0)}finally{y("feed",!1)}}},[j,s,m,S,y]);t.useEffect(()=>{if(o){const v=Date.now();(!s||v-s>=fe)&&Q(!0)}},[o,j]);const se=async(v,T,z)=>{if(T){const E=await q.getSongById(T.Id);E&&l(E)}else await G(v,z)},G=async(v,T)=>{const z=!window.matchMedia("(hover: hover) and (pointer: fine)").matches;r(z?"mobile":"desktop"),z||$({x:T.clientX,y:T.clientY}),C(v.name),_(v.id),p(!0),d(!0);try{const E=await Te(v.url);E?k(E):(d(!1),window.open(v.url,"_blank","noopener,noreferrer"))}catch{d(!1),window.open(v.url,"_blank","noopener,noreferrer")}finally{p(!1)}};if(!o)return null;const K=a.length>0,le=i.feed&&!K&&!x;return e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-xl font-bold mb-2 px-4",children:"Top 10"}),le?e.jsx(Oe,{}):K?e.jsx("div",{className:"space-y-0",children:a.map((v,T)=>{const z=c(v.name,v.artistName),E=z!==null;return e.jsx(Se,{rank:T+1,title:v.name,subtitle:v.artistName,artworkUrl:E&&z.AlbumId?q.getAlbumArtUrl(z.AlbumId,96):at(v.artworkUrl100,96),isInLibrary:E,isMenuOpen:J===v.id||F===v.id&&f,onClick:g=>se(v,z,g),onContextMenu:g=>{g.preventDefault(),z&&(Y({Id:z.Id,Name:v.name,Type:"Audio"}),W(v.id),X("desktop"),D({x:g.clientX,y:g.clientY}),V(!0))},onLongPress:()=>{z&&(Y({Id:z.Id,Name:v.name,Type:"Audio"}),W(v.id),X("mobile"),D(null),V(!0))},onExternalClick:g=>G(v,g)},v.id)})}):e.jsx("div",{className:"px-4 py-8 text-center text-gray-500 text-sm",children:"Could not load charts"}),e.jsx(Le,{isOpen:f,onClose:()=>{d(!1),k(null),_(null)},odesliData:w,loading:N,title:A||void 0,mode:u,position:b||void 0}),e.jsx(he,{item:H,itemType:"song",isOpen:B,onClose:()=>{V(!1),Y(null),W(null)},zIndex:99999,mode:U,position:L||void 0})]})}function pt(){const l=ye(),{playTrack:a}=te(),{feedNewReleases:s,feedLastUpdated:i,loading:m,setFeedNewReleases:S,setFeedLastUpdated:y,setLoading:j}=O(),{showNewReleases:o,muspyRssUrl:c}=pe(),{findAlbum:f,findSong:d,findArtistImageUrl:u}=Ee(),[r,b]=t.useState(!1),[$,w]=t.useState("mobile"),[k,N]=t.useState(null),[p,x]=t.useState(null),[R,A]=t.useState(!1),[C,F]=t.useState(!1),[_,B]=t.useState(null),[V,U]=t.useState(null),[X,L]=t.useState(!1),[D,H]=t.useState("mobile"),[Y,J]=t.useState(null),[W,Q]=t.useState(null),[se,G]=t.useState(null),K=t.useCallback(async(n=!1)=>{if(!c)return;const I=Date.now();if(!(!n&&i&&I-i<fe)){j("feed",!0),F(!1);try{const h=await dt(c,10);S(h),y(I)}catch(h){console.error("Failed to fetch Muspy releases:",h),F(!0)}finally{j("feed",!1)}}},[c,i,S,y,j]);t.useEffect(()=>{if(o&&c){const n=Date.now();(!i||n-i>=fe)&&K(!0)}},[o,c]);const ne=t.useRef(new Set);t.useEffect(()=>{const n=async()=>{const I=s.filter(h=>h.id.startsWith("muspy-")&&!ne.current.has(h.id));if(I.length!==0)for(const h of I){ne.current.add(h.id);try{console.log(`[FeedSection] Searching MB for: ${h.title} - ${h.artistName}`);const P=await ct(h.artistName,h.title);if(P){console.log(`[FeedSection] Found MBID for "${h.title}": ${P.id} (${P.type})`);const re=O.getState().feedNewReleases.map(ae=>ae.id===h.id?{...ae,id:P.id,type:P.type}:ae);S(re)}else console.log(`[FeedSection] No MBID found for "${h.title}"`)}catch(P){console.error(`[FeedSection] Failed to search MB for "${h.title}":`,P)}}};s.length>0&&n()},[s,S]);const le=async(n,I,h)=>{if(I)if(I.type==="song"){const P=await q.getSongById(I.song.Id);P&&a(P)}else l(`/album/${I.albumId}`);else await v(n,h)},v=async(n,I)=>{const h=!window.matchMedia("(hover: hover) and (pointer: fine)").matches;w(h?"mobile":"desktop"),h||N({x:I.clientX,y:I.clientY}),B(n.title),U(n.id),A(!0),b(!0);const P=n.mbUrl&&!n.id.startsWith("muspy-");try{let M=null;if(P&&(M=await Te(n.mbUrl)),M&&Object.keys(M.linksByPlatform).length>0)x(M);else{const re=Ae(n.artistName,n.title);x(re)}}catch{const M=Ae(n.artistName,n.title);x(M)}finally{A(!1)}};if(!o||!c)return null;const T=s.length>0,z=m.feed,E=!!c,g=z&&!T&&!C&&E;return e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-xl font-bold mb-2 px-4",children:"New Releases"}),g?e.jsx(Oe,{}):T?e.jsx("div",{className:"space-y-0",children:s.map(n=>{const h=n.type==="Single"?d(n.title,n.artistName):null,P=h?null:f(n.title,n.artistName),M=h?{type:"song",song:h}:P?{type:"album",albumId:P.albumId}:null,re=M!==null,oe=!n.id.startsWith("muspy-")?$e(n.id,250):null,we=u(n.artistName),ce=we?q.getArtistImageUrl(we,96):null;let ie,de,xe;(M==null?void 0:M.type)==="song"&&(h!=null&&h.AlbumId)?(ie=q.getAlbumArtUrl(h.AlbumId,96),de=oe||void 0,xe=ce||void 0):(M==null?void 0:M.type)==="album"&&(P!=null&&P.albumId)?(ie=q.getAlbumArtUrl(P.albumId,96),de=oe||void 0,xe=ce||void 0):oe?(ie=oe,de=ce||void 0):ie=ce||"";const be=new Date(n.releaseDate),ve=!isNaN(be.getTime())?be.toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",Ue=ve?`${ve} â€¢ ${n.artistName}`:n.artistName;return e.jsx(Se,{title:n.title,subtitle:Ue,artworkUrl:ie,fallbackArtworkUrl:de,secondFallbackUrl:xe,isInLibrary:re,isMenuOpen:se===n.id||V===n.id&&r,onClick:Z=>le(n,M,Z),onContextMenu:Z=>{Z.preventDefault(),(M==null?void 0:M.type)==="song"&&h?(Q({Id:h.Id,Name:n.title,Type:"Audio"}),G(n.id),H("desktop"),J({x:Z.clientX,y:Z.clientY}),L(!0)):(M==null?void 0:M.type)==="album"&&P&&(Q({Id:P.albumId,Name:n.title,Type:"MusicAlbum"}),G(n.id),H("desktop"),J({x:Z.clientX,y:Z.clientY}),L(!0))},onLongPress:()=>{(M==null?void 0:M.type)==="song"&&h?(Q({Id:h.Id,Name:n.title,Type:"Audio"}),G(n.id),H("mobile"),J(null),L(!0)):(M==null?void 0:M.type)==="album"&&P&&(Q({Id:P.albumId,Name:n.title,Type:"MusicAlbum"}),G(n.id),H("mobile"),J(null),L(!0))},onExternalClick:Z=>v(n,Z)},n.id)})}):E?e.jsx("div",{className:"px-4 py-8 text-left text-gray-500 text-sm",children:C?"Failed to load releases":"No new releases found"}):e.jsx("div",{className:"px-4 py-8 text-center text-gray-500 text-sm",children:"Configure Muspy RSS in settings"}),e.jsx(Le,{isOpen:r,onClose:()=>{b(!1),x(null),U(null)},odesliData:p,loading:R,title:_||void 0,mode:$,position:k||void 0}),e.jsx(he,{item:W,itemType:(W==null?void 0:W.Type)==="Audio"?"song":"album",isOpen:X,onClose:()=>{L(!1),Q(null),G(null)},zIndex:99999,mode:D,position:Y||void 0})]})}function xt({twoColumns:l=!1}){const{recentlyPlayed:a,setRecentlyPlayed:s,setLoading:i}=O(),{showRecentlyPlayed:m}=pe(),{playTrack:S}=te(),y=qe(),[j,o]=t.useState(!1),[c,f]=t.useState("mobile"),[d,u]=t.useState(null),[r,b]=t.useState(null);t.useEffect(()=>{m&&(async()=>{i("recentlyPlayed",!0);try{const k=await q.getRecentlyPlayed(10);s(k.Items||[])}catch(k){console.error(k)}finally{i("recentlyPlayed",!1)}})()},[m,s,i]);const $=w=>{S(w,a)};return!m||!a||a.length===0?null:e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-xl font-bold mb-2 px-4",children:"Recently Played"}),e.jsx("div",{className:l?"md:grid md:grid-cols-2 min-[1680px]:block":"",children:a.map(w=>{var k,N;return e.jsx(Se,{title:w.Name||"Unknown",subtitle:`${w.AlbumArtist||((N=(k=w.ArtistItems)==null?void 0:k[0])==null?void 0:N.Name)||"Unknown Artist"}${w.Album?` â€¢ ${w.Album}`:""}`,artworkUrl:q.getAlbumArtUrl(w.AlbumId||w.Id,96),isCurrentTrack:(y==null?void 0:y.Id)===w.Id,isInLibrary:!0,isMenuOpen:(r==null?void 0:r.Id)===w.Id,onClick:()=>$(w),onContextMenu:p=>{p.preventDefault(),b(w),f("desktop"),u({x:p.clientX,y:p.clientY}),o(!0)},onLongPress:()=>{b(w),f("mobile"),u(null),o(!0)}},w.Id)})}),e.jsx(he,{item:r,itemType:"song",isOpen:j,onClose:()=>{o(!1),b(null)},zIndex:99999,mode:c,position:d||void 0})]})}function vt(){const[l,a]=t.useState(!1),{recentlyAdded:s,recentlyPlayed:i,loading:m}=O(),{showTop10:S,showNewReleases:y,showRecentlyPlayed:j,muspyRssUrl:o}=pe(),c=t.useRef(!1),{isQueueSidebarOpen:f}=te();t.useEffect(()=>{(m.recentlyAdded||m.recentlyPlayed)&&(c.current=!0)},[m.recentlyAdded,m.recentlyPlayed]);const u=[S,y&&!!o,j].filter(Boolean).length,r=c.current&&!m.recentlyAdded&&!m.recentlyPlayed&&s.length===0&&i.length===0;return e.jsxs("div",{className:"pb-20",children:[e.jsx("div",{className:`fixed top-0 left-0 right-0 bg-black z-10 lg:left-16 transition-[left,right] duration-300 ${f?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top))"},children:e.jsx("div",{className:"max-w-[768px] min-[1680px]:max-w-[1080px] w-full mx-auto",children:e.jsx(Ke,{onSearchStateChange:a})})}),e.jsx("div",{className:`fixed left-0 right-0 z-[60] lg:left-16 transition-[left,right] duration-300 ${f?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 4.5rem - 2px)",height:"24px",background:"linear-gradient(to bottom, rgba(0, 0, 0, 0.8), transparent)"}}),e.jsx("div",{className:l?"hidden [@media((hover:hover)_and_(pointer:fine)_and_(min-width:1024px))]:block":"",style:{paddingTop:"calc(env(safe-area-inset-top) + 4.5rem + 24px)"},children:e.jsxs("div",{className:"w-full",children:[e.jsx("div",{className:"pb-4",children:e.jsx(et,{})}),u>0&&e.jsxs("div",{className:`
              mt-4
              ${u>=2?"md:grid md:gap-4":""}
              ${u===2?"md:grid-cols-2":""}
              ${u>=3?"md:grid-cols-2 min-[1680px]:grid-cols-3":""}
            `,children:[j&&e.jsx("div",{className:u===3?"md:col-span-2 min-[1680px]:col-span-1":"",children:e.jsx(xt,{twoColumns:u===3})}),S&&e.jsx("div",{children:e.jsx(ht,{})}),y&&e.jsx("div",{children:e.jsx(pt,{})})]}),r&&e.jsx("div",{className:"flex items-center justify-center py-16 text-gray-400",children:e.jsx("p",{children:"No music found"})})]})})]})}export{vt as default};
