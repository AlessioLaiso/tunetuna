import{m as ye,b as Se,a as Z,g as re,r as l,j as e,i as Ce,I as E,e as v,o as Pe,S as ke,x as De,P as Me,L as Ee,C as ee,l as Te,f as le,D as Oe,h as ze}from"./index-BZ_PLwtQ.js";import{u as te}from"./useScrollLazyLoad-DluFwx0h.js";import{A as Le}from"./arrow-left-CcRMvxfn.js";import{E as Be}from"./ellipsis-Dfa8CYu6.js";import{C as Re}from"./chevron-up-C8XVBgPL.js";import{A as Fe}from"./arrow-up-down-Cw_m4nuJ.js";const se=45,Ye=45,ne=45,Ue=45;function _e({album:n,year:h,onNavigate:N,onContextMenu:w,showImage:A=!0}){const[S,C]=l.useState(!1),d=l.useRef(!1),s=g=>{if(d.current){g.preventDefault(),g.stopPropagation(),d.current=!1;return}N(n.Id)},P=g=>{g.preventDefault(),g.stopPropagation(),d.current=!0,w(n,"desktop",{x:g.clientX,y:g.clientY}),setTimeout(()=>{d.current=!1},100)},c=le({onLongPress:g=>{g.preventDefault(),d.current=!0,w(n,"mobile")},onClick:s});return e.jsxs("button",{onClick:s,onContextMenu:P,...c,className:"text-left group",children:[e.jsx("div",{className:"aspect-square rounded overflow-hidden mb-2 bg-zinc-900 flex items-center justify-center",children:S?e.jsx(Oe,{className:"w-12 h-12 text-gray-500"}):A?e.jsx(E,{src:v.getAlbumArtUrl(n.Id,474),alt:n.Name,className:"w-full h-full object-cover",showOutline:!0,rounded:"rounded",onError:()=>C(!0)}):e.jsx("div",{className:"w-full h-full bg-zinc-900"})}),e.jsx("div",{className:"text-sm font-medium text-white truncate",children:n.Name}),h&&e.jsx("div",{className:"text-xs text-gray-400 truncate",children:h})]})}function Ve({song:n,album:h,year:N,onClick:w,onContextMenu:A,contextMenuItemId:S,showImage:C=!0}){const d=S===n.Id,s=re(),P=le({onLongPress:c=>{c.preventDefault(),A(n,"mobile")},onClick:()=>w(n)});return e.jsxs("button",{onClick:()=>w(n),onContextMenu:c=>{c.preventDefault(),A(n,"desktop",{x:c.clientX,y:c.clientY})},...P,className:`w-full flex items-center gap-3 hover:bg-white/10 transition-colors group px-4 py-3 ${d?"bg-white/10":""}`,children:[e.jsx("div",{className:"w-12 h-12 rounded-sm overflow-hidden flex-shrink-0 bg-zinc-900 self-center flex items-center justify-center",children:C?e.jsx(E,{src:v.getAlbumArtUrl(n.AlbumId||n.Id,96),alt:n.Name,className:"w-full h-full object-cover",showOutline:!0,rounded:"rounded-sm"}):e.jsx("div",{className:"w-full h-full bg-zinc-900"})}),e.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[e.jsx("div",{className:`text-sm font-medium truncate transition-colors ${(s==null?void 0:s.Id)===n.Id?"text-[var(--accent-color)]":"text-white group-hover:text-[var(--accent-color)]"}`,children:n.Name}),(h||N)&&e.jsxs("div",{className:"text-xs text-gray-400 flex items-center gap-1 min-w-0",children:[h&&e.jsx("span",{className:"truncate",children:h}),h&&N&&e.jsx("span",{className:"flex-shrink-0",children:"•"}),N&&e.jsx("span",{className:"flex-shrink-0",children:N})]})]}),n.RunTimeTicks&&e.jsx("div",{className:"text-xs text-gray-500 flex-shrink-0 text-right",children:ze(n.RunTimeTicks)})]})}function We(){var W;const{id:n}=ye(),h=Se(),{playAlbum:N,playTrack:w,isPlaying:A,pause:S,addToQueue:C}=Z(),d=re(),[s,P]=l.useState(null),[c,g]=l.useState([]),[I,ae]=l.useState([]),[ie,T]=l.useState(!0),[Y,O]=l.useState(!1),[$e,k]=l.useState(!0),[y,z]=l.useState(!0),[oe,L]=l.useState(!1),[ce,U]=l.useState("mobile"),[ue,_]=l.useState(null),[D,B]=l.useState(null),[de,R]=l.useState(null),[me,V]=l.useState(!1),[xe,fe]=l.useState("mobile"),[he,ge]=l.useState(null),[M,pe]=l.useState("Alphabetical"),[$,H]=l.useState(se),[q,Q]=l.useState(ne),G=l.useRef(null),be=Z(t=>t.isQueueSidebarOpen);l.useEffect(()=>{const t=document.querySelector(".main-scrollable");t&&t.scrollTo({top:0,behavior:"auto"})},[n]);const J=t=>t.toLowerCase().replace(/[_\*\-\.]/g,"").trim();l.useEffect(()=>{if(!n)return;let t=!0;return(async()=>{var r;T(!0);try{let o=await v.getArtistById(n);if(!o){const f=(await v.getArtists({limit:1e3})).Items.find(m=>m.Id===n);f&&(o=f)}if(!t)return;if(!o){T(!1);return}P(o),z(!0);const u=await v.getArtistItems(n);if(!t)return;if(u.albums.length===0&&u.songs.length===0&&o.Name){const x=J(o.Name),m=((r=(await v.search(o.Name,50)).Artists)==null?void 0:r.Items)||[];for(const p of m){if(!t)return;if(p.Id!==n&&J(p.Name)===x){const F=await v.getArtistItems(p.Id);if(F.albums.length>0||F.songs.length>0){h(`/artist/${p.Id}`,{replace:!0});return}}}}if(!t)return;const b=[...u.albums].sort((x,f)=>{const m=x.ProductionYear||(x.PremiereDate?new Date(x.PremiereDate).getFullYear():0);return(f.ProductionYear||(f.PremiereDate?new Date(f.PremiereDate).getFullYear():0))-m});g(b),ae(u.songs)}catch(i){if(!t)return;Te.error("Failed to load artist data:",i)}finally{t&&T(!1)}})(),()=>{t=!1}},[n,h]),l.useEffect(()=>{if(!(s!=null&&s.Overview))return;k(!0);let t=null,a=null,r=null,i=!1;const o=()=>{const x=G.current;if(!x||!(s!=null&&s.Overview)){k(!1);return}const f=window.getComputedStyle(x);let m=parseFloat(f.lineHeight||"0");if((!Number.isFinite(m)||m===0)&&(m=parseFloat(f.fontSize||"16")*1.5),m===0){k(!1);return}const p=x.scrollHeight;if(p===0&&!i){i=!0,u();return}const Ie=Math.round(p/m)>2;k(Ie)},u=()=>{t!==null&&cancelAnimationFrame(t),a!==null&&clearTimeout(a),t=requestAnimationFrame(()=>{a=window.setTimeout(o,0)}),r!==null&&clearTimeout(r),r=window.setTimeout(()=>{i=!1,o()},300)},b=()=>{i=!1,u()};return u(),window.addEventListener("resize",b),()=>{t!==null&&cancelAnimationFrame(t),a!==null&&clearTimeout(a),r!==null&&clearTimeout(r),window.removeEventListener("resize",b)}},[s==null?void 0:s.Overview]),l.useEffect(()=>{H(se)},[c.length]),l.useEffect(()=>{Q(ne)},[I.length]),te({totalCount:I.length,visibleCount:q,increment:Ue,setVisibleCount:Q,threshold:1}),te({totalCount:c.length,visibleCount:$,increment:Ye,setVisibleCount:H,threshold:1});const ve=()=>{if(j.length>0){const t=[...j].sort(()=>Math.random()-.5);N(t)}},X=t=>t.ProductionYear?t.ProductionYear.toString():t.PremiereDate?new Date(t.PremiereDate).getFullYear().toString():null,Ne=t=>{const a=t.Album||null;let r=null;if(t.AlbumId){const i=c.find(o=>o.Id===t.AlbumId);i&&(r=X(i))}return{album:a,year:r}},K=t=>{if(t.AlbumId){const a=c.find(r=>r.Id===t.AlbumId);if(a)return a.ProductionYear||(a.PremiereDate?new Date(a.PremiereDate).getFullYear():0)}return t.ProductionYear||(t.PremiereDate?new Date(t.PremiereDate).getFullYear():0)},j=l.useMemo(()=>{if(M==="Alphabetical")return[...I].sort((r,i)=>{const o=r.Name||"",u=i.Name||"";return o.localeCompare(u)});const t=(r,i,o)=>{const u=K(r),b=K(i),x=r.AlbumId||"",f=i.AlbumId||"";if(u!==b)return o?b-u:u-b;if(x!==f)return x.localeCompare(f);const m=r.IndexNumber||0,p=i.IndexNumber||0;return m!==p?m-p:(r.Name||"").localeCompare(i.Name||"")},a=M==="Newest";return[...I].sort((r,i)=>t(r,i,a))},[I,M,c]),je=t=>{t.preventDefault(),t.stopPropagation(),j.length>0&&N(j)},we=t=>{t.preventDefault(),t.stopPropagation(),j.length>0&&C(j)},Ae=()=>{pe(t=>t==="Alphabetical"?"Newest":t==="Newest"?"Oldest":"Alphabetical")};return ie?e.jsx("div",{className:"pb-20",children:e.jsx("div",{className:"flex items-center justify-center h-screen text-gray-400",children:e.jsx(Ce,{})})}):s?e.jsxs("div",{className:"pb-20",children:[e.jsx("div",{className:`fixed top-0 left-0 right-0 z-[60] lg:left-16 transition-[left,right] duration-300 ${be?"sidebar-open-right-offset":""}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top))"},children:e.jsx("div",{className:"max-w-[768px] mx-auto",children:e.jsxs("div",{className:"relative flex items-center justify-between gap-4 p-4",children:[e.jsx("button",{onClick:()=>h(-1),className:"text-white hover:text-zinc-300 transition-colors z-10",children:e.jsx(Le,{className:"w-6 h-6"})}),s&&e.jsx("button",{onClick:t=>{const a=t.currentTarget.getBoundingClientRect();fe("desktop"),ge({x:a.left+a.width/2,y:a.bottom+5}),V(!0)},className:"text-white hover:text-zinc-300 transition-colors z-10",children:e.jsx(Be,{className:"w-6 h-6"})})]})})}),e.jsxs("div",{className:"relative z-30 w-screen",style:{marginTop:"calc(-1 * env(safe-area-inset-top))",marginLeft:"calc(50% - 50vw)",marginRight:"calc(50% - 50vw)"},children:[y&&e.jsxs("div",{className:"relative w-full min-h-64 md:min-h-80 bg-black",style:{paddingTop:"env(safe-area-inset-top)"},children:[e.jsx("div",{className:"w-full flex items-center justify-center md:hidden",children:e.jsx(E,{src:v.getArtistImageUrl(s.Id),alt:s.Name,className:"w-full h-auto object-contain",onError:()=>z(!1)})}),e.jsx("div",{className:"hidden md:block w-full h-80",children:e.jsx("img",{src:v.getArtistBackdropUrl(s.Id),alt:s.Name,className:"w-full h-full object-cover",onError:()=>z(!1)})}),e.jsx("div",{className:"absolute inset-x-0 top-0 bottom-[-1px] bg-gradient-to-b from-transparent via-black/60 to-black pointer-events-none"})]}),e.jsx("div",{className:`left-0 right-0 ${y?"absolute":"relative"} ${y?"pt-16":"pt-12"}`,style:y?{bottom:"-28px",paddingBottom:"1.5rem"}:{},children:e.jsxs("div",{className:"max-w-[768px] mx-auto px-4 flex items-end gap-6 md:grid md:grid-cols-3 md:gap-4",children:[y&&e.jsx("div",{className:"hidden md:block md:col-span-1",children:e.jsx("div",{className:"aspect-square rounded overflow-hidden bg-zinc-900 flex items-center justify-center",children:e.jsx(E,{src:v.getArtistImageUrl(s.Id),alt:s.Name,className:"w-full h-full object-cover",showOutline:!0,rounded:"rounded"})})}),e.jsx("div",{className:`flex-1 min-w-0 pb-2 ${y?"md:col-span-2":"md:col-span-3"}`,children:e.jsxs("div",{className:"mb-4 mt-4",children:[e.jsx("h1",{className:"text-4xl md:text-5xl font-bold text-white mb-2 break-words",children:s.Name}),e.jsxs("div",{className:"flex items-center justify-between gap-4 mt-2",children:[e.jsxs("p",{className:"text-sm text-gray-300",children:[c.length," ",c.length===1?"album":"albums"," • ",j.length," ",j.length===1?"song":"songs"]}),e.jsx("button",{onClick:()=>{var a;d&&A&&(((a=d.ArtistItems)==null?void 0:a.some(r=>r.Id===n))||d.AlbumArtist===(s==null?void 0:s.Name))?S():ve()},className:"bg-white/10 hover:bg-white/20 text-white font-semibold py-1.5 px-3 rounded-full transition-all hover:scale-105 flex items-center gap-1.5 backdrop-blur-sm border border-white/20 flex-shrink-0",children:d&&A&&((W=d.ArtistItems)!=null&&W.some(t=>t.Id===n)||d.AlbumArtist===(s==null?void 0:s.Name))?e.jsxs(e.Fragment,{children:[e.jsx(Pe,{className:"w-3.5 h-3.5"}),"Pause"]}):e.jsxs(e.Fragment,{children:[e.jsx(ke,{className:"w-3.5 h-3.5"}),"Shuffle"]})})]})]})})]})})]}),e.jsxs("div",{className:"pt-3 md:pt-7",children:[s.Overview&&e.jsx("div",{className:"mb-6 -mt-4 px-4",children:e.jsxs("div",{className:"text-white relative",children:[e.jsx("p",{ref:G,className:"text-sm text-gray-300 leading-relaxed absolute opacity-0 pointer-events-none -z-10",children:s.Overview}),!Y&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>O(!0),className:"flex-1 text-left min-w-0",children:e.jsx("p",{className:"text-sm text-gray-300 leading-relaxed line-clamp-2",children:s.Overview})}),e.jsx("button",{onClick:()=>O(!0),className:"flex-shrink-0 text-gray-400 hover:text-white transition-colors",children:e.jsx(De,{className:"w-4 h-4"})})]}),Y&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-300 leading-relaxed whitespace-pre-line",children:s.Overview}),e.jsxs("button",{onClick:()=>O(!1),className:"mt-2 flex items-center gap-1 text-sm text-gray-400 hover:text-white transition-colors ml-auto",children:["Show less",e.jsx(Re,{className:"w-4 h-4"})]})]})]})}),c.length>0&&e.jsxs("div",{className:"mb-10 px-4",children:[e.jsxs("h2",{className:"text-2xl font-bold text-white mb-4",children:["Albums (",c.length,")"]}),e.jsx("div",{className:"grid grid-cols-3 md:grid-cols-4 gap-4",children:c.map((t,a)=>{const r=X(t);return e.jsx(_e,{album:t,year:r,onNavigate:i=>h(`/album/${i}`),onContextMenu:(i,o,u)=>{B(i),R("album"),U(o||"mobile"),_(u||null),L(!0)},showImage:a<$},t.Id)})})]}),I.length>0&&e.jsxs("div",{id:"songs-section",children:[e.jsxs("div",{className:"px-4 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h2",{className:"text-2xl font-bold text-white",children:["Songs (",I.length,")"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:je,className:"w-10 h-10 flex items-center justify-center text-white hover:bg-white/10 rounded-full transition-colors","aria-label":"Play all songs",children:e.jsx(Me,{className:"w-5 h-5"})}),e.jsx("button",{type:"button",onClick:we,className:"w-10 h-10 flex items-center justify-center text-white hover:bg-white/10 rounded-full transition-colors","aria-label":"Add all songs to queue",children:e.jsx(Ee,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"mt-1",children:e.jsxs("button",{type:"button",onClick:Ae,className:"text-sm text-gray-400 hover:text-white transition-colors flex items-center gap-1",children:[M,e.jsx(Fe,{className:"w-4 h-4"})]})})]}),e.jsx("div",{className:"space-y-0",children:j.map((t,a)=>{const{album:r,year:i}=Ne(t);return e.jsx(Ve,{song:t,album:r,year:i,onClick:w,onContextMenu:(o,u,b)=>{B(o),R("song"),U(u||"mobile"),_(b||null),L(!0)},contextMenuItemId:(D==null?void 0:D.Id)||null,showImage:a<q},t.Id)})})]})]}),e.jsx(ee,{item:D,itemType:de,isOpen:oe,onClose:()=>{L(!1),B(null),R(null)},zIndex:99999,mode:ce,position:ue||void 0}),e.jsx(ee,{item:s,itemType:"artist",isOpen:me,onClose:()=>{V(!1)},mode:xe,position:he||void 0})]}):e.jsx("div",{className:"pb-20",children:e.jsx("div",{className:"flex items-center justify-center h-screen text-gray-400",children:e.jsx("p",{children:"Artist not found on the Jellyfin server"})})})}export{We as default};
