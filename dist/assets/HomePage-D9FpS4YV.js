import{c as Re,r as t,u as U,a as te,b as we,d as _e,j as e,S as De,l as fe,e as L,C as xe,f as ze,D as be,I as $e,A as He,g as qe,B as Ve,h as ge,i as Ye,F as he,M as We}from"./index-Kr6dcGJx.js";import{S as Ge}from"./search-D2ETlu7_.js";import{u as Xe,F as Ae}from"./useSearch-cZV-4Owm.js";import{E as Qe}from"./ellipsis-DTpmKk5Z.js";/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ze=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],Je=Re("search",Ze);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],et=Re("settings",Ke),tt=[{type:"artists",limit:5},{type:"albums",limit:12},{type:"playlists"},{type:"songs"}];function st({onSearchStateChange:n,title:i="Search"}){const[s,r]=t.useState(!1),u=t.useRef(null),w=t.useRef(null),[y,N]=t.useState(!1),[c,d]=t.useState(null),{genres:m}=U(),[f,o]=t.useState([]),{playAlbum:a,addToQueue:v,playTrack:$,shuffleAllSongs:b,isQueueSidebarOpen:k}=te(),[M,g]=t.useState(!1),{searchQuery:x,setSearchQuery:P,isSearching:z,searchResults:S,selectedGenres:_,setSelectedGenres:D,yearRange:H,setYearRange:Y,clearSearch:B,clearAll:Q}=Xe({debounceMs:0});t.useEffect(()=>{if(M){const h=setTimeout(()=>{g(!1)},1e4);return()=>clearTimeout(h)}},[M]);const E=we(),[q,V]=_e();t.useEffect(()=>{const h=q.get("yearMin"),l=q.get("yearMax"),C=q.get("genre");let p=!1;(h||l)&&(Y({min:h?parseInt(h,10):null,max:l?parseInt(l,10):null}),p=!0),C&&(D([C]),p=!0),p&&(r(!0),V({},{replace:!0}))},[]),t.useEffect(()=>{(async()=>{try{const l=U.getState();if(l.years.length>0)o(l.years);else{const C=await L.getYears();o(C)}}catch(l){fe.error("Failed to load filter values:",l)}})()},[]);const W=h=>{P(h),h.trim().length>0&&!s&&r(!0)},J=h=>{E(`/artist/${h}`),r(!1),B()},G=h=>{E(`/album/${h}`),r(!1),B()},Z=h=>{$(h,[h])},se=h=>{E(`/playlist/${h}`),r(!1),B()},X=()=>{B()},K=()=>{r(!1),Q()},ne=h=>{d(h),N(!0)},le=h=>{D(h)},j=h=>{Y(h)},O=()=>{S!=null&&S.songs&&S.songs.length>0&&a(S.songs)},R=()=>{S!=null&&S.songs&&S.songs.length>0&&v(S.songs)},T=s;return t.useEffect(()=>{n&&n(T)},[T,n]),t.useEffect(()=>{if(s){const l=window.matchMedia("(hover: hover) and (pointer: fine) and (min-width: 1024px)").matches?w:u;setTimeout(()=>{var C;if((C=l.current)==null||C.focus(),l.current){const p=l.current.value.length;l.current.setSelectionRange(p,p)}},50)}},[s]),t.useEffect(()=>{if(!s)return;const h=l=>{l.key==="Escape"&&(l.preventDefault(),l.stopPropagation(),K())};return window.addEventListener("keydown",h,!0),()=>window.removeEventListener("keydown",h,!0)},[s]),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"px-4 md:pl-2 md:pr-4 pt-4 pb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Tunetuna"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:async()=>{const h=te.getState(),{isShuffleAllActive:l,isShuffleGenreActive:C}=h;if(!(M||l||C)){g(!0);try{await b()}catch(p){fe.error("Home shuffle button - shuffleAllSongs failed:",p),fe.error("Shuffle all failed:",p)}finally{g(!1)}}},disabled:M,className:"w-10 h-10 flex items-center justify-center text-white hover:bg-zinc-800 rounded-full transition-colors disabled:opacity-50","aria-label":"Shuffle all songs",children:M?e.jsx("div",{className:"w-5 h-5 border-2 border-zinc-400 border-t-white rounded-full animate-spin"}):e.jsx(De,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>r(!0),className:"w-10 h-10 flex items-center justify-center text-white hover:bg-zinc-800 rounded-full transition-colors","aria-label":"Search",children:e.jsx(Je,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>E("/settings"),className:"w-10 h-10 flex items-center justify-center text-white hover:bg-zinc-800 rounded-full transition-colors","aria-label":"Settings",children:e.jsx(et,{className:"w-5 h-5"})})]})]})}),e.jsx(Ge,{isOpen:s,onClose:K,title:i,searchQuery:x,onSearchChange:W,onClearSearch:X,isLoading:z,results:S,sections:tt,filterConfig:{showGenreFilter:!0,showYearFilter:!0},filterState:{selectedGenres:_,yearRange:H},onOpenFilterSheet:ne,onArtistClick:J,onAlbumClick:G,onSongClick:Z,onPlaylistClick:se,onPlayAllSongs:O,onAddSongsToQueue:R,isQueueSidebarOpen:k,desktopSearchInputRef:w,mobileSearchInputRef:u}),c==="genre"&&e.jsx(Ae,{isOpen:y,onClose:()=>N(!1),filterType:"genre",genres:m,selectedValues:_,onApply:le}),c==="year"&&e.jsx(Ae,{isOpen:y,onClose:()=>N(!1),filterType:"year",availableYears:f,yearRange:H,onApplyYear:j})]})}function Se({album:n,onNavigate:i,onContextMenu:s}){var d,m;const[r,u]=t.useState(!1),w=t.useRef(!1),y=f=>{if(w.current){w.current=!1;return}i(n.Id)},N=f=>{f.preventDefault(),f.stopPropagation(),w.current=!0,s(n,"desktop",{x:f.clientX,y:f.clientY}),setTimeout(()=>{w.current=!1},300)},c=ze({onLongPress:f=>{f.preventDefault(),w.current=!0,s(n,"mobile")},onClick:()=>{if(w.current){w.current=!1;return}y()}});return e.jsxs("button",{onClick:()=>{if(w.current){w.current=!1;return}y()},onContextMenu:N,...c,className:"text-left group",children:[e.jsx("div",{className:"aspect-square rounded overflow-hidden mb-2 bg-zinc-900 flex items-center justify-center",children:r?e.jsx(be,{className:"w-12 h-12 text-gray-500"}):e.jsx($e,{src:L.getAlbumArtUrl(n.Id,474),alt:n.Name,className:"w-full h-full object-cover",showOutline:!0,rounded:"rounded",onError:()=>u(!0)})}),e.jsx("div",{className:"text-sm font-medium text-white truncate",children:n.Name}),e.jsx("div",{className:"text-xs text-gray-400 truncate",children:n.AlbumArtist||((m=(d=n.ArtistItems)==null?void 0:d[0])==null?void 0:m.Name)||"Unknown Artist"})]})}function nt(){const{recentlyAdded:n,setRecentlyAdded:i,setLoading:s}=U(),r=we(),u=t.useRef(null),[w,y]=t.useState(0),[N,c]=t.useState(!1),[d,m]=t.useState("mobile"),[f,o]=t.useState(null),[a,v]=t.useState(null);t.useEffect(()=>{(async()=>{s("recentlyAdded",!0);try{const x=await L.getRecentlyAdded(18);i(x.Items||[])}catch(x){fe.error("Failed to load recently added:",x)}finally{s("recentlyAdded",!1)}})()},[i,s]);const $=()=>{if(!u.current)return;const g=u.current,x=g.scrollLeft,P=g.clientWidth,z=Math.round(x/P);y(z)},b=g=>{if(!u.current)return;const x=u.current,P=x.clientWidth;x.scrollTo({left:g*P,behavior:"smooth"})};if(!n||n.length===0)return null;const k=6,M=[];for(let g=0;g<n.length;g+=k)M.push(n.slice(g,g+k));return e.jsxs("div",{className:"px-4 mb-8",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Recently Added"}),e.jsxs("div",{className:"md:hidden",children:[e.jsx("div",{ref:u,onScroll:$,className:"overflow-x-auto snap-x snap-mandatory scrollbar-hide",style:{scrollbarWidth:"none",msOverflowStyle:"none"},children:e.jsx("div",{className:"flex",style:{width:`${M.length*100}%`},children:M.map((g,x)=>{const P=Math.ceil(g.length/3);return e.jsx("div",{className:"snap-start flex-shrink-0 w-full",style:{width:`${100/M.length}%`},children:e.jsx("div",{className:"grid grid-cols-3 gap-3",style:{gridTemplateRows:`repeat(${P}, minmax(0, 1fr))`},children:g.map(z=>e.jsx(Se,{album:z,onNavigate:S=>r(`/album/${S}`),onContextMenu:(S,_,D)=>{v(S),m(_||"desktop"),o(D||null),c(!0)}},z.Id))})},x)})})}),M.length>1&&e.jsx("div",{className:"flex justify-center gap-2 mt-4",children:M.map((g,x)=>e.jsx("button",{onClick:()=>b(x),className:`w-2 h-2 rounded-full transition-colors ${x===w?"bg-white":"bg-zinc-600"}`,"aria-label":`Go to page ${x+1}`},x))})]}),e.jsx("div",{className:"hidden md:block min-[1680px]:hidden",children:e.jsx("div",{className:"grid grid-cols-4 gap-3",children:n.slice(0,8).map(g=>e.jsx(Se,{album:g,onNavigate:x=>r(`/album/${x}`),onContextMenu:(x,P,z)=>{v(x),m(P||"desktop"),o(z||null),c(!0)}},g.Id))})}),e.jsx("div",{className:"hidden min-[1680px]:block",children:e.jsx("div",{className:"grid grid-cols-5 gap-3",children:n.slice(0,10).map(g=>e.jsx(Se,{album:g,onNavigate:x=>r(`/album/${x}`),onContextMenu:(x,P,z)=>{v(x),m(P||"desktop"),o(z||null),c(!0)}},g.Id))})}),e.jsx("style",{children:`
        .scrollbar-hide::-webkit-scrollbar {
          display: none;
        }
      `}),e.jsx(xe,{item:a,itemType:"album",isOpen:N,onClose:()=>{c(!1),v(null)},zIndex:999999,mode:d,position:f||void 0})]})}const lt="https://musicbrainz.org/ws/2",at=`${He}/${qe} (https://github.com/AlessioLaiso/tunetuna)`,rt="https://coverartarchive.org",it="https://api.song.link/v1-alpha.1";let ke=0;const Ce=1100;async function ot(n="gb",i=10){const s=`/api/stats/proxy/apple-music/${n}/${i}`,r=await fetch(s);if(!r.ok)throw new Error(`Apple Music RSS failed: ${r.status}`);return(await r.json()).feed.results}function ct(n,i=300){return n.replace(/\d+x\d+/,`${i}x${i}`)}async function dt(){const i=Date.now()-ke;i<Ce&&await new Promise(s=>setTimeout(s,Ce-i)),ke=Date.now()}async function ut(n,i){await dt();const s=`releasegroup:"${i}" AND artist:"${n}"`,r=new URLSearchParams({query:s,fmt:"json",limit:"1"}),u=await fetch(`${lt}/release-group/?${r}`,{headers:{"User-Agent":at,Accept:"application/json"}});if(!u.ok)throw new Error(`MusicBrainz search failed: ${u.status}`);const y=(await u.json())["release-groups"]||[];return y.length===0?null:{id:y[0].id,type:y[0]["primary-type"]||"Album"}}function Te(n,i=500){return`${rt}/release-group/${n}/front-${i}`}async function Le(n,i){const s=new URLSearchParams({url:n});try{const r=await fetch(`${it}/links?${s}`);if(!r.ok){if(r.status===404)return null;throw new Error(`Odesli API failed: ${r.status}`)}return await r.json()}catch{return null}}async function mt(n,i=10){if(!n)return[];const s=`https://api.allorigins.win/raw?url=${encodeURIComponent(n)}`;console.log("[Muspy] Fetching from:",s);const r=await fetch(s);if(!r.ok)throw new Error(`Muspy RSS failed: ${r.status}`);const u=await r.text();console.log("[Muspy] Response length:",u.length,"First 500 chars:",u.substring(0,500));const y=new DOMParser().parseFromString(u,"text/xml"),N=y.querySelector("parsererror");N&&console.error("[Muspy] XML parse error:",N.textContent);const c=y.querySelectorAll("entry");console.log("[Muspy] Found",c.length,"entries");const d=[];return c.forEach((m,f)=>{var B,Q,E,q,V,W;if(f>=i)return;const o=((B=m.querySelector("title"))==null?void 0:B.textContent)||"",a=m.querySelector('link[rel="alternate"]')||m.querySelector("link"),v=(a==null?void 0:a.getAttribute("href"))||(a==null?void 0:a.textContent)||"",$=((Q=m.querySelector("summary"))==null?void 0:Q.textContent)||((E=m.querySelector("content"))==null?void 0:E.textContent)||"",b=((q=m.querySelector("updated"))==null?void 0:q.textContent)||((V=m.querySelector("published"))==null?void 0:V.textContent)||"";(W=m.querySelector("id"))!=null&&W.textContent;const k=/[a-fA-F0-9]{8}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{12}/i,g=m.outerHTML.match(k),x=g?g[0]:`muspy-${f}`,P=$.match(/\((Single|Album|EP)\)/i),z=P?P[1]:"Album",S=o.split(" - "),_=S.length>1?S[0].trim():$,D=S.length>1?S.slice(1).join(" - ").trim():o;let H="";if(b)try{H=new Date(b).toISOString().split("T")[0]}catch{H=b}const Y=x.startsWith("muspy-")?v:`https://musicbrainz.org/release-group/${x}`;d.push({id:x,title:D,artistName:_,releaseDate:H,type:z,artworkUrl:x.startsWith("muspy-")?void 0:Te(x,500),mbUrl:Y})}),d}const ft=[{id:"spotify",name:"Spotify",icon:"spotify"},{id:"appleMusic",name:"Apple Music",icon:"apple"},{id:"youtube",name:"YouTube",icon:"youtube"},{id:"youtubeMusic",name:"YouTube Music",icon:"youtube"},{id:"tidal",name:"Tidal",icon:"tidal"},{id:"deezer",name:"Deezer",icon:"deezer"},{id:"amazonMusic",name:"Amazon Music",icon:"amazon"},{id:"soundcloud",name:"SoundCloud",icon:"soundcloud"}];function pe(n,i){const s=encodeURIComponent(`${n} ${i}`);return{entityUniqueId:"search",userCountry:"US",pageUrl:`https://www.google.com/search?q=${s}`,linksByPlatform:{spotify:{url:`https://open.spotify.com/search/${s}`},appleMusic:{url:`https://music.apple.com/search?term=${s}`},youtube:{url:`https://www.youtube.com/results?search_query=${s}`},youtubeMusic:{url:`https://music.youtube.com/search?q=${s}`},tidal:{url:`https://listen.tidal.com/search?q=${s}`},deezer:{url:`https://www.deezer.com/search/${s}`},amazonMusic:{url:`https://music.amazon.com/search/${s}`}}}}const Ie={spotify:e.jsx("svg",{viewBox:"0 0 24 24",className:"w-5 h-5",fill:"currentColor",children:e.jsx("path",{d:"M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.66 0 12 0zm5.521 17.34c-.24.359-.66.48-1.021.24-2.82-1.74-6.36-2.101-10.561-1.141-.418.122-.779-.179-.899-.539-.12-.421.18-.78.54-.9 4.56-1.021 8.52-.6 11.64 1.32.42.18.479.659.301 1.02zm1.44-3.3c-.301.42-.841.6-1.262.3-3.239-1.98-8.159-2.58-11.939-1.38-.479.12-1.02-.12-1.14-.6-.12-.48.12-1.021.6-1.141C9.6 9.9 15 10.561 18.72 12.84c.361.181.54.78.241 1.2zm.12-3.36C15.24 8.4 8.82 8.16 5.16 9.301c-.6.179-1.2-.181-1.38-.721-.18-.601.18-1.2.72-1.381 4.26-1.26 11.28-1.02 15.721 1.621.539.3.719 1.02.419 1.56-.299.421-1.02.599-1.559.3z"})}),appleMusic:e.jsx("svg",{viewBox:"0 0 24 24",className:"w-5 h-5",fill:"currentColor",children:e.jsx("path",{d:"M23.994 6.124a9.23 9.23 0 00-.24-2.19c-.317-1.31-1.062-2.31-2.18-3.043a5.022 5.022 0 00-1.877-.726 10.496 10.496 0 00-1.564-.15c-.04-.003-.083-.01-.124-.013H5.986c-.152.01-.303.017-.455.026-.747.043-1.49.123-2.193.4-1.336.53-2.3 1.452-2.865 2.78-.192.448-.292.925-.363 1.408-.056.392-.088.785-.1 1.18 0 .032-.007.062-.01.093v12.223c.01.14.017.283.027.424.05.815.154 1.624.497 2.373.65 1.42 1.738 2.353 3.234 2.802.42.127.856.187 1.293.228.555.053 1.11.06 1.667.06h11.03a12.5 12.5 0 001.57-.1c.822-.106 1.596-.35 2.296-.81a5.046 5.046 0 001.88-2.207c.186-.42.293-.87.37-1.324.113-.675.138-1.358.137-2.04-.002-3.8 0-7.595-.003-11.393zm-6.423 3.99v5.712c0 .417-.058.827-.244 1.206-.29.59-.76.962-1.388 1.14-.35.1-.706.157-1.07.173-.95.045-1.773-.6-1.943-1.536a1.88 1.88 0 011.038-2.022c.323-.16.67-.25 1.018-.324.378-.082.758-.153 1.134-.24.274-.063.457-.23.51-.516a.904.904 0 00.02-.193c0-1.815 0-3.63-.002-5.443a.725.725 0 00-.026-.185c-.04-.15-.15-.243-.304-.234-.16.01-.318.035-.475.066-.76.15-1.52.303-2.28.456l-2.326.47-1.374.278c-.016.003-.032.01-.048.013-.277.077-.377.203-.39.49-.002.042 0 .086 0 .13-.002 2.602 0 5.204-.003 7.805 0 .42-.047.836-.215 1.227-.278.64-.77 1.04-1.434 1.233-.35.1-.71.16-1.075.172-.96.036-1.755-.6-1.92-1.544-.14-.812.23-1.685 1.154-2.075.357-.15.73-.232 1.108-.31.287-.06.575-.116.86-.177.383-.083.583-.323.6-.714v-.15c0-2.96 0-5.922.002-8.883 0-.123.013-.25.042-.37.07-.285.273-.448.546-.518.255-.065.515-.112.774-.165.733-.15 1.466-.296 2.2-.444l2.27-.46c.67-.134 1.34-.27 2.01-.403.22-.043.443-.088.664-.106.31-.025.523.17.554.482.008.073.012.148.012.223.002 1.91.002 3.822 0 5.732z"})}),youtube:e.jsx("svg",{viewBox:"0 0 24 24",className:"w-5 h-5",fill:"currentColor",children:e.jsx("path",{d:"M23.498 6.186a3.016 3.016 0 00-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 00.502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 002.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 002.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"})}),youtubeMusic:e.jsx("svg",{viewBox:"0 0 24 24",className:"w-5 h-5",fill:"currentColor",children:e.jsx("path",{d:"M12 0C5.376 0 0 5.376 0 12s5.376 12 12 12 12-5.376 12-12S18.624 0 12 0zm0 19.104c-3.924 0-7.104-3.18-7.104-7.104S8.076 4.896 12 4.896s7.104 3.18 7.104 7.104-3.18 7.104-7.104 7.104zm0-13.332c-3.432 0-6.228 2.796-6.228 6.228S8.568 18.228 12 18.228s6.228-2.796 6.228-6.228S15.432 5.772 12 5.772zM9.684 15.54V8.46L15.816 12l-6.132 3.54z"})}),tidal:e.jsx("svg",{viewBox:"0 0 24 24",className:"w-5 h-5",fill:"currentColor",children:e.jsx("path",{d:"M12.012 3.992L8.008 7.996 4.004 3.992 0 7.996 4.004 12l4.004-4.004L12.012 12l4.004-4.004L20.02 12l4.004-4.004-4.004-4.004-4.004 4.004-4.004-4.004zM12.012 12.012L8.008 16.02l4.004 4.004 4.004-4.004-4.004-4.008z"})}),deezer:e.jsx("svg",{viewBox:"0 0 24 24",className:"w-5 h-5",fill:"currentColor",children:e.jsx("path",{d:"M18.81 4.16v3.03H24V4.16h-5.19zM6.27 8.38v3.027h5.189V8.38h-5.19zm12.54 0v3.027H24V8.38h-5.19zM6.27 12.594v3.027h5.189v-3.027h-5.19zm6.27 0v3.027h5.19v-3.027h-5.19zm6.27 0v3.027H24v-3.027h-5.19zM0 16.81v3.029h5.19v-3.03H0zm6.27 0v3.029h5.189v-3.03h-5.19zm6.27 0v3.029h5.19v-3.03h-5.19zm6.27 0v3.029H24v-3.03h-5.19z"})}),amazonMusic:e.jsx("svg",{viewBox:"0 0 24 24",className:"w-5 h-5",fill:"currentColor",children:e.jsx("path",{d:"M.045 18.02c.072-.116.187-.124.348-.022 3.636 2.11 7.594 3.166 11.87 3.166 2.852 0 5.668-.533 8.447-1.595l.315-.118c.138-.053.209-.073.315-.073.186 0 .27.089.27.267 0 .178-.089.355-.267.533l-.178.178c-2.852 2.346-6.22 3.52-10.106 3.52-4.24 0-7.942-1.192-11.107-3.574-.168-.133-.217-.244-.217-.333 0-.089.044-.133.133-.178zm21.243-3.928c-.236-.178-.712-.267-1.424-.267-.712 0-1.598.178-2.665.533-1.067.356-2.134.89-3.201 1.602-.178.089-.267.178-.267.267s.089.133.267.133c.089 0 .178-.044.267-.089l.356-.178c1.156-.533 2.223-.8 3.2-.8.979 0 1.469.267 1.469.8 0 .356-.178.712-.534 1.068-.356.355-.89.711-1.6 1.066l-.535.267c-.356.178-.534.356-.534.534 0 .133.089.2.267.2.089 0 .178-.022.267-.067l.445-.222c1.6-.8 2.756-1.424 3.467-1.869.712-.444 1.068-.889 1.068-1.333 0-.445-.178-.712-.534-.978-.356-.267-.978-.4-1.868-.4zm-6.844-7.11c0-1.067-.267-1.957-.8-2.67-.533-.711-1.422-1.066-2.666-1.066-1.244 0-2.223.355-2.933 1.066-.712.712-1.156 1.78-1.334 3.2h7.733v-.533zm3.911 1.956H8.045c.089 1.422.445 2.489 1.067 3.2.622.712 1.511 1.067 2.666 1.067.89 0 1.69-.178 2.4-.533.712-.356 1.334-.89 1.868-1.6.178-.178.356-.267.534-.267.178 0 .267.089.267.267 0 .178-.089.356-.267.533-.622.8-1.422 1.423-2.4 1.868-.978.445-2.044.667-3.2.667-1.778 0-3.2-.533-4.267-1.6-1.067-1.066-1.6-2.577-1.6-4.533 0-1.956.533-3.467 1.6-4.533 1.067-1.067 2.489-1.6 4.267-1.6 1.778 0 3.111.445 4 1.334.89.889 1.334 2.177 1.334 3.866v1.067c0 .266-.089.4-.267.4l-.089-.003z"})}),soundcloud:e.jsx("svg",{viewBox:"0 0 24 24",className:"w-5 h-5",fill:"currentColor",children:e.jsx("path",{d:"M1.175 12.225c-.051 0-.094.046-.101.1l-.233 2.154.233 2.105c.007.058.05.098.101.098.05 0 .09-.04.099-.098l.255-2.105-.27-2.154c-.009-.06-.048-.1-.098-.1m-.899.828c-.06 0-.091.037-.104.094L0 14.479l.165 1.308c.014.057.045.094.09.094s.089-.037.099-.094l.19-1.308-.19-1.334c-.01-.057-.045-.09-.09-.09m1.83-1.229c-.061 0-.12.045-.12.104l-.21 2.563.225 2.458c0 .06.045.104.106.104.061 0 .12-.044.12-.104l.24-2.458-.24-2.563c0-.06-.045-.104-.12-.104m.945-.089c-.075 0-.135.06-.15.135l-.193 2.64.21 2.544c.016.077.075.138.149.138.075 0 .135-.061.15-.138l.225-2.545-.225-2.64c-.015-.074-.06-.135-.135-.135m1.065.42c-.09 0-.149.075-.164.164l-.158 2.255.18 2.46c.015.09.074.165.164.165.089 0 .149-.075.164-.165l.209-2.46-.209-2.255c-.015-.09-.075-.164-.164-.164m.944-.54c-.104 0-.194.09-.209.195l-.149 2.81.164 2.445c.015.105.09.195.194.195.104 0 .195-.09.21-.195l.18-2.445-.18-2.81c-.015-.105-.09-.195-.194-.195m1.076-.505c-.119 0-.21.09-.225.21l-.135 3.3.149 2.4c.015.12.105.21.225.21.12 0 .21-.09.225-.21l.165-2.4-.165-3.3c-.015-.12-.105-.21-.225-.21m1.064-.54c-.135 0-.239.105-.254.24l-.12 3.825.135 2.354c.015.135.12.24.255.24.12 0 .24-.105.255-.24l.149-2.354-.149-3.825c-.015-.135-.12-.24-.255-.24m1.109-.27c-.015-.15-.135-.255-.27-.255-.15 0-.255.105-.27.255l-.12 4.08.12 2.31c.015.15.12.255.27.255.149 0 .255-.105.27-.255l.134-2.31-.134-4.08m.494 6.645c.015.165.135.284.285.284.149 0 .27-.12.284-.284l.121-2.325-.12-5.175c-.015-.165-.135-.285-.285-.285-.149 0-.27.12-.284.285l-.107 5.175.106 2.325m1.184-6.18c-.165 0-.3.135-.314.3l-.091 3.855.105 2.31c.015.165.135.3.3.3.164 0 .284-.135.299-.3l.12-2.31-.12-3.855c-.015-.165-.135-.3-.3-.3m1.199-.075c-.18 0-.314.135-.329.315l-.09 3.915.104 2.295c.015.18.135.315.315.315s.314-.135.314-.315l.12-2.295-.12-3.915c-.015-.18-.149-.315-.314-.315m1.139-.195c-.195 0-.345.149-.359.345l-.075 4.11.09 2.265c.014.195.149.345.344.345.195 0 .345-.15.359-.345l.105-2.265-.105-4.095c-.014-.195-.164-.36-.359-.36m1.305 0c-.209 0-.359.164-.374.359l-.074 4.095.089 2.25c.015.21.165.375.375.375.194 0 .359-.165.374-.375l.09-2.25-.09-4.095c-.015-.209-.165-.359-.375-.359m1.289.015c-.225 0-.39.18-.39.405l-.06 4.065.075 2.235c.016.225.166.39.391.39.225 0 .391-.165.406-.39l.09-2.235-.091-4.065c-.014-.24-.18-.405-.405-.405m1.35.09c-.24 0-.42.18-.42.42l-.045 3.975.06 2.205c.015.24.18.42.42.42.24 0 .404-.18.42-.42l.075-2.205-.075-3.975c-.015-.24-.18-.42-.42-.42m1.33.135c-.256 0-.435.194-.45.435l-.046 3.825.061 2.175c.015.255.195.45.435.45.256 0 .436-.195.45-.45l.076-2.175-.076-3.825c-.014-.255-.194-.435-.45-.435m1.453-.09c-.27 0-.48.21-.48.465l-.03 3.915.03 2.145c.015.27.21.465.48.465.27 0 .48-.195.48-.465l.045-2.145-.045-3.915c0-.255-.21-.465-.48-.465m1.444.285c-.285 0-.495.225-.51.495l-.015 3.645.03 2.13c.015.285.225.51.51.51.27 0 .494-.225.51-.51l.03-2.13-.03-3.645c-.016-.285-.225-.495-.51-.495m3.39.465c-.165-.045-.345-.075-.51-.075-.18 0-.345.015-.51.045-.044-.9-.39-1.695-.945-2.34-.556-.645-1.35-1.08-2.31-1.215-.27-.045-.405-.165-.405-.405V6.54c0-1.305-.465-2.415-1.395-3.345C19.2 2.265 18.09 1.8 16.77 1.8c-1.155 0-2.16.375-3.045 1.095-.885.72-1.44 1.635-1.68 2.745-.165-.03-.315-.045-.45-.045-1.35 0-2.355.93-2.355 2.115 0 .24.03.465.075.69-.645.12-1.17.435-1.59.945-.42.51-.63 1.095-.63 1.755 0 .75.255 1.38.765 1.89s1.14.765 1.89.765h10.53c.93 0 1.695-.285 2.31-.855.615-.57.93-1.29.93-2.145 0-.855-.3-1.575-.9-2.16-.6-.585-1.335-.885-2.205-.9"})})};function ht(){return e.jsx("div",{className:"animate-pulse space-y-0",children:[...Array(4)].map((n,i)=>e.jsxs("div",{className:"flex items-center gap-3 px-4 py-2.5",children:[e.jsx("div",{className:"w-5 h-5 rounded bg-zinc-700"}),e.jsx("div",{className:"h-4 bg-zinc-700 rounded w-24"})]},i))})}function Oe({isOpen:n,onClose:i,odesliData:s,loading:r=!1,title:u,mode:w="mobile",position:y,zIndex:N=99999}){if(!n)return null;const c=s?ft.filter(a=>s.linksByPlatform[a.id]):[],d=a=>{if(!s)return;const v=s.linksByPlatform[a];v!=null&&v.url&&window.open(v.url,"_blank","noopener,noreferrer"),i()},f=(()=>{if(u)return u;if(!(s!=null&&s.entitiesByUniqueId))return"Loading...";const a=Object.values(s.entitiesByUniqueId);for(const v of a)if(v.title)return v.title;return"Loading..."})(),o=r||!s||c.length===0;if(w==="desktop"){const v=o?4:c.length,$=Math.min(400,v*44+48);let b=(y==null?void 0:y.x)||100,k=(y==null?void 0:y.y)||100;return b+220>window.innerWidth&&(b=window.innerWidth-220-10),k+$>window.innerHeight&&(k=window.innerHeight-$-10),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0",onClick:i,style:{zIndex:N-1}}),e.jsxs("div",{className:"fixed bg-zinc-900 border border-zinc-700 rounded-lg shadow-2xl py-2 min-w-[200px]",style:{left:b,top:k,zIndex:N},onClick:M=>M.stopPropagation(),children:[e.jsx("div",{className:"px-4 pb-2 mb-1 border-b border-zinc-700",children:e.jsx("div",{className:"text-sm font-medium text-white truncate",children:f})}),o?e.jsx(ht,{}):e.jsx("div",{className:"space-y-0",children:c.map(M=>e.jsxs("button",{onClick:()=>d(M.id),className:"w-full flex items-center gap-3 px-4 py-2.5 hover:bg-zinc-800 transition-colors text-left",children:[e.jsx("span",{className:"text-white flex-shrink-0",children:Ie[M.id]||e.jsx("span",{className:"w-5 h-5 flex items-center justify-center text-xs",children:"ðŸŽµ"})}),e.jsx("span",{className:"flex-1 text-sm text-white",children:M.name})]},M.id))})]})]})}return e.jsx(Ve,{isOpen:n,onClose:i,zIndex:N,children:e.jsxs("div",{className:"pb-6",children:[e.jsx("div",{className:"mb-4 ml-4",children:e.jsx("div",{className:"text-lg font-semibold text-white break-words",children:f})}),o?e.jsx("div",{className:"animate-pulse space-y-1",children:[...Array(4)].map((a,v)=>e.jsxs("div",{className:"flex items-center gap-4 pl-4 pr-4 py-3",children:[e.jsx("div",{className:"w-5 h-5 rounded bg-zinc-700"}),e.jsx("div",{className:"h-4 bg-zinc-700 rounded w-28"})]},v))}):e.jsx("div",{className:"space-y-1",children:c.map(a=>e.jsxs("button",{onClick:()=>d(a.id),className:"w-full flex items-center gap-4 pl-4 pr-4 py-3 rounded-lg hover:bg-white/10 transition-colors",children:[e.jsx("span",{className:"text-white",children:Ie[a.id]||e.jsx("span",{className:"w-5 h-5 flex items-center justify-center text-xs",children:"ðŸŽµ"})}),e.jsx("span",{className:"flex-1 text-left text-white font-medium",children:a.name})]},a.id))})]})})}function pt(){const[n,i]=t.useState(()=>U.persist.hasHydrated());return t.useEffect(()=>{if(U.persist.hasHydrated()){i(!0);return}return U.persist.onFinishHydration(()=>{i(!0)})},[]),n}function ee(n){return n.toLowerCase().replace(/[^a-z0-9]/g,"")}function me(n){return n.replace(/\s*\(feat\..*?\)/gi,"").replace(/\s*\[feat\..*?\]/gi,"").replace(/\s*ft\..*$/gi,"").replace(/\s*\(with.*?\)/gi,"").replace(/\s*\[with.*?\]/gi,"").replace(/\s*\(explicit\)/gi,"").replace(/\s*\[explicit\]/gi,"").replace(/\s*\(deluxe.*?\)/gi,"").replace(/\s*\[deluxe.*?\]/gi,"").replace(/\s*-\s*single$/gi,"").replace(/\s*-\s*ep$/gi,"").trim()}function Pe(n){return n.split(/[,&]/)[0].replace(/\s*feat\..*$/gi,"").replace(/\s*ft\..*$/gi,"").replace(/\s*with\s+.*$/gi,"").trim()}function Ee(){const n=U(c=>c.songs),i=U(c=>c.genreSongs),s=pt(),r=t.useMemo(()=>{var m,f;if(!s)return new Map;let c=n;if(c.length===0&&i){const o=new Set;c=Object.values(i).flat().filter(a=>o.has(a.Id)?!1:(o.add(a.Id),!0))}const d=new Map;for(const o of c){const a=ee(Pe(o.AlbumArtist||((f=(m=o.ArtistItems)==null?void 0:m[0])==null?void 0:f.Name)||""));a&&(d.has(a)||d.set(a,[]),d.get(a).push(o))}return d},[n,i,s]),u=c=>{const d=ee(Pe(c));if(!d)return null;if(r.has(d))return r.get(d);for(const[m,f]of r)if(m.includes(d)||d.includes(m))return f;return null};return{findSong:(c,d)=>{const m=u(d);if(!m)return null;const f=ee(me(c));if(!f)return null;for(const o of m){const a=ee(me(o.Name||""));if(a===f||a.includes(f)||f.includes(a))return o}return null},findAlbum:(c,d)=>{const m=u(d);if(!m)return null;const f=ee(me(c));if(!f)return null;for(const o of m){if(!o.AlbumId||!o.Album)continue;const a=ee(me(o.Album));if(a===f||a.includes(f)||f.includes(a))return{albumId:o.AlbumId,albumName:o.Album}}return null},findArtistImageUrl:c=>{var f,o,a;const d=u(c);return!d||d.length===0?null:((a=(o=(f=d[0])==null?void 0:f.ArtistItems)==null?void 0:o[0])==null?void 0:a.Id)||null},artistIndex:r}}function ve({title:n,subtitle:i,artworkUrl:s,fallbackArtworkUrl:r,secondFallbackUrl:u,rank:w,isCurrentTrack:y,isInLibrary:N,isMenuOpen:c,subtitleIcon:d,onClick:m,onContextMenu:f,onLongPress:o,onExternalClick:a}){const[v,$]=t.useState(!1),[b,k]=t.useState(!1),[M,g]=t.useState(!1);t.useEffect(()=>{$(!1),k(!1),g(!1)},[s]);let x=s;M&&u?x=u:b&&r&&(x=r);const P=()=>{!b&&r?k(!0):!M&&u?g(!0):$(!0)},z=ze({onLongPress:S=>{S.preventDefault(),o==null||o(S)},onClick:S=>m(S)});return e.jsxs("button",{onClick:S=>m(S),onContextMenu:f,...z,className:`w-full flex items-center gap-3 hover:bg-white/10 transition-colors group py-2.5 ${c?"bg-white/10":""}`,children:[e.jsx("div",{className:"w-12 h-12 rounded-sm overflow-hidden flex-shrink-0 bg-zinc-900 self-center flex items-center justify-center",children:v?e.jsx(be,{className:"w-6 h-6 text-gray-500"}):e.jsx($e,{src:x,alt:n,className:"w-full h-full object-cover",showOutline:!0,rounded:"rounded-sm",onError:P})}),e.jsxs("div",{className:"flex-1 min-w-0 text-left flex gap-3 items-baseline",children:[w!==void 0&&e.jsx("span",{className:"text-zinc-500 text-sm flex-shrink-0",children:w}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium truncate text-white group-hover:text-[var(--accent-color)] transition-colors",children:n}),e.jsxs("div",{className:"text-xs text-gray-400 truncate flex items-center gap-1.5",children:[i,d&&e.jsx("span",{className:"flex-shrink-0",children:d})]})]})]}),!N&&a&&e.jsx("div",{onClick:S=>{S.stopPropagation(),a(S)},className:"flex-shrink-0 p-2 text-gray-400 hover:text-white cursor-pointer",children:e.jsx(Qe,{className:"w-4 h-4"})})]})}function Fe(){return e.jsx("div",{className:"animate-pulse",children:[...Array(5)].map((n,i)=>e.jsxs("div",{className:"flex items-center gap-3 py-2.5",children:[e.jsx("div",{className:"w-12 h-12 rounded-sm bg-zinc-800"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-4 bg-zinc-800 rounded w-3/4 mb-1.5"}),e.jsx("div",{className:"h-3 bg-zinc-800 rounded w-1/2"})]})]},i))})}function xt(){const{playTrack:n}=te(),{feedTopSongs:i,feedLastUpdated:s,loading:r,setFeedTopSongs:u,setFeedLastUpdated:w,setLoading:y}=U(),{feedCountry:N,showTop10:c}=ge(),{findSong:d}=Ee(),[m,f]=t.useState(!1),[o,a]=t.useState("mobile"),[v,$]=t.useState(null),[b,k]=t.useState(null),[M,g]=t.useState(!1),[x,P]=t.useState(!1),[z,S]=t.useState(null),[_,D]=t.useState(null),[H,Y]=t.useState(!1),[B,Q]=t.useState("mobile"),[E,q]=t.useState(null),[V,W]=t.useState(null),[J,G]=t.useState(null),Z=t.useCallback(async(j=!1)=>{const O=Date.now();if(!(!j&&s&&O-s<he)){y("feed",!0),P(!1);try{const R=await ot(N,10);u(R),w(O)}catch(R){console.error("Failed to fetch top songs:",R),P(!0)}finally{y("feed",!1)}}},[N,s,u,w,y]);t.useEffect(()=>{if(c){const j=Date.now();(!s||j-s>=he)&&Z(!0)}},[c,N]);const se=async(j,O,R)=>{if(O){const T=await L.getSongById(O.Id);T&&n(T)}else await X(j,R)},X=async(j,O)=>{const R=!window.matchMedia("(hover: hover) and (pointer: fine)").matches;a(R?"mobile":"desktop"),R||$({x:O.clientX,y:O.clientY}),S(j.name),D(j.id),g(!0),f(!0);try{const T=await Le(j.url);if(T&&Object.keys(T.linksByPlatform).length>0)k(T);else{const h=pe(j.artistName,j.name);k(h)}}catch{const T=pe(j.artistName,j.name);k(T)}finally{g(!1)}};if(!c)return null;const K=i.length>0,le=r.feed&&!K&&!x;return e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-xl font-bold mb-2",children:"Top 10"}),le?e.jsx(Fe,{}):K?e.jsx("div",{className:"space-y-0",children:i.map((j,O)=>{const R=d(j.name,j.artistName),T=R!==null;return e.jsx(ve,{rank:O+1,title:j.name,subtitle:j.artistName,artworkUrl:T&&R.AlbumId?L.getAlbumArtUrl(R.AlbumId,96):ct(j.artworkUrl100,96),isInLibrary:T,isMenuOpen:J===j.id||_===j.id&&m,onClick:h=>se(j,R,h),onContextMenu:async h=>{if(h.preventDefault(),R){const l=await L.getSongById(R.Id);l&&(W(l),G(j.id),Q("desktop"),q({x:h.clientX,y:h.clientY}),Y(!0))}},onLongPress:async()=>{if(R){const h=await L.getSongById(R.Id);h&&(W(h),G(j.id),Q("mobile"),q(null),Y(!0))}},onExternalClick:h=>X(j,h)},j.id)})}):e.jsx("div",{className:"py-8 text-left text-gray-500 text-sm",children:"Could not load charts"}),e.jsx(Oe,{isOpen:m,onClose:()=>{f(!1),k(null),D(null)},odesliData:b,loading:M,title:z||void 0,mode:o,position:v||void 0}),e.jsx(xe,{item:V,itemType:"song",isOpen:H,onClose:()=>{Y(!1),W(null),G(null)},zIndex:99999,mode:B,position:E||void 0})]})}function gt(){const n=we(),{playTrack:i}=te(),{feedNewReleases:s,feedLastUpdated:r,loading:u,setFeedNewReleases:w,setFeedLastUpdated:y,setLoading:N}=U(),{showNewReleases:c,muspyRssUrl:d}=ge(),{findAlbum:m,findSong:f,findArtistImageUrl:o}=Ee(),[a,v]=t.useState(!1),[$,b]=t.useState("mobile"),[k,M]=t.useState(null),[g,x]=t.useState(null),[P,z]=t.useState(!1),[S,_]=t.useState(!1),[D,H]=t.useState(null),[Y,B]=t.useState(null),[Q,E]=t.useState(!1),[q,V]=t.useState("mobile"),[W,J]=t.useState(null),[G,Z]=t.useState(null),[se,X]=t.useState(null),K=t.useCallback(async(l=!1)=>{if(!d)return;const C=Date.now();if(!(!l&&r&&C-r<he)){N("feed",!0),_(!1);try{const p=await mt(d,10);w(p),y(C)}catch(p){console.error("Failed to fetch Muspy releases:",p),_(!0)}finally{N("feed",!1)}}},[d,r,w,y,N]);t.useEffect(()=>{if(c&&d){const l=Date.now();(!r||l-r>=he)&&K(!0)}},[c,d]);const ne=t.useRef(new Set);t.useEffect(()=>{const l=async()=>{const C=s.filter(p=>p.id.startsWith("muspy-")&&!ne.current.has(p.id));if(C.length!==0)for(const p of C){ne.current.add(p.id);try{console.log(`[FeedSection] Searching MB for: ${p.title} - ${p.artistName}`);const I=await ut(p.artistName,p.title);if(I){console.log(`[FeedSection] Found MBID for "${p.title}": ${I.id} (${I.type})`);const ae=U.getState().feedNewReleases.map(oe=>oe.id===p.id?{...oe,id:I.id,type:I.type}:oe);w(ae)}else console.log(`[FeedSection] No MBID found for "${p.title}"`)}catch(I){console.error(`[FeedSection] Failed to search MB for "${p.title}":`,I)}}};s.length>0&&l()},[s,w]);const le=async(l,C,p)=>{if(C)if(C.type==="song"){const I=await L.getSongById(C.song.Id);I&&i(I)}else n(`/album/${C.albumId}`);else await j(l,p)},j=async(l,C)=>{const p=!window.matchMedia("(hover: hover) and (pointer: fine)").matches;b(p?"mobile":"desktop"),p||M({x:C.clientX,y:C.clientY}),H(l.title),B(l.id),z(!0),v(!0);const I=l.mbUrl&&!l.id.startsWith("muspy-");try{let A=null;if(I&&(A=await Le(l.mbUrl)),A&&Object.keys(A.linksByPlatform).length>0)x(A);else{const ae=pe(l.artistName,l.title);x(ae)}}catch{const A=pe(l.artistName,l.title);x(A)}finally{z(!1)}};if(!c||!d)return null;const O=s.length>0,R=u.feed,T=!!d,h=R&&!O&&!S&&T;return e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-xl font-bold mb-2",children:"New Releases"}),h?e.jsx(Fe,{}):O?e.jsx("div",{className:"space-y-0",children:s.map(l=>{const C=l.type==="Single",p=C?f(l.title,l.artistName):null,I=p?null:m(l.title,l.artistName),A=p?{type:"song",song:p}:I?{type:"album",albumId:I.albumId}:null,ae=A!==null,ce=!l.id.startsWith("muspy-")?Te(l.id,250):null,je=o(l.artistName),de=je?L.getArtistImageUrl(je,96):null;let re,ue,ye;(A==null?void 0:A.type)==="song"&&(p!=null&&p.AlbumId)?(re=L.getAlbumArtUrl(p.AlbumId,96),ue=ce||void 0,ye=de||void 0):(A==null?void 0:A.type)==="album"&&(I!=null&&I.albumId)?(re=L.getAlbumArtUrl(I.albumId,96),ue=ce||void 0,ye=de||void 0):ce?(re=ce,ue=de||void 0):re=de||"";const Ne=new Date(l.releaseDate),Me=!isNaN(Ne.getTime())?Ne.toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",Ue=Me?`${l.artistName} â€¢ ${Me}`:l.artistName,Be=C?e.jsx(We,{className:"w-3 h-3"}):e.jsx(be,{className:"w-3 h-3"});return e.jsx(ve,{title:l.title,subtitle:Ue,subtitleIcon:Be,artworkUrl:re,fallbackArtworkUrl:ue,secondFallbackUrl:ye,isInLibrary:ae,isMenuOpen:se===l.id||Y===l.id&&a,onClick:F=>le(l,A,F),onContextMenu:async F=>{if(F.preventDefault(),(A==null?void 0:A.type)==="song"&&p){const ie=await L.getSongById(p.Id);ie&&(Z(ie),X(l.id),V("desktop"),J({x:F.clientX,y:F.clientY}),E(!0))}else if((A==null?void 0:A.type)==="album"&&I){const ie=await L.getAlbumById(I.albumId);ie&&(Z(ie),X(l.id),V("desktop"),J({x:F.clientX,y:F.clientY}),E(!0))}},onLongPress:async()=>{if((A==null?void 0:A.type)==="song"&&p){const F=await L.getSongById(p.Id);F&&(Z(F),X(l.id),V("mobile"),J(null),E(!0))}else if((A==null?void 0:A.type)==="album"&&I){const F=await L.getAlbumById(I.albumId);F&&(Z(F),X(l.id),V("mobile"),J(null),E(!0))}},onExternalClick:F=>j(l,F)},l.id)})}):T?e.jsx("div",{className:"py-8 text-left text-gray-500 text-sm",children:S?"Failed to load releases":"No new releases found"}):e.jsx("div",{className:"py-8 text-center text-gray-500 text-sm",children:"Configure Muspy RSS in settings"}),e.jsx(Oe,{isOpen:a,onClose:()=>{v(!1),x(null),B(null)},odesliData:g,loading:P,title:D||void 0,mode:$,position:k||void 0}),e.jsx(xe,{item:G,itemType:(G==null?void 0:G.Type)==="Audio"?"song":"album",isOpen:Q,onClose:()=>{E(!1),Z(null),X(null)},zIndex:99999,mode:q,position:W||void 0})]})}function yt({twoColumns:n=!1}){const{recentlyPlayed:i,setRecentlyPlayed:s,setLoading:r}=U(),{showRecentlyPlayed:u}=ge(),{playTrack:w}=te(),y=Ye(),[N,c]=t.useState(!1),[d,m]=t.useState("mobile"),[f,o]=t.useState(null),[a,v]=t.useState(null);t.useEffect(()=>{u&&(async()=>{r("recentlyPlayed",!0);try{const k=await L.getRecentlyPlayed(10);s(k.Items||[])}catch(k){console.error(k)}finally{r("recentlyPlayed",!1)}})()},[u,s,r]);const $=b=>{w(b,i)};return!u||!i||i.length===0?null:e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-xl font-bold mb-2",children:"Recently Played"}),e.jsx("div",{className:n?"md:grid md:grid-cols-2 md:gap-3 min-[1680px]:block":"",children:i.map(b=>{var k,M;return e.jsx(ve,{title:b.Name||"Unknown",subtitle:`${b.AlbumArtist||((M=(k=b.ArtistItems)==null?void 0:k[0])==null?void 0:M.Name)||"Unknown Artist"}${b.Album?` â€¢ ${b.Album}`:""}`,artworkUrl:L.getAlbumArtUrl(b.AlbumId||b.Id,96),isCurrentTrack:(y==null?void 0:y.Id)===b.Id,isInLibrary:!0,isMenuOpen:(a==null?void 0:a.Id)===b.Id,onClick:()=>$(b),onContextMenu:g=>{g.preventDefault(),v(b),m("desktop"),o({x:g.clientX,y:g.clientY}),c(!0)},onLongPress:()=>{v(b),m("mobile"),o(null),c(!0)}},b.Id)})}),e.jsx(xe,{item:a,itemType:"song",isOpen:N,onClose:()=>{c(!1),v(null)},zIndex:99999,mode:d,position:f||void 0})]})}function Nt(){const[n,i]=t.useState(!1),{recentlyAdded:s,recentlyPlayed:r,loading:u}=U(),{showTop10:w,showNewReleases:y,showRecentlyPlayed:N,muspyRssUrl:c}=ge(),d=t.useRef(!1),{isQueueSidebarOpen:m}=te();t.useEffect(()=>{(u.recentlyAdded||u.recentlyPlayed)&&(d.current=!0)},[u.recentlyAdded,u.recentlyPlayed]);const o=[w,y&&!!c,N].filter(Boolean).length,a=d.current&&!u.recentlyAdded&&!u.recentlyPlayed&&s.length===0&&r.length===0;return e.jsxs("div",{className:"pb-20",children:[e.jsx("div",{className:`fixed top-0 left-0 right-0 bg-black z-10 lg:left-16 transition-[left,right] duration-300 ${m?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top))"},children:e.jsx("div",{className:"max-w-[768px] min-[1680px]:max-w-[1080px] w-full mx-auto",children:e.jsx(st,{onSearchStateChange:i})})}),e.jsx("div",{className:`fixed left-0 right-0 z-[60] lg:left-16 transition-[left,right] duration-300 ${m?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 4.5rem - 2px)",height:"24px",background:"linear-gradient(to bottom, rgba(0, 0, 0, 0.8), transparent)"}}),e.jsx("div",{className:n?"hidden [@media((hover:hover)_and_(pointer:fine)_and_(min-width:1024px))]:block":"",style:{paddingTop:"calc(env(safe-area-inset-top) + 4.5rem + 24px)"},children:e.jsxs("div",{className:"w-full",children:[e.jsx("div",{className:"pb-4",children:e.jsx(nt,{})}),o>0&&e.jsxs("div",{className:`
              mt-4 px-4
              ${o>=2?"md:grid md:gap-3":""}
              ${o===2?"md:grid-cols-2":""}
              ${o>=3?"md:grid-cols-2 min-[1680px]:grid-cols-3":""}
            `,children:[N&&e.jsx("div",{className:o===3?"md:col-span-2 min-[1680px]:col-span-1":"",children:e.jsx(yt,{twoColumns:o===3})}),w&&e.jsx("div",{children:e.jsx(xt,{})}),y&&e.jsx("div",{children:e.jsx(gt,{})})]}),a&&e.jsx("div",{className:"flex items-center justify-center py-16 text-gray-400",children:e.jsx("p",{children:"No music found"})})]})})]})}export{Nt as default};
