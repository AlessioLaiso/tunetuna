import{b as ie,r as s,f as ke,j as t,I as Oe,e as G,C as ce,u as d,a as M,d as Te,l as oe,o as Le}from"./index-CYP8MbMQ.js";import{P as Re}from"./Pagination-DTlpEmXp.js";import{u as Fe,F as ae}from"./useSearch-aA9_kEm9.js";import{S as De}from"./search-nOvPuA3A.js";import{A as Ye}from"./arrow-up-down-CQL7NhOq.js";import"./chevron-right-DDON67Yh.js";import"./tag-Cl7DAqNB.js";import"./piano-C8jGzXQo.js";function _e({album:o,onContextMenu:m,contextMenuItemId:E,showImage:k=!0}){var w,A;const v=ie(),[x,y]=s.useState(!1),[O,b]=s.useState("mobile"),[T,l]=s.useState(null),a=s.useRef(!1),L=E===o.Id,C=r=>{if(a.current){r.preventDefault(),a.current=!1;return}v(`/album/${o.Id}`)},R=r=>{var f,j,p,h;r.preventDefault(),r.stopPropagation(),(j=(f=r.nativeEvent)==null?void 0:f.preventDefault)==null||j.call(f),(h=(p=r.nativeEvent)==null?void 0:p.stopImmediatePropagation)==null||h.call(p),a.current=!0,m?m(o,"album","desktop",{x:r.clientX,y:r.clientY}):(b("desktop"),l({x:r.clientX,y:r.clientY}),y(!0)),setTimeout(()=>{a.current=!1},300)},F=ke({onLongPress:r=>{r.preventDefault(),m?(a.current=!0,m(o,"album","mobile")):(a.current=!0,b("mobile"),l(null),y(!0))}});return t.jsxs(t.Fragment,{children:[t.jsxs("button",{onClick:r=>{if(x||a.current){r.preventDefault(),r.stopPropagation();return}C(r)},onContextMenu:r=>{R(r)},...F,className:`text-left group ${L?"ring-2 ring-blue-500":""}`,children:[t.jsx("div",{className:"aspect-square rounded overflow-hidden bg-zinc-900 relative flex items-center justify-center",children:k?t.jsx(Oe,{src:G.getAlbumArtUrl(o.Id,474),alt:o.Name,className:"w-full h-full object-cover",showOutline:!0,rounded:"rounded"}):t.jsx("div",{className:"w-full h-full bg-zinc-900"})}),t.jsx("div",{className:"text-sm font-medium text-white truncate group-hover:text-[var(--accent-color)] transition-colors",children:o.Name}),t.jsx("div",{className:"text-xs text-gray-400 truncate",children:o.AlbumArtist||((A=(w=o.ArtistItems)==null?void 0:w[0])==null?void 0:A.Name)||"Unknown Artist"})]}),t.jsx(ce,{item:o,itemType:"album",isOpen:x,onClose:()=>y(!1),mode:O,position:T||void 0})]})}const Be=[{type:"albums"},{type:"artists",limit:5},{type:"playlists"},{type:"songs"}],P=84,le=45,$e=45;function Ke(){const o=d(e=>e.albums),m=d(e=>e.setAlbums),E=d(e=>e.sortPreferences),k=d(e=>e.setSortPreference),v=d(e=>e.setLoading),x=d(e=>e.loading),y=d(e=>e.genres),O=M(e=>e.playTrack),b=M(e=>e.playAlbum),T=M(e=>e.addToQueue),[l,a]=s.useState(!1),[L,C]=s.useState(!1),[R,F]=s.useState("mobile"),[w,A]=s.useState(null),[r,f]=s.useState(null),[j,p]=s.useState(null),[h,Q]=s.useState(0),[z,H]=s.useState(0),[ue,V]=s.useState(le),D=ie(),[U,X]=Te(),J=s.useRef(null),K=s.useRef(null),[W,Y]=s.useState(!1),[q,de]=s.useState(null),[me,Z]=s.useState([]),i=E.albums,N=s.useRef(!0),[fe,ee]=s.useState(!1),te=s.useRef(i),_=M(e=>e.isQueueSidebarOpen),{searchQuery:S,setSearchQuery:pe,isSearching:he,searchResults:c,selectedGenres:se,setSelectedGenres:ge,yearRange:ne,setYearRange:B,clearSearch:I,clearAll:xe}=Fe();s.useEffect(()=>{const e=U.get("year");if(e){const n=parseInt(e,10);!isNaN(n)&&n>0&&(B({min:n,max:n}),a(!0),X({},{replace:!0}))}},[U,X,B]),s.useEffect(()=>{(async()=>{try{const n=d.getState();if(n.years.length>0)Z(n.years);else{const u=await G.getYears();Z(u)}}catch(n){oe.error("Failed to load filter values:",n)}})()},[]),s.useEffect(()=>{if(l){const n=window.matchMedia("(hover: hover) and (pointer: fine) and (min-width: 1024px)").matches?K:J;setTimeout(()=>{var u;if((u=n.current)==null||u.focus(),n.current){const g=n.current.value.length;n.current.setSelectionRange(g,g)}},50)}},[l]),s.useEffect(()=>{if(!l)return;const e=n=>{n.key==="Escape"&&(n.preventDefault(),n.stopPropagation(),re())};return window.addEventListener("keydown",e,!0),()=>window.removeEventListener("keydown",e,!0)},[l]);const ye=e=>{pe(e),e.trim().length>0&&!l&&a(!0)},Se=()=>{I()},re=()=>{a(!1),xe()},ve=e=>{de(e),Y(!0)},be=e=>{ge(e)},Ce=e=>{B(e)},we=e=>{D(`/artist/${e}`),a(!1),I()},Ae=e=>{D(`/album/${e}`),a(!1),I()},je=e=>{O(e,[e])},Ne=()=>{c!=null&&c.songs&&c.songs.length>0&&b(c.songs)},Ie=()=>{c!=null&&c.songs&&c.songs.length>0&&T(c.songs)},Me=e=>{D(`/playlist/${e}`),a(!1),I()},Pe=(e,n,u="mobile",g)=>{f(e),p(n),F(u),A(g||null),C(!0)};s.useEffect(()=>{const e=n=>{};return document.addEventListener("contextmenu",e,!0),()=>{document.removeEventListener("contextmenu",e,!0)}},[]),s.useEffect(()=>{S.trim()||Q(0)},[i,S]),s.useEffect(()=>{V(le)},[h,o.length]);const $=s.useCallback(()=>{const e=window.scrollY||document.documentElement.scrollTop,n=window.innerHeight||document.documentElement.clientHeight,u=document.documentElement.scrollHeight;e+n*1.5>=u&&V(g=>Math.min(g+$e,o.length))},[o.length]);s.useEffect(()=>(window.addEventListener("scroll",$,{passive:!0}),()=>{window.removeEventListener("scroll",$)}),[$]),s.useEffect(()=>{S.trim()||(!N.current&&te.current!==i&&ee(!0),te.current=i,Ee())},[h,i,S]),s.useEffect(()=>{N.current&&(N.current=!1)},[]);const Ee=async()=>{v("albums",!0);try{const e={limit:P,startIndex:h*P};i==="RecentlyAdded"?(e.sortBy=["DateCreated"],e.sortOrder="Descending"):i==="Newest"?(e.sortBy=["ProductionYear","SortName"],e.sortOrder=["Descending","Ascending"]):(e.sortBy=["SortName"],e.sortOrder="Ascending");const n=await G.getAlbums(e);m(n.Items),H(n.TotalRecordCount||0)}catch(e){oe.error("Failed to load albums:",e),m([]),H(0)}finally{v("albums",!1),ee(!1)}};return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"pb-20",children:[t.jsx("div",{className:`fixed top-0 left-0 right-0 bg-black z-10 lg:left-16 transition-[left,right] duration-300 ${_?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top))"},children:t.jsx("div",{className:"max-w-[768px] mx-auto",children:t.jsxs("div",{className:"p-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsx("h1",{className:"text-2xl font-bold text-white",children:"Albums"}),t.jsx("button",{onClick:()=>a(!0),className:"w-10 h-10 flex items-center justify-center text-white hover:bg-zinc-800 rounded-full transition-colors","aria-label":"Search",children:t.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})]}),!l&&t.jsxs("div",{className:"flex items-center justify-between gap-2",children:[t.jsxs("button",{onClick:()=>{k("albums",i==="RecentlyAdded"?"Alphabetical":i==="Alphabetical"?"Newest":"RecentlyAdded")},className:"text-sm text-gray-400 hover:text-white transition-colors flex items-center gap-1",children:[i==="RecentlyAdded"?"Recently Added":i==="Newest"?"Newest":"Alphabetically",t.jsx(Ye,{className:"w-4 h-4"})]}),x.albums&&!N.current&&t.jsx("div",{className:"flex items-center",children:t.jsx(Le,{})})]})]})})}),t.jsx("div",{className:`fixed left-0 right-0 z-10 lg:left-16 transition-[left,right] duration-300 ${_?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 7rem - 8px)",height:"24px",background:"linear-gradient(to bottom, rgba(0, 0, 0, 0.8), transparent)"}}),t.jsx("div",{style:{paddingTop:"calc(env(safe-area-inset-top) + 7rem)"},onContextMenu:e=>{},children:t.jsx("div",{className:`${fe?"opacity-50 pointer-events-none":""} ${l?"hidden [@media((hover:hover)_and_(pointer:fine)_and_(min-width:1024px))]:block":""}`,onContextMenu:e=>{},children:o.length===0&&!x.albums?t.jsx("div",{className:"flex items-center justify-center py-16 text-gray-400",children:t.jsx("p",{children:"No albums found"})}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"p-4",children:t.jsx("div",{className:"grid grid-cols-3 md:grid-cols-4 gap-3",onContextMenu:e=>{},children:o.map((e,n)=>t.jsx(_e,{album:e,onContextMenu:Pe,contextMenuItemId:(r==null?void 0:r.Id)||null,showImage:n<ue},e.Id))})}),t.jsx(Re,{currentPage:h,totalPages:Math.ceil(z/P),onPageChange:Q,itemsPerPage:P,totalItems:z})]})})})]}),t.jsx(De,{isOpen:l,onClose:re,title:"Search",searchQuery:S,onSearchChange:ye,onClearSearch:Se,isLoading:he,results:c,sections:Be,filterConfig:{showGenreFilter:!0,showYearFilter:!0,showGroupingFilters:!1},filterState:{selectedGenres:se,yearRange:ne,selectedGroupings:{}},onOpenFilterSheet:ve,onArtistClick:we,onAlbumClick:Ae,onSongClick:je,onPlaylistClick:Me,onPlayAllSongs:Ne,onAddSongsToQueue:Ie,isQueueSidebarOpen:_,desktopSearchInputRef:K,mobileSearchInputRef:J}),q==="genre"&&t.jsx(ae,{isOpen:W,onClose:()=>Y(!1),filterType:"genre",genres:y,selectedValues:se,onApply:be}),q==="year"&&t.jsx(ae,{isOpen:W,onClose:()=>Y(!1),filterType:"year",availableYears:me,yearRange:ne,onApplyYear:Ce}),t.jsx(ce,{item:r,itemType:j,isOpen:L,onClose:()=>{C(!1),f(null),p(null)},zIndex:99999,mode:R,position:w||void 0})]})}export{Ke as default};
