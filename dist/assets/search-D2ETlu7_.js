import{c as de,r as l,j as e,e as w,l as me,f as xe,U as O,n as he,C as fe,G as pe,P as ge,L as be,o as k}from"./index-Kr6dcGJx.js";/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],ye=de("calendar",ve),q=l.forwardRef(({value:t,onChange:s,placeholder:c="Search...",debounceMs:r=150,showClearButton:h=!1,onClear:m},u)=>{const[n,x]=l.useState(t),a=l.useRef(s),i=l.useRef(null),d=f=>{i.current=f,typeof u=="function"?u(f):u&&(u.current=f)};return l.useEffect(()=>{a.current=s},[s]),l.useEffect(()=>{const f=setTimeout(()=>{a.current(n)},r);return()=>clearTimeout(f)},[n,r]),l.useEffect(()=>{t===""&&n!==""&&x(t)},[t]),e.jsxs("div",{className:"relative",children:[e.jsx("input",{ref:d,type:"text",value:n,onChange:f=>{x(f.target.value)},placeholder:c,className:"w-full px-4 py-2 pl-10 pr-10 bg-zinc-900 border border-zinc-800 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-[var(--accent-color)] focus:border-transparent"}),e.jsx("svg",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),e.jsx("button",{onClick:f=>{f.preventDefault(),f.stopPropagation(),x(""),m&&m(),setTimeout(()=>{var j;(j=i.current)==null||j.focus()},0)},className:`absolute right-3 top-1/2 transform -translate-y-1/2 w-5 h-5 transition-opacity ${h&&n?"text-gray-400 hover:text-white opacity-100 pointer-events-auto":"opacity-0 pointer-events-none"}`,"aria-label":"Clear search",type:"button",children:e.jsx("svg",{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",className:"w-full h-full",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})});q.displayName="SearchInput";const K=500,I=new Map,U=new Map;function Z(){if(I.size>K){const t=Array.from(I.keys()).slice(0,I.size-K);for(const s of t)I.delete(s)}}async function we(t){if(I.has(t))return I.get(t)??null;if(U.has(t))return U.get(t);const s=(async()=>{try{const{albums:c,songs:r}=await w.getArtistItems(t),h=c[0],m=r.find(a=>a.AlbumId)||r[0],u=h||m,n=u?u.AlbumId||u.Id:null,x=n?w.getAlbumArtUrl(n,96):null;return I.set(t,x),Z(),x}catch(c){return me.error("Failed to load fallback album art for artist:",t,c),I.set(t,null),Z(),null}finally{U.delete(t)}})();return U.set(t,s),s}function je(t){return I.get(t)}const Ne=l.memo(function({artist:s,onClick:c,onContextMenu:r,contextMenuItemId:h}){var R;const[m,u]=l.useState(!1),n=l.useRef(!1),x=h===s.Id,[a,i]=l.useState(null);l.useEffect(()=>{var o;if((o=s.ImageTags)!=null&&o.Primary){i(null);return}const p=je(s.Id);if(p!==void 0){i(p);return}let z=!1;return we(s.Id).then(M=>{z||i(M)}),()=>{z=!0}},[s.Id,s.ImageTags]);const d=p=>{if(x||n.current){p.preventDefault(),p.stopPropagation(),n.current=!1;return}c(s.Id)},f=p=>{p.preventDefault(),p.stopPropagation(),n.current=!0,r(s,"artist","desktop",{x:p.clientX,y:p.clientY}),setTimeout(()=>{n.current=!1},300)},j=xe({onLongPress:p=>{p.preventDefault(),n.current=!0,r(s,"artist","mobile")},onClick:d}),C=(R=s.ImageTags)!=null&&R.Primary?w.getArtistImageUrl(s.Id,96):a;return e.jsxs("button",{onClick:d,onContextMenu:f,...j,className:`w-full flex items-center gap-4 hover:bg-white/10 transition-colors text-left cursor-pointer px-4 h-[72px] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--accent-color)] focus-visible:ring-inset ${x?"bg-white/10":""}`,"aria-label":`Go to artist ${s.Name}`,children:[e.jsx("div",{className:"w-12 h-12 rounded-full overflow-hidden flex-shrink-0 bg-zinc-900 flex items-center justify-center",children:m?e.jsx(O,{className:"w-6 h-6 text-gray-500"}):C?e.jsx("img",{src:C,alt:s.Name,className:"w-full h-full object-cover",onError:()=>u(!0),loading:"lazy"}):e.jsx(O,{className:"w-6 h-6 text-gray-500"})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("div",{className:"text-base font-medium text-white truncate group-hover:text-[var(--accent-color)] transition-colors",children:s.Name})})]})});function ke({album:t,onClick:s,onContextMenu:c,contextMenuItemId:r}){var x,a;const h=l.useRef(!1),m=r===t.Id,u=i=>{if(m||h.current){i.preventDefault(),i.stopPropagation(),h.current=!1;return}s(t.Id)},n=i=>{i.preventDefault(),i.stopPropagation(),h.current=!0,c(t,"album","desktop",{x:i.clientX,y:i.clientY}),setTimeout(()=>{h.current=!1},300)};return e.jsxs("button",{onClick:u,onContextMenu:n,className:"text-left group",children:[e.jsxs("div",{className:"aspect-square rounded overflow-hidden mb-3 bg-zinc-900 shadow-lg relative flex items-center justify-center",children:[e.jsx("img",{src:w.getAlbumArtUrl(t.Id,474),alt:t.Name,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 pointer-events-none border border-white rounded",style:{borderColor:"rgba(255, 255, 255, 0.03)",borderWidth:"1px"}})]}),e.jsx("div",{className:"text-sm font-semibold text-white truncate mb-1",children:t.Name}),e.jsx("div",{className:"text-xs text-gray-400 truncate",children:t.AlbumArtist||((a=(x=t.ArtistItems)==null?void 0:x[0])==null?void 0:a.Name)||"Unknown Artist"})]})}function Ce({song:t,onClick:s,onContextMenu:c,contextMenuItemId:r,showImage:h=!0}){var i;const m=l.useRef(!1),u=r===t.Id,n=d=>{const f=Math.floor(d/1e7),j=Math.floor(f/60),C=f%60;return`${j}:${C.toString().padStart(2,"0")}`},x=d=>{if(u||m.current){d.preventDefault(),d.stopPropagation(),m.current=!1;return}s(t)},a=d=>{d.preventDefault(),d.stopPropagation(),m.current=!0,c(t,"song","desktop",{x:d.clientX,y:d.clientY}),setTimeout(()=>{m.current=!1},300)};return e.jsxs("button",{onClick:x,onContextMenu:a,className:`w-full flex items-center gap-3 hover:bg-white/10 transition-colors group px-4 py-3 ${u?"bg-white/10":""}`,children:[h&&e.jsx("div",{className:"w-12 h-12 rounded-sm overflow-hidden flex-shrink-0 bg-zinc-900 self-center",children:e.jsx("img",{src:w.getAlbumArtUrl(t.AlbumId||t.Id,96),alt:t.Name,className:"w-full h-full object-cover",loading:"lazy"})}),e.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[e.jsx("div",{className:"text-sm font-medium text-white truncate group-hover:text-[var(--accent-color)] transition-colors",children:t.Name}),e.jsx("div",{className:"text-xs text-gray-400 truncate",children:((i=t.ArtistItems)==null?void 0:i.map(d=>d.Name).join(", "))||t.AlbumArtist||"Unknown Artist"})]}),t.RunTimeTicks&&e.jsx("div",{className:"text-xs text-gray-500 flex-shrink-0",children:n(t.RunTimeTicks)})]})}function Ae({playlist:t,onClick:s,onContextMenu:c}){return e.jsxs("button",{onClick:()=>s(t.Id),onContextMenu:r=>{r.preventDefault(),r.stopPropagation(),c(t,"playlist","desktop",{x:r.clientX,y:r.clientY})},className:"w-full flex items-center gap-3 hover:bg-white/10 transition-colors group px-4 py-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-sm overflow-hidden flex-shrink-0 bg-zinc-900 self-center",children:e.jsx("img",{src:w.getAlbumArtUrl(t.Id,96),alt:t.Name,className:"w-full h-full object-cover",loading:"lazy"})}),e.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[e.jsx("div",{className:"text-sm font-medium text-white truncate group-hover:text-[var(--accent-color)] transition-colors",children:t.Name}),e.jsx("div",{className:"text-xs text-gray-400 truncate",children:t.ChildCount?`${t.ChildCount} tracks`:"Playlist"})]})]})}function Me({isOpen:t,onClose:s,title:c="Search",searchQuery:r,onSearchChange:h,onClearSearch:m,isLoading:u,results:n,sections:x,filterConfig:a,filterState:i,onOpenFilterSheet:d,onArtistClick:f,onAlbumClick:j,onSongClick:C,onPlaylistClick:R,onPlayAllSongs:p,onAddSongsToQueue:z,isQueueSidebarOpen:o=!1,desktopSearchInputRef:M,mobileSearchInputRef:S}){const T=l.useRef(null),P=l.useRef(null),L=M||T,y=S||P,[Q,Y]=l.useState(!1),[ee,B]=l.useState(!1);l.useEffect(()=>{if(t)B(!0),requestAnimationFrame(()=>{requestAnimationFrame(()=>{Y(!0)})});else{Y(!1);const g=setTimeout(()=>{B(!1)},200);return()=>clearTimeout(g)}},[t]);const[te,X]=l.useState(!1),[se,ne]=l.useState("mobile"),[re,le]=l.useState(null),[N,V]=l.useState(null),[ae,W]=l.useState(null),F=(g,b,D,E)=>{V(g),W(b),ne(D),le(E||null),X(!0)};l.useEffect(()=>{var g,b;t&&(window.matchMedia("(hover: hover) and (pointer: fine) and (min-width: 1024px)").matches?(g=L.current)==null||g.focus():(b=y.current)==null||b.focus())},[t,L,y]),l.useEffect(()=>{if(!t)return;const g=b=>{b.key==="Escape"&&s()};return window.addEventListener("keydown",g,!0),()=>window.removeEventListener("keydown",g,!0)},[t,s]);const $=a.showGenreFilter||a.showYearFilter,ie=n&&(n.artists.length>0||n.albums.length>0||n.songs.length>0||n.playlists&&n.playlists.length>0),oe=(g,b)=>{if(!n)return null;const{type:D,limit:E}=g,G=b?"":"-mx-4",_=b?"pl-2 pr-4":"";switch(D){case"artists":{const v=E?n.artists.slice(0,E):n.artists;return v.length===0?null:e.jsxs("div",{children:[e.jsx("h2",{className:`text-xl font-bold text-white mb-4 ${_}`,children:"Artists"}),e.jsx("div",{className:`space-y-0 ${G}`,children:v.map(A=>e.jsx(Ne,{artist:A,onClick:f,onContextMenu:F,contextMenuItemId:(N==null?void 0:N.Id)||null},A.Id))})]},"artists")}case"albums":{const v=E?n.albums.slice(0,E):n.albums;return v.length===0?null:e.jsxs("div",{className:b?_:"",children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Albums"}),e.jsx("div",{className:"grid grid-cols-3 md:grid-cols-4 gap-4",children:v.map(A=>e.jsx(ke,{album:A,onClick:j,onContextMenu:F,contextMenuItemId:(N==null?void 0:N.Id)||null},A.Id))})]},"albums")}case"songs":return n.songs.length===0?null:e.jsxs("div",{children:[e.jsxs("div",{className:`flex items-center justify-between mb-4 ${_}`,children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"Songs"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:p,className:"w-10 h-10 flex items-center justify-center text-white hover:bg-white/10 rounded-lg transition-colors","aria-label":"Play all songs",children:e.jsx(ge,{className:"w-5 h-5"})}),e.jsx("button",{type:"button",onClick:z,className:"w-10 h-10 flex items-center justify-center text-white hover:bg-white/10 rounded-lg transition-colors","aria-label":"Add all songs to queue",children:e.jsx(be,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:`space-y-0 ${G}`,children:n.songs.map((v,A)=>e.jsx(Ce,{song:v,onClick:C,onContextMenu:F,contextMenuItemId:(N==null?void 0:N.Id)||null,showImage:!0},v.Id))})]},"songs");case"playlists":{const v=n.playlists;return!v||v.length===0?null:e.jsxs("div",{children:[e.jsx("h2",{className:`text-xl font-bold text-white mb-4 ${_}`,children:"Playlists"}),e.jsx("div",{className:`space-y-0 ${G}`,children:v.map(A=>e.jsx(Ae,{playlist:A,onClick:R,onContextMenu:F},A.Id))})]},"playlists")}default:return null}},J=()=>$?e.jsxs(e.Fragment,{children:[a.showGenreFilter&&e.jsxs("button",{onClick:()=>d("genre"),className:`flex items-center gap-2 px-3 py-2 rounded-lg transition-colors ${i.selectedGenres.length>0?"bg-[var(--accent-color)] text-white":"bg-white/10 text-white hover:bg-white/20"}`,"aria-label":"Filter by genre",children:[e.jsx(pe,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Genre"})]}),a.showYearFilter&&e.jsxs("button",{onClick:()=>d("year"),className:`flex items-center gap-2 px-3 py-2 rounded-lg transition-colors ${i.yearRange.min!==null||i.yearRange.max!==null?"bg-[var(--accent-color)] text-white":"bg-white/10 text-white hover:bg-white/20"}`,"aria-label":"Filter by year",children:[e.jsx(ye,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Year"})]})]}):null,ce=()=>e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-zinc-800 border-t-[var(--accent-color)]"})}),ue=()=>e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 text-gray-400",children:[e.jsx("div",{className:"text-lg mb-2",children:"No results found"}),e.jsx("div",{className:"text-sm",children:"Try a different search term"})]}),H=g=>u?ce():n?ie?e.jsx("div",{className:"space-y-8",children:x.map(b=>oe(b,g))}):ue():e.jsx("div",{className:"flex flex-col items-center justify-center py-16 text-gray-400"});return ee?he.createPortal(e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`hidden [@media((hover:hover)_and_(pointer:fine)_and_(min-width:1024px))]:block fixed inset-0 z-[9998] bg-black/50 transition-opacity duration-200 ${Q?"opacity-100":"opacity-0"}`,onClick:s}),e.jsx("div",{className:`hidden [@media((hover:hover)_and_(pointer:fine)_and_(min-width:1024px))]:flex fixed top-0 left-16 z-[9999] justify-center pointer-events-none ${o?"":"right-0"}`,style:o?{right:"var(--sidebar-width)"}:void 0,children:e.jsxs("div",{className:"w-[768px] max-h-[80vh] overflow-y-auto bg-zinc-900 rounded-b-xl shadow-2xl pointer-events-auto border-l border-r border-b border-zinc-800",children:[e.jsxs("div",{className:"px-4 pt-4 pb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"text-lg font-semibold text-white",children:c}),e.jsx("button",{onClick:s,className:"px-3 py-1.5 text-white text-sm font-medium hover:bg-zinc-800 rounded-lg transition-colors",children:"Cancel"})]}),e.jsx(q,{ref:L,value:r,onChange:h,placeholder:"Search for artists, albums, songs...",showClearButton:r.trim().length>0,onClear:m})]}),$&&e.jsx("div",{className:"flex items-center gap-3 px-4 pt-3 pb-4",children:J()}),e.jsx("div",{className:"px-4 pb-8",children:H(!1)})]})}),e.jsxs("div",{className:"fixed inset-0 bg-black z-[9999] overflow-y-scroll p-0 m-0 [@media((hover:hover)_and_(pointer:fine)_and_(min-width:1024px))]:hidden",children:[e.jsx("div",{className:"fixed top-0 left-0 right-0 bg-black z-50 pointer-events-none",style:{height:"env(safe-area-inset-top)",top:"var(--header-offset, 0px)"}}),e.jsx("div",{className:"fixed top-0 left-0 right-0 bg-black z-10 pt-0 pb-0 w-full m-0",style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top))",height:"76px"},children:e.jsx("div",{className:"max-w-[768px] mx-auto w-full",children:e.jsxs("div",{className:"flex items-center gap-3 pl-2 pr-4 pt-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(q,{ref:y,value:r,onChange:h,showClearButton:r.trim().length>0,onClear:m})}),e.jsx("button",{onClick:s,className:"px-4 py-2 text-white text-sm font-medium hover:text-zinc-300 transition-colors whitespace-nowrap flex-shrink-0",children:"Cancel"})]})})}),e.jsxs("div",{className:"max-w-[768px] mx-auto w-full",style:{paddingTop:"calc(76px + env(safe-area-inset-top))"},children:[$&&e.jsx("div",{className:"sticky bg-black z-10 pt-3 pb-4",style:{top:"calc(76px + env(safe-area-inset-top))"},children:e.jsx("div",{className:"flex items-center gap-3 pl-2 pr-4",children:J()})}),$&&e.jsx("div",{className:`fixed left-0 right-0 z-[60] lg:left-16 transition-[left,right] duration-300 ${o?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 76px + 4rem)",height:"24px",background:"linear-gradient(to bottom, rgba(0, 0, 0, 0.8), transparent)"}}),e.jsx("div",{className:"pb-32",style:{paddingTop:$?"40px":"16px"},children:H(!0)})]})]}),e.jsx(fe,{item:N,itemType:ae,isOpen:te,onClose:()=>{X(!1),V(null),W(null)},zIndex:999999,mode:se,position:re||void 0})]}),document.body):null}async function Se(t,s,c){var C,R,p,z;const r=await w.search(t,s,c),h=((C=r.Songs)==null?void 0:C.Items)||[],m=((R=r.Albums)==null?void 0:R.Items)||[],u=((p=r.Artists)==null?void 0:p.Items)||[],n=((z=r.Playlists)==null?void 0:z.Items)||[],a=k(t).toLowerCase().trim(),i=h.filter(o=>{var T,P,L;if(k(o.Name||"").toLowerCase().includes(a))return!0;const S=[];return o.AlbumArtist&&S.push(k(o.AlbumArtist)),(T=o.AlbumArtists)!=null&&T.length&&S.push(...o.AlbumArtists.map(y=>k(y.Name||"")).filter(Boolean)),(P=o.ArtistItems)!=null&&P.length&&S.push(...o.ArtistItems.map(y=>k(y.Name||"")).filter(Boolean)),!!(S.some(y=>y.toLowerCase().includes(a))||(L=o.Genres)!=null&&L.some(y=>k(y).toLowerCase().includes(a)))}),d=u.filter(o=>k(o.Name||"").toLowerCase().includes(a)),f=m.filter(o=>{var T,P;const M=k(o.Name||""),S=k(o.AlbumArtist||((P=(T=o.ArtistItems)==null?void 0:T[0])==null?void 0:P.Name)||"");return M.toLowerCase().includes(a)||S.toLowerCase().includes(a)}),j=n.filter(o=>k(o.Name||"").toLowerCase().includes(a));return{artists:d,albums:f,playlists:j,songs:i}}async function Re(t,s){var n,x;const c={};(n=s==null?void 0:s.genres)!=null&&n.length&&(c.genres=s.genres),(x=s==null?void 0:s.years)!=null&&x.length&&(c.years=s.years);const[r,h,m,u]=await Promise.all([w.getArtists({limit:t}),w.getAlbums({limit:t,...c}),w.getPlaylists({limit:t}),w.getSongs({limit:t,...c})]);return{artists:r.Items||[],albums:h.Items||[],playlists:m.Items||[],songs:u.Items||[]}}export{Me as S,we as a,Re as f,je as g,Se as u};
