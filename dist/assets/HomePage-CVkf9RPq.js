import{c as Oe,r,u as W,g as Te,a as oe,b as ye,d as We,j as e,S as Ge,l as pe,e as O,I as Ae,C as be,f as Ee,D as Ce,A as qe,h as Ve,B as Ye,i as we,k as Xe,F as xe,M as Qe}from"./index-SABcFPCf.js";import{S as Ze}from"./search-DxrwQPN1.js";import{u as Je,F as ve}from"./useSearch-JRx9Gb2c.js";import{C as Ke,a as et}from"./chevron-right-DTK3rJeC.js";import{E as tt}from"./ellipsis-BXuQLaHH.js";import"./piano-DaVkbRzM.js";/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const st=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],nt=Oe("search",st);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lt=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],rt=Oe("settings",lt),it=[{type:"artists",limit:5},{type:"albums",limit:12},{type:"playlists"},{type:"songs"}];function at({onSearchStateChange:t,title:i="Search"}){const[s,c]=r.useState(!1),m=r.useRef(null),p=r.useRef(null),[x,g]=r.useState(!1),[f,d]=r.useState(null),[u,l]=r.useState(null),{genres:o,songs:a}=W(),[h,k]=r.useState([]),$=r.useMemo(()=>Te(a),[a]),{playAlbum:R,addToQueue:I,playTrack:S,shuffleAllSongs:n,isQueueSidebarOpen:w}=oe(),[N,j]=r.useState(!1),{searchQuery:L,setSearchQuery:X,isSearching:Q,searchResults:T,selectedGenres:Z,setSelectedGenres:J,yearRange:G,setYearRange:K,selectedGroupings:q,setSelectedGroupings:ee,clearSearch:Y,clearAll:te}=Je({debounceMs:300});r.useEffect(()=>{if(N){const b=setTimeout(()=>{j(!1)},1e4);return()=>clearTimeout(b)}},[N]);const V=ye(),[ne,se]=We();r.useEffect(()=>{const b=ne.get("yearMin"),P=ne.get("yearMax"),D=ne.get("genre");let _=!1;(b||P)&&(K({min:b?parseInt(b,10):null,max:P?parseInt(P,10):null}),_=!0),D&&(J([D]),_=!0),_&&(c(!0),se({},{replace:!0}))},[]),r.useEffect(()=>{(async()=>{try{const P=W.getState();if(P.years.length>0)k(P.years);else{const D=await O.getYears();k(D)}}catch(P){pe.error("Failed to load filter values:",P)}})()},[]);const ie=b=>{X(b),b.trim().length>0&&!s&&c(!0)},ce=b=>{V(`/artist/${b}`),c(!1),Y()},de=b=>{V(`/album/${b}`),c(!1),Y()},A=b=>{S(b,[b])},F=b=>{V(`/playlist/${b}`),c(!1),Y()},z=()=>{Y()},U=()=>{c(!1),te()},B=b=>{d(b),g(!0)},y=b=>{J(b)},E=b=>{K(b)},v=b=>{l(b),d("grouping"),g(!0)},M=(b,P)=>{ee(D=>({...D,[b]:P}))},C=()=>{T!=null&&T.songs&&T.songs.length>0&&R(T.songs)},le=()=>{T!=null&&T.songs&&T.songs.length>0&&I(T.songs)},re=s;return r.useEffect(()=>{t&&t(re)},[re,t]),r.useEffect(()=>{if(s){const P=window.matchMedia("(hover: hover) and (pointer: fine) and (min-width: 1024px)").matches?p:m;setTimeout(()=>{var D;if((D=P.current)==null||D.focus(),P.current){const _=P.current.value.length;P.current.setSelectionRange(_,_)}},50)}},[s]),r.useEffect(()=>{if(!s)return;const b=P=>{P.key==="Escape"&&(P.preventDefault(),P.stopPropagation(),U())};return window.addEventListener("keydown",b,!0),()=>window.removeEventListener("keydown",b,!0)},[s]),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"px-4 md:pl-2 md:pr-4 pt-4 pb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Tunetuna"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:async()=>{const b=oe.getState(),{isShuffleAllActive:P,isShuffleGenreActive:D}=b;if(!(N||P||D)){j(!0);try{await n()}catch(_){pe.error("Home shuffle button - shuffleAllSongs failed:",_),pe.error("Shuffle all failed:",_)}finally{j(!1)}}},disabled:N,className:"w-10 h-10 flex items-center justify-center text-white hover:bg-zinc-800 rounded-full transition-colors disabled:opacity-50","aria-label":"Shuffle all songs",children:N?e.jsx("div",{className:"w-5 h-5 border-2 border-zinc-400 border-t-white rounded-full animate-spin"}):e.jsx(Ge,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>c(!0),className:"w-10 h-10 flex items-center justify-center text-white hover:bg-zinc-800 rounded-full transition-colors","aria-label":"Search",children:e.jsx(nt,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>V("/settings"),className:"w-10 h-10 flex items-center justify-center text-white hover:bg-zinc-800 rounded-full transition-colors","aria-label":"Settings",children:e.jsx(rt,{className:"w-5 h-5"})})]})]})}),e.jsx(Ze,{isOpen:s,onClose:U,title:i,searchQuery:L,onSearchChange:ie,onClearSearch:z,isLoading:Q,results:T,sections:it,filterConfig:{showGenreFilter:!0,showYearFilter:!0,showGroupingFilters:!0},filterState:{selectedGenres:Z,yearRange:G,selectedGroupings:q},onOpenFilterSheet:B,groupingCategories:$,onOpenGroupingFilterSheet:v,onArtistClick:ce,onAlbumClick:de,onSongClick:A,onPlaylistClick:F,onPlayAllSongs:C,onAddSongsToQueue:le,isQueueSidebarOpen:w,desktopSearchInputRef:p,mobileSearchInputRef:m}),f==="genre"&&e.jsx(ve,{isOpen:x,onClose:()=>g(!1),filterType:"genre",genres:o,selectedValues:Z,onApply:y}),f==="year"&&e.jsx(ve,{isOpen:x,onClose:()=>g(!1),filterType:"year",availableYears:h,yearRange:G,onApplyYear:E}),f==="grouping"&&u&&e.jsx(ve,{isOpen:x,onClose:()=>g(!1),filterType:"grouping",groupingCategory:u,selectedGroupingValues:q[u.key]||[],onApplyGrouping:M})]})}function je({moodValue:t,moodName:i,albumId:s}){const c=ye(),{recordMoodAccess:m}=W(),p=()=>{m(t),c(`/mood/${encodeURIComponent(t)}`)};return e.jsxs("button",{onClick:p,className:"bg-zinc-800/50 rounded-xl px-3 py-2 border border-zinc-700/50 hover:bg-zinc-800 transition-colors group text-left flex items-center justify-between w-full h-11",children:[e.jsx("div",{className:"text-sm font-medium text-white group-hover:text-[var(--accent-color)] transition-colors truncate",children:i}),s&&e.jsx("div",{className:"w-7 h-7 rounded overflow-hidden flex-shrink-0 ml-2",children:e.jsx(Ae,{src:O.getAlbumArtUrl(s,56),alt:"",className:"w-full h-full object-cover",showOutline:!1,rounded:"rounded"})})]})}function Pe({children:t,className:i="",gap:s=12}){const c=r.useRef(null),[m,p]=r.useState(!1),[x,g]=r.useState(!1),[f,d]=r.useState(!1),u=()=>{if(!c.current)return;const{scrollLeft:o,scrollWidth:a,clientWidth:h}=c.current;p(o>0),g(o+h<a-1)};r.useEffect(()=>{u();const o=c.current;if(o)return o.addEventListener("scroll",u,{passive:!0}),window.addEventListener("resize",u),()=>{o.removeEventListener("scroll",u),window.removeEventListener("resize",u)}},[t]);const l=o=>{if(!c.current)return;const a=c.current,h=a.clientWidth-s*2;a.scrollBy({left:o==="left"?-h:h,behavior:"smooth"})};return e.jsxs("div",{className:"relative",onMouseEnter:()=>d(!0),onMouseLeave:()=>d(!1),children:[e.jsx("div",{ref:c,className:`overflow-x-auto scrollbar-hide ${i}`,style:{scrollbarWidth:"none",msOverflowStyle:"none"},children:t}),m&&f&&e.jsx("button",{onClick:()=>l("left"),className:"absolute left-0 top-1/2 -translate-y-1/2 z-10 w-10 h-10 flex items-center justify-center bg-black/70 hover:bg-black/90 rounded-full transition-colors","aria-label":"Scroll left",children:e.jsx(Ke,{className:"w-6 h-6 text-white"})}),x&&f&&e.jsx("button",{onClick:()=>l("right"),className:"absolute right-0 top-1/2 -translate-y-1/2 z-10 w-10 h-10 flex items-center justify-center bg-black/70 hover:bg-black/90 rounded-full transition-colors","aria-label":"Scroll right",children:e.jsx(et,{className:"w-6 h-6 text-white"})}),e.jsx("style",{children:`
        .scrollbar-hide::-webkit-scrollbar {
          display: none;
        }
      `})]})}function ot(t){let i=0;for(let s=0;s<t.length;s++){const c=t.charCodeAt(s);i=(i<<5)-i+c,i=i&i}return i}function ct(t){const i=new Date().toISOString().split("T")[0];return ot(`${i}-${t}`)}function dt(t){return t?t.charAt(0).toUpperCase()+t.slice(1):""}function ut(t,i,s){const c=i.filter(f=>{var d;return(d=f.Grouping)==null?void 0:d.some(u=>u.toLowerCase()===`mood_${t.toLowerCase()}`)});if(c.length===0)return null;const m=c.filter(f=>f.AlbumId);if(m.length===0)return null;let p=m.filter(f=>!s.has(f.AlbumId));p.length===0&&(p=m);const x=ct(t),g=Math.abs(x)%p.length;return p[g].AlbumId}function mt(t,i){return[...t].sort((s,c)=>{const m=i[s.toLowerCase()]||0,p=i[c.toLowerCase()]||0;return m!==p?p-m:s.localeCompare(c)})}function ft(){const{songs:t,recentlyAccessedMoods:i}=W(),s=r.useRef(null),[c,m]=r.useState(0),p=r.useMemo(()=>Te(t).find(o=>o.key==="mood"),[t]),x=r.useMemo(()=>{if(!p||p.values.length===0)return[];const l=mt(p.values,i),o=new Set;return l.map(a=>{const h=ut(a.toLowerCase(),t,o);return h&&o.add(h),{value:a.toLowerCase(),name:dt(a),albumId:h}})},[p,t,i]);if(x.length===0)return null;const g=()=>{if(!s.current)return;const l=s.current,o=l.scrollLeft,a=l.clientWidth,h=Math.round(o/a);m(h)},f=l=>{if(!s.current)return;const o=s.current,a=o.clientWidth;o.scrollTo({left:l*a,behavior:"smooth"})},d=6,u=[];for(let l=0;l<x.length;l+=d)u.push(x.slice(l,l+d));return e.jsxs("div",{className:"px-4 mb-4",children:[e.jsxs("div",{className:"md:hidden",children:[e.jsx("div",{ref:s,onScroll:g,className:"overflow-x-auto snap-x snap-mandatory scrollbar-hide",style:{scrollbarWidth:"none",msOverflowStyle:"none"},children:e.jsx("div",{className:"flex",style:{width:`${u.length*100}%`},children:u.map((l,o)=>{const a=Math.ceil(l.length/3);return e.jsx("div",{className:"snap-start flex-shrink-0 w-full",style:{width:`${100/u.length}%`},children:e.jsx("div",{className:"grid grid-cols-3 gap-2",style:{gridTemplateRows:`repeat(${a}, minmax(0, 1fr))`},children:l.map(h=>e.jsx(je,{moodValue:h.value,moodName:h.name,albumId:h.albumId},h.value))})},o)})})}),u.length>1&&e.jsx("div",{className:"flex justify-center gap-2 mt-3",children:u.map((l,o)=>e.jsx("button",{onClick:()=>f(o),className:`w-2 h-2 rounded-full transition-colors ${o===c?"bg-white":"bg-zinc-600"}`,"aria-label":`Go to page ${o+1}`},o))})]}),e.jsx("div",{className:"hidden md:block min-[1680px]:hidden",children:e.jsx(Pe,{gap:8,children:e.jsx("div",{className:"grid grid-rows-2 grid-flow-col gap-2",style:{gridAutoColumns:"calc((100% - 24px) / 4)"},children:x.map(l=>e.jsx(je,{moodValue:l.value,moodName:l.name,albumId:l.albumId},l.value))})})}),e.jsx("div",{className:"hidden min-[1680px]:block",children:e.jsx(Pe,{gap:8,children:e.jsx("div",{className:"grid grid-rows-2 grid-flow-col gap-2",style:{gridAutoColumns:"calc((100% - 32px) / 5)"},children:x.map(l=>e.jsx(je,{moodValue:l.value,moodName:l.name,albumId:l.albumId},l.value))})})}),e.jsx("style",{children:`
        .scrollbar-hide::-webkit-scrollbar {
          display: none;
        }
      `})]})}function Ne({album:t,onNavigate:i,onContextMenu:s}){var d,u;const[c,m]=r.useState(!1),p=r.useRef(!1),x=l=>{if(p.current){p.current=!1;return}i(t.Id)},g=l=>{l.preventDefault(),l.stopPropagation(),p.current=!0,s(t,"desktop",{x:l.clientX,y:l.clientY}),setTimeout(()=>{p.current=!1},300)},f=Ee({onLongPress:l=>{l.preventDefault(),p.current=!0,s(t,"mobile")},onClick:()=>{if(p.current){p.current=!1;return}x()}});return e.jsxs("button",{onClick:()=>{if(p.current){p.current=!1;return}x()},onContextMenu:g,...f,className:"text-left group",children:[e.jsx("div",{className:"aspect-square rounded overflow-hidden mb-2 bg-zinc-900 flex items-center justify-center",children:c?e.jsx(Ce,{className:"w-12 h-12 text-gray-500"}):e.jsx(Ae,{src:O.getAlbumArtUrl(t.Id,474),alt:t.Name,className:"w-full h-full object-cover",showOutline:!0,rounded:"rounded",onError:()=>m(!0)})}),e.jsx("div",{className:"text-sm font-medium text-white truncate",children:t.Name}),e.jsx("div",{className:"text-xs text-gray-400 truncate",children:t.AlbumArtist||((u=(d=t.ArtistItems)==null?void 0:d[0])==null?void 0:u.Name)||"Unknown Artist"})]})}function ht(){const{recentlyAdded:t,setRecentlyAdded:i,setLoading:s}=W(),c=ye(),m=r.useRef(null),[p,x]=r.useState(0),[g,f]=r.useState(!1),[d,u]=r.useState("mobile"),[l,o]=r.useState(null),[a,h]=r.useState(null);r.useEffect(()=>{(async()=>{s("recentlyAdded",!0);try{const n=await O.getRecentlyAdded(18);i(n.Items||[])}catch(n){pe.error("Failed to load recently added:",n)}finally{s("recentlyAdded",!1)}})()},[i,s]);const k=()=>{if(!m.current)return;const S=m.current,n=S.scrollLeft,w=S.clientWidth,N=Math.round(n/w);x(N)},$=S=>{if(!m.current)return;const n=m.current,w=n.clientWidth;n.scrollTo({left:S*w,behavior:"smooth"})};if(!t||t.length===0)return null;const R=6,I=[];for(let S=0;S<t.length;S+=R)I.push(t.slice(S,S+R));return e.jsxs("div",{className:"px-4 mb-8",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Recently Added"}),e.jsxs("div",{className:"md:hidden",children:[e.jsx("div",{ref:m,onScroll:k,className:"overflow-x-auto snap-x snap-mandatory scrollbar-hide",style:{scrollbarWidth:"none",msOverflowStyle:"none"},children:e.jsx("div",{className:"flex",style:{width:`${I.length*100}%`},children:I.map((S,n)=>{const w=Math.ceil(S.length/3);return e.jsx("div",{className:"snap-start flex-shrink-0 w-full",style:{width:`${100/I.length}%`},children:e.jsx("div",{className:"grid grid-cols-3 gap-3",style:{gridTemplateRows:`repeat(${w}, minmax(0, 1fr))`},children:S.map(N=>e.jsx(Ne,{album:N,onNavigate:j=>c(`/album/${j}`),onContextMenu:(j,L,X)=>{h(j),u(L||"desktop"),o(X||null),f(!0)}},N.Id))})},n)})})}),I.length>1&&e.jsx("div",{className:"flex justify-center gap-2 mt-4",children:I.map((S,n)=>e.jsx("button",{onClick:()=>$(n),className:`w-2 h-2 rounded-full transition-colors ${n===p?"bg-white":"bg-zinc-600"}`,"aria-label":`Go to page ${n+1}`},n))})]}),e.jsx("div",{className:"hidden md:block min-[1680px]:hidden",children:e.jsx("div",{className:"grid grid-cols-4 gap-3",children:t.slice(0,8).map(S=>e.jsx(Ne,{album:S,onNavigate:n=>c(`/album/${n}`),onContextMenu:(n,w,N)=>{h(n),u(w||"desktop"),o(N||null),f(!0)}},S.Id))})}),e.jsx("div",{className:"hidden min-[1680px]:block",children:e.jsx("div",{className:"grid grid-cols-5 gap-3",children:t.slice(0,10).map(S=>e.jsx(Ne,{album:S,onNavigate:n=>c(`/album/${n}`),onContextMenu:(n,w,N)=>{h(n),u(w||"desktop"),o(N||null),f(!0)}},S.Id))})}),e.jsx("style",{children:`
        .scrollbar-hide::-webkit-scrollbar {
          display: none;
        }
      `}),e.jsx(be,{item:a,itemType:"album",isOpen:g,onClose:()=>{f(!1),h(null)},zIndex:999999,mode:d,position:l||void 0})]})}const pt="https://musicbrainz.org/ws/2",xt=`${qe}/${Ve} (https://github.com/AlessioLaiso/tunetuna)`,gt="https://coverartarchive.org",yt="https://api.song.link/v1-alpha.1";let Re=0;const $e=1100;async function bt(t="gb",i=10){const s=`/api/stats/proxy/apple-music/${t}/${i}`,c=await fetch(s);if(!c.ok)throw new Error(`Apple Music RSS failed: ${c.status}`);return(await c.json()).feed.results}function wt(t,i=300){return t.replace(/\d+x\d+/,`${i}x${i}`)}async function St(){const i=Date.now()-Re;i<$e&&await new Promise(s=>setTimeout(s,$e-i)),Re=Date.now()}async function vt(t,i){await St();const s=`releasegroup:"${i}" AND artist:"${t}"`,c=new URLSearchParams({query:s,fmt:"json",limit:"1"}),m=await fetch(`${pt}/release-group/?${c}`,{headers:{"User-Agent":xt,Accept:"application/json"}});if(!m.ok)throw new Error(`MusicBrainz search failed: ${m.status}`);const x=(await m.json())["release-groups"]||[];return x.length===0?null:{id:x[0].id,type:x[0]["primary-type"]||"Album"}}function Ue(t,i=500){return`${gt}/release-group/${t}/front-${i}`}async function Fe(t,i){const s=new URLSearchParams({url:t});try{const c=await fetch(`${yt}/links?${s}`);if(!c.ok){if(c.status===404)return null;throw new Error(`Odesli API failed: ${c.status}`)}return await c.json()}catch{return null}}async function jt(t,i=10){if(!t)return[];const s=`https://api.allorigins.win/raw?url=${encodeURIComponent(t)}`;console.log("[Muspy] Fetching from:",s);const c=await fetch(s);if(!c.ok)throw new Error(`Muspy RSS failed: ${c.status}`);const m=await c.text();console.log("[Muspy] Response length:",m.length,"First 500 chars:",m.substring(0,500));const x=new DOMParser().parseFromString(m,"text/xml"),g=x.querySelector("parsererror");g&&console.error("[Muspy] XML parse error:",g.textContent);const f=x.querySelectorAll("entry");console.log("[Muspy] Found",f.length,"entries");const d=[];return f.forEach((u,l)=>{var Z,J,G,K,q,ee;if(l>=i)return;const o=((Z=u.querySelector("title"))==null?void 0:Z.textContent)||"",a=u.querySelector('link[rel="alternate"]')||u.querySelector("link"),h=(a==null?void 0:a.getAttribute("href"))||(a==null?void 0:a.textContent)||"",k=((J=u.querySelector("summary"))==null?void 0:J.textContent)||((G=u.querySelector("content"))==null?void 0:G.textContent)||"",$=((K=u.querySelector("updated"))==null?void 0:K.textContent)||((q=u.querySelector("published"))==null?void 0:q.textContent)||"";(ee=u.querySelector("id"))!=null&&ee.textContent;const R=/[a-fA-F0-9]{8}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{12}/i,S=u.outerHTML.match(R),n=S?S[0]:`muspy-${l}`,w=k.match(/\((Single|Album|EP)\)/i),N=w?w[1]:"Album",j=o.split(" - "),L=j.length>1?j[0].trim():k,X=j.length>1?j.slice(1).join(" - ").trim():o;let Q="";if($)try{Q=new Date($).toISOString().split("T")[0]}catch{Q=$}const T=n.startsWith("muspy-")?h:`https://musicbrainz.org/release-group/${n}`;d.push({id:n,title:X,artistName:L,releaseDate:Q,type:N,artworkUrl:n.startsWith("muspy-")?void 0:Ue(n,500),mbUrl:T})}),d}const Nt=[{id:"spotify",name:"Spotify",icon:"spotify"},{id:"appleMusic",name:"Apple Music",icon:"apple"},{id:"youtube",name:"YouTube",icon:"youtube"},{id:"youtubeMusic",name:"YouTube Music",icon:"youtube"},{id:"tidal",name:"Tidal",icon:"tidal"},{id:"deezer",name:"Deezer",icon:"deezer"},{id:"amazonMusic",name:"Amazon Music",icon:"amazon"},{id:"soundcloud",name:"SoundCloud",icon:"soundcloud"}];function ge(t,i){const s=encodeURIComponent(`${t} ${i}`);return{entityUniqueId:"search",userCountry:"US",pageUrl:`https://www.google.com/search?q=${s}`,linksByPlatform:{spotify:{url:`https://open.spotify.com/search/${s}`},appleMusic:{url:`https://music.apple.com/search?term=${s}`},youtube:{url:`https://www.youtube.com/results?search_query=${s}`},youtubeMusic:{url:`https://music.youtube.com/search?q=${s}`},tidal:{url:`https://listen.tidal.com/search?q=${s}`},deezer:{url:`https://www.deezer.com/search/${s}`},amazonMusic:{url:`https://music.amazon.com/search/${s}`}}}}const ze={spotify:e.jsx("svg",{viewBox:"0 0 24 24",className:"w-5 h-5",fill:"currentColor",children:e.jsx("path",{d:"M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.66 0 12 0zm5.521 17.34c-.24.359-.66.48-1.021.24-2.82-1.74-6.36-2.101-10.561-1.141-.418.122-.779-.179-.899-.539-.12-.421.18-.78.54-.9 4.56-1.021 8.52-.6 11.64 1.32.42.18.479.659.301 1.02zm1.44-3.3c-.301.42-.841.6-1.262.3-3.239-1.98-8.159-2.58-11.939-1.38-.479.12-1.02-.12-1.14-.6-.12-.48.12-1.021.6-1.141C9.6 9.9 15 10.561 18.72 12.84c.361.181.54.78.241 1.2zm.12-3.36C15.24 8.4 8.82 8.16 5.16 9.301c-.6.179-1.2-.181-1.38-.721-.18-.601.18-1.2.72-1.381 4.26-1.26 11.28-1.02 15.721 1.621.539.3.719 1.02.419 1.56-.299.421-1.02.599-1.559.3z"})}),appleMusic:e.jsx("svg",{viewBox:"0 0 24 24",className:"w-5 h-5",fill:"currentColor",children:e.jsx("path",{d:"M23.994 6.124a9.23 9.23 0 00-.24-2.19c-.317-1.31-1.062-2.31-2.18-3.043a5.022 5.022 0 00-1.877-.726 10.496 10.496 0 00-1.564-.15c-.04-.003-.083-.01-.124-.013H5.986c-.152.01-.303.017-.455.026-.747.043-1.49.123-2.193.4-1.336.53-2.3 1.452-2.865 2.78-.192.448-.292.925-.363 1.408-.056.392-.088.785-.1 1.18 0 .032-.007.062-.01.093v12.223c.01.14.017.283.027.424.05.815.154 1.624.497 2.373.65 1.42 1.738 2.353 3.234 2.802.42.127.856.187 1.293.228.555.053 1.11.06 1.667.06h11.03a12.5 12.5 0 001.57-.1c.822-.106 1.596-.35 2.296-.81a5.046 5.046 0 001.88-2.207c.186-.42.293-.87.37-1.324.113-.675.138-1.358.137-2.04-.002-3.8 0-7.595-.003-11.393zm-6.423 3.99v5.712c0 .417-.058.827-.244 1.206-.29.59-.76.962-1.388 1.14-.35.1-.706.157-1.07.173-.95.045-1.773-.6-1.943-1.536a1.88 1.88 0 011.038-2.022c.323-.16.67-.25 1.018-.324.378-.082.758-.153 1.134-.24.274-.063.457-.23.51-.516a.904.904 0 00.02-.193c0-1.815 0-3.63-.002-5.443a.725.725 0 00-.026-.185c-.04-.15-.15-.243-.304-.234-.16.01-.318.035-.475.066-.76.15-1.52.303-2.28.456l-2.326.47-1.374.278c-.016.003-.032.01-.048.013-.277.077-.377.203-.39.49-.002.042 0 .086 0 .13-.002 2.602 0 5.204-.003 7.805 0 .42-.047.836-.215 1.227-.278.64-.77 1.04-1.434 1.233-.35.1-.71.16-1.075.172-.96.036-1.755-.6-1.92-1.544-.14-.812.23-1.685 1.154-2.075.357-.15.73-.232 1.108-.31.287-.06.575-.116.86-.177.383-.083.583-.323.6-.714v-.15c0-2.96 0-5.922.002-8.883 0-.123.013-.25.042-.37.07-.285.273-.448.546-.518.255-.065.515-.112.774-.165.733-.15 1.466-.296 2.2-.444l2.27-.46c.67-.134 1.34-.27 2.01-.403.22-.043.443-.088.664-.106.31-.025.523.17.554.482.008.073.012.148.012.223.002 1.91.002 3.822 0 5.732z"})}),youtube:e.jsx("svg",{viewBox:"0 0 24 24",className:"w-5 h-5",fill:"currentColor",children:e.jsx("path",{d:"M23.498 6.186a3.016 3.016 0 00-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 00.502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 002.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 002.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"})}),youtubeMusic:e.jsx("svg",{viewBox:"0 0 24 24",className:"w-5 h-5",fill:"currentColor",children:e.jsx("path",{d:"M12 0C5.376 0 0 5.376 0 12s5.376 12 12 12 12-5.376 12-12S18.624 0 12 0zm0 19.104c-3.924 0-7.104-3.18-7.104-7.104S8.076 4.896 12 4.896s7.104 3.18 7.104 7.104-3.18 7.104-7.104 7.104zm0-13.332c-3.432 0-6.228 2.796-6.228 6.228S8.568 18.228 12 18.228s6.228-2.796 6.228-6.228S15.432 5.772 12 5.772zM9.684 15.54V8.46L15.816 12l-6.132 3.54z"})}),tidal:e.jsx("svg",{viewBox:"0 0 24 24",className:"w-5 h-5",fill:"currentColor",children:e.jsx("path",{d:"M12.012 3.992L8.008 7.996 4.004 3.992 0 7.996 4.004 12l4.004-4.004L12.012 12l4.004-4.004L20.02 12l4.004-4.004-4.004-4.004-4.004 4.004-4.004-4.004zM12.012 12.012L8.008 16.02l4.004 4.004 4.004-4.004-4.004-4.008z"})}),deezer:e.jsx("svg",{viewBox:"0 0 24 24",className:"w-5 h-5",fill:"currentColor",children:e.jsx("path",{d:"M18.81 4.16v3.03H24V4.16h-5.19zM6.27 8.38v3.027h5.189V8.38h-5.19zm12.54 0v3.027H24V8.38h-5.19zM6.27 12.594v3.027h5.189v-3.027h-5.19zm6.27 0v3.027h5.19v-3.027h-5.19zm6.27 0v3.027H24v-3.027h-5.19zM0 16.81v3.029h5.19v-3.03H0zm6.27 0v3.029h5.189v-3.03h-5.19zm6.27 0v3.029h5.19v-3.03h-5.19zm6.27 0v3.029H24v-3.03h-5.19z"})}),amazonMusic:e.jsx("svg",{viewBox:"0 0 24 24",className:"w-5 h-5",fill:"currentColor",children:e.jsx("path",{d:"M.045 18.02c.072-.116.187-.124.348-.022 3.636 2.11 7.594 3.166 11.87 3.166 2.852 0 5.668-.533 8.447-1.595l.315-.118c.138-.053.209-.073.315-.073.186 0 .27.089.27.267 0 .178-.089.355-.267.533l-.178.178c-2.852 2.346-6.22 3.52-10.106 3.52-4.24 0-7.942-1.192-11.107-3.574-.168-.133-.217-.244-.217-.333 0-.089.044-.133.133-.178zm21.243-3.928c-.236-.178-.712-.267-1.424-.267-.712 0-1.598.178-2.665.533-1.067.356-2.134.89-3.201 1.602-.178.089-.267.178-.267.267s.089.133.267.133c.089 0 .178-.044.267-.089l.356-.178c1.156-.533 2.223-.8 3.2-.8.979 0 1.469.267 1.469.8 0 .356-.178.712-.534 1.068-.356.355-.89.711-1.6 1.066l-.535.267c-.356.178-.534.356-.534.534 0 .133.089.2.267.2.089 0 .178-.022.267-.067l.445-.222c1.6-.8 2.756-1.424 3.467-1.869.712-.444 1.068-.889 1.068-1.333 0-.445-.178-.712-.534-.978-.356-.267-.978-.4-1.868-.4zm-6.844-7.11c0-1.067-.267-1.957-.8-2.67-.533-.711-1.422-1.066-2.666-1.066-1.244 0-2.223.355-2.933 1.066-.712.712-1.156 1.78-1.334 3.2h7.733v-.533zm3.911 1.956H8.045c.089 1.422.445 2.489 1.067 3.2.622.712 1.511 1.067 2.666 1.067.89 0 1.69-.178 2.4-.533.712-.356 1.334-.89 1.868-1.6.178-.178.356-.267.534-.267.178 0 .267.089.267.267 0 .178-.089.356-.267.533-.622.8-1.422 1.423-2.4 1.868-.978.445-2.044.667-3.2.667-1.778 0-3.2-.533-4.267-1.6-1.067-1.066-1.6-2.577-1.6-4.533 0-1.956.533-3.467 1.6-4.533 1.067-1.067 2.489-1.6 4.267-1.6 1.778 0 3.111.445 4 1.334.89.889 1.334 2.177 1.334 3.866v1.067c0 .266-.089.4-.267.4l-.089-.003z"})}),soundcloud:e.jsx("svg",{viewBox:"0 0 24 24",className:"w-5 h-5",fill:"currentColor",children:e.jsx("path",{d:"M1.175 12.225c-.051 0-.094.046-.101.1l-.233 2.154.233 2.105c.007.058.05.098.101.098.05 0 .09-.04.099-.098l.255-2.105-.27-2.154c-.009-.06-.048-.1-.098-.1m-.899.828c-.06 0-.091.037-.104.094L0 14.479l.165 1.308c.014.057.045.094.09.094s.089-.037.099-.094l.19-1.308-.19-1.334c-.01-.057-.045-.09-.09-.09m1.83-1.229c-.061 0-.12.045-.12.104l-.21 2.563.225 2.458c0 .06.045.104.106.104.061 0 .12-.044.12-.104l.24-2.458-.24-2.563c0-.06-.045-.104-.12-.104m.945-.089c-.075 0-.135.06-.15.135l-.193 2.64.21 2.544c.016.077.075.138.149.138.075 0 .135-.061.15-.138l.225-2.545-.225-2.64c-.015-.074-.06-.135-.135-.135m1.065.42c-.09 0-.149.075-.164.164l-.158 2.255.18 2.46c.015.09.074.165.164.165.089 0 .149-.075.164-.165l.209-2.46-.209-2.255c-.015-.09-.075-.164-.164-.164m.944-.54c-.104 0-.194.09-.209.195l-.149 2.81.164 2.445c.015.105.09.195.194.195.104 0 .195-.09.21-.195l.18-2.445-.18-2.81c-.015-.105-.09-.195-.194-.195m1.076-.505c-.119 0-.21.09-.225.21l-.135 3.3.149 2.4c.015.12.105.21.225.21.12 0 .21-.09.225-.21l.165-2.4-.165-3.3c-.015-.12-.105-.21-.225-.21m1.064-.54c-.135 0-.239.105-.254.24l-.12 3.825.135 2.354c.015.135.12.24.255.24.12 0 .24-.105.255-.24l.149-2.354-.149-3.825c-.015-.135-.12-.24-.255-.24m1.109-.27c-.015-.15-.135-.255-.27-.255-.15 0-.255.105-.27.255l-.12 4.08.12 2.31c.015.15.12.255.27.255.149 0 .255-.105.27-.255l.134-2.31-.134-4.08m.494 6.645c.015.165.135.284.285.284.149 0 .27-.12.284-.284l.121-2.325-.12-5.175c-.015-.165-.135-.285-.285-.285-.149 0-.27.12-.284.285l-.107 5.175.106 2.325m1.184-6.18c-.165 0-.3.135-.314.3l-.091 3.855.105 2.31c.015.165.135.3.3.3.164 0 .284-.135.299-.3l.12-2.31-.12-3.855c-.015-.165-.135-.3-.3-.3m1.199-.075c-.18 0-.314.135-.329.315l-.09 3.915.104 2.295c.015.18.135.315.315.315s.314-.135.314-.315l.12-2.295-.12-3.915c-.015-.18-.149-.315-.314-.315m1.139-.195c-.195 0-.345.149-.359.345l-.075 4.11.09 2.265c.014.195.149.345.344.345.195 0 .345-.15.359-.345l.105-2.265-.105-4.095c-.014-.195-.164-.36-.359-.36m1.305 0c-.209 0-.359.164-.374.359l-.074 4.095.089 2.25c.015.21.165.375.375.375.194 0 .359-.165.374-.375l.09-2.25-.09-4.095c-.015-.209-.165-.359-.375-.359m1.289.015c-.225 0-.39.18-.39.405l-.06 4.065.075 2.235c.016.225.166.39.391.39.225 0 .391-.165.406-.39l.09-2.235-.091-4.065c-.014-.24-.18-.405-.405-.405m1.35.09c-.24 0-.42.18-.42.42l-.045 3.975.06 2.205c.015.24.18.42.42.42.24 0 .404-.18.42-.42l.075-2.205-.075-3.975c-.015-.24-.18-.42-.42-.42m1.33.135c-.256 0-.435.194-.45.435l-.046 3.825.061 2.175c.015.255.195.45.435.45.256 0 .436-.195.45-.45l.076-2.175-.076-3.825c-.014-.255-.194-.435-.45-.435m1.453-.09c-.27 0-.48.21-.48.465l-.03 3.915.03 2.145c.015.27.21.465.48.465.27 0 .48-.195.48-.465l.045-2.145-.045-3.915c0-.255-.21-.465-.48-.465m1.444.285c-.285 0-.495.225-.51.495l-.015 3.645.03 2.13c.015.285.225.51.51.51.27 0 .494-.225.51-.51l.03-2.13-.03-3.645c-.016-.285-.225-.495-.51-.495m3.39.465c-.165-.045-.345-.075-.51-.075-.18 0-.345.015-.51.045-.044-.9-.39-1.695-.945-2.34-.556-.645-1.35-1.08-2.31-1.215-.27-.045-.405-.165-.405-.405V6.54c0-1.305-.465-2.415-1.395-3.345C19.2 2.265 18.09 1.8 16.77 1.8c-1.155 0-2.16.375-3.045 1.095-.885.72-1.44 1.635-1.68 2.745-.165-.03-.315-.045-.45-.045-1.35 0-2.355.93-2.355 2.115 0 .24.03.465.075.69-.645.12-1.17.435-1.59.945-.42.51-.63 1.095-.63 1.755 0 .75.255 1.38.765 1.89s1.14.765 1.89.765h10.53c.93 0 1.695-.285 2.31-.855.615-.57.93-1.29.93-2.145 0-.855-.3-1.575-.9-2.16-.6-.585-1.335-.885-2.205-.9"})})};function At(){return e.jsx("div",{className:"animate-pulse space-y-0",children:[...Array(4)].map((t,i)=>e.jsxs("div",{className:"flex items-center gap-3 px-4 py-2.5",children:[e.jsx("div",{className:"w-5 h-5 rounded bg-zinc-700"}),e.jsx("div",{className:"h-4 bg-zinc-700 rounded w-24"})]},i))})}function Be({isOpen:t,onClose:i,odesliData:s,loading:c=!1,title:m,mode:p="mobile",position:x,zIndex:g=99999}){if(!t)return null;const f=s?Nt.filter(a=>s.linksByPlatform[a.id]):[],d=a=>{if(!s)return;const h=s.linksByPlatform[a];h!=null&&h.url&&window.open(h.url,"_blank","noopener,noreferrer"),i()},l=(()=>{if(m)return m;if(!(s!=null&&s.entitiesByUniqueId))return"Loading...";const a=Object.values(s.entitiesByUniqueId);for(const h of a)if(h.title)return h.title;return"Loading..."})(),o=c||!s||f.length===0;if(p==="desktop"){const h=o?4:f.length,k=Math.min(400,h*44+48);let $=(x==null?void 0:x.x)||100,R=(x==null?void 0:x.y)||100;return $+220>window.innerWidth&&($=window.innerWidth-220-10),R+k>window.innerHeight&&(R=window.innerHeight-k-10),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0",onClick:i,style:{zIndex:g-1}}),e.jsxs("div",{className:"fixed bg-zinc-900 border border-zinc-700 rounded-lg shadow-2xl py-2 min-w-[200px]",style:{left:$,top:R,zIndex:g},onClick:I=>I.stopPropagation(),children:[e.jsx("div",{className:"px-4 pb-2 mb-1 border-b border-zinc-700",children:e.jsx("div",{className:"text-sm font-medium text-white truncate",children:l})}),o?e.jsx(At,{}):e.jsx("div",{className:"space-y-0",children:f.map(I=>e.jsxs("button",{onClick:()=>d(I.id),className:"w-full flex items-center gap-3 px-4 py-2.5 hover:bg-zinc-800 transition-colors text-left",children:[e.jsx("span",{className:"text-white flex-shrink-0",children:ze[I.id]||e.jsx("span",{className:"w-5 h-5 flex items-center justify-center text-xs",children:"ðŸŽµ"})}),e.jsx("span",{className:"flex-1 text-sm text-white",children:I.name})]},I.id))})]})]})}return e.jsx(Ye,{isOpen:t,onClose:i,zIndex:g,children:e.jsxs("div",{className:"pb-6",children:[e.jsx("div",{className:"mb-4 ml-4",children:e.jsx("div",{className:"text-lg font-semibold text-white break-words",children:l})}),o?e.jsx("div",{className:"animate-pulse space-y-1",children:[...Array(4)].map((a,h)=>e.jsxs("div",{className:"flex items-center gap-4 pl-4 pr-4 py-3",children:[e.jsx("div",{className:"w-5 h-5 rounded bg-zinc-700"}),e.jsx("div",{className:"h-4 bg-zinc-700 rounded w-28"})]},h))}):e.jsx("div",{className:"space-y-1",children:f.map(a=>e.jsxs("button",{onClick:()=>d(a.id),className:"w-full flex items-center gap-4 pl-4 pr-4 py-3 rounded-lg hover:bg-white/10 transition-colors",children:[e.jsx("span",{className:"text-white",children:ze[a.id]||e.jsx("span",{className:"w-5 h-5 flex items-center justify-center text-xs",children:"ðŸŽµ"})}),e.jsx("span",{className:"flex-1 text-left text-white font-medium",children:a.name})]},a.id))})]})})}function Ct(){const[t,i]=r.useState(()=>W.persist.hasHydrated());return r.useEffect(()=>{if(W.persist.hasHydrated()){i(!0);return}return W.persist.onFinishHydration(()=>{i(!0)})},[]),t}function ae(t){return t.toLowerCase().replace(/[^a-z0-9]/g,"")}function he(t){return t.replace(/\s*\(feat\..*?\)/gi,"").replace(/\s*\[feat\..*?\]/gi,"").replace(/\s*ft\..*$/gi,"").replace(/\s*\(with.*?\)/gi,"").replace(/\s*\[with.*?\]/gi,"").replace(/\s*\(explicit\)/gi,"").replace(/\s*\[explicit\]/gi,"").replace(/\s*\(deluxe.*?\)/gi,"").replace(/\s*\[deluxe.*?\]/gi,"").replace(/\s*-\s*single$/gi,"").replace(/\s*-\s*ep$/gi,"").trim()}function Le(t){return t.split(/[,&]/)[0].replace(/\s*feat\..*$/gi,"").replace(/\s*ft\..*$/gi,"").replace(/\s*with\s+.*$/gi,"").trim()}function De(){const t=W(f=>f.songs),i=W(f=>f.genreSongs),s=Ct(),c=r.useMemo(()=>{var u,l;if(!s)return new Map;let f=t;if(f.length===0&&i){const o=new Set;f=Object.values(i).flat().filter(a=>o.has(a.Id)?!1:(o.add(a.Id),!0))}const d=new Map;for(const o of f){const a=ae(Le(o.AlbumArtist||((l=(u=o.ArtistItems)==null?void 0:u[0])==null?void 0:l.Name)||""));a&&(d.has(a)||d.set(a,[]),d.get(a).push(o))}return d},[t,i,s]),m=f=>{const d=ae(Le(f));if(!d)return null;if(c.has(d))return c.get(d);for(const[u,l]of c)if(u.includes(d)||d.includes(u))return l;return null};return{findSong:(f,d)=>{const u=m(d);if(!u)return null;const l=ae(he(f));if(!l)return null;for(const o of u){const a=ae(he(o.Name||""));if(a===l||a.includes(l)||l.includes(a))return o}return null},findAlbum:(f,d)=>{const u=m(d);if(!u)return null;const l=ae(he(f));if(!l)return null;for(const o of u){if(!o.AlbumId||!o.Album)continue;const a=ae(he(o.Album));if(a===l||a.includes(l)||l.includes(a))return{albumId:o.AlbumId,albumName:o.Album}}return null},findArtistImageUrl:f=>{var l,o,a;const d=m(f);return!d||d.length===0?null:((a=(o=(l=d[0])==null?void 0:l.ArtistItems)==null?void 0:o[0])==null?void 0:a.Id)||null},artistIndex:c}}function me({title:t,subtitle:i,artworkUrl:s,fallbackArtworkUrl:c,secondFallbackUrl:m,rank:p,isCurrentTrack:x,isInLibrary:g,isMenuOpen:f,subtitleIcon:d,paddingRight:u=!1,onClick:l,onContextMenu:o,onLongPress:a,onExternalClick:h}){const[k,$]=r.useState(!1),[R,I]=r.useState(!1),[S,n]=r.useState(!1);r.useEffect(()=>{$(!1),I(!1),n(!1)},[s]);let w=s;S&&m?w=m:R&&c&&(w=c);const N=()=>{!R&&c?I(!0):!S&&m?n(!0):$(!0)},j=Ee({onLongPress:L=>{L.preventDefault(),a==null||a(L)},onClick:L=>l(L)});return e.jsxs("button",{onClick:L=>l(L),onContextMenu:o,...j,className:`w-full flex items-center gap-2 hover:bg-white/10 transition-colors group py-2.5 ${f?"bg-white/10":""} ${u?"pr-4":""}`,children:[e.jsx("div",{className:"w-12 h-12 rounded-sm overflow-hidden flex-shrink-0 bg-zinc-900 self-center flex items-center justify-center",children:k?e.jsx(Ce,{className:"w-6 h-6 text-gray-500"}):e.jsx(Ae,{src:w,alt:t,className:"w-full h-full object-cover",showOutline:!0,rounded:"rounded-sm",onError:N})}),e.jsxs("div",{className:"flex-1 min-w-0 text-left flex gap-3 items-baseline",children:[p!==void 0&&e.jsx("span",{className:"text-zinc-500 text-sm flex-shrink-0 w-5 text-right",children:p}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium truncate text-white group-hover:text-[var(--accent-color)] transition-colors",children:t}),e.jsxs("div",{className:"text-xs text-gray-400 flex items-center gap-1.5 min-w-0",children:[e.jsx("span",{className:"truncate",children:i}),d&&e.jsx("span",{className:"flex-shrink-0",children:d})]})]})]}),!g&&h&&e.jsx("div",{onClick:L=>{L.stopPropagation(),h(L)},className:"flex-shrink-0 p-2 text-gray-400 hover:text-white cursor-pointer",children:e.jsx(tt,{className:"w-4 h-4"})})]})}function Me(){return e.jsx("div",{className:"animate-pulse",children:[...Array(5)].map((t,i)=>e.jsxs("div",{className:"flex items-center gap-3 py-2.5",children:[e.jsx("div",{className:"w-12 h-12 rounded-sm bg-zinc-800"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-4 bg-zinc-800 rounded w-3/4 mb-1.5"}),e.jsx("div",{className:"h-3 bg-zinc-800 rounded w-1/2"})]})]},i))})}function Mt(){const{playTrack:t}=oe(),{feedTopSongs:i,feedLastUpdated:s,loading:c,setFeedTopSongs:m,setFeedLastUpdated:p,setLoading:x}=W(),{feedCountry:g,showTop10:f}=we(),{findSong:d}=De(),[u,l]=r.useState(!1),[o,a]=r.useState("mobile"),[h,k]=r.useState(null),[$,R]=r.useState(null),[I,S]=r.useState(!1),[n,w]=r.useState(!1),[N,j]=r.useState(null),[L,X]=r.useState(null),[Q,T]=r.useState(!1),[Z,J]=r.useState("mobile"),[G,K]=r.useState(null),[q,ee]=r.useState(null),[Y,te]=r.useState(null),V=r.useCallback(async(A=!1)=>{const F=Date.now();if(!(!A&&s&&F-s<xe)){x("feed",!0),w(!1);try{const z=await bt(g,10);m(z),p(F)}catch(z){console.error("Failed to fetch top songs:",z),w(!0)}finally{x("feed",!1)}}},[g,s,m,p,x]);r.useEffect(()=>{if(f){const A=Date.now();(!s||A-s>=xe)&&V(!0)}},[f,g]);const ne=async(A,F,z)=>{if(F){const U=await O.getSongById(F.Id);U&&t(U)}else await se(A,z)},se=async(A,F)=>{const z=!window.matchMedia("(hover: hover) and (pointer: fine)").matches;a(z?"mobile":"desktop"),z||k({x:F.clientX,y:F.clientY}),j(A.name),X(A.id),S(!0),l(!0);try{const U=await Fe(A.url);if(U&&Object.keys(U.linksByPlatform).length>0)R(U);else{const B=ge(A.artistName,A.name);R(B)}}catch{const U=ge(A.artistName,A.name);R(U)}finally{S(!1)}};if(!f)return null;const ie=i.length>0,de=c.feed&&!ie&&!n;return e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-xl font-bold mb-2",children:"Top 10"}),de?e.jsx(Me,{}):ie?e.jsx("div",{className:"space-y-0",children:i.map((A,F)=>{const z=d(A.name,A.artistName),U=z!==null;return e.jsx(me,{rank:F+1,title:A.name,subtitle:A.artistName,artworkUrl:U&&z.AlbumId?O.getAlbumArtUrl(z.AlbumId,96):wt(A.artworkUrl100,96),isInLibrary:U,isMenuOpen:Y===A.id||L===A.id&&u,onClick:B=>ne(A,z,B),onContextMenu:async B=>{if(B.preventDefault(),z){const y=await O.getSongById(z.Id);y&&(ee(y),te(A.id),J("desktop"),K({x:B.clientX,y:B.clientY}),T(!0))}},onLongPress:async()=>{if(z){const B=await O.getSongById(z.Id);B&&(ee(B),te(A.id),J("mobile"),K(null),T(!0))}},onExternalClick:B=>se(A,B)},A.id)})}):e.jsx("div",{className:"py-8 text-left text-gray-500 text-sm",children:"Could not load charts"}),e.jsx(Be,{isOpen:u,onClose:()=>{l(!1),R(null),X(null)},odesliData:$,loading:I,title:N||void 0,mode:o,position:h||void 0}),e.jsx(be,{item:q,itemType:"song",isOpen:Q,onClose:()=>{T(!1),ee(null),te(null)},zIndex:99999,mode:Z,position:G||void 0})]})}function kt(){const t=ye(),{playTrack:i}=oe(),{feedNewReleases:s,feedLastUpdated:c,loading:m,setFeedNewReleases:p,setFeedLastUpdated:x,setLoading:g}=W(),{showNewReleases:f,muspyRssUrl:d}=we(),{findAlbum:u,findSong:l,findArtistImageUrl:o}=De(),[a,h]=r.useState(!1),[k,$]=r.useState("mobile"),[R,I]=r.useState(null),[S,n]=r.useState(null),[w,N]=r.useState(!1),[j,L]=r.useState(!1),[X,Q]=r.useState(null),[T,Z]=r.useState(null),[J,G]=r.useState(!1),[K,q]=r.useState("mobile"),[ee,Y]=r.useState(null),[te,V]=r.useState(null),[ne,se]=r.useState(null),ie=r.useCallback(async(y=!1)=>{if(!d)return;const E=Date.now();if(!(!y&&c&&E-c<xe)){g("feed",!0),L(!1);try{const v=await jt(d,10);p(v),x(E)}catch(v){console.error("Failed to fetch Muspy releases:",v),L(!0)}finally{g("feed",!1)}}},[d,c,p,x,g]);r.useEffect(()=>{if(f&&d){const y=Date.now();(!c||y-c>=xe)&&ie(!0)}},[f,d]);const ce=r.useRef(new Set);r.useEffect(()=>{const y=async()=>{const E=s.filter(v=>v.id.startsWith("muspy-")&&!ce.current.has(v.id));if(E.length!==0)for(const v of E){ce.current.add(v.id);try{console.log(`[FeedSection] Searching MB for: ${v.title} - ${v.artistName}`);const M=await vt(v.artistName,v.title);if(M){console.log(`[FeedSection] Found MBID for "${v.title}": ${M.id} (${M.type})`);const le=W.getState().feedNewReleases.map(re=>re.id===v.id?{...re,id:M.id,type:M.type}:re);p(le)}else console.log(`[FeedSection] No MBID found for "${v.title}"`)}catch(M){console.error(`[FeedSection] Failed to search MB for "${v.title}":`,M)}}};s.length>0&&y()},[s,p]);const de=async(y,E,v)=>{if(E)if(E.type==="song"){const M=await O.getSongById(E.song.Id);M&&i(M)}else t(`/album/${E.albumId}`);else await A(y,v)},A=async(y,E)=>{const v=!window.matchMedia("(hover: hover) and (pointer: fine)").matches;$(v?"mobile":"desktop"),v||I({x:E.clientX,y:E.clientY}),Q(y.title),Z(y.id),N(!0),h(!0);const M=y.mbUrl&&!y.id.startsWith("muspy-");try{let C=null;if(M&&(C=await Fe(y.mbUrl)),C&&Object.keys(C.linksByPlatform).length>0)n(C);else{const le=ge(y.artistName,y.title);n(le)}}catch{const C=ge(y.artistName,y.title);n(C)}finally{N(!1)}};if(!f||!d)return null;const F=s.length>0,z=m.feed,U=!!d,B=z&&!F&&!j&&U;return e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-xl font-bold mb-2",children:"New Releases"}),B?e.jsx(Me,{}):F?e.jsx("div",{className:"space-y-0",children:s.map(y=>{const E=y.type==="Single",v=E?l(y.title,y.artistName):null,M=v?null:u(y.title,y.artistName),C=v?{type:"song",song:v}:M?{type:"album",albumId:M.albumId}:null,le=C!==null,b=!y.id.startsWith("muspy-")?Ue(y.id,250):null,P=o(y.artistName),D=P?O.getArtistImageUrl(P,96):null;let _,fe,Se;(C==null?void 0:C.type)==="song"&&(v!=null&&v.AlbumId)?(_=O.getAlbumArtUrl(v.AlbumId,96),fe=b||void 0,Se=D||void 0):(C==null?void 0:C.type)==="album"&&(M!=null&&M.albumId)?(_=O.getAlbumArtUrl(M.albumId,96),fe=b||void 0,Se=D||void 0):b?(_=b,fe=D||void 0):_=D||"";const ke=new Date(y.releaseDate),Ie=!isNaN(ke.getTime())?ke.toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",_e=Ie?`${y.artistName} â€¢ ${Ie}`:y.artistName,He=E?e.jsx(Qe,{className:"w-3 h-3"}):e.jsx(Ce,{className:"w-3 h-3"});return e.jsx(me,{title:y.title,subtitle:_e,subtitleIcon:He,artworkUrl:_,fallbackArtworkUrl:fe,secondFallbackUrl:Se,isInLibrary:le,isMenuOpen:ne===y.id||T===y.id&&a,onClick:H=>de(y,C,H),onContextMenu:async H=>{if(H.preventDefault(),(C==null?void 0:C.type)==="song"&&v){const ue=await O.getSongById(v.Id);ue&&(V(ue),se(y.id),q("desktop"),Y({x:H.clientX,y:H.clientY}),G(!0))}else if((C==null?void 0:C.type)==="album"&&M){const ue=await O.getAlbumById(M.albumId);ue&&(V(ue),se(y.id),q("desktop"),Y({x:H.clientX,y:H.clientY}),G(!0))}},onLongPress:async()=>{if((C==null?void 0:C.type)==="song"&&v){const H=await O.getSongById(v.Id);H&&(V(H),se(y.id),q("mobile"),Y(null),G(!0))}else if((C==null?void 0:C.type)==="album"&&M){const H=await O.getAlbumById(M.albumId);H&&(V(H),se(y.id),q("mobile"),Y(null),G(!0))}},onExternalClick:H=>A(y,H)},y.id)})}):U?e.jsx("div",{className:"py-8 text-left text-gray-500 text-sm",children:j?"Failed to load releases":"No new releases found"}):e.jsx("div",{className:"py-8 text-center text-gray-500 text-sm",children:"Configure Muspy RSS in settings"}),e.jsx(Be,{isOpen:a,onClose:()=>{h(!1),n(null),Z(null)},odesliData:S,loading:w,title:X||void 0,mode:k,position:R||void 0}),e.jsx(be,{item:te,itemType:(te==null?void 0:te.Type)==="Audio"?"song":"album",isOpen:J,onClose:()=>{G(!1),V(null),se(null)},zIndex:99999,mode:K,position:ee||void 0})]})}function It({twoColumns:t=!1}){const{recentlyPlayed:i,loading:s,setRecentlyPlayed:c,setLoading:m}=W(),{showRecentlyPlayed:p}=we(),{playTrack:x}=oe(),g=Xe(),[f,d]=r.useState(!1),[u,l]=r.useState("mobile"),[o,a]=r.useState(null),[h,k]=r.useState(null);r.useEffect(()=>{p&&(async()=>{m("recentlyPlayed",!0);try{const w=await O.getRecentlyPlayed(10);c(w.Items||[])}catch(w){console.error(w)}finally{m("recentlyPlayed",!1)}})()},[p,c,m]);const $=n=>{x(n,i)};if(!p)return null;const R=i&&i.length>0,S=s.recentlyPlayed&&!R;return e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-xl font-bold mb-2",children:"Recently Played"}),S?e.jsx(Me,{}):R?e.jsx("div",{className:t?"md:grid md:grid-cols-2 md:gap-3 min-[1680px]:block":"",children:t?e.jsxs(e.Fragment,{children:[e.jsx("div",{children:i.slice(0,5).map(n=>{var w,N;return e.jsx(me,{title:n.Name||"Unknown",subtitle:`${n.AlbumArtist||((N=(w=n.ArtistItems)==null?void 0:w[0])==null?void 0:N.Name)||"Unknown Artist"}${n.Album?` â€¢ ${n.Album}`:""}`,artworkUrl:O.getAlbumArtUrl(n.AlbumId||n.Id,96),isCurrentTrack:(g==null?void 0:g.Id)===n.Id,isInLibrary:!0,isMenuOpen:(h==null?void 0:h.Id)===n.Id,paddingRight:!0,onClick:()=>$(n),onContextMenu:j=>{j.preventDefault(),k(n),l("desktop"),a({x:j.clientX,y:j.clientY}),d(!0)},onLongPress:()=>{k(n),l("mobile"),a(null),d(!0)}},n.Id)})}),e.jsx("div",{children:i.slice(5,10).map(n=>{var w,N;return e.jsx(me,{title:n.Name||"Unknown",subtitle:`${n.AlbumArtist||((N=(w=n.ArtistItems)==null?void 0:w[0])==null?void 0:N.Name)||"Unknown Artist"}${n.Album?` â€¢ ${n.Album}`:""}`,artworkUrl:O.getAlbumArtUrl(n.AlbumId||n.Id,96),isCurrentTrack:(g==null?void 0:g.Id)===n.Id,isInLibrary:!0,isMenuOpen:(h==null?void 0:h.Id)===n.Id,paddingRight:!0,onClick:()=>$(n),onContextMenu:j=>{j.preventDefault(),k(n),l("desktop"),a({x:j.clientX,y:j.clientY}),d(!0)},onLongPress:()=>{k(n),l("mobile"),a(null),d(!0)}},n.Id)})})]}):i.map(n=>{var w,N;return e.jsx(me,{title:n.Name||"Unknown",subtitle:`${n.AlbumArtist||((N=(w=n.ArtistItems)==null?void 0:w[0])==null?void 0:N.Name)||"Unknown Artist"}${n.Album?` â€¢ ${n.Album}`:""}`,artworkUrl:O.getAlbumArtUrl(n.AlbumId||n.Id,96),isCurrentTrack:(g==null?void 0:g.Id)===n.Id,isInLibrary:!0,isMenuOpen:(h==null?void 0:h.Id)===n.Id,paddingRight:!0,onClick:()=>$(n),onContextMenu:j=>{j.preventDefault(),k(n),l("desktop"),a({x:j.clientX,y:j.clientY}),d(!0)},onLongPress:()=>{k(n),l("mobile"),a(null),d(!0)}},n.Id)})}):null,e.jsx(be,{item:h,itemType:"song",isOpen:f,onClose:()=>{d(!1),k(null)},zIndex:99999,mode:u,position:o||void 0})]})}function Et(){const[t,i]=r.useState(!1),{recentlyAdded:s,recentlyPlayed:c,loading:m}=W(),{showTop10:p,showNewReleases:x,showRecentlyPlayed:g,muspyRssUrl:f}=we(),d=r.useRef(!1),{isQueueSidebarOpen:u}=oe();r.useEffect(()=>{(m.recentlyAdded||m.recentlyPlayed)&&(d.current=!0)},[m.recentlyAdded,m.recentlyPlayed]);const o=[p,x&&!!f,g].filter(Boolean).length,a=d.current&&!m.recentlyAdded&&!m.recentlyPlayed&&s.length===0&&c.length===0;return e.jsxs("div",{className:"pb-20",children:[e.jsx("div",{className:`fixed top-0 left-0 right-0 bg-black z-10 lg:left-16 transition-[left,right] duration-300 ${u?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top))"},children:e.jsx("div",{className:"max-w-[768px] min-[1680px]:max-w-[1080px] w-full mx-auto",children:e.jsx(at,{onSearchStateChange:i})})}),e.jsx("div",{className:`fixed left-0 right-0 z-[60] lg:left-16 transition-[left,right] duration-300 ${u?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 4.5rem - 2px)",height:"24px",background:"linear-gradient(to bottom, rgba(0, 0, 0, 0.8), transparent)"}}),e.jsx("div",{className:t?"hidden [@media((hover:hover)_and_(pointer:fine)_and_(min-width:1024px))]:block":"",style:{paddingTop:"calc(env(safe-area-inset-top) + 4.5rem + 24px)"},children:e.jsxs("div",{className:"w-full",children:[e.jsx(ft,{}),e.jsx("div",{className:"pb-4",children:e.jsx(ht,{})}),o>0&&e.jsxs("div",{className:`
              mt-4 px-4
              ${o>=2?"md:grid md:gap-3":""}
              ${o===2?"md:grid-cols-2":""}
              ${o>=3?"md:grid-cols-2 min-[1680px]:grid-cols-3":""}
            `,children:[g&&e.jsx("div",{className:o===3?"md:col-span-2 min-[1680px]:col-span-1":"",children:e.jsx(It,{twoColumns:o===3})}),p&&e.jsx("div",{children:e.jsx(Mt,{})}),x&&e.jsx("div",{children:e.jsx(kt,{})})]}),a&&e.jsx("div",{className:"flex items-center justify-center py-16 text-gray-400",children:e.jsx("p",{children:"No music found"})})]})})]})}export{Et as default};
