import{k as Ie,b as ye,a as ee,g as le,r as i,j as e,h as Se,I as E,e as v,l as Ce,S as Pe,s as ke,P as Me,L as De,C as te,f as ae,D as Ee}from"./index-scgXBtC7.js";import{u as se}from"./useScrollLazyLoad-Dy2MVRnq.js";import{A as Te}from"./arrow-left-CXDjeGBi.js";import{E as Oe}from"./ellipsis-Ca9L3Qdt.js";import{C as ze}from"./chevron-up-DVHtpv9O.js";import{A as Le}from"./arrow-up-down-DHpxObdw.js";const ne=45,Be=45,re=45,Re=45;function Fe({album:r,year:g,onNavigate:N,onContextMenu:A,showImage:I=!0}){const[S,C]=i.useState(!1),m=i.useRef(!1),s=o=>{if(m.current){o.preventDefault(),o.stopPropagation(),m.current=!1;return}N(r.Id)},P=o=>{o.preventDefault(),o.stopPropagation(),m.current=!0,A(r,"desktop",{x:o.clientX,y:o.clientY}),setTimeout(()=>{m.current=!1},100)},x=ae({onLongPress:o=>{o.preventDefault(),m.current=!0,A(r,"mobile")},onClick:s});return e.jsxs("button",{onClick:s,onContextMenu:P,...x,className:"text-left group",children:[e.jsx("div",{className:"aspect-square rounded overflow-hidden mb-2 bg-zinc-900 flex items-center justify-center",children:S?e.jsx(Ee,{className:"w-12 h-12 text-gray-500"}):I?e.jsx(E,{src:v.getAlbumArtUrl(r.Id,474),alt:r.Name,className:"w-full h-full object-cover",showOutline:!0,rounded:"rounded",onError:()=>C(!0)}):e.jsx("div",{className:"w-full h-full bg-zinc-900"})}),e.jsx("div",{className:"text-sm font-medium text-white truncate",children:r.Name}),g&&e.jsx("div",{className:"text-xs text-gray-400 truncate",children:g})]})}function Ye({song:r,album:g,year:N,onClick:A,onContextMenu:I,contextMenuItemId:S,showImage:C=!0}){const m=S===r.Id,s=le(),P=o=>{const b=Math.floor(o/1e7),T=Math.floor(b/60),O=b%60;return`${T}:${O.toString().padStart(2,"0")}`},x=ae({onLongPress:o=>{o.preventDefault(),I(r,"mobile")},onClick:()=>A(r)});return e.jsxs("button",{onClick:()=>A(r),onContextMenu:o=>{o.preventDefault(),I(r,"desktop",{x:o.clientX,y:o.clientY})},...x,className:`w-full flex items-center gap-3 hover:bg-white/10 transition-colors group px-4 py-3 ${m?"bg-white/10":""}`,children:[e.jsx("div",{className:"w-12 h-12 rounded-sm overflow-hidden flex-shrink-0 bg-zinc-900 self-center flex items-center justify-center",children:C?e.jsx(E,{src:v.getAlbumArtUrl(r.AlbumId||r.Id,96),alt:r.Name,className:"w-full h-full object-cover",showOutline:!0,rounded:"rounded-sm"}):e.jsx("div",{className:"w-full h-full bg-zinc-900"})}),e.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[e.jsx("div",{className:`text-sm font-medium truncate transition-colors ${(s==null?void 0:s.Id)===r.Id?"text-[var(--accent-color)]":"text-white group-hover:text-[var(--accent-color)]"}`,children:r.Name}),(g||N)&&e.jsxs("div",{className:"text-xs text-gray-400 flex items-center gap-1 min-w-0",children:[g&&e.jsx("span",{className:"truncate",children:g}),g&&N&&e.jsx("span",{className:"flex-shrink-0",children:"•"}),N&&e.jsx("span",{className:"flex-shrink-0",children:N})]})]}),r.RunTimeTicks&&e.jsx("div",{className:"text-xs text-gray-500 flex-shrink-0 text-right",children:P(r.RunTimeTicks)})]})}function Xe(){var Z;const{id:r}=Ie(),g=ye(),{playAlbum:N,playTrack:A,isPlaying:I,pause:S,addToQueue:C}=ee(),m=le(),[s,P]=i.useState(null),[x,o]=i.useState([]),[b,T]=i.useState([]),[O,z]=i.useState(!0),[$,L]=i.useState(!1),[$e,k]=i.useState(!0),[y,B]=i.useState(!0),[ie,R]=i.useState(!1),[oe,U]=i.useState("mobile"),[ce,_]=i.useState(null),[M,F]=i.useState(null),[ue,Y]=i.useState(null),[de,V]=i.useState(!1),[me,xe]=i.useState("mobile"),[he,fe]=i.useState(null),[D,ge]=i.useState("Alphabetical"),[H,q]=i.useState(ne),[Q,G]=i.useState(re),J=i.useRef(null),pe=ee(t=>t.isQueueSidebarOpen);i.useEffect(()=>{const t=document.querySelector(".main-scrollable");t&&t.scrollTo({top:0,behavior:"auto"})},[r]);const X=t=>t.toLowerCase().replace(/[_\*\-\.]/g,"").trim();i.useEffect(()=>{if(!r)return;(async()=>{var l;z(!0);try{let n=await v.getArtistById(r);if(!n){const h=(await v.getArtists({limit:1e3})).Items.find(p=>p.Id===r);h&&(n=h)}if(!n){z(!1);return}P(n),B(!0);const c=await v.getArtistItems(r);if(c.albums.length===0&&c.songs.length===0&&n.Name){const d=X(n.Name),p=((l=(await v.search(n.Name,50)).Artists)==null?void 0:l.Items)||[];for(const f of p)if(f.Id!==r&&X(f.Name)===d){const w=await v.getArtistItems(f.Id);if(w.albums.length>0||w.songs.length>0){g(`/artist/${f.Id}`,{replace:!0});return}}}const u=[...c.albums].sort((d,h)=>{const p=d.ProductionYear||(d.PremiereDate?new Date(d.PremiereDate).getFullYear():0);return(h.ProductionYear||(h.PremiereDate?new Date(h.PremiereDate).getFullYear():0))-p});o(u),T(c.songs)}catch(a){console.error("Failed to load artist data:",a)}finally{z(!1)}})()},[r,g]),i.useEffect(()=>{if(!(s!=null&&s.Overview))return;k(!0);let t=null,l=null,a=null,n=!1;const c=()=>{const h=J.current;if(!h||!(s!=null&&s.Overview)){k(!1);return}const p=window.getComputedStyle(h);let f=parseFloat(p.lineHeight||"0");if((!Number.isFinite(f)||f===0)&&(f=parseFloat(p.fontSize||"16")*1.5),f===0){k(!1);return}const w=h.scrollHeight;if(w===0&&!n){n=!0,u();return}const Ae=Math.round(w/f)>2;k(Ae)},u=()=>{t!==null&&cancelAnimationFrame(t),l!==null&&clearTimeout(l),t=requestAnimationFrame(()=>{l=window.setTimeout(c,0)}),a!==null&&clearTimeout(a),a=window.setTimeout(()=>{n=!1,c()},300)},d=()=>{n=!1,u()};return u(),window.addEventListener("resize",d),()=>{t!==null&&cancelAnimationFrame(t),l!==null&&clearTimeout(l),a!==null&&clearTimeout(a),window.removeEventListener("resize",d)}},[s==null?void 0:s.Overview]),i.useEffect(()=>{q(ne)},[x.length]),i.useEffect(()=>{G(re)},[b.length]),se({totalCount:b.length,visibleCount:Q,increment:Re,setVisibleCount:G,threshold:1}),se({totalCount:x.length,visibleCount:H,increment:Be,setVisibleCount:q,threshold:1});const be=()=>{if(j.length>0){const t=[...j].sort(()=>Math.random()-.5);N(t)}},K=t=>t.ProductionYear?t.ProductionYear.toString():t.PremiereDate?new Date(t.PremiereDate).getFullYear().toString():null,ve=t=>{const l=t.Album||null;let a=null;if(t.AlbumId){const n=x.find(c=>c.Id===t.AlbumId);n&&(a=K(n))}return{album:l,year:a}},W=t=>{if(t.AlbumId){const l=x.find(a=>a.Id===t.AlbumId);if(l)return l.ProductionYear||(l.PremiereDate?new Date(l.PremiereDate).getFullYear():0)}return t.ProductionYear||(t.PremiereDate?new Date(t.PremiereDate).getFullYear():0)},j=i.useMemo(()=>{if(D==="Alphabetical")return[...b].sort((a,n)=>{const c=a.Name||"",u=n.Name||"";return c.localeCompare(u)});const t=(a,n,c)=>{const u=W(a),d=W(n),h=a.AlbumId||"",p=n.AlbumId||"";if(u!==d)return c?d-u:u-d;if(h!==p)return h.localeCompare(p);const f=a.IndexNumber||0,w=n.IndexNumber||0;return f!==w?f-w:(a.Name||"").localeCompare(n.Name||"")},l=D==="Newest";return[...b].sort((a,n)=>t(a,n,l))},[b,D,x]),Ne=t=>{t.preventDefault(),t.stopPropagation(),j.length>0&&N(j)},je=t=>{t.preventDefault(),t.stopPropagation(),j.length>0&&C(j)},we=()=>{ge(t=>t==="Alphabetical"?"Newest":t==="Newest"?"Oldest":"Alphabetical")};return O?e.jsx("div",{className:"pb-20",children:e.jsx("div",{className:"flex items-center justify-center h-screen text-gray-400",children:e.jsx(Se,{})})}):s?e.jsxs("div",{className:"pb-20",children:[e.jsx("div",{className:`fixed top-0 left-0 right-0 z-[60] lg:left-16 transition-[left,right] duration-300 ${pe?"sidebar-open-right-offset":""}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top))"},children:e.jsx("div",{className:"max-w-[768px] mx-auto",children:e.jsxs("div",{className:"relative flex items-center justify-between gap-4 p-4",children:[e.jsx("button",{onClick:()=>g(-1),className:"text-white hover:text-zinc-300 transition-colors z-10",children:e.jsx(Te,{className:"w-6 h-6"})}),s&&e.jsx("button",{onClick:t=>{const l=t.currentTarget.getBoundingClientRect();xe("desktop"),fe({x:l.left+l.width/2,y:l.bottom+5}),V(!0)},className:"text-white hover:text-zinc-300 transition-colors z-10",children:e.jsx(Oe,{className:"w-6 h-6"})})]})})}),e.jsxs("div",{className:"relative z-30 w-screen",style:{marginTop:"calc(-1 * env(safe-area-inset-top))",marginLeft:"calc(50% - 50vw)",marginRight:"calc(50% - 50vw)"},children:[y&&e.jsxs("div",{className:"relative w-full min-h-64 md:min-h-80 bg-black",style:{paddingTop:"env(safe-area-inset-top)"},children:[e.jsx("div",{className:"w-full flex items-center justify-center md:hidden",children:e.jsx(E,{src:v.getArtistImageUrl(s.Id),alt:s.Name,className:"w-full h-auto object-contain",onError:()=>B(!1)})}),e.jsx("div",{className:"hidden md:block w-full h-80",children:e.jsx("img",{src:v.getArtistBackdropUrl(s.Id),alt:s.Name,className:"w-full h-full object-cover",onError:()=>B(!1)})}),e.jsx("div",{className:"absolute inset-x-0 top-0 bottom-[-1px] bg-gradient-to-b from-transparent via-black/60 to-black pointer-events-none"})]}),e.jsx("div",{className:`left-0 right-0 ${y?"absolute":"relative"} ${y?"pt-16":"pt-12"}`,style:y?{bottom:"-28px",paddingBottom:"1.5rem"}:{},children:e.jsxs("div",{className:"max-w-[768px] mx-auto px-4 flex items-end gap-6 md:grid md:grid-cols-3 md:gap-4",children:[y&&e.jsx("div",{className:"hidden md:block md:col-span-1",children:e.jsx("div",{className:"aspect-square rounded overflow-hidden bg-zinc-900 flex items-center justify-center",children:e.jsx(E,{src:v.getArtistImageUrl(s.Id),alt:s.Name,className:"w-full h-full object-cover",showOutline:!0,rounded:"rounded"})})}),e.jsx("div",{className:`flex-1 min-w-0 pb-2 ${y?"md:col-span-2":"md:col-span-3"}`,children:e.jsxs("div",{className:"mb-4 mt-4",children:[e.jsx("h1",{className:"text-4xl md:text-5xl font-bold text-white mb-2 break-words",children:s.Name}),e.jsxs("div",{className:"flex items-center justify-between gap-4 mt-2",children:[e.jsxs("p",{className:"text-sm text-gray-300",children:[x.length," ",x.length===1?"album":"albums"," • ",j.length," ",j.length===1?"song":"songs"]}),e.jsx("button",{onClick:()=>{var l;m&&I&&(((l=m.ArtistItems)==null?void 0:l.some(a=>a.Id===r))||m.AlbumArtist===(s==null?void 0:s.Name))?S():be()},className:"bg-white/10 hover:bg-white/20 text-white font-semibold py-1.5 px-3 rounded-full transition-all hover:scale-105 flex items-center gap-1.5 backdrop-blur-sm border border-white/20 flex-shrink-0",children:m&&I&&((Z=m.ArtistItems)!=null&&Z.some(t=>t.Id===r)||m.AlbumArtist===(s==null?void 0:s.Name))?e.jsxs(e.Fragment,{children:[e.jsx(Ce,{className:"w-3.5 h-3.5"}),"Pause"]}):e.jsxs(e.Fragment,{children:[e.jsx(Pe,{className:"w-3.5 h-3.5"}),"Shuffle"]})})]})]})})]})})]}),e.jsxs("div",{className:"pt-3 md:pt-7",children:[s.Overview&&e.jsx("div",{className:"mb-6 -mt-4 px-4",children:e.jsxs("div",{className:"text-white relative",children:[e.jsx("p",{ref:J,className:"text-sm text-gray-300 leading-relaxed absolute opacity-0 pointer-events-none -z-10",children:s.Overview}),!$&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>L(!0),className:"flex-1 text-left min-w-0",children:e.jsx("p",{className:"text-sm text-gray-300 leading-relaxed line-clamp-2",children:s.Overview})}),e.jsx("button",{onClick:()=>L(!0),className:"flex-shrink-0 text-gray-400 hover:text-white transition-colors",children:e.jsx(ke,{className:"w-4 h-4"})})]}),$&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-300 leading-relaxed whitespace-pre-line",children:s.Overview}),e.jsxs("button",{onClick:()=>L(!1),className:"mt-2 flex items-center gap-1 text-sm text-gray-400 hover:text-white transition-colors ml-auto",children:["Show less",e.jsx(ze,{className:"w-4 h-4"})]})]})]})}),x.length>0&&e.jsxs("div",{className:"mb-10 px-4",children:[e.jsxs("h2",{className:"text-2xl font-bold text-white mb-4",children:["Albums (",x.length,")"]}),e.jsx("div",{className:"grid grid-cols-3 md:grid-cols-4 gap-4",children:x.map((t,l)=>{const a=K(t);return e.jsx(Fe,{album:t,year:a,onNavigate:n=>g(`/album/${n}`),onContextMenu:(n,c,u)=>{F(n),Y("album"),U(c||"mobile"),_(u||null),R(!0)},showImage:l<H},t.Id)})})]}),b.length>0&&e.jsxs("div",{id:"songs-section",children:[e.jsxs("div",{className:"px-4 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h2",{className:"text-2xl font-bold text-white",children:["Songs (",b.length,")"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:Ne,className:"w-10 h-10 flex items-center justify-center text-white hover:bg-white/10 rounded-lg transition-colors","aria-label":"Play all songs",children:e.jsx(Me,{className:"w-5 h-5"})}),e.jsx("button",{type:"button",onClick:je,className:"w-10 h-10 flex items-center justify-center text-white hover:bg-white/10 rounded-lg transition-colors","aria-label":"Add all songs to queue",children:e.jsx(De,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"mt-1",children:e.jsxs("button",{type:"button",onClick:we,className:"text-sm text-gray-400 hover:text-white transition-colors flex items-center gap-1",children:[D,e.jsx(Le,{className:"w-4 h-4"})]})})]}),e.jsx("div",{className:"space-y-0",children:j.map((t,l)=>{const{album:a,year:n}=ve(t);return e.jsx(Ye,{song:t,album:a,year:n,onClick:A,onContextMenu:(c,u,d)=>{F(c),Y("song"),U(u||"mobile"),_(d||null),R(!0)},contextMenuItemId:(M==null?void 0:M.Id)||null,showImage:l<Q},t.Id)})})]})]}),e.jsx(te,{item:M,itemType:ue,isOpen:ie,onClose:()=>{R(!1),F(null),Y(null)},zIndex:99999,mode:oe,position:ce||void 0}),e.jsx(te,{item:s,itemType:"artist",isOpen:de,onClose:()=>{V(!1)},mode:me,position:he||void 0})]}):e.jsx("div",{className:"pb-20",children:e.jsx("div",{className:"flex items-center justify-center h-screen text-gray-400",children:e.jsx("p",{children:"Artist not found on the Jellyfin server"})})})}export{Xe as default};
