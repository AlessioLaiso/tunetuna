import{m as V,b as K,a as v,g as A,r as n,j as e,o as Q,P as U,C as T,e as w,l as Y,f as J,I as X,h as q}from"./index-BZ_PLwtQ.js";import{A as G}from"./arrow-left-CcRMvxfn.js";import{E as W}from"./ellipsis-Dfa8CYu6.js";const S=45,Z=45;function ee({track:t,index:N,tracks:h,onClick:f,onContextMenu:d,contextMenuItemId:p}){var m,g;const o=p===t.Id,r=A(),s=n.useRef(!1),j=a=>{a.preventDefault(),a.stopPropagation(),s.current=!0,d(t,"desktop",{x:a.clientX,y:a.clientY}),setTimeout(()=>{s.current=!1},300)},b=J({onLongPress:a=>{a.preventDefault(),s.current=!0,d(t,"mobile")},onClick:()=>{if(s.current){s.current=!1;return}f(t,h)}});return e.jsxs("button",{onClick:()=>{if(s.current){s.current=!1;return}f(t,h)},onContextMenu:j,...b,className:`w-full flex items-center gap-3 hover:bg-white/10 transition-colors group px-4 py-3 ${o?"bg-white/10":""}`,children:[e.jsx("div",{className:"w-12 h-12 rounded-sm overflow-hidden flex-shrink-0 bg-zinc-900 self-center",children:e.jsx(X,{src:w.getAlbumArtUrl(t.AlbumId||t.Id,96),alt:t.Name,className:"w-full h-full object-cover",showOutline:!0,rounded:"rounded-sm"})}),e.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[e.jsx("div",{className:`text-sm font-medium truncate transition-colors ${(r==null?void 0:r.Id)===t.Id?"text-[var(--accent-color)]":"text-white group-hover:text-[var(--accent-color)]"}`,children:t.Name}),e.jsxs("div",{className:"text-xs text-gray-400 truncate",children:[t.AlbumArtist||((g=(m=t.ArtistItems)==null?void 0:m[0])==null?void 0:g.Name)||"Unknown Artist",t.Album&&` â€¢ ${t.Album}`]})]}),t.RunTimeTicks&&e.jsx("div",{className:"text-xs text-gray-500 flex-shrink-0 text-right",children:q(t.RunTimeTicks)})]})}function le(){const{id:t}=V(),N=K(),{playAlbum:h,playTrack:f,isPlaying:d}=v(),p=A(),[o,r]=n.useState(null),[s,j]=n.useState([]),[b,m]=n.useState(!0),[g,a]=n.useState(!1),[y,P]=n.useState(null),[E,L]=n.useState("mobile"),[O,R]=n.useState(null),[k,C]=n.useState(!1),[D,H]=n.useState("mobile"),[z,B]=n.useState(null),[_,I]=n.useState(S),$=v(l=>l.isQueueSidebarOpen);n.useEffect(()=>{if(!t)return;(async()=>{m(!0);try{const i=await w.getAlbumTracks(t);j(i);const u=(await w.getPlaylists({limit:1e3})).Items.find(x=>x.Id===t);u?r(u):i.length>0&&r({Id:t,Name:"Playlist",Type:"Playlist"})}catch(i){Y.error("Failed to load playlist data:",i)}finally{m(!1)}})()},[t]),n.useEffect(()=>{I(S)},[s.length]),n.useEffect(()=>{const l=()=>{const i=window.scrollY||document.documentElement.scrollTop,c=window.innerHeight||document.documentElement.clientHeight,u=document.documentElement.scrollHeight;i+c*1.5>=u&&I(x=>Math.min(x+Z,s.length))};return window.addEventListener("scroll",l,{passive:!0}),()=>window.removeEventListener("scroll",l)},[s.length]);const F=()=>{s.length>0&&h(s)},M=()=>!s.length||!p?!1:s.some(l=>l.Id===p.Id);return b?e.jsx("div",{className:"pb-20",children:e.jsx("div",{className:"flex items-center justify-center h-screen text-gray-400",children:e.jsx("p",{children:"Loading..."})})}):!o||s.length===0?e.jsx("div",{className:"pb-20",children:e.jsx("div",{className:"flex items-center justify-center h-screen text-gray-400",children:e.jsx("p",{children:"Playlist not found"})})}):e.jsxs("div",{className:"pb-20",children:[e.jsx("div",{className:`fixed top-0 left-0 right-0 bg-black z-10 lg:left-16 transition-[left,right] duration-300 ${$?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top))"},children:e.jsx("div",{className:"max-w-[768px] mx-auto",children:e.jsxs("div",{className:"flex items-center justify-between gap-4 px-4",style:{paddingTop:"calc(1rem + 8px)",paddingBottom:"1rem"},children:[e.jsx("button",{onClick:()=>N(-1),className:"text-white hover:text-zinc-300 transition-colors",children:e.jsx(G,{className:"w-6 h-6"})}),o&&e.jsx("button",{onClick:l=>{const i=l.currentTarget.getBoundingClientRect();H("desktop"),B({x:i.left+i.width/2,y:i.bottom+5}),C(!0)},className:"text-white hover:text-zinc-300 transition-colors",children:e.jsx(W,{className:"w-6 h-6"})})]})})}),e.jsxs("div",{className:"pt-20",children:[e.jsx("div",{className:"mb-6 px-4 pt-4",children:e.jsxs("div",{className:"w-full",children:[e.jsx("h2",{className:"text-4xl md:text-5xl font-bold mb-0.5 text-left break-words",children:o.Name}),e.jsxs("div",{className:"flex items-center justify-between gap-4 mt-2",children:[e.jsxs("div",{className:"text-gray-400",children:[s.length," ",s.length===1?"track":"tracks"]}),e.jsx("button",{onClick:M()&&d?()=>v.getState().pause():F,className:"bg-white/10 hover:bg-white/20 text-white font-semibold py-1.5 px-3 rounded-full transition-all hover:scale-105 flex items-center gap-1.5 backdrop-blur-sm border border-white/20 flex-shrink-0",children:M()&&d?e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"w-3.5 h-3.5"}),"Pause"]}):e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"w-3.5 h-3.5"}),"Play"]})})]})]})}),e.jsx("div",{children:e.jsx("div",{className:"space-y-0",children:s.slice(0,_).map((l,i)=>e.jsx(ee,{track:l,index:i,tracks:s,onClick:c=>f(c,s),onContextMenu:(c,u,x)=>{P(c),L(u||"mobile"),R(x||null),a(!0)},contextMenuItemId:(y==null?void 0:y.Id)||null},l.Id))})})]}),e.jsx(T,{item:y,itemType:"song",isOpen:g,onClose:()=>{a(!1),P(null)},mode:E,position:O||void 0}),e.jsx(T,{item:o,itemType:"playlist",isOpen:k,onClose:()=>{C(!1)},mode:D,position:z||void 0})]})}export{le as default};
