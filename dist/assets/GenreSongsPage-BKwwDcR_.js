import{m as je,b as Se,a as T,g as ve,u as we,s as Ae,r as l,j as e,i as Ie,S as Pe,P as ye,L as Ce,C as De,e as M,l as K,f as Me,D as Ee,I as Ge}from"./index-PsEdoSi2.js";import{u as W}from"./useScrollLazyLoad-1vmlePRD.js";import{S as ke}from"./SongItem-Bg5OLh4P.js";import{P as Le}from"./Pagination-hmfO_Z-V.js";import{A as Y}from"./arrow-left-DTh5IIws.js";import{A as Te}from"./arrow-up-down-zKh4t3O0.js";const Z=45,Ye=45,D=84,ee=45,Be=45;function Oe({album:o,year:b,onNavigate:A,onContextMenu:E,showImage:B=!0}){const[O,G]=l.useState(!1),x=l.useRef(!1),S=g=>{g.preventDefault(),g.stopPropagation(),x.current=!0,E(o,"desktop",{x:g.clientX,y:g.clientY}),setTimeout(()=>{x.current=!1},300)},I=Me({onLongPress:g=>{g.preventDefault(),x.current=!0,E(o,"mobile")},onClick:()=>{if(x.current){x.current=!1;return}A(o.Id)}});return e.jsxs("button",{onClick:()=>{if(x.current){x.current=!1;return}A(o.Id)},onContextMenu:S,...I,className:"text-left group",children:[e.jsx("div",{className:"aspect-square rounded overflow-hidden mb-2 bg-zinc-900 flex items-center justify-center",children:O?e.jsx(Ee,{className:"w-12 h-12 text-gray-500"}):B?e.jsx(Ge,{src:M.getAlbumArtUrl(o.Id,474),alt:o.Name,className:"w-full h-full object-cover",showOutline:!0,rounded:"rounded",onError:()=>G(!0)}):e.jsx("div",{className:"w-full h-full bg-zinc-900"})}),e.jsx("div",{className:"text-sm font-medium text-white truncate",children:o.Name}),b&&e.jsx("div",{className:"text-xs text-gray-400 truncate",children:b})]})}function $e(){const{id:o}=je(),b=Se(),{playAlbum:A,toggleShuffle:E,isPlaying:B,pause:O,shuffleGenreSongs:G,addToQueue:x}=T();ve();const{genres:S,genreSongs:I,setGenreSongs:g}=we(),{state:z}=Ae(),[d,F]=l.useState(null),[f,_]=l.useState([]),[te,v]=l.useState(!0),[se,V]=l.useState(!1),[re,ne]=l.useState("mobile"),[ae,le]=l.useState(null),[ie,U]=l.useState(null),[oe,R]=l.useState(null),[$,Q]=l.useState(Z),[q,H]=l.useState(ee),[ce,ue]=l.useState(0),[w,k]=l.useState(!1),[P,me]=l.useState("Alphabetical"),[L,J]=l.useState(0),y=T(t=>t.isQueueSidebarOpen);l.useEffect(()=>{if(w){const t=setTimeout(()=>{k(!1)},1e4);return()=>clearTimeout(t)}},[w]),l.useEffect(()=>{z==="success"&&o&&ue(t=>t+1)},[z,o]),l.useEffect(()=>{if(!o)return;let t=!0;return(async()=>{const s=I[o];if(s&&s.length>0){let n=S;if(n.length===0&&(n=await M.getGenres()),!t)return;const a=n.find(i=>i.Id===o);a&&F(a),_(s),v(!1);return}v(!0);try{let n=S;if(n.length===0&&(n=await M.getGenres()),!t)return;const a=n.find(c=>c.Id===o);if(!a){v(!1);return}F(a);const i=a.Name;if(!i){v(!1);return}const m=await M.getGenreSongs(o,i);if(!t)return;g(o,m),_(m)}catch(n){if(!t)return;K.error("Failed to load genre songs:",n)}finally{t&&v(!1)}})(),()=>{t=!1}},[o,S,I,g,ce]);const de=async()=>{if(f.length>0&&(d!=null&&d.Id)&&(d!=null&&d.Name)&&!w){const t=T.getState(),{isShuffleAllActive:r,isShuffleGenreActive:s,shuffle:n}=t;if(r||s)return;k(!0);try{await G(d.Id,d.Name)}catch(a){K.error("Failed to shuffle genre:",a)}finally{k(!1)}}},u=l.useMemo(()=>{const t=new Map;return f.forEach(r=>{if(r.AlbumId&&r.Album&&!t.has(r.AlbumId)){const s={Id:r.AlbumId,Name:r.Album,AlbumArtist:r.AlbumArtist,ArtistItems:r.ArtistItems,ProductionYear:r.ProductionYear,PremiereDate:r.PremiereDate};t.set(r.AlbumId,s)}}),Array.from(t.values()).sort((r,s)=>{const n=r.ProductionYear||(r.PremiereDate?new Date(r.PremiereDate).getFullYear():0),a=s.ProductionYear||(s.PremiereDate?new Date(s.PremiereDate).getFullYear():0);if(n!==a)return a-n;const i=r.Name||"",m=s.Name||"";return i.localeCompare(m)})},[f]),p=u.length>84,fe=l.useMemo(()=>{if(!p)return u;const t=L*D,r=t+D;return u.slice(t,r)},[u,L,p]);l.useMemo(()=>{const t=new Map;f.forEach(s=>{var m,c;const n=s.AlbumArtist||((c=(m=s.ArtistItems)==null?void 0:m[0])==null?void 0:c.Name)||"Unknown Artist",a=s.AlbumId||"no-album";t.has(n)||t.set(n,new Map);const i=t.get(n);i.has(a)||i.set(a,[]),i.get(a).push(s)});const r=[];return t.forEach((s,n)=>{const a=[];s.forEach((i,m)=>{var j;const c=[...i].sort((C,pe)=>{const be=C.IndexNumber||0,Ne=pe.IndexNumber||0;return be-Ne}),h=((j=c[0])==null?void 0:j.Album)||"Unknown Album";a.push({albumId:m,albumName:h,songs:c})}),a.sort((i,m)=>{const c=i.songs[0],h=m.songs[0],j=(c==null?void 0:c.ProductionYear)||(c!=null&&c.PremiereDate?new Date(c.PremiereDate).getFullYear():0),C=(h==null?void 0:h.ProductionYear)||(h!=null&&h.PremiereDate?new Date(h.PremiereDate).getFullYear():0);return j!==C?C-j:i.albumName.localeCompare(m.albumName)}),r.push({artist:n,albums:a})}),r.sort((s,n)=>s.artist.localeCompare(n.artist)),r},[f]);const X=(t,r)=>{const s=r.find(a=>a.Id===t.AlbumId);if(s){const a=s.ProductionYear||(s.PremiereDate?new Date(s.PremiereDate).getFullYear():0);return s.PremiereDate?new Date(s.PremiereDate).getTime():a*1e4}const n=t.ProductionYear||(t.PremiereDate?new Date(t.PremiereDate).getFullYear():0);return t.PremiereDate?new Date(t.PremiereDate).getTime():n*1e4},N=l.useMemo(()=>P==="Alphabetical"?[...f].sort((t,r)=>{const s=t.Name||"",n=r.Name||"";return s.localeCompare(n)}):[...f].sort((t,r)=>{const s=X(t,u),n=X(r,u);if(s!==n)return P==="Newest"?n-s:s-n;const a=t.Album||"",i=r.Album||"";if(a!==i)return a.localeCompare(i);const m=t.IndexNumber||0,c=r.IndexNumber||0;if(m!==c)return m-c;const h=t.Name||"",j=r.Name||"";return h.localeCompare(j)}),[f,P,u]),he=()=>{me(t=>t==="Alphabetical"?"Newest":t==="Newest"?"Oldest":"Alphabetical")},xe=()=>{N.length>0&&A(N)},ge=()=>{N.length>0&&x(N)};return l.useEffect(()=>{p||Q(Z)},[u.length,p]),l.useEffect(()=>{J(0)},[o]),l.useEffect(()=>{H(ee)},[N.length]),W({totalCount:N.length,visibleCount:q,increment:Be,setVisibleCount:H,threshold:1}),W({totalCount:u.length,visibleCount:$,increment:Ye,setVisibleCount:Q,threshold:1,enabled:!p}),te?e.jsxs("div",{className:"pb-20",children:[e.jsx("div",{className:`fixed top-0 left-0 right-0 bg-black z-10 lg:left-16 transition-[left,right] duration-300 ${y?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top))"},children:e.jsx("div",{className:"max-w-[768px] mx-auto",children:e.jsxs("div",{className:"flex items-center gap-4 p-4",children:[e.jsx("button",{onClick:()=>b(-1),className:"text-white hover:text-zinc-300 transition-colors",children:e.jsx(Y,{className:"w-6 h-6"})}),e.jsx("h1",{className:"text-xl font-bold flex-1 truncate",children:(d==null?void 0:d.Name)||""}),e.jsx("div",{className:"flex items-center",children:e.jsx(Ie,{})})]})})}),e.jsx("div",{className:"pt-20",children:e.jsx("div",{className:"flex items-center justify-center h-screen text-gray-400"})})]}):!d||f.length===0?e.jsxs("div",{className:"pb-20",children:[e.jsx("div",{className:`fixed top-0 left-0 right-0 bg-black z-10 lg:left-16 transition-[left,right] duration-300 ${y?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top))"},children:e.jsx("div",{className:"max-w-[768px] mx-auto",children:e.jsxs("div",{className:"flex items-center gap-4 p-4",children:[e.jsx("button",{onClick:()=>b(-1),className:"text-white hover:text-zinc-300 transition-colors",children:e.jsx(Y,{className:"w-6 h-6"})}),e.jsx("h1",{className:"text-xl font-bold flex-1 truncate",children:"Genre"})]})})}),e.jsx("div",{className:"pt-20",children:e.jsx("div",{className:"flex items-center justify-center h-screen text-gray-400",children:e.jsx("p",{children:"Genre not found or no songs available"})})})]}):e.jsxs("div",{className:"pb-20",children:[e.jsx("div",{className:`fixed top-0 left-0 right-0 bg-black z-10 lg:left-16 transition-[left,right] duration-300 ${y?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top))"},children:e.jsx("div",{className:"max-w-[768px] mx-auto",children:e.jsxs("div",{className:"flex items-center gap-4 p-4",children:[e.jsx("button",{onClick:()=>b(-1),className:"text-white hover:text-zinc-300 transition-colors",children:e.jsx(Y,{className:"w-6 h-6"})}),e.jsx("h1",{className:"text-xl font-bold flex-1 truncate",children:d.Name}),e.jsx("button",{onClick:de,disabled:w,className:"w-8 h-8 flex items-center justify-center text-white hover:bg-zinc-800 rounded-full transition-colors disabled:opacity-50","aria-label":"Shuffle genre songs",children:w?e.jsx("div",{className:"w-4 h-4 border-2 border-zinc-400 border-t-white rounded-full animate-spin"}):e.jsx(Pe,{className:"w-5 h-5"})})]})})}),e.jsx("div",{className:`fixed left-0 right-0 z-[60] lg:left-16 transition-[left,right] duration-300 ${y?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 5rem - 16px)",height:"24px",background:"linear-gradient(to bottom, rgba(0, 0, 0, 0.8), transparent)"}}),e.jsxs("div",{style:{paddingTop:"calc(env(safe-area-inset-top) + 5rem)"},children:[u.length>0&&e.jsxs("div",{className:"mb-10 px-4 pt-4",children:[e.jsxs("h2",{className:"text-xl font-bold text-white mb-4",children:["Albums (",u.length,")"]}),e.jsx("div",{className:"grid grid-cols-3 md:grid-cols-4 gap-4",children:(p?fe:u).map((t,r)=>{const s=t.ProductionYear||(t.PremiereDate?new Date(t.PremiereDate).getFullYear():null);return e.jsx(Oe,{album:t,year:s,onNavigate:n=>b(`/album/${n}`),onContextMenu:(n,a,i)=>{U(n),R("album"),ne(a||"mobile"),le(i||null),V(!0)},showImage:p?!0:r<$},t.Id)})})]}),p&&u.length>0&&e.jsx("div",{className:"-mt-10 mb-10",children:e.jsx(Le,{currentPage:L,totalPages:Math.ceil(u.length/D),onPageChange:J,itemsPerPage:D,totalItems:u.length})}),f.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"px-4 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h2",{className:"text-2xl font-bold text-white",children:["Songs (",f.length,")"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:xe,className:"w-10 h-10 flex items-center justify-center text-white hover:bg-white/10 rounded-full transition-colors","aria-label":"Play all songs",children:e.jsx(ye,{className:"w-5 h-5"})}),e.jsx("button",{type:"button",onClick:ge,className:"w-10 h-10 flex items-center justify-center text-white hover:bg-white/10 rounded-full transition-colors","aria-label":"Add all songs to queue",children:e.jsx(Ce,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"mt-1",children:e.jsxs("button",{type:"button",onClick:he,className:"text-sm text-gray-400 hover:text-white transition-colors flex items-center gap-1",children:[P,e.jsx(Te,{className:"w-4 h-4"})]})})]}),e.jsx("div",{className:"space-y-0",children:N.map((t,r)=>{const s=r<q;return e.jsx(ke,{song:t,showImage:s},t.Id)})})]})]}),e.jsx(De,{item:ie,itemType:oe,isOpen:se,onClose:()=>{V(!1),U(null),R(null)},mode:re,position:ae||void 0})]})}export{$e as default};
