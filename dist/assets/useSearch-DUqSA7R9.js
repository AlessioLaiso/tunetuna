import{r as a,j as t,B as E,X as F,l as M}from"./index-BtrRwJyr.js";import{u as L,f as $}from"./search-BiHio9im.js";function q({isOpen:v,onClose:b,filterType:m,availableYears:l=[],yearRange:x={min:null,max:null},onApplyYear:w,genres:R=[],selectedValues:N=[],onApply:h}){const[i,f]=a.useState(x),[c,p]=a.useState(N),r=a.useRef(null),j=a.useRef(null);a.useEffect(()=>{f(x)},[x]),a.useEffect(()=>{p(N)},[N]);const S=e=>{p(n=>n.includes(e)?n.filter(s=>s!==e):[...n,e])},k=()=>{m==="year"&&w?w(i):m==="genre"&&h&&h(c),b()},G=()=>{m==="year"?(f({min:null,max:null}),w&&w({min:null,max:null})):m==="genre"&&p([]),b()},I=l.length>0?l[0]:1900,z=l.length>0?l[l.length-1]:new Date().getFullYear(),d=a.useRef(!1);a.useEffect(()=>{if(m==="year"&&v&&l.length>0){const e=d.current;d.current=!1,setTimeout(()=>{if(r.current){const s=i.min!==null?l.indexOf(i.min):0;if(s!==-1){const o=r.current.querySelector(`[data-year-index="${s}"]`);o&&o.scrollIntoView({behavior:e?"instant":"smooth",block:"center"})}}if(j.current){const s=i.max!==null?l.indexOf(i.max):l.length-1;if(s!==-1){const o=j.current.querySelector(`[data-year-index="${s}"]`);o&&o.scrollIntoView({behavior:e?"instant":"smooth",block:"center"})}}},e?350:50)}},[m,v,i.min,i.max,l]),a.useEffect(()=>{v&&(d.current=!0)},[v]);const u=(e,n)=>{f(s=>{if(e==="min"){const o=s.max!==null&&n>s.max?s.max:n;return setTimeout(()=>{const g=l.indexOf(o);if(g!==-1&&r.current){const C=r.current.querySelector(`[data-year-index="${g}"]`);C&&C.scrollIntoView({behavior:"smooth",block:"center"})}},50),{...s,min:o}}else{const o=s.min!==null&&n<s.min?s.min:n;return setTimeout(()=>{const g=l.indexOf(o);if(g!==-1&&j.current){const C=j.current.querySelector(`[data-year-index="${g}"]`);C&&C.scrollIntoView({behavior:"smooth",block:"center"})}},50),{...s,max:o}}})},y=(i.min===null||i.min===I)&&(i.max===null||i.max===z)&&x.min===null&&x.max===null;return t.jsx(E,{isOpen:v,onClose:b,zIndex:10001,children:t.jsxs("div",{className:"pb-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4 px-4",children:[t.jsxs("div",{className:"text-lg font-semibold text-white",children:["Filter by ",m==="genre"?"Genre":"Year"]}),t.jsx("button",{onClick:b,className:"w-8 h-8 flex items-center justify-center text-white hover:bg-white/10 rounded-full transition-colors","aria-label":"Close",children:t.jsx(F,{className:"w-5 h-5"})})]}),t.jsx("div",{className:"px-4 max-h-[75vh] overflow-y-auto overscroll-none touch-pan-y",children:m==="year"?t.jsx("div",{className:"space-y-6",children:t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsxs("div",{className:"flex-1 relative",children:[t.jsx("div",{className:"text-center text-sm text-gray-400 mb-2",children:"From"}),t.jsx("div",{ref:r,className:"h-64 overflow-y-auto scroll-smooth snap-y snap-mandatory py-[calc(50%-1.5rem)] overscroll-contain",children:l.length>0?l.map((e,n)=>{const s=i.min===e,o=i.max!==null&&e>i.max;return t.jsx("button",{"data-year-index":n,onClick:()=>u("min",e),disabled:o,className:`w-full py-3 px-4 text-center snap-center transition-colors ${s?"bg-[var(--accent-color)] text-white font-semibold rounded-lg":o?"text-gray-500 cursor-not-allowed":"text-white hover:bg-white/10"}`,children:e},e)}):t.jsx("div",{className:"text-center py-8 text-gray-400",children:t.jsx("div",{className:"text-sm",children:"No years available"})})}),t.jsx("div",{className:"absolute left-0 right-0 h-12 bg-gradient-to-b from-zinc-900 to-transparent pointer-events-none",style:{top:"1.75rem"}}),t.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-12 bg-gradient-to-t from-zinc-900 to-transparent pointer-events-none"})]}),t.jsxs("div",{className:"flex-1 relative",children:[t.jsx("div",{className:"text-center text-sm text-gray-400 mb-2",children:"To"}),t.jsx("div",{ref:j,className:"h-64 overflow-y-auto scroll-smooth snap-y snap-mandatory py-[calc(50%-1.5rem)] overscroll-contain",children:l.length>0?l.map((e,n)=>{const s=i.max===e,o=i.min!==null&&e<i.min;return t.jsx("button",{"data-year-index":n,onClick:()=>u("max",e),disabled:o,className:`w-full py-3 px-4 text-center snap-center transition-colors ${s?"bg-[var(--accent-color)] text-white font-semibold rounded-lg":o?"text-gray-500 cursor-not-allowed":"text-white hover:bg-white/10"}`,children:e},e)}):t.jsx("div",{className:"text-center py-8 text-gray-400",children:t.jsx("div",{className:"text-sm",children:"No years available"})})}),t.jsx("div",{className:"absolute left-0 right-0 h-14 bg-gradient-to-b from-zinc-900 via-zinc-900/80 to-transparent pointer-events-none",style:{top:"1.75rem"}}),t.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-14 bg-gradient-to-t from-zinc-900 via-zinc-900/80 to-transparent pointer-events-none"})]})]})}):t.jsx("div",{className:"space-y-2",children:m==="genre"?R.length>0?[...R].sort((e,n)=>(e.Name||"").localeCompare(n.Name||"")).map(e=>{const n=e.Name||"",s=c.includes(n);return t.jsxs("button",{onClick:()=>S(n),className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-white/10 transition-colors text-left",children:[t.jsx("div",{className:`w-5 h-5 rounded border-2 flex items-center justify-center transition-colors ${s?"bg-white border-white":"border-white/40 bg-transparent"}`,children:s&&t.jsx("svg",{className:"w-3 h-3 text-zinc-900",fill:"currentColor",viewBox:"0 0 20 20",children:t.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),t.jsx("span",{className:"text-white font-medium",children:n})]},e.Id)}):t.jsx("div",{className:"text-center py-8 text-gray-400",children:t.jsx("div",{className:"text-sm",children:"No genres available"})}):t.jsx("div",{className:"text-center py-8 text-gray-400",children:t.jsx("div",{className:"text-sm",children:"No genres available"})})})}),t.jsxs("div",{className:"flex gap-3 mt-6 px-4",children:[t.jsx("button",{onClick:G,disabled:m==="year"&&y,className:"flex-1 px-4 py-3 bg-white/10 hover:bg-white/20 disabled:opacity-30 disabled:cursor-not-allowed text-white font-medium rounded-lg transition-colors",children:"Clear"}),t.jsx("button",{onClick:k,className:"flex-1 px-4 py-3 bg-white text-zinc-900 font-medium rounded-lg hover:bg-gray-100 transition-colors",children:"Apply"})]})]})})}function B(v={}){const{debounceMs:b=250,limit:m=450,includeYearFilter:l=!0}=v,[x,w]=a.useState(""),[R,N]=a.useState(!1),[h,i]=a.useState(null),f=a.useRef(null),[c,p]=a.useState([]),[r,j]=a.useState({min:null,max:null}),S=l?c.length>0||r.min!==null||r.max!==null:c.length>0,k=a.useCallback(()=>{const d={};if(c.length>0&&(d.genres=c),l&&(r.min!==null||r.max!==null)){const u=new Date().getFullYear(),y=r.min??1900,e=r.max??u,n=[];for(let s=y;s<=e;s++)n.push(s);d.years=n}return d.genres||d.years?d:void 0},[c,r,l]);a.useEffect(()=>{f.current&&f.current.abort();const d=x.trim().length>0;if(d||S){N(!0);const u=new AbortController;f.current=u;const y=async()=>{if(!u.signal.aborted)try{const e=k();let n;d?n=await L(x,m,e):n=await $(m,e),u.signal.aborted||i(n)}catch(e){u.signal.aborted||(M.error("Search failed:",e),i(null))}finally{u.signal.aborted||N(!1)}};if(b>0){const e=window.setTimeout(y,b);return()=>{window.clearTimeout(e),u.abort()}}else return y(),()=>{u.abort()}}else f.current=null,i(null),N(!1)},[x,c,r,S,b,m,k]),a.useEffect(()=>()=>{f.current&&f.current.abort()},[]);const G=a.useMemo(()=>{if(!h)return null;const d=e=>{if(l&&(r.min!==null||r.max!==null))return!1;if(c.length>0){const n=e.Genres||[];if(!c.some(o=>n.some(g=>g.toLowerCase()===o.toLowerCase())))return!1}return!0},u=e=>{if(c.length>0){const n=e.Genres||[];if(!c.some(o=>n.some(g=>g.toLowerCase()===o.toLowerCase())))return!1}if(l&&(r.min!==null||r.max!==null)){const n=e.ProductionYear;if(!n||n<=0||r.min!==null&&n<r.min||r.max!==null&&n>r.max)return!1}return!0},y=e=>!(l&&(r.min!==null||r.max!==null)||c.length>0);return{artists:h.artists.filter(d),albums:h.albums.filter(u),playlists:(h.playlists||[]).filter(y),songs:h.songs.filter(u)}},[h,c,r,l]),I=a.useCallback(()=>{w(""),i(null)},[]),z=a.useCallback(()=>{w(""),i(null),p([]),j({min:null,max:null})},[]);return{searchQuery:x,setSearchQuery:w,isSearching:R,rawSearchResults:h,searchResults:G,selectedGenres:c,setSelectedGenres:p,yearRange:r,setYearRange:j,hasActiveFilters:S,clearSearch:I,clearAll:z}}export{q as F,B as u};
