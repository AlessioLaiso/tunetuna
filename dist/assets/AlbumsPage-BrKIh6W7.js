import{b as Ne,r as s,f as K,j as e,D as Z,I as $e,e as F,C as we,u as ge,a as ve,i as _e,d as Be,h as Ue,G as Ve,P as Qe,L as Xe}from"./index-scgXBtC7.js";import{u as Je,f as We,S as qe}from"./search-Ei8VsrFv.js";import{S as Ke}from"./SearchArtistItem-BD5CnpKm.js";import{P as Ze}from"./Pagination-BlzUVH5l.js";import{F as be}from"./FilterBottomSheet-CShdrEBf.js";import{A as et}from"./arrow-up-down-DHpxObdw.js";import{C as tt}from"./calendar-DhXdNtGO.js";function st({album:n,onContextMenu:y,contextMenuItemId:w,showImage:k=!0}){var m,Y;const M=Ne(),[p,f]=s.useState(!1),[P,C]=s.useState("mobile"),[L,u]=s.useState(null),[g,d]=s.useState(!1),l=s.useRef(!1),o=w===n.Id,i=c=>{if(l.current){c.preventDefault(),l.current=!1;return}M(`/album/${n.Id}`)},O=c=>{var D,H,R,$;c.preventDefault(),c.stopPropagation(),(H=(D=c.nativeEvent)==null?void 0:D.preventDefault)==null||H.call(D),($=(R=c.nativeEvent)==null?void 0:R.stopImmediatePropagation)==null||$.call(R),l.current=!0,y?y(n,"album","desktop",{x:c.clientX,y:c.clientY}):(C("desktop"),u({x:c.clientX,y:c.clientY}),f(!0)),setTimeout(()=>{l.current=!1},300)},T=K({onLongPress:c=>{c.preventDefault(),y?(l.current=!0,y(n,"album","mobile")):(l.current=!0,C("mobile"),u(null),f(!0))}});return e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:c=>{if(p||l.current){c.preventDefault(),c.stopPropagation();return}i(c)},onContextMenu:c=>{O(c)},...T,className:`text-left group ${o?"ring-2 ring-blue-500":""}`,children:[e.jsx("div",{className:"aspect-square rounded overflow-hidden mb-2 bg-zinc-900 relative flex items-center justify-center",children:g?e.jsx(Z,{className:"w-12 h-12 text-gray-500"}):k?e.jsx($e,{src:F.getAlbumArtUrl(n.Id,474),alt:n.Name,className:"w-full h-full object-cover",showOutline:!0,rounded:"rounded",onError:()=>d(!0)}):e.jsx("div",{className:"w-full h-full bg-zinc-900"})}),e.jsx("div",{className:"text-sm font-medium text-white truncate",children:n.Name}),e.jsx("div",{className:"text-xs text-gray-400 truncate",children:n.AlbumArtist||((Y=(m=n.ArtistItems)==null?void 0:m[0])==null?void 0:Y.Name)||"Unknown Artist"})]}),e.jsx(we,{item:n,itemType:"album",isOpen:p,onClose:()=>f(!1),mode:P,position:L||void 0})]})}function nt({album:n,onClick:y,onContextMenu:w,contextMenuItemId:k}){var g,d;const[M,p]=s.useState(!1),f=s.useRef(!1),P=k===n.Id,C=l=>{if(P||f.current){l.preventDefault(),l.stopPropagation(),f.current=!1;return}y(n.Id)},L=l=>{l.preventDefault(),l.stopPropagation(),f.current=!0,w(n,"album","desktop",{x:l.clientX,y:l.clientY}),setTimeout(()=>{f.current=!1},300)},u=K({onLongPress:l=>{l.preventDefault(),f.current=!0,w(n,"album","mobile")},onClick:C});return e.jsxs("button",{onClick:C,onContextMenu:L,...u,className:"text-left group",children:[e.jsx("div",{className:"aspect-square rounded overflow-hidden mb-3 bg-zinc-900 shadow-lg relative flex items-center justify-center",children:M?e.jsx(Z,{className:"w-12 h-12 text-gray-500"}):e.jsxs(e.Fragment,{children:[e.jsx("img",{src:F.getAlbumArtUrl(n.Id,474),alt:n.Name,className:"w-full h-full object-cover",onError:()=>p(!0)}),e.jsx("div",{className:"absolute inset-0 pointer-events-none border border-white rounded",style:{borderColor:"rgba(255, 255, 255, 0.03)",borderWidth:"1px"}})]})}),e.jsx("div",{className:"text-sm font-semibold text-white truncate mb-1",children:n.Name}),e.jsx("div",{className:"text-xs text-gray-400 truncate",children:n.AlbumArtist||((d=(g=n.ArtistItems)==null?void 0:g[0])==null?void 0:d.Name)||"Unknown Artist"})]})}function rt({song:n,onClick:y,onContextMenu:w,contextMenuItemId:k,showImage:M=!0}){var l,o;const p=s.useRef(!1),f=k===n.Id,[P,C]=s.useState(!1),L=i=>{const O=Math.floor(i/1e7),T=Math.floor(O/60),m=O%60;return`${T}:${m.toString().padStart(2,"0")}`},u=i=>{if(f||p.current){i.preventDefault(),i.stopPropagation(),p.current=!1;return}y(n)},g=i=>{i.preventDefault(),i.stopPropagation(),p.current=!0,w(n,"song","desktop",{x:i.clientX,y:i.clientY}),setTimeout(()=>{p.current=!1},300)},d=K({onLongPress:i=>{i.preventDefault(),p.current=!0,w(n,"song","mobile")},onClick:u});return e.jsxs("button",{onClick:u,onContextMenu:g,...d,className:`w-full flex items-center gap-3 hover:bg-white/10 transition-colors group px-4 py-3 ${f?"bg-white/10":""}`,children:[e.jsx("div",{className:"w-12 h-12 rounded-sm overflow-hidden flex-shrink-0 bg-zinc-900 self-center relative flex items-center justify-center",children:P?e.jsx(Z,{className:"w-7 h-7 text-gray-500"}):e.jsxs(e.Fragment,{children:[e.jsx("img",{src:F.getAlbumArtUrl(n.AlbumId||n.Id,96),alt:n.Name,className:"w-full h-full object-cover",loading:"lazy",onError:()=>C(!0)}),e.jsx("div",{className:"absolute inset-0 pointer-events-none border border-white rounded-sm",style:{borderColor:"rgba(255, 255, 255, 0.03)",borderWidth:"1px"}})]})}),e.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[e.jsx("div",{className:"text-sm font-medium text-white truncate group-hover:text-[var(--accent-color)] transition-colors",children:n.Name}),e.jsxs("div",{className:"text-xs text-gray-400 truncate",children:[n.AlbumArtist||((o=(l=n.ArtistItems)==null?void 0:l[0])==null?void 0:o.Name)||"Unknown Artist",n.Album&&` â€¢ ${n.Album}`]})]}),n.RunTimeTicks&&e.jsx("div",{className:"text-xs text-gray-500 flex-shrink-0 text-right",children:L(n.RunTimeTicks)})]})}const V=84,je=45,lt=45,ye=45,at=45;function xt(){const{albums:n,setAlbums:y,sortPreferences:w,setSortPreference:k,setLoading:M,loading:p,genres:f}=ge(),{playTrack:P,playAlbum:C,addToQueue:L}=ve(),[u,g]=s.useState(""),[d,l]=s.useState(!1),[o,i]=s.useState(null),[O,T]=s.useState(!1),m=s.useRef(null),[Y,c]=s.useState(!1),[D,H]=s.useState("mobile"),[R,$]=s.useState(null),[v,ee]=s.useState(null),[Ce,te]=s.useState(null),[_,se]=s.useState(0),[ne,re]=s.useState(0),[Se,le]=s.useState(je),Q=Ne(),[ae,oe]=_e(),G=s.useRef(null),[S,ie]=s.useState([]),[h,X]=s.useState({min:null,max:null}),[ce,J]=s.useState(!1),[ue,Ie]=s.useState(null),[Ae,de]=s.useState([]),N=w.albums,B=s.useRef(!0),[Ee,me]=s.useState(!1),he=s.useRef(N),[ke,xe]=s.useState(ye),W=ve(t=>t.isQueueSidebarOpen);s.useEffect(()=>{const t=ae.get("year");if(t){const r=parseInt(t,10);!isNaN(r)&&r>0&&(X({min:r,max:r}),l(!0),oe({},{replace:!0}))}},[ae,oe]),s.useEffect(()=>{(async()=>{try{const r=ge.getState();if(r.years.length>0)de(r.years);else{const j=await F.getYears();de(j)}}catch(r){console.error("Failed to load filter values:",r)}})()},[]);const fe=S.length>0||h.min!==null||h.max!==null;s.useEffect(()=>{m.current&&m.current.abort();const t=u.trim().length>0;if(t||fe){T(!0),m.current=new AbortController;const r=window.setTimeout(async()=>{var j,x,b,U;if(!((j=m.current)!=null&&j.signal.aborted))try{let E;t?E=await Je(u,450):E=await We(450),(x=m.current)!=null&&x.signal.aborted||i(E)}catch(E){(b=m.current)!=null&&b.signal.aborted||(console.error("Search failed:",E),i(null))}finally{(U=m.current)!=null&&U.signal.aborted||T(!1)}},250);return()=>{window.clearTimeout(r),m.current&&m.current.abort()}}else m.current=null,i(null),T(!1)},[u,fe]);const a=s.useMemo(()=>{if(!o)return null;const t=x=>{if(h.min!==null||h.max!==null)return!1;if(S.length>0){const b=x.Genres||[];if(!S.some(E=>b.some(q=>q.toLowerCase()===E.toLowerCase())))return!1}return!0},r=x=>{if(S.length>0){const b=x.Genres||[];if(!S.some(E=>b.some(q=>q.toLowerCase()===E.toLowerCase())))return!1}if(h.min!==null||h.max!==null){const b=x.ProductionYear;if(!b||b<=0||h.min!==null&&b<h.min||h.max!==null&&b>h.max)return!1}return!0},j=x=>!(h.min!==null||h.max!==null||S.length>0);return{albums:o.albums.filter(r),artists:o.artists.filter(t),playlists:(o.playlists||[]).filter(j),songs:o.songs.filter(r)}},[o,S,h]);s.useEffect(()=>{var t;if(d&&((t=G.current)==null||t.focus(),G.current)){const r=G.current.value.length;G.current.setSelectionRange(r,r)}},[d]),s.useEffect(()=>()=>{m.current&&m.current.abort()},[]);const Me=t=>{g(t),t.trim().length>0&&!d&&l(!0)},Pe=()=>{g(""),i(null)},Le=()=>{l(!1),g(""),i(null),ie([]),X({min:null,max:null})},pe=t=>{Ie(t),J(!0)},Te=t=>{ie(t)},Oe=t=>{X(t)},De=t=>{Q(`/artist/${t}`),l(!1),g(""),i(null)},Re=t=>{Q(`/album/${t}`),l(!1),g(""),i(null)},Fe=t=>{P(t,[t])},Ge=t=>{t.preventDefault(),t.stopPropagation(),a!=null&&a.songs&&a.songs.length>0&&C(a.songs)},ze=t=>{t.preventDefault(),t.stopPropagation(),a!=null&&a.songs&&a.songs.length>0&&L(a.songs)},Ye=t=>{Q(`/playlist/${t}`),l(!1),g(""),i(null)},z=(t,r,j="mobile",x)=>{ee(t),te(r),H(j),$(x||null),c(!0)};s.useEffect(()=>{const t=r=>{};return document.addEventListener("contextmenu",t,!0),()=>{document.removeEventListener("contextmenu",t,!0)}},[]),s.useEffect(()=>{u.trim()||se(0)},[N,u]),s.useEffect(()=>{xe(ye)},[u,d,o==null?void 0:o.songs.length]);const I=s.useCallback(()=>{var x;if(!d||!((x=o==null?void 0:o.songs)!=null&&x.length))return;const t=window.scrollY||document.documentElement.scrollTop,r=window.innerHeight||document.documentElement.clientHeight,j=document.documentElement.scrollHeight;t+r*1.5>=j&&xe(b=>Math.min(b+at,o.songs.length))},[d,o==null?void 0:o.songs.length]);s.useEffect(()=>{var t;if(!(!d||!((t=o==null?void 0:o.songs)!=null&&t.length)))return document.addEventListener("scroll",I,{passive:!0,capture:!0}),window.addEventListener("scroll",I,{passive:!0}),document.addEventListener("touchmove",I,{passive:!0}),document.addEventListener("touchend",I,{passive:!0}),()=>{document.removeEventListener("scroll",I,{capture:!0}),window.removeEventListener("scroll",I),document.removeEventListener("touchmove",I),document.removeEventListener("touchend",I)}},[I]),s.useEffect(()=>{le(je)},[_,n.length]);const A=s.useCallback(()=>{const t=window.scrollY||document.documentElement.scrollTop,r=window.innerHeight||document.documentElement.clientHeight,j=document.documentElement.scrollHeight;t+r*1.5>=j&&le(x=>Math.min(x+lt,n.length))},[n.length]);s.useEffect(()=>(document.addEventListener("scroll",A,{passive:!0,capture:!0}),window.addEventListener("scroll",A,{passive:!0}),document.addEventListener("touchmove",A,{passive:!0}),document.addEventListener("touchend",A,{passive:!0}),()=>{document.removeEventListener("scroll",A,{capture:!0}),window.removeEventListener("scroll",A),document.removeEventListener("touchmove",A),document.removeEventListener("touchend",A)}),[A]),s.useEffect(()=>{u.trim()||(!B.current&&he.current!==N&&me(!0),he.current=N,He())},[_,N,u]),s.useEffect(()=>{B.current&&(B.current=!1)},[]);const He=async()=>{M("albums",!0);try{const t={limit:V,startIndex:_*V};N==="RecentlyAdded"?(t.sortBy=["DateCreated"],t.sortOrder="Descending"):N==="Newest"?(t.sortBy=["ProductionYear","SortName"],t.sortOrder=["Descending","Ascending"]):(t.sortBy=["SortName"],t.sortOrder="Ascending");const r=await F.getAlbums(t);y(r.Items),re(r.TotalRecordCount||0)}catch(t){console.error("Failed to load albums:",t),y([]),re(0)}finally{M("albums",!1),me(!1)}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"pb-20",children:[e.jsx("div",{className:`fixed top-0 left-0 right-0 bg-black z-10 lg:left-16 transition-[left,right] duration-300 ${W?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top))"},children:e.jsx("div",{className:"max-w-[768px] mx-auto",children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Albums"}),e.jsx("button",{onClick:()=>l(!0),className:"w-10 h-10 flex items-center justify-center text-white hover:bg-zinc-800 rounded-full transition-colors","aria-label":"Search",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})]}),!d&&e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("button",{onClick:()=>{k("albums",N==="RecentlyAdded"?"Alphabetical":N==="Alphabetical"?"Newest":"RecentlyAdded")},className:"text-sm text-gray-400 hover:text-white transition-colors flex items-center gap-1",children:[N==="RecentlyAdded"?"Recently Added":N==="Newest"?"Newest":"Alphabetically",e.jsx(et,{className:"w-4 h-4"})]}),p.albums&&!B.current&&e.jsx("div",{className:"flex items-center",children:e.jsx(Ue,{})})]})]})})}),e.jsx("div",{className:`fixed left-0 right-0 z-10 lg:left-16 transition-[left,right] duration-300 ${W?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 7rem - 8px)",height:"24px",background:"linear-gradient(to bottom, rgba(0, 0, 0, 0.8), transparent)"}}),e.jsx("div",{style:{paddingTop:"calc(env(safe-area-inset-top) + 7rem)"},onContextMenu:t=>{},children:!d&&e.jsx("div",{className:Ee?"opacity-50 pointer-events-none":"",onContextMenu:t=>{},children:n.length===0&&!p.albums?e.jsx("div",{className:"flex items-center justify-center py-16 text-gray-400",children:e.jsx("p",{children:"No albums found"})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-4",children:e.jsx("div",{className:"grid grid-cols-3 md:grid-cols-4 gap-3",onContextMenu:t=>{},children:n.map((t,r)=>e.jsx(st,{album:t,onContextMenu:z,contextMenuItemId:(v==null?void 0:v.Id)||null,showImage:r<Se},t.Id))})}),e.jsx(Ze,{currentPage:_,totalPages:Math.ceil(ne/V),onPageChange:se,itemsPerPage:V,totalItems:ne})]})})})]}),d&&Be.createPortal(e.jsx(e.Fragment,{children:e.jsxs("div",{className:"fixed inset-0 bg-black z-[9999] overflow-y-auto p-0 m-0",children:[e.jsx("div",{className:"fixed top-0 left-0 right-0 bg-black z-50 pointer-events-none",style:{height:"env(safe-area-inset-top)",top:"var(--header-offset, 0px)"}}),e.jsx("div",{className:"fixed top-0 left-0 right-0 bg-black z-10 pt-0 pb-0 w-full m-0",style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top))",height:"76px"},children:e.jsx("div",{className:"max-w-[768px] mx-auto w-full",children:e.jsxs("div",{className:"flex items-center gap-3 px-4 pt-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(qe,{ref:G,value:u,onChange:Me,showClearButton:u.trim().length>0,onClear:Pe})}),e.jsx("button",{onClick:Le,className:"px-4 py-2 text-white text-sm font-medium hover:text-zinc-300 transition-colors whitespace-nowrap flex-shrink-0",children:"Cancel"})]})})}),e.jsxs("div",{className:"max-w-[768px] mx-auto w-full",style:{paddingTop:"calc(52px + env(safe-area-inset-top))"},children:[e.jsx("div",{className:"sticky bg-black z-10 pt-3 pb-4",style:{top:"calc(76px + env(safe-area-inset-top))"},children:e.jsxs("div",{className:"flex items-center gap-3 px-4",children:[e.jsxs("button",{onClick:()=>pe("genre"),className:`flex items-center gap-2 px-3 py-2 rounded-lg transition-colors ${S.length>0?"bg-[var(--accent-color)] text-white":"bg-white/10 text-white hover:bg-white/20"}`,"aria-label":"Filter by genre",children:[e.jsx(Ve,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Genre"})]}),e.jsxs("button",{onClick:()=>pe("year"),className:`flex items-center gap-2 px-3 py-2 rounded-lg transition-colors ${h.min!==null||h.max!==null?"bg-[var(--accent-color)] text-white":"bg-white/10 text-white hover:bg-white/20"}`,"aria-label":"Filter by year",children:[e.jsx(tt,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Year"})]})]})}),e.jsx("div",{className:`fixed left-0 right-0 z-[60] lg:left-16 transition-[left,right] duration-300 ${W?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 76px + 4rem)",height:"24px",background:"linear-gradient(to bottom, rgba(0, 0, 0, 0.8), transparent)"}}),e.jsx("div",{className:"pb-32",style:{paddingTop:"40px"},children:O?e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-zinc-800 border-t-[var(--accent-color)]"})}):a?e.jsxs("div",{className:"space-y-8",children:[a.albums.length>0&&e.jsxs("div",{className:"px-4",children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Albums"}),e.jsx("div",{className:"grid grid-cols-3 md:grid-cols-4 gap-4",children:a.albums.map(t=>e.jsx(nt,{album:t,onClick:Re,onContextMenu:z,contextMenuItemId:(v==null?void 0:v.Id)||null},t.Id))})]}),a.artists.length>0&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-4 px-4",children:"Artists"}),e.jsx("div",{className:"space-y-0",children:a.artists.slice(0,5).map(t=>e.jsx(Ke,{artist:t,onClick:De,onContextMenu:z,contextMenuItemId:(v==null?void 0:v.Id)||null},t.Id))})]}),a.playlists&&a.playlists.length>0&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-4 px-4",children:"Playlists"}),e.jsx("div",{className:"space-y-0",children:a.playlists.map(t=>e.jsxs("button",{onClick:()=>Ye(t.Id),onContextMenu:r=>{r.preventDefault(),r.stopPropagation(),z(t,"playlist","desktop",{x:r.clientX,y:r.clientY})},className:"w-full flex items-center gap-3 hover:bg-white/10 transition-colors group px-4 py-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-sm overflow-hidden flex-shrink-0 bg-zinc-900 self-center",children:e.jsx("img",{src:F.getAlbumArtUrl(t.Id,96),alt:t.Name,className:"w-full h-full object-cover",loading:"lazy"})}),e.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[e.jsx("div",{className:"text-sm font-medium text-white truncate group-hover:text-[var(--accent-color)] transition-colors",children:t.Name}),e.jsx("div",{className:"text-xs text-gray-400 truncate",children:t.ChildCount?`${t.ChildCount} tracks`:"Playlist"})]})]},t.Id))})]}),a.songs.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 px-4",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"Songs"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:Ge,className:"w-10 h-10 flex items-center justify-center text-white hover:bg-white/10 rounded-lg transition-colors","aria-label":"Play all songs",children:e.jsx(Qe,{className:"w-5 h-5"})}),e.jsx("button",{type:"button",onClick:ze,className:"w-10 h-10 flex items-center justify-center text-white hover:bg-white/10 rounded-lg transition-colors","aria-label":"Add all songs to queue",children:e.jsx(Xe,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"space-y-0",children:a.songs.map((t,r)=>e.jsx(rt,{song:t,onClick:Fe,onContextMenu:z,contextMenuItemId:(v==null?void 0:v.Id)||null,showImage:r<ke},t.Id))})]}),a.artists.length===0&&a.albums.length===0&&(!a.playlists||a.playlists.length===0)&&a.songs.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 text-gray-400 px-4",children:[e.jsx("div",{className:"text-lg mb-2",children:"No results found"}),e.jsx("div",{className:"text-sm",children:"Try a different search term"})]})]}):e.jsx("div",{className:"flex flex-col items-center justify-center py-16 text-gray-400 px-4"})})]})]})}),document.body),ue==="genre"&&e.jsx(be,{isOpen:ce,onClose:()=>J(!1),filterType:"genre",genres:f,selectedValues:S,onApply:Te}),ue==="year"&&e.jsx(be,{isOpen:ce,onClose:()=>J(!1),filterType:"year",availableYears:Ae,yearRange:h,onApplyYear:Oe}),e.jsx(we,{item:v,itemType:Ce,isOpen:Y,onClose:()=>{c(!1),ee(null),te(null)},zIndex:99999,mode:D,position:R||void 0})]})}export{xt as default};
