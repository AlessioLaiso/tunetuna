import{b as $,r as s,f as le,j as e,I as ae,e as E,C as D,u as oe,a as T,l as L,i as ie}from"./index-CRd4tkFy.js";import{u as ce,a as ue}from"./search-D6xEzTk6.js";import{A as de}from"./arrow-up-down-DT_8JL3N.js";function fe({playlist:a}){const C=$(),[p,u]=s.useState(!1),[v,g]=s.useState("mobile"),[j,y]=s.useState(null),i=s.useRef(!1),o=n=>{if(i.current){n.preventDefault(),i.current=!1;return}C(`/playlist/${a.Id}`)},d=le({onLongPress:n=>{n.preventDefault(),i.current=!0,g("mobile"),y(null),u(!0)}}),w=n=>{n.preventDefault(),n.stopPropagation(),i.current=!0,g("desktop"),y({x:n.clientX,y:n.clientY}),u(!0),setTimeout(()=>{i.current=!1},300)};return e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:n=>{if(p||i.current){n.preventDefault(),n.stopPropagation();return}o(n)},onContextMenu:w,...d,className:"w-full flex items-center gap-3 hover:bg-white/10 transition-colors group px-4 py-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-sm overflow-hidden flex-shrink-0 bg-zinc-900 self-center",children:e.jsx(ae,{src:E.getAlbumArtUrl(a.Id,96),alt:a.Name,className:"w-full h-full object-cover",showOutline:!0,rounded:"rounded-sm"})}),e.jsxs("div",{className:"flex-1 min-w-0 text-left flex flex-col justify-center",children:[e.jsx("div",{className:"text-sm font-medium text-white truncate group-hover:text-[var(--accent-color)] transition-colors",children:a.Name}),e.jsx("div",{className:"text-xs text-gray-400 truncate",children:a.ChildCount?`${a.ChildCount} tracks`:"Playlist"})]})]}),e.jsx(D,{item:a,itemType:"playlist",isOpen:p,onClose:()=>u(!1),mode:v,position:j||void 0})]})}const he=[{type:"playlists"},{type:"artists",limit:5},{type:"albums",limit:12},{type:"songs"}];function be(){const[a,C]=s.useState([]),[p,u]=s.useState(!0),{sortPreferences:v,setSortPreference:g}=oe(),{playTrack:j,playAlbum:y,addToQueue:i}=T(),o=v.playlists,d=s.useRef(!0),[w,n]=s.useState(!1),k=s.useRef(o),N=$(),[S,f]=s.useState(""),[h,x]=s.useState(!1),[m,c]=s.useState(null),[F,M]=s.useState(!1),r=s.useRef(null),[Q,z]=s.useState(!1),[_,B]=s.useState(null),[G,H]=s.useState(null),[U,xe]=s.useState("mobile"),[Y,me]=s.useState(null),[J,pe]=s.useState(45),A=T(t=>t.isQueueSidebarOpen);s.useEffect(()=>{h||(!d.current&&k.current!==o&&n(!0),k.current=o,V())},[o,h]),s.useEffect(()=>{d.current&&(d.current=!1)},[]),s.useEffect(()=>{if(r.current&&r.current.abort(),S.trim()){M(!0),r.current=new AbortController;const t=window.setTimeout(async()=>{var b,I,O,R;if(!((b=r.current)!=null&&b.signal.aborted))try{const P=await ce(S,450);(I=r.current)!=null&&I.signal.aborted||c(P)}catch(P){(O=r.current)!=null&&O.signal.aborted||(L.error("Search failed:",P),c(null))}finally{(R=r.current)!=null&&R.signal.aborted||M(!1)}},250);return()=>{window.clearTimeout(t),r.current&&r.current.abort()}}else r.current=null,c(null),M(!1)},[S]),s.useEffect(()=>()=>{r.current&&r.current.abort()},[]);const V=async()=>{u(!0);try{const t={limit:100};o==="RecentlyAdded"?(t.sortBy=["DateCreated"],t.sortOrder="Descending"):(t.sortBy=["SortName"],t.sortOrder="Ascending");const b=await E.getPlaylists(t);C(b.Items)}catch(t){L.error("Failed to load playlists:",t)}finally{u(!1),n(!1)}},W=t=>{f(t),t.trim().length>0&&!h&&x(!0)},X=()=>{f(""),c(null)},K=()=>{x(!1),f(""),c(null)},Z=t=>{N(`/artist/${t}`),x(!1),f(""),c(null)},q=t=>{N(`/album/${t}`),x(!1),f(""),c(null)},ee=t=>{j(t,[t])},te=()=>{l!=null&&l.songs&&l.songs.length>0&&y(l.songs)},se=()=>{l!=null&&l.songs&&l.songs.length>0&&i(l.songs)},ne=t=>{N(`/playlist/${t}`),x(!1),f(""),c(null)},re=t=>{},l=s.useMemo(()=>m?{playlists:m.playlists||[],artists:m.artists||[],albums:m.albums||[],songs:m.songs||[]}:null,[m]);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"pb-20",children:[e.jsx("div",{className:`fixed top-0 left-0 right-0 bg-black z-10 lg:left-16 transition-[left,right] duration-300 ${A?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top))"},children:e.jsx("div",{className:"max-w-[768px] mx-auto",children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Playlists"}),e.jsx("button",{onClick:()=>x(!0),className:"w-10 h-10 flex items-center justify-center text-white hover:bg-zinc-800 rounded-full transition-colors","aria-label":"Search",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})]}),!h&&e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("button",{onClick:()=>g("playlists",o==="RecentlyAdded"?"Alphabetical":"RecentlyAdded"),className:"text-sm text-gray-400 hover:text-white transition-colors flex items-center gap-1",children:[o==="RecentlyAdded"?"Recently Added":"Alphabetically",e.jsx(de,{className:"w-4 h-4"})]}),p&&!d.current&&e.jsx("div",{className:"flex items-center",children:e.jsx(ie,{})})]})]})})}),e.jsx("div",{className:`fixed left-0 right-0 z-10 lg:left-16 transition-[left,right] duration-300 ${A?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 7rem - 8px)",height:"24px",background:"linear-gradient(to bottom, rgba(0, 0, 0, 0.8), transparent)"}}),e.jsx("div",{style:{paddingTop:"calc(env(safe-area-inset-top) + 7rem)"},children:e.jsx("div",{className:`${w?"opacity-50 pointer-events-none":""} ${h?"hidden [@media((hover:hover)_and_(pointer:fine)_and_(min-width:1024px))]:block":""}`,children:a.length===0&&!p?e.jsx("div",{className:"flex items-center justify-center py-16 text-gray-400",children:e.jsx("p",{children:"No playlists found"})}):e.jsx("div",{className:"space-y-0",children:a.map(t=>e.jsx(fe,{playlist:t},t.Id))})})})]}),e.jsx(ue,{isOpen:h,onClose:K,searchQuery:S,onSearchChange:W,onClearSearch:X,isLoading:F,results:l,sections:he,filterConfig:{showGenreFilter:!1,showYearFilter:!1},filterState:{selectedGenres:[],yearRange:{min:null,max:null}},onOpenFilterSheet:re,onArtistClick:Z,onAlbumClick:q,onSongClick:ee,onPlaylistClick:ne,onPlayAllSongs:te,onAddSongsToQueue:se,visibleSongImageCount:J,isQueueSidebarOpen:A}),e.jsx(D,{item:_,itemType:G,isOpen:Q,onClose:()=>{z(!1),B(null),H(null)},zIndex:99999,mode:U,position:Y||void 0})]})}export{be as default};
