import{b as le,r as t,f as Me,j as e,U as te,e as Q,C as ae,u as Ne,a as se,l as ne,i as Te}from"./index-Di0xjSmi.js";import{g as Ee,b as Pe,u as ke,f as Oe,a as Le}from"./search-CG59b2Tx.js";import{P as Re}from"./Pagination-BcdLLTPj.js";import{F as Fe}from"./FilterBottomSheet-C0prlNNc.js";import{A as Ge}from"./arrow-up-down-_pjW89sG.js";function _e({artist:n,onContextMenu:C,contextMenuItemId:G}){var R,T;const _=le(),[P,k]=t.useState(!1),[O,M]=t.useState(!1),[D,L]=t.useState("mobile"),[d,m]=t.useState(null),a=t.useRef(!1),[g,f]=t.useState(null),h=G===n.Id;t.useEffect(()=>{var I;if((I=n.ImageTags)!=null&&I.Primary){f(null);return}const r=Ee(n.Id);if(r!==void 0){f(r);return}let p=!1;return Pe(n.Id).then(S=>{p||f(S)}),()=>{p=!0}},[n.Id,n.ImageTags]);const $=r=>{if(a.current){r.preventDefault(),a.current=!1;return}_(`/artist/${n.Id}`)},N=Me({onLongPress:r=>{r.preventDefault(),C?(a.current=!0,C(n,"artist","mobile")):(a.current=!0,L("mobile"),m(null),M(!0))}}),i=r=>{var p,I,S,A;r.preventDefault(),r.stopPropagation(),(I=(p=r.nativeEvent)==null?void 0:p.preventDefault)==null||I.call(p),(A=(S=r.nativeEvent)==null?void 0:S.stopImmediatePropagation)==null||A.call(S),a.current=!0,C?C(n,"artist","desktop",{x:r.clientX,y:r.clientY}):(L("desktop"),m({x:r.clientX,y:r.clientY}),M(!0)),setTimeout(()=>{a.current=!1},300)};return e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:r=>{if(O||a.current){r.preventDefault(),r.stopPropagation();return}$(r)},onContextMenu:i,...N,className:`w-full flex items-center gap-4 hover:bg-white/10 transition-colors group px-4 h-[72px] ${h?"bg-white/10":""}`,children:[e.jsx("div",{className:"w-12 h-12 rounded-full overflow-hidden flex-shrink-0 bg-zinc-900 flex items-center justify-center",children:P?e.jsx(te,{className:"w-6 h-6 text-gray-500"}):(R=n.ImageTags)!=null&&R.Primary||g?e.jsx("img",{src:(T=n.ImageTags)!=null&&T.Primary?Q.getArtistImageUrl(n.Id,96):g||"",alt:n.Name,className:"w-full h-full object-cover",onError:()=>k(!0),loading:"lazy"}):e.jsx(te,{className:"w-6 h-6 text-gray-500"})}),e.jsx("div",{className:"flex-1 min-w-0 text-left",children:e.jsx("div",{className:"text-base font-medium text-white truncate group-hover:text-[var(--accent-color)] transition-colors",children:n.Name})})]}),e.jsx(ae,{item:n,itemType:"artist",isOpen:O,onClose:()=>M(!1),zIndex:99999,mode:D,position:d||void 0})]})}const De=[{type:"artists"},{type:"albums",limit:12},{type:"playlists"},{type:"songs"}],j=90,$e=45,re=45,ze=45;function Xe(){const{artists:n,setArtists:C,sortPreferences:G,setSortPreference:_,setLoading:P,loading:k,genres:O}=Ne(),{playTrack:M,playAlbum:D,addToQueue:L}=se(),[d,m]=t.useState(""),[a,g]=t.useState(!1),[f,h]=t.useState(null),[$,N]=t.useState(!1),i=t.useRef(null),[R,T]=t.useState(!1),[r,p]=t.useState("mobile"),[I,S]=t.useState(null),[A,B]=t.useState(null),[oe,U]=t.useState(null),[E,V]=t.useState(0),[Y,X]=t.useState(0),[ie,J]=t.useState(re),z=le(),[y,W]=t.useState([]),[ce,K]=t.useState(!1),[ue,de]=t.useState(null),b=G.artists,F=t.useRef(!0),[fe,Z]=t.useState(!1),q=t.useRef(b),[he,He]=t.useState($e),H=se(s=>s.isQueueSidebarOpen),ee=y.length>0;t.useEffect(()=>{i.current&&i.current.abort();const s=d.trim().length>0;if(s||ee){N(!0),i.current=new AbortController;const u=window.setTimeout(async()=>{var l,o,v,w;if(!((l=i.current)!=null&&l.signal.aborted))try{let x;s?x=await ke(d,450):x=await Oe(450),(o=i.current)!=null&&o.signal.aborted||h(x)}catch(x){(v=i.current)!=null&&v.signal.aborted||(ne.error("Search failed:",x),h(null))}finally{(w=i.current)!=null&&w.signal.aborted||N(!1)}},250);return()=>{window.clearTimeout(u),i.current&&i.current.abort()}}else i.current=null,h(null),N(!1)},[d,ee]);const c=t.useMemo(()=>{if(!f)return null;const s=l=>{if(y.length>0){const o=l.Genres||[];if(!y.some(w=>o.some(x=>x.toLowerCase()===w.toLowerCase())))return!1}return!0},u=l=>{if(y.length>0){const o=l.Genres||[];if(!y.some(w=>o.some(x=>x.toLowerCase()===w.toLowerCase())))return!1}return!0};return{artists:f.artists.filter(s),albums:f.albums.filter(u),playlists:f.playlists||[],songs:f.songs.filter(u)}},[f,y]);t.useEffect(()=>()=>{i.current&&i.current.abort()},[]);const me=s=>{m(s),s.trim().length>0&&!a&&g(!0)},ge=()=>{m(""),h(null)},pe=()=>{g(!1),m(""),h(null),W([])},xe=s=>{s==="genre"&&(de("genre"),K(!0))},Se=s=>{W(s)},ye=s=>{z(`/artist/${s}`),g(!1),m(""),h(null)},be=s=>{z(`/album/${s}`),g(!1),m(""),h(null)},ve=s=>{M(s,[s])},Ce=()=>{c!=null&&c.songs&&c.songs.length>0&&D(c.songs)},Ie=()=>{c!=null&&c.songs&&c.songs.length>0&&L(c.songs)},Ae=s=>{z(`/playlist/${s}`),g(!1),m(""),h(null)},we=(s,u,l="mobile",o)=>{B(s),U(u),p(l),S(o||null),T(!0)},je=async()=>{var u;const s=Date.now();P("artists",!0);try{const l={limit:j,startIndex:E*j};b==="RecentlyAdded"?(l.sortBy=["DateCreated"],l.sortOrder="Descending"):(l.sortBy=["SortName"],l.sortOrder="Ascending");let o=await Q.getArtists(l);(((u=o.Items)==null?void 0:u.length)||0)===0&&(o=await Q.getArtists({limit:j,startIndex:E*j}));const v=o.Items||[];X(o.TotalRecordCount||0);const w=Date.now()-s;C(v)}catch(l){ne.error("Failed to load artists:",l),C([]),X(0)}finally{P("artists",!1),Z(!1)}};return t.useEffect(()=>{!d.trim()&&!a&&V(0)},[b,d,a]),t.useEffect(()=>{J(re)},[E,n.length]),t.useEffect(()=>{const s=()=>{const u=window.scrollY||document.documentElement.scrollTop,l=window.innerHeight||document.documentElement.clientHeight,o=document.documentElement.scrollHeight;u+l*1.5>=o&&J(v=>Math.min(v+ze,n.length))};return window.addEventListener("scroll",s,{passive:!0}),()=>window.removeEventListener("scroll",s)},[n.length]),t.useEffect(()=>{!d.trim()&&!a&&(!F.current&&q.current!==b&&Z(!0),q.current=b,je())},[E,b,d,a]),t.useEffect(()=>{F.current&&(F.current=!1)},[]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"pb-20",children:[e.jsx("div",{className:`fixed top-0 left-0 right-0 bg-black z-10 lg:left-16 transition-[left,right] duration-300 ${H?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top))"},children:e.jsx("div",{className:"max-w-[768px] mx-auto",children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Artists"}),e.jsx("button",{onClick:()=>g(!0),className:"w-10 h-10 flex items-center justify-center text-white hover:bg-zinc-800 rounded-full transition-colors","aria-label":"Search",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})]}),!a&&e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("button",{onClick:()=>_("artists",b==="RecentlyAdded"?"Alphabetical":"RecentlyAdded"),className:"text-sm text-gray-400 hover:text-white transition-colors flex items-center gap-1",children:[b==="RecentlyAdded"?"Recently Added":"Alphabetically",e.jsx(Ge,{className:"w-4 h-4"})]}),k.artists&&!F.current&&e.jsx("div",{className:"flex items-center",children:e.jsx(Te,{})})]})]})})}),e.jsx("div",{className:`fixed left-0 right-0 z-10 lg:left-16 transition-[left,right] duration-300 ${H?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 7rem - 8px)",height:"24px",background:"linear-gradient(to bottom, rgba(0, 0, 0, 0.8), transparent)"}}),e.jsx("div",{style:{paddingTop:"calc(env(safe-area-inset-top) + 7rem)"},children:e.jsxs("div",{className:`${fe?"opacity-50 pointer-events-none":""} ${a?"hidden [@media((hover:hover)_and_(pointer:fine)_and_(min-width:1024px))]:block":""}`,children:[n.length===0&&!k.artists&&e.jsx("div",{className:"flex items-center justify-center py-8 text-gray-400",children:e.jsx("p",{children:"No artists found"})}),n.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-0",children:n.slice(0,ie).map(s=>e.jsx(_e,{artist:s,onContextMenu:we,contextMenuItemId:(A==null?void 0:A.Id)||null},s.Id))}),e.jsx(Re,{currentPage:E,totalPages:Math.ceil(Y/j),onPageChange:V,itemsPerPage:j,totalItems:Y})]})]})})]}),e.jsx(Le,{isOpen:a,onClose:pe,searchQuery:d,onSearchChange:me,onClearSearch:ge,isLoading:$,results:c,sections:De,filterConfig:{showGenreFilter:!0,showYearFilter:!1},filterState:{selectedGenres:y,yearRange:{min:null,max:null}},onOpenFilterSheet:xe,onArtistClick:ye,onAlbumClick:be,onSongClick:ve,onPlaylistClick:Ae,onPlayAllSongs:Ce,onAddSongsToQueue:Ie,visibleSongImageCount:he,isQueueSidebarOpen:H}),ue==="genre"&&e.jsx(Fe,{isOpen:ce,onClose:()=>K(!1),filterType:"genre",genres:O,selectedValues:y,onApply:Se}),e.jsx(ae,{item:A,itemType:oe,isOpen:R,onClose:()=>{T(!1),B(null),U(null)},zIndex:99999,mode:r,position:I||void 0})]})}export{Xe as default};
