import{c as U,r as o,j as e,e as w,l as he,f as fe,U as Q,o as pe,C as ge,G as be,P as ve,L as ye,p as N}from"./index-SABcFPCf.js";import{P as we}from"./piano-DaVkbRzM.js";/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],Ne=U("calendar",je);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],Ae=U("funnel",ke);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],Ie=U("globe",Ce);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]],ze=U("smile",Me),W=o.forwardRef(({value:t,onChange:s,placeholder:c="Search...",debounceMs:r=150,showClearButton:p=!1,onClear:m},u)=>{const[n,x]=o.useState(t),l=o.useRef(s),a=o.useRef(null),i=h=>{a.current=h,typeof u=="function"?u(h):u&&(u.current=h)};return o.useEffect(()=>{l.current=s},[s]),o.useEffect(()=>{const h=setTimeout(()=>{l.current(n)},r);return()=>clearTimeout(h)},[n,r]),o.useEffect(()=>{t===""&&n!==""&&x(t)},[t]),e.jsxs("div",{className:"relative",children:[e.jsx("input",{ref:i,type:"text",value:n,onChange:h=>{x(h.target.value)},placeholder:c,className:"w-full px-4 py-2 pl-10 pr-10 bg-zinc-900 border border-zinc-800 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-[var(--accent-color)] focus:border-transparent"}),e.jsx("svg",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),e.jsx("button",{onClick:h=>{h.preventDefault(),h.stopPropagation(),x(""),m&&m(),setTimeout(()=>{var v;(v=a.current)==null||v.focus()},0)},className:`absolute right-3 top-1/2 transform -translate-y-1/2 w-5 h-5 transition-opacity ${p&&n?"text-gray-400 hover:text-white opacity-100 pointer-events-auto":"opacity-0 pointer-events-none"}`,"aria-label":"Clear search",type:"button",children:e.jsx("svg",{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",className:"w-full h-full",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})});W.displayName="SearchInput";const ee=500,z=new Map,D=new Map;function te(){if(z.size>ee){const t=Array.from(z.keys()).slice(0,z.size-ee);for(const s of t)z.delete(s)}}async function Re(t){if(z.has(t))return z.get(t)??null;if(D.has(t))return D.get(t);const s=(async()=>{try{const{albums:c,songs:r}=await w.getArtistItems(t),p=c[0],m=r.find(l=>l.AlbumId)||r[0],u=p||m,n=u?u.AlbumId||u.Id:null,x=n?w.getAlbumArtUrl(n,96):null;return z.set(t,x),te(),x}catch(c){return he.error("Failed to load fallback album art for artist:",t,c),z.set(t,null),te(),null}finally{D.delete(t)}})();return D.set(t,s),s}function Se(t){return z.get(t)}const Pe=o.memo(function({artist:s,onClick:c,onContextMenu:r,contextMenuItemId:p}){var S;const[m,u]=o.useState(!1),n=o.useRef(!1),x=p===s.Id,[l,a]=o.useState(null);o.useEffect(()=>{var d;if((d=s.ImageTags)!=null&&d.Primary){a(null);return}const g=Se(s.Id);if(g!==void 0){a(g);return}let P=!1;return Re(s.Id).then(R=>{P||a(R)}),()=>{P=!0}},[s.Id,s.ImageTags]);const i=g=>{if(x||n.current){g.preventDefault(),g.stopPropagation(),n.current=!1;return}c(s.Id)},h=g=>{g.preventDefault(),g.stopPropagation(),n.current=!0,r(s,"artist","desktop",{x:g.clientX,y:g.clientY}),setTimeout(()=>{n.current=!1},300)},v=fe({onLongPress:g=>{g.preventDefault(),n.current=!0,r(s,"artist","mobile")},onClick:i}),k=(S=s.ImageTags)!=null&&S.Primary?w.getArtistImageUrl(s.Id,96):l;return e.jsxs("button",{onClick:i,onContextMenu:h,...v,className:`w-full flex items-center gap-4 hover:bg-white/10 transition-colors text-left cursor-pointer px-4 h-[72px] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--accent-color)] focus-visible:ring-inset ${x?"bg-white/10":""}`,"aria-label":`Go to artist ${s.Name}`,children:[e.jsx("div",{className:"w-12 h-12 rounded-full overflow-hidden flex-shrink-0 bg-zinc-900 flex items-center justify-center",children:m?e.jsx(Q,{className:"w-6 h-6 text-gray-500"}):k?e.jsx("img",{src:k,alt:s.Name,className:"w-full h-full object-cover",onError:()=>u(!0),loading:"lazy"}):e.jsx(Q,{className:"w-6 h-6 text-gray-500"})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("div",{className:"text-base font-medium text-white truncate group-hover:text-[var(--accent-color)] transition-colors",children:s.Name})})]})});function Le({album:t,onClick:s,onContextMenu:c,contextMenuItemId:r}){var x,l;const p=o.useRef(!1),m=r===t.Id,u=a=>{if(m||p.current){a.preventDefault(),a.stopPropagation(),p.current=!1;return}s(t.Id)},n=a=>{a.preventDefault(),a.stopPropagation(),p.current=!0,c(t,"album","desktop",{x:a.clientX,y:a.clientY}),setTimeout(()=>{p.current=!1},300)};return e.jsxs("button",{onClick:u,onContextMenu:n,className:"text-left group",children:[e.jsxs("div",{className:"aspect-square rounded overflow-hidden mb-3 bg-zinc-900 shadow-lg relative flex items-center justify-center",children:[e.jsx("img",{src:w.getAlbumArtUrl(t.Id,474),alt:t.Name,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 pointer-events-none border border-white rounded",style:{borderColor:"rgba(255, 255, 255, 0.03)",borderWidth:"1px"}})]}),e.jsx("div",{className:"text-sm font-semibold text-white truncate mb-1",children:t.Name}),e.jsx("div",{className:"text-xs text-gray-400 truncate",children:t.AlbumArtist||((l=(x=t.ArtistItems)==null?void 0:x[0])==null?void 0:l.Name)||"Unknown Artist"})]})}function Te({song:t,onClick:s,onContextMenu:c,contextMenuItemId:r,showImage:p=!0}){var a;const m=o.useRef(!1),u=r===t.Id,n=i=>{const h=Math.floor(i/1e7),v=Math.floor(h/60),k=h%60;return`${v}:${k.toString().padStart(2,"0")}`},x=i=>{if(u||m.current){i.preventDefault(),i.stopPropagation(),m.current=!1;return}s(t)},l=i=>{i.preventDefault(),i.stopPropagation(),m.current=!0,c(t,"song","desktop",{x:i.clientX,y:i.clientY}),setTimeout(()=>{m.current=!1},300)};return e.jsxs("button",{onClick:x,onContextMenu:l,className:`w-full flex items-center gap-3 hover:bg-white/10 transition-colors group px-4 py-3 ${u?"bg-white/10":""}`,children:[p&&e.jsx("div",{className:"w-12 h-12 rounded-sm overflow-hidden flex-shrink-0 bg-zinc-900 self-center",children:e.jsx("img",{src:w.getAlbumArtUrl(t.AlbumId||t.Id,96),alt:t.Name,className:"w-full h-full object-cover",loading:"lazy"})}),e.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[e.jsx("div",{className:"text-sm font-medium text-white truncate group-hover:text-[var(--accent-color)] transition-colors",children:t.Name}),e.jsx("div",{className:"text-xs text-gray-400 truncate",children:((a=t.ArtistItems)==null?void 0:a.map(i=>i.Name).join(", "))||t.AlbumArtist||"Unknown Artist"})]}),t.RunTimeTicks&&e.jsx("div",{className:"text-xs text-gray-500 flex-shrink-0",children:n(t.RunTimeTicks)})]})}function _e({playlist:t,onClick:s,onContextMenu:c}){return e.jsxs("button",{onClick:()=>s(t.Id),onContextMenu:r=>{r.preventDefault(),r.stopPropagation(),c(t,"playlist","desktop",{x:r.clientX,y:r.clientY})},className:"w-full flex items-center gap-3 hover:bg-white/10 transition-colors group px-4 py-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-sm overflow-hidden flex-shrink-0 bg-zinc-900 self-center",children:e.jsx("img",{src:w.getAlbumArtUrl(t.Id,96),alt:t.Name,className:"w-full h-full object-cover",loading:"lazy"})}),e.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[e.jsx("div",{className:"text-sm font-medium text-white truncate group-hover:text-[var(--accent-color)] transition-colors",children:t.Name}),e.jsx("div",{className:"text-xs text-gray-400 truncate",children:t.ChildCount?`${t.ChildCount} tracks`:"Playlist"})]})]})}const $e=t=>{switch(t.toLowerCase()){case"language":return Ie;case"mood":return ze;case"instrumental":return we;default:return Ae}};function De({isOpen:t,onClose:s,title:c="Search",searchQuery:r,onSearchChange:p,onClearSearch:m,isLoading:u,results:n,sections:x,filterConfig:l,filterState:a,onOpenFilterSheet:i,groupingCategories:h=[],onOpenGroupingFilterSheet:v,onArtistClick:k,onAlbumClick:S,onSongClick:g,onPlaylistClick:P,onPlayAllSongs:d,onAddSongsToQueue:R,isQueueSidebarOpen:A=!1,desktopSearchInputRef:L,mobileSearchInputRef:T}){const $=o.useRef(null),C=o.useRef(null),G=L||$,q=T||C,[se,X]=o.useState(!1),[ne,V]=o.useState(!1);o.useEffect(()=>{if(t)V(!0),requestAnimationFrame(()=>{requestAnimationFrame(()=>{X(!0)})});else{X(!1);const f=setTimeout(()=>{V(!1)},200);return()=>clearTimeout(f)}},[t]);const[re,H]=o.useState(!1),[le,ae]=o.useState("mobile"),[oe,ie]=o.useState(null),[j,J]=o.useState(null),[ce,K]=o.useState(null),E=(f,b,_,I)=>{J(f),K(b),ae(_),ie(I||null),H(!0)};o.useEffect(()=>{var f,b;t&&(window.matchMedia("(hover: hover) and (pointer: fine) and (min-width: 1024px)").matches?(f=G.current)==null||f.focus():(b=q.current)==null||b.focus())},[t,G,q]),o.useEffect(()=>{if(!t)return;const f=b=>{b.key==="Escape"&&s()};return window.addEventListener("keydown",f,!0),()=>window.removeEventListener("keydown",f,!0)},[t,s]);const Y=l.showGenreFilter||l.showYearFilter||l.showGroupingFilters&&h.length>0,ue=n&&(n.artists.length>0||n.albums.length>0||n.songs.length>0||n.playlists&&n.playlists.length>0),de=(f,b)=>{if(!n)return null;const{type:_,limit:I}=f,B=b?"":"-mx-4",F=b?"pl-2 pr-4":"";switch(_){case"artists":{const y=I?n.artists.slice(0,I):n.artists;return y.length===0?null:e.jsxs("div",{children:[e.jsx("h2",{className:`text-xl font-bold text-white mb-4 ${F}`,children:"Artists"}),e.jsx("div",{className:`space-y-0 ${B}`,children:y.map(M=>e.jsx(Pe,{artist:M,onClick:k,onContextMenu:E,contextMenuItemId:(j==null?void 0:j.Id)||null},M.Id))})]},"artists")}case"albums":{const y=I?n.albums.slice(0,I):n.albums;return y.length===0?null:e.jsxs("div",{className:b?F:"",children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Albums"}),e.jsx("div",{className:"grid grid-cols-3 md:grid-cols-4 gap-4",children:y.map(M=>e.jsx(Le,{album:M,onClick:S,onContextMenu:E,contextMenuItemId:(j==null?void 0:j.Id)||null},M.Id))})]},"albums")}case"songs":return n.songs.length===0?null:e.jsxs("div",{children:[e.jsxs("div",{className:`flex items-center justify-between mb-4 ${F}`,children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"Songs"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:d,className:"w-10 h-10 flex items-center justify-center text-white hover:bg-white/10 rounded-lg transition-colors","aria-label":"Play all songs",children:e.jsx(ve,{className:"w-5 h-5"})}),e.jsx("button",{type:"button",onClick:R,className:"w-10 h-10 flex items-center justify-center text-white hover:bg-white/10 rounded-lg transition-colors","aria-label":"Add all songs to queue",children:e.jsx(ye,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:`space-y-0 ${B}`,children:n.songs.map((y,M)=>e.jsx(Te,{song:y,onClick:g,onContextMenu:E,contextMenuItemId:(j==null?void 0:j.Id)||null,showImage:!0},y.Id))})]},"songs");case"playlists":{const y=n.playlists;return!y||y.length===0?null:e.jsxs("div",{children:[e.jsx("h2",{className:`text-xl font-bold text-white mb-4 ${F}`,children:"Playlists"}),e.jsx("div",{className:`space-y-0 ${B}`,children:y.map(M=>e.jsx(_e,{playlist:M,onClick:P,onContextMenu:E},M.Id))})]},"playlists")}default:return null}},Z=()=>Y?e.jsxs(e.Fragment,{children:[l.showGenreFilter&&e.jsxs("button",{onClick:()=>i("genre"),className:`flex items-center gap-2 px-3 py-2 rounded-lg transition-colors ${a.selectedGenres.length>0?"bg-[var(--accent-color)] text-white":"bg-white/10 text-white hover:bg-white/20"}`,"aria-label":"Filter by genre",children:[e.jsx(be,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Genre"})]}),l.showYearFilter&&e.jsxs("button",{onClick:()=>i("year"),className:`flex items-center gap-2 px-3 py-2 rounded-lg transition-colors ${a.yearRange.min!==null||a.yearRange.max!==null?"bg-[var(--accent-color)] text-white":"bg-white/10 text-white hover:bg-white/20"}`,"aria-label":"Filter by year",children:[e.jsx(Ne,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Year"})]}),l.showGroupingFilters&&h.map(f=>{var I;const b=$e(f.key),_=(((I=a.selectedGroupings[f.key])==null?void 0:I.length)||0)>0;return e.jsxs("button",{onClick:()=>v==null?void 0:v(f),className:`flex items-center gap-2 px-3 py-2 rounded-lg transition-colors ${_?"bg-[var(--accent-color)] text-white":"bg-white/10 text-white hover:bg-white/20"}`,"aria-label":`Filter by ${f.name}`,children:[e.jsx(b,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:f.name})]},f.key)})]}):null,me=()=>e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-zinc-800 border-t-[var(--accent-color)]"})}),xe=()=>e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 text-gray-400",children:[e.jsx("div",{className:"text-lg mb-2",children:"No results found"}),e.jsx("div",{className:"text-sm",children:"Try a different search term"})]}),O=f=>u?me():n?ue?e.jsx("div",{className:"space-y-8",children:x.map(b=>de(b,f))}):xe():e.jsx("div",{className:"flex flex-col items-center justify-center py-16 text-gray-400"});return ne?pe.createPortal(e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`hidden [@media((hover:hover)_and_(pointer:fine)_and_(min-width:1024px))]:block fixed inset-0 z-[9998] bg-black/50 transition-opacity duration-200 ${se?"opacity-100":"opacity-0"}`,onClick:s}),e.jsx("div",{className:`hidden [@media((hover:hover)_and_(pointer:fine)_and_(min-width:1024px))]:flex fixed top-0 left-16 z-[9999] justify-center pointer-events-none ${A?"":"right-0"}`,style:A?{right:"var(--sidebar-width)"}:void 0,children:e.jsxs("div",{className:"w-[768px] max-h-[80vh] bg-zinc-900 rounded-b-xl shadow-2xl pointer-events-auto border-l border-r border-b border-zinc-800 flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"sticky top-0 bg-zinc-900 z-10 px-4 pt-4 pb-4 border-b border-zinc-800 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"text-lg font-semibold text-white",children:c}),e.jsx("button",{onClick:s,className:"px-3 py-1.5 text-white text-sm font-medium hover:bg-zinc-800 rounded-lg transition-colors",children:"Cancel"})]}),e.jsx(W,{ref:G,value:r,onChange:p,placeholder:"Search for artists, albums, songs...",showClearButton:r.trim().length>0,onClear:m})]}),e.jsxs("div",{className:"overflow-y-auto flex-1 px-4 pb-8",children:[Y&&e.jsx("div",{className:"flex flex-wrap items-center gap-3 pt-3 pb-4 border-b border-zinc-800 mb-4",children:Z()}),O(!1)]})]})}),e.jsxs("div",{className:"fixed inset-0 bg-black z-[9999] flex flex-col p-0 m-0 [@media((hover:hover)_and_(pointer:fine)_and_(min-width:1024px))]:hidden",children:[e.jsx("div",{className:"fixed top-0 left-0 right-0 bg-black z-50 pointer-events-none",style:{height:"env(safe-area-inset-top)",top:"var(--header-offset, 0px)"}}),e.jsx("div",{className:"sticky top-0 left-0 right-0 bg-black z-10 pt-0 pb-0 w-full m-0",style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top))"},children:e.jsx("div",{className:"max-w-[768px] mx-auto w-full",children:e.jsxs("div",{className:"flex items-center gap-3 pl-2 pr-4 pt-4 pb-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(W,{ref:q,value:r,onChange:p,showClearButton:r.trim().length>0,onClear:m})}),e.jsx("button",{onClick:s,className:"px-4 py-2 text-white text-sm font-medium hover:text-zinc-300 transition-colors whitespace-nowrap flex-shrink-0",children:"Cancel"})]})})}),e.jsx("div",{className:"overflow-y-auto flex-1",children:e.jsxs("div",{className:"max-w-[768px] mx-auto w-full",children:[Y&&e.jsx("div",{className:"bg-black pt-3 pb-4",children:e.jsx("div",{className:"flex flex-wrap items-center gap-3 pl-2 pr-4",children:Z()})}),e.jsx("div",{className:"pb-32 pt-4",children:O(!0)})]})})]}),e.jsx(ge,{item:j,itemType:ce,isOpen:re,onClose:()=>{H(!1),J(null),K(null)},zIndex:999999,mode:le,position:oe||void 0})]}),document.body):null}async function Ue(t,s,c){var k,S,g,P;const r=await w.search(t,s,c),p=((k=r.Songs)==null?void 0:k.Items)||[],m=((S=r.Albums)==null?void 0:S.Items)||[],u=((g=r.Artists)==null?void 0:g.Items)||[],n=((P=r.Playlists)==null?void 0:P.Items)||[],l=N(t).toLowerCase().trim(),a=p.filter(d=>{var L,T,$;if(N(d.Name||"").toLowerCase().includes(l))return!0;const A=[];return d.AlbumArtist&&A.push(N(d.AlbumArtist)),(L=d.AlbumArtists)!=null&&L.length&&A.push(...d.AlbumArtists.map(C=>N(C.Name||"")).filter(Boolean)),(T=d.ArtistItems)!=null&&T.length&&A.push(...d.ArtistItems.map(C=>N(C.Name||"")).filter(Boolean)),!!(A.some(C=>C.toLowerCase().includes(l))||($=d.Genres)!=null&&$.some(C=>N(C).toLowerCase().includes(l)))}),i=u.filter(d=>N(d.Name||"").toLowerCase().includes(l)),h=m.filter(d=>{var L,T;const R=N(d.Name||""),A=N(d.AlbumArtist||((T=(L=d.ArtistItems)==null?void 0:L[0])==null?void 0:T.Name)||"");return R.toLowerCase().includes(l)||A.toLowerCase().includes(l)}),v=n.filter(d=>N(d.Name||"").toLowerCase().includes(l));return{artists:i,albums:h,playlists:v,songs:a}}async function Ge(t,s){var x,l;const c={};(x=s==null?void 0:s.genres)!=null&&x.length&&(c.genres=s.genres),(l=s==null?void 0:s.years)!=null&&l.length&&(c.years=s.years);const[r,p,m,u]=await Promise.all([w.getArtists({limit:t}),w.getAlbums({limit:t,...c}),w.getPlaylists({limit:t}),w.getSongs({limit:t,...c})]),n=(u.Items||[]).map(a=>({...a,Grouping:(a.Tags||[]).filter(i=>i.startsWith("grouping:")).map(i=>i.replace("grouping:",""))}));return{artists:r.Items||[],albums:p.Items||[],playlists:m.Items||[],songs:n}}export{De as S,Re as a,Ge as f,Se as g,Ue as u};
