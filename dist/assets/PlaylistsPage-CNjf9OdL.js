import{b as J,r as n,f as O,j as e,I as ue,e as A,C as W,u as xe,a as Q,d as me,h as he,P as fe,L as ge,U as B,D as Y}from"./index-9VyyR-5F.js";import{S as pe,u as ve}from"./search-DDcTeqWD.js";import{A as be}from"./arrow-up-down-CTrKx1sL.js";function je({playlist:s}){const C=J(),[h,p]=n.useState(!1),[k,f]=n.useState("mobile"),[i,j]=n.useState(null),u=n.useRef(!1),c=a=>{if(u.current){a.preventDefault(),u.current=!1;return}C(`/playlist/${s.Id}`)},g=O({onLongPress:a=>{a.preventDefault(),u.current=!0,f("mobile"),j(null),p(!0)}}),y=a=>{a.preventDefault(),a.stopPropagation(),u.current=!0,f("desktop"),j({x:a.clientX,y:a.clientY}),p(!0),setTimeout(()=>{u.current=!1},300)};return e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:a=>{if(h||u.current){a.preventDefault(),a.stopPropagation();return}c(a)},onContextMenu:y,...g,className:"w-full flex items-center gap-3 hover:bg-white/10 transition-colors group px-4 py-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-sm overflow-hidden flex-shrink-0 bg-zinc-900 self-center",children:e.jsx(ue,{src:A.getAlbumArtUrl(s.Id,96),alt:s.Name,className:"w-full h-full object-cover",showOutline:!0,rounded:"rounded-sm"})}),e.jsxs("div",{className:"flex-1 min-w-0 text-left flex flex-col justify-center",children:[e.jsx("div",{className:"text-sm font-medium text-white truncate group-hover:text-[var(--accent-color)] transition-colors",children:s.Name}),e.jsx("div",{className:"text-xs text-gray-400 truncate",children:s.ChildCount?`${s.ChildCount} tracks`:"Playlist"})]})]}),e.jsx(W,{item:s,itemType:"playlist",isOpen:h,onClose:()=>p(!1),mode:k,position:i||void 0})]})}const $=new Map;function ye({artist:s,onClick:C,onContextMenu:h,contextMenuItemId:p}){var x,I;const[k,f]=n.useState(!1),i=n.useRef(!1),j=p===s.Id,[u,c]=n.useState(null);n.useEffect(()=>{var m;if((m=s.ImageTags)!=null&&m.Primary){c(null);return}const l=$.get(s.Id);if(l!==void 0){c(l);return}let v=!1;return(async()=>{try{const{albums:N,songs:o}=await A.getArtistItems(s.Id),w=N[0],z=o.find(b=>b.AlbumId)||o[0],P=w||z,E=P?P.AlbumId||P.Id:null,T=E?A.getAlbumArtUrl(E,96):null;$.set(s.Id,T),v||c(T)}catch(N){console.error("Failed to load fallback album art for artist (playlists search):",s.Id,N),$.set(s.Id,null)}})(),()=>{v=!0}},[s.Id,s.ImageTags]);const g=l=>{if(j||i.current){l.preventDefault(),l.stopPropagation(),i.current=!1;return}C(s.Id)},y=l=>{l.preventDefault(),l.stopPropagation(),i.current=!0,h(s,"artist"),setTimeout(()=>{i.current=!1},300)},a=O({onLongPress:l=>{l.preventDefault(),i.current=!0,h(s,"artist")},onClick:g});return e.jsxs("button",{onClick:g,onContextMenu:y,...a,className:`w-full flex items-center gap-4 hover:bg-white/10 transition-colors text-left px-4 h-[72px] ${j?"bg-white/10":""}`,children:[e.jsx("div",{className:"w-12 h-12 rounded-full overflow-hidden flex-shrink-0 bg-zinc-900 flex items-center justify-center",children:k?e.jsx(B,{className:"w-6 h-6 text-gray-500"}):(x=s.ImageTags)!=null&&x.Primary||u?e.jsx("img",{src:(I=s.ImageTags)!=null&&I.Primary?A.getArtistImageUrl(s.Id,96):u||"",alt:s.Name,className:"w-full h-full object-cover",onError:()=>f(!0),loading:"lazy"}):e.jsx(B,{className:"w-6 h-6 text-gray-500"})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("div",{className:"text-base font-medium text-white truncate group-hover:text-[var(--accent-color)] transition-colors",children:s.Name})})]})}function Ne({album:s,onClick:C,onContextMenu:h,contextMenuItemId:p}){var y,a;const[k,f]=n.useState(!1),i=n.useRef(!1),j=p===s.Id,u=x=>{if(j||i.current){x.preventDefault(),x.stopPropagation(),i.current=!1;return}C(s.Id)},c=x=>{x.preventDefault(),x.stopPropagation(),i.current=!0,h(s,"album"),setTimeout(()=>{i.current=!1},300)},g=O({onLongPress:x=>{x.preventDefault(),i.current=!0,h(s,"album")},onClick:u});return e.jsxs("button",{onClick:u,onContextMenu:c,...g,className:"text-left group",children:[e.jsx("div",{className:"aspect-square rounded overflow-hidden mb-3 bg-zinc-900 shadow-lg relative flex items-center justify-center",children:k?e.jsx(Y,{className:"w-12 h-12 text-gray-500"}):e.jsxs(e.Fragment,{children:[e.jsx("img",{src:A.getAlbumArtUrl(s.Id,474),alt:s.Name,className:"w-full h-full object-cover",onError:()=>f(!0)}),e.jsx("div",{className:"absolute inset-0 pointer-events-none border border-white rounded",style:{borderColor:"rgba(255, 255, 255, 0.03)",borderWidth:"1px"}})]})}),e.jsx("div",{className:"text-sm font-semibold text-white truncate mb-1",children:s.Name}),e.jsx("div",{className:"text-xs text-gray-400 truncate",children:s.AlbumArtist||((a=(y=s.ArtistItems)==null?void 0:y[0])==null?void 0:a.Name)||"Unknown Artist"})]})}function we({song:s,onClick:C,onContextMenu:h,contextMenuItemId:p,showImage:k=!0}){var x,I;const f=n.useRef(!1),i=p===s.Id,[j,u]=n.useState(!1),c=l=>{const v=Math.floor(l/1e7),S=Math.floor(v/60),m=v%60;return`${S}:${m.toString().padStart(2,"0")}`},g=l=>{if(i||f.current){l.preventDefault(),l.stopPropagation(),f.current=!1;return}C(s)},y=l=>{l.preventDefault(),l.stopPropagation(),f.current=!0,h(s,"song"),setTimeout(()=>{f.current=!1},300)},a=O({onLongPress:l=>{l.preventDefault(),f.current=!0,h(s,"song")},onClick:g});return e.jsxs("button",{onClick:g,onContextMenu:y,...a,className:`w-full flex items-center gap-3 hover:bg-white/10 transition-colors group px-4 py-3 ${i?"bg-white/10":""}`,children:[e.jsx("div",{className:"w-12 h-12 rounded-sm overflow-hidden flex-shrink-0 bg-zinc-900 self-center relative flex items-center justify-center",children:j?e.jsx(Y,{className:"w-7 h-7 text-gray-500"}):e.jsxs(e.Fragment,{children:[e.jsx("img",{src:A.getAlbumArtUrl(s.AlbumId||s.Id,96),alt:s.Name,className:"w-full h-full object-cover",loading:"lazy",onError:()=>u(!0)}),e.jsx("div",{className:"absolute inset-0 pointer-events-none border border-white rounded-sm",style:{borderColor:"rgba(255, 255, 255, 0.03)",borderWidth:"1px"}})]})}),e.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[e.jsx("div",{className:"text-sm font-medium text-white truncate group-hover:text-[var(--accent-color)] transition-colors",children:s.Name}),e.jsxs("div",{className:"text-xs text-gray-400 truncate",children:[s.AlbumArtist||((I=(x=s.ArtistItems)==null?void 0:x[0])==null?void 0:I.Name)||"Unknown Artist",s.Album&&` â€¢ ${s.Album}`]})]}),s.RunTimeTicks&&e.jsx("div",{className:"text-xs text-gray-500 flex-shrink-0 text-right",children:c(s.RunTimeTicks)})]})}function ke(){const[s,C]=n.useState([]),[h,p]=n.useState(!0),{sortPreferences:k,setSortPreference:f}=xe(),{playTrack:i,playAlbum:j,addToQueue:u}=Q(),c=k.playlists,g=n.useRef(!0),[y,a]=n.useState(!1),x=n.useRef(c),I=J(),l=n.useRef(null),[v,S]=n.useState(""),[m,N]=n.useState(!1),[o,w]=n.useState(null),[z,P]=n.useState(!1),[E,T]=n.useState(!1),[b,U]=n.useState(null),[X,F]=n.useState(null),[q,V]=n.useState("mobile"),[G,K]=n.useState(null),[Z,H]=n.useState(45),R=Q(t=>t.isQueueSidebarOpen);n.useEffect(()=>{m||(!g.current&&x.current!==c&&a(!0),x.current=c,_())},[c,m]),n.useEffect(()=>{g.current&&(g.current=!1)},[]),n.useEffect(()=>{if(v.trim()){P(!0);const t=window.setTimeout(()=>{(async()=>{try{const M=await ve(v,450);w(M)}catch(M){console.error("Search failed:",M),w(null)}finally{P(!1)}})()},250);return()=>{window.clearTimeout(t)}}else w(null),P(!1)},[v]),n.useEffect(()=>{H(45)},[v,m,o==null?void 0:o.songs.length]),n.useEffect(()=>{var d;if(!m||!((d=o==null?void 0:o.songs)!=null&&d.length))return;const t=()=>{const M=window.scrollY||document.documentElement.scrollTop,L=window.innerHeight||document.documentElement.clientHeight,ce=document.documentElement.scrollHeight;M+L*1.5>=ce&&H(de=>Math.min(de+45,o.songs.length))};return window.addEventListener("scroll",t,{passive:!0}),()=>window.removeEventListener("scroll",t)},[m,o==null?void 0:o.songs.length]),n.useEffect(()=>{var t;if(m&&((t=l.current)==null||t.focus(),l.current)){const d=l.current.value.length;l.current.setSelectionRange(d,d)}},[m]);const _=async()=>{p(!0);try{const t={limit:100};c==="RecentlyAdded"?(t.sortBy=["DateCreated"],t.sortOrder="Descending"):(t.sortBy=["SortName"],t.sortOrder="Ascending");const d=await A.getPlaylists(t);C(d.Items)}catch(t){console.error("Failed to load playlists:",t)}finally{p(!1),a(!1)}},ee=t=>{S(t),t.trim().length>0&&!m&&N(!0)},te=()=>{S(""),w(null)},se=()=>{N(!1),S(""),w(null)},ne=t=>{I(`/artist/${t}`),N(!1),S(""),w(null)},le=t=>{I(`/album/${t}`),N(!1),S(""),w(null)},re=t=>{i(t,[t])},ae=t=>{t.preventDefault(),t.stopPropagation(),r!=null&&r.songs&&r.songs.length>0&&j(r.songs)},oe=t=>{t.preventDefault(),t.stopPropagation(),r!=null&&r.songs&&r.songs.length>0&&u(r.songs)},ie=t=>{I(`/playlist/${t}`),N(!1),S(""),w(null)},D=(t,d,M="mobile",L)=>{U(t),F(d),V(M),K(L||null),T(!0)},r=n.useMemo(()=>o?{playlists:o.playlists||[],artists:o.artists||[],albums:o.albums||[],songs:o.songs||[]}:null,[o]);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"pb-20",children:[e.jsx("div",{className:`fixed top-0 left-0 right-0 bg-black z-10 lg:left-16 transition-[left,right] duration-300 ${R?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top))"},children:e.jsx("div",{className:"max-w-[768px] mx-auto",children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Playlists"}),e.jsx("button",{onClick:()=>N(!0),className:"w-10 h-10 flex items-center justify-center text-white hover:bg-zinc-800 rounded-full transition-colors","aria-label":"Search",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})]}),!m&&e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("button",{onClick:()=>f("playlists",c==="RecentlyAdded"?"Alphabetical":"RecentlyAdded"),className:"text-sm text-gray-400 hover:text-white transition-colors flex items-center gap-1",children:[c==="RecentlyAdded"?"Recently Added":"Alphabetically",e.jsx(be,{className:"w-4 h-4"})]}),h&&!g.current&&e.jsx("div",{className:"flex items-center",children:e.jsx(he,{})})]})]})})}),e.jsx("div",{className:`fixed left-0 right-0 z-10 lg:left-16 transition-[left,right] duration-300 ${R?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 7rem - 8px)",height:"24px",background:"linear-gradient(to bottom, rgba(0, 0, 0, 0.8), transparent)"}}),e.jsx("div",{style:{paddingTop:"calc(env(safe-area-inset-top) + 7rem)"},children:!m&&e.jsx("div",{className:y?"opacity-50 pointer-events-none":"",children:s.length===0&&!h?e.jsx("div",{className:"flex items-center justify-center py-16 text-gray-400",children:e.jsx("p",{children:"No playlists found"})}):e.jsx("div",{className:"space-y-0",children:s.map(t=>e.jsx(je,{playlist:t},t.Id))})})})]}),m&&me.createPortal(e.jsx(e.Fragment,{children:e.jsxs("div",{className:"fixed inset-0 bg-black z-[9999] overflow-y-auto p-0 m-0",children:[e.jsx("div",{className:"fixed top-0 left-0 right-0 bg-black z-50 pointer-events-none",style:{height:"env(safe-area-inset-top)",top:"var(--header-offset, 0px)"}}),e.jsx("div",{className:"fixed top-0 left-0 right-0 bg-black z-10 pt-0 pb-0 w-full m-0",style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top))",height:"76px"},children:e.jsx("div",{className:"max-w-[768px] mx-auto w-full",children:e.jsxs("div",{className:"flex items-center gap-3 px-4 pt-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(pe,{ref:l,value:v,onChange:ee,showClearButton:v.trim().length>0,onClear:te})}),e.jsx("button",{onClick:se,className:"px-4 py-2 text-white text-sm font-medium hover:text-zinc-300 transition-colors whitespace-nowrap flex-shrink-0",children:"Cancel"})]})})}),e.jsx("div",{className:`fixed left-0 right-0 z-[60] lg:left-16 transition-[left,right] duration-300 ${R?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 76px)",height:"24px",background:"linear-gradient(to bottom, rgba(0, 0, 0, 0.8), transparent)"}}),e.jsx("div",{className:"max-w-[768px] mx-auto w-full",style:{paddingTop:"calc(52px + env(safe-area-inset-top))"},children:e.jsx("div",{className:"pb-32 pt-4",children:z?e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-zinc-800 border-t-[var(--accent-color)]"})}):r?e.jsxs("div",{className:"space-y-8",children:[r.playlists.length>0&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-4 px-4",children:"Playlists"}),e.jsx("div",{className:"space-y-0",children:r.playlists.map(t=>e.jsxs("button",{onClick:()=>ie(t.Id),onContextMenu:d=>{d.preventDefault(),d.stopPropagation(),D(t,"playlist","desktop",{x:d.clientX,y:d.clientY})},className:"w-full flex items-center gap-3 hover:bg-white/10 transition-colors group px-4 py-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-sm overflow-hidden flex-shrink-0 bg-zinc-900 self-center",children:e.jsx("img",{src:A.getAlbumArtUrl(t.Id,96),alt:t.Name,className:"w-full h-full object-cover",loading:"lazy"})}),e.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[e.jsx("div",{className:"text-sm font-medium text-white truncate group-hover:text-[var(--accent-color)] transition-colors",children:t.Name}),e.jsx("div",{className:"text-xs text-gray-400 truncate",children:t.ChildCount?`${t.ChildCount} tracks`:"Playlist"})]})]},t.Id))})]}),r.artists.length>0&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-4 px-4",children:"Artists"}),e.jsx("div",{className:"space-y-0",children:r.artists.slice(0,5).map(t=>e.jsx(ye,{artist:t,onClick:ne,onContextMenu:D,contextMenuItemId:(b==null?void 0:b.Id)||null},t.Id))})]}),r.albums.length>0&&e.jsxs("div",{className:"px-4",children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Albums"}),e.jsx("div",{className:"grid grid-cols-3 gap-4",children:r.albums.slice(0,12).map(t=>e.jsx(Ne,{album:t,onClick:le,onContextMenu:D,contextMenuItemId:(b==null?void 0:b.Id)||null},t.Id))})]}),r.songs.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 px-4",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"Songs"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:ae,className:"w-10 h-10 flex items-center justify-center text-white hover:bg-white/10 rounded-lg transition-colors","aria-label":"Play all songs",children:e.jsx(fe,{className:"w-5 h-5"})}),e.jsx("button",{type:"button",onClick:oe,className:"w-10 h-10 flex items-center justify-center text-white hover:bg-white/10 rounded-lg transition-colors","aria-label":"Add all songs to queue",children:e.jsx(ge,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"space-y-0",children:r.songs.map((t,d)=>e.jsx(we,{song:t,onClick:re,onContextMenu:D,contextMenuItemId:(b==null?void 0:b.Id)||null,showImage:d<Z},t.Id))})]}),r.playlists.length===0&&r.artists.length===0&&r.albums.length===0&&r.songs.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 text-gray-400 px-4",children:[e.jsx("div",{className:"text-lg mb-2",children:"No results found"}),e.jsx("div",{className:"text-sm",children:"Try a different search term"})]})]}):e.jsx("div",{className:"flex flex-col items-center justify-center py-16 text-gray-400 px-4"})})})]})}),document.body),e.jsx(W,{item:b,itemType:X,isOpen:E,onClose:()=>{T(!1),U(null),F(null)},zIndex:99999,mode:q,position:G||void 0})]})}export{ke as default};
