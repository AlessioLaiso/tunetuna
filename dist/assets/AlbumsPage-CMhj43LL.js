import{b as ie,r as s,f as ke,j as t,D as Oe,I as Te,e as H,C as ce,u as m,a as E,d as Le,l as oe,k as Re}from"./index-BtrRwJyr.js";import{P as Fe}from"./Pagination-CLClewXh.js";import{u as De,F as ae}from"./useSearch-DUqSA7R9.js";import{S as Ye}from"./search-BiHio9im.js";import{A as _e}from"./arrow-up-down-h7shJkgn.js";function Be({album:o,onContextMenu:f,contextMenuItemId:P,showImage:k=!0}){var h,b;const w=ie(),[S,v]=s.useState(!1),[O,A]=s.useState("mobile"),[T,a]=s.useState(null),[u,L]=s.useState(!1),c=s.useRef(!1),R=P===o.Id,F=r=>{if(c.current){r.preventDefault(),c.current=!1;return}w(`/album/${o.Id}`)},D=r=>{var p,g,x,C;r.preventDefault(),r.stopPropagation(),(g=(p=r.nativeEvent)==null?void 0:p.preventDefault)==null||g.call(p),(C=(x=r.nativeEvent)==null?void 0:x.stopImmediatePropagation)==null||C.call(x),c.current=!0,f?f(o,"album","desktop",{x:r.clientX,y:r.clientY}):(A("desktop"),a({x:r.clientX,y:r.clientY}),v(!0)),setTimeout(()=>{c.current=!1},300)},Y=ke({onLongPress:r=>{r.preventDefault(),f?(c.current=!0,f(o,"album","mobile")):(c.current=!0,A("mobile"),a(null),v(!0))}});return t.jsxs(t.Fragment,{children:[t.jsxs("button",{onClick:r=>{if(S||c.current){r.preventDefault(),r.stopPropagation();return}F(r)},onContextMenu:r=>{D(r)},...Y,className:`text-left group ${R?"ring-2 ring-blue-500":""}`,children:[t.jsx("div",{className:"aspect-square rounded overflow-hidden mb-2 bg-zinc-900 relative flex items-center justify-center",children:u?t.jsx(Oe,{className:"w-12 h-12 text-gray-500"}):k?t.jsx(Te,{src:H.getAlbumArtUrl(o.Id,474),alt:o.Name,className:"w-full h-full object-cover",showOutline:!0,rounded:"rounded",onError:()=>L(!0)}):t.jsx("div",{className:"w-full h-full bg-zinc-900"})}),t.jsx("div",{className:"text-sm font-medium text-white truncate",children:o.Name}),t.jsx("div",{className:"text-xs text-gray-400 truncate",children:o.AlbumArtist||((b=(h=o.ArtistItems)==null?void 0:h[0])==null?void 0:b.Name)||"Unknown Artist"})]}),t.jsx(ce,{item:o,itemType:"album",isOpen:S,onClose:()=>v(!1),mode:O,position:T||void 0})]})}const $e=[{type:"albums"},{type:"artists",limit:5},{type:"playlists"},{type:"songs"}],M=84,le=45,Qe=45;function Xe(){const o=m(e=>e.albums),f=m(e=>e.setAlbums),P=m(e=>e.sortPreferences),k=m(e=>e.setSortPreference),w=m(e=>e.setLoading),S=m(e=>e.loading),v=m(e=>e.genres),O=E(e=>e.playTrack),A=E(e=>e.playAlbum),T=E(e=>e.addToQueue),[a,u]=s.useState(!1),[L,c]=s.useState(!1),[R,F]=s.useState("mobile"),[D,Y]=s.useState(null),[h,b]=s.useState(null),[r,p]=s.useState(null),[g,x]=s.useState(0),[C,G]=s.useState(0),[ue,V]=s.useState(le),_=ie(),[U,X]=Le(),J=s.useRef(null),K=s.useRef(null),[W,B]=s.useState(!1),[q,de]=s.useState(null),[me,Z]=s.useState([]),l=P.albums,N=s.useRef(!0),[fe,ee]=s.useState(!1),te=s.useRef(l),$=E(e=>e.isQueueSidebarOpen),{searchQuery:j,setSearchQuery:he,isSearching:pe,searchResults:i,selectedGenres:se,setSelectedGenres:ge,yearRange:ne,setYearRange:Q,clearSearch:I,clearAll:xe}=De();s.useEffect(()=>{const e=U.get("year");if(e){const n=parseInt(e,10);!isNaN(n)&&n>0&&(Q({min:n,max:n}),u(!0),X({},{replace:!0}))}},[U,X,Q]),s.useEffect(()=>{(async()=>{try{const n=m.getState();if(n.years.length>0)Z(n.years);else{const d=await H.getYears();Z(d)}}catch(n){oe.error("Failed to load filter values:",n)}})()},[]),s.useEffect(()=>{if(a){const n=window.matchMedia("(hover: hover) and (pointer: fine) and (min-width: 1024px)").matches?K:J;setTimeout(()=>{var d;if((d=n.current)==null||d.focus(),n.current){const y=n.current.value.length;n.current.setSelectionRange(y,y)}},50)}},[a]),s.useEffect(()=>{if(!a)return;const e=n=>{n.key==="Escape"&&(n.preventDefault(),n.stopPropagation(),re())};return window.addEventListener("keydown",e,!0),()=>window.removeEventListener("keydown",e,!0)},[a]);const ye=e=>{he(e),e.trim().length>0&&!a&&u(!0)},Se=()=>{I()},re=()=>{u(!1),xe()},ve=e=>{de(e),B(!0)},be=e=>{ge(e)},Ce=e=>{Q(e)},je=e=>{_(`/artist/${e}`),u(!1),I()},we=e=>{_(`/album/${e}`),u(!1),I()},Ae=e=>{O(e,[e])},Ne=()=>{i!=null&&i.songs&&i.songs.length>0&&A(i.songs)},Ie=()=>{i!=null&&i.songs&&i.songs.length>0&&T(i.songs)},Ee=e=>{_(`/playlist/${e}`),u(!1),I()},Me=(e,n,d="mobile",y)=>{b(e),p(n),F(d),Y(y||null),c(!0)};s.useEffect(()=>{const e=n=>{};return document.addEventListener("contextmenu",e,!0),()=>{document.removeEventListener("contextmenu",e,!0)}},[]),s.useEffect(()=>{j.trim()||x(0)},[l,j]),s.useEffect(()=>{V(le)},[g,o.length]);const z=s.useCallback(()=>{const e=window.scrollY||document.documentElement.scrollTop,n=window.innerHeight||document.documentElement.clientHeight,d=document.documentElement.scrollHeight;e+n*1.5>=d&&V(y=>Math.min(y+Qe,o.length))},[o.length]);s.useEffect(()=>(window.addEventListener("scroll",z,{passive:!0}),()=>{window.removeEventListener("scroll",z)}),[z]),s.useEffect(()=>{j.trim()||(!N.current&&te.current!==l&&ee(!0),te.current=l,Pe())},[g,l,j]),s.useEffect(()=>{N.current&&(N.current=!1)},[]);const Pe=async()=>{w("albums",!0);try{const e={limit:M,startIndex:g*M};l==="RecentlyAdded"?(e.sortBy=["DateCreated"],e.sortOrder="Descending"):l==="Newest"?(e.sortBy=["ProductionYear","SortName"],e.sortOrder=["Descending","Ascending"]):(e.sortBy=["SortName"],e.sortOrder="Ascending");const n=await H.getAlbums(e);f(n.Items),G(n.TotalRecordCount||0)}catch(e){oe.error("Failed to load albums:",e),f([]),G(0)}finally{w("albums",!1),ee(!1)}};return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"pb-20",children:[t.jsx("div",{className:`fixed top-0 left-0 right-0 bg-black z-10 lg:left-16 transition-[left,right] duration-300 ${$?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top))"},children:t.jsx("div",{className:"max-w-[768px] mx-auto",children:t.jsxs("div",{className:"p-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsx("h1",{className:"text-2xl font-bold text-white",children:"Albums"}),t.jsx("button",{onClick:()=>u(!0),className:"w-10 h-10 flex items-center justify-center text-white hover:bg-zinc-800 rounded-full transition-colors","aria-label":"Search",children:t.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})]}),!a&&t.jsxs("div",{className:"flex items-center justify-between gap-2",children:[t.jsxs("button",{onClick:()=>{k("albums",l==="RecentlyAdded"?"Alphabetical":l==="Alphabetical"?"Newest":"RecentlyAdded")},className:"text-sm text-gray-400 hover:text-white transition-colors flex items-center gap-1",children:[l==="RecentlyAdded"?"Recently Added":l==="Newest"?"Newest":"Alphabetically",t.jsx(_e,{className:"w-4 h-4"})]}),S.albums&&!N.current&&t.jsx("div",{className:"flex items-center",children:t.jsx(Re,{})})]})]})})}),t.jsx("div",{className:`fixed left-0 right-0 z-10 lg:left-16 transition-[left,right] duration-300 ${$?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 7rem - 8px)",height:"24px",background:"linear-gradient(to bottom, rgba(0, 0, 0, 0.8), transparent)"}}),t.jsx("div",{style:{paddingTop:"calc(env(safe-area-inset-top) + 7rem)"},onContextMenu:e=>{},children:t.jsx("div",{className:`${fe?"opacity-50 pointer-events-none":""} ${a?"hidden [@media((hover:hover)_and_(pointer:fine)_and_(min-width:1024px))]:block":""}`,onContextMenu:e=>{},children:o.length===0&&!S.albums?t.jsx("div",{className:"flex items-center justify-center py-16 text-gray-400",children:t.jsx("p",{children:"No albums found"})}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"p-4",children:t.jsx("div",{className:"grid grid-cols-3 md:grid-cols-4 gap-3",onContextMenu:e=>{},children:o.map((e,n)=>t.jsx(Be,{album:e,onContextMenu:Me,contextMenuItemId:(h==null?void 0:h.Id)||null,showImage:n<ue},e.Id))})}),t.jsx(Fe,{currentPage:g,totalPages:Math.ceil(C/M),onPageChange:x,itemsPerPage:M,totalItems:C})]})})})]}),t.jsx(Ye,{isOpen:a,onClose:re,title:"Search",searchQuery:j,onSearchChange:ye,onClearSearch:Se,isLoading:pe,results:i,sections:$e,filterConfig:{showGenreFilter:!0,showYearFilter:!0},filterState:{selectedGenres:se,yearRange:ne},onOpenFilterSheet:ve,onArtistClick:je,onAlbumClick:we,onSongClick:Ae,onPlaylistClick:Ee,onPlayAllSongs:Ne,onAddSongsToQueue:Ie,isQueueSidebarOpen:$,desktopSearchInputRef:K,mobileSearchInputRef:J}),q==="genre"&&t.jsx(ae,{isOpen:W,onClose:()=>B(!1),filterType:"genre",genres:v,selectedValues:se,onApply:be}),q==="year"&&t.jsx(ae,{isOpen:W,onClose:()=>B(!1),filterType:"year",availableYears:me,yearRange:ne,onApplyYear:Ce}),t.jsx(ce,{item:h,itemType:r,isOpen:L,onClose:()=>{c(!1),b(null),p(null)},zIndex:99999,mode:R,position:D||void 0})]})}export{Xe as default};
