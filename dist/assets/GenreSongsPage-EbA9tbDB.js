import{k as Ne,b as je,a as T,g as Se,u as ve,s as we,r as l,j as e,h as Ae,S as Ie,P as Pe,L as ye,C as Ce,e as M,f as De,D as Me,I as Ee}from"./index-CSzK2hrG.js";import{u as K}from"./useScrollLazyLoad-BOVOrKYT.js";import{S as ke}from"./SongItem-C-oL5asR.js";import{P as Ge}from"./Pagination-B9FRLs7D.js";import{A as Y}from"./arrow-left-DEhp5iD0.js";import{A as Le}from"./arrow-up-down-DnJ9a3Ov.js";const W=45,Te=45,D=84,Z=45,Ye=45;function Be({album:i,year:b,onNavigate:A,onContextMenu:E,showImage:B=!0}){const[O,k]=l.useState(!1),x=l.useRef(!1),S=g=>{g.preventDefault(),g.stopPropagation(),x.current=!0,E(i,"desktop",{x:g.clientX,y:g.clientY}),setTimeout(()=>{x.current=!1},300)},I=De({onLongPress:g=>{g.preventDefault(),x.current=!0,E(i,"mobile")},onClick:()=>{if(x.current){x.current=!1;return}A(i.Id)}});return e.jsxs("button",{onClick:()=>{if(x.current){x.current=!1;return}A(i.Id)},onContextMenu:S,...I,className:"text-left group",children:[e.jsx("div",{className:"aspect-square rounded overflow-hidden mb-2 bg-zinc-900 flex items-center justify-center",children:O?e.jsx(Me,{className:"w-12 h-12 text-gray-500"}):B?e.jsx(Ee,{src:M.getAlbumArtUrl(i.Id,474),alt:i.Name,className:"w-full h-full object-cover",showOutline:!0,rounded:"rounded",onError:()=>k(!0)}):e.jsx("div",{className:"w-full h-full bg-zinc-900"})}),e.jsx("div",{className:"text-sm font-medium text-white truncate",children:i.Name}),b&&e.jsx("div",{className:"text-xs text-gray-400 truncate",children:b})]})}function Re(){const{id:i}=Ne(),b=je(),{playAlbum:A,toggleShuffle:E,isPlaying:B,pause:O,shuffleGenreSongs:k,addToQueue:x}=T();Se();const{genres:S,genreSongs:I,setGenreSongs:g}=ve(),{state:z}=we(),[d,F]=l.useState(null),[f,_]=l.useState([]),[ee,v]=l.useState(!0),[te,V]=l.useState(!1),[se,re]=l.useState("mobile"),[ne,ae]=l.useState(null),[le,U]=l.useState(null),[oe,R]=l.useState(null),[$,Q]=l.useState(W),[q,H]=l.useState(Z),[ie,ce]=l.useState(0),[w,G]=l.useState(!1),[P,ue]=l.useState("Alphabetical"),[L,J]=l.useState(0),y=T(t=>t.isQueueSidebarOpen);l.useEffect(()=>{if(w){const t=setTimeout(()=>{G(!1)},1e4);return()=>clearTimeout(t)}},[w]),l.useEffect(()=>{z==="success"&&i&&ce(t=>t+1)},[z,i]),l.useEffect(()=>{if(!i)return;let t=!0;return(async()=>{const s=I[i];if(s&&s.length>0){let n=S;if(n.length===0&&(n=await M.getGenres()),!t)return;const a=n.find(o=>o.Id===i);a&&F(a),_(s),v(!1);return}v(!0);try{let n=S;if(n.length===0&&(n=await M.getGenres()),!t)return;const a=n.find(c=>c.Id===i);if(!a){v(!1);return}F(a);const o=a.Name;if(!o){v(!1);return}const m=await M.getGenreSongs(i,o);if(!t)return;g(i,m),_(m)}catch(n){if(!t)return;console.error("Failed to load genre songs:",n)}finally{t&&v(!1)}})(),()=>{t=!1}},[i,S,I,g,ie]);const me=async()=>{if(f.length>0&&(d!=null&&d.Id)&&(d!=null&&d.Name)&&!w){const t=T.getState(),{isShuffleAllActive:r,isShuffleGenreActive:s,shuffle:n}=t;if(r||s)return;G(!0);try{await k(d.Id,d.Name)}catch(a){console.error("Failed to shuffle genre:",a)}finally{G(!1)}}},u=l.useMemo(()=>{const t=new Map;return f.forEach(r=>{if(r.AlbumId&&r.Album&&!t.has(r.AlbumId)){const s={Id:r.AlbumId,Name:r.Album,AlbumArtist:r.AlbumArtist,ArtistItems:r.ArtistItems,ProductionYear:r.ProductionYear,PremiereDate:r.PremiereDate};t.set(r.AlbumId,s)}}),Array.from(t.values()).sort((r,s)=>{const n=r.ProductionYear||(r.PremiereDate?new Date(r.PremiereDate).getFullYear():0),a=s.ProductionYear||(s.PremiereDate?new Date(s.PremiereDate).getFullYear():0);if(n!==a)return a-n;const o=r.Name||"",m=s.Name||"";return o.localeCompare(m)})},[f]),p=u.length>84,de=l.useMemo(()=>{if(!p)return u;const t=L*D,r=t+D;return u.slice(t,r)},[u,L,p]);l.useMemo(()=>{const t=new Map;f.forEach(s=>{var m,c;const n=s.AlbumArtist||((c=(m=s.ArtistItems)==null?void 0:m[0])==null?void 0:c.Name)||"Unknown Artist",a=s.AlbumId||"no-album";t.has(n)||t.set(n,new Map);const o=t.get(n);o.has(a)||o.set(a,[]),o.get(a).push(s)});const r=[];return t.forEach((s,n)=>{const a=[];s.forEach((o,m)=>{var j;const c=[...o].sort((C,ge)=>{const pe=C.IndexNumber||0,be=ge.IndexNumber||0;return pe-be}),h=((j=c[0])==null?void 0:j.Album)||"Unknown Album";a.push({albumId:m,albumName:h,songs:c})}),a.sort((o,m)=>{const c=o.songs[0],h=m.songs[0],j=(c==null?void 0:c.ProductionYear)||(c!=null&&c.PremiereDate?new Date(c.PremiereDate).getFullYear():0),C=(h==null?void 0:h.ProductionYear)||(h!=null&&h.PremiereDate?new Date(h.PremiereDate).getFullYear():0);return j!==C?C-j:o.albumName.localeCompare(m.albumName)}),r.push({artist:n,albums:a})}),r.sort((s,n)=>s.artist.localeCompare(n.artist)),r},[f]);const X=(t,r)=>{const s=r.find(a=>a.Id===t.AlbumId);if(s){const a=s.ProductionYear||(s.PremiereDate?new Date(s.PremiereDate).getFullYear():0);return s.PremiereDate?new Date(s.PremiereDate).getTime():a*1e4}const n=t.ProductionYear||(t.PremiereDate?new Date(t.PremiereDate).getFullYear():0);return t.PremiereDate?new Date(t.PremiereDate).getTime():n*1e4},N=l.useMemo(()=>P==="Alphabetical"?[...f].sort((t,r)=>{const s=t.Name||"",n=r.Name||"";return s.localeCompare(n)}):[...f].sort((t,r)=>{const s=X(t,u),n=X(r,u);if(s!==n)return P==="Newest"?n-s:s-n;const a=t.Album||"",o=r.Album||"";if(a!==o)return a.localeCompare(o);const m=t.IndexNumber||0,c=r.IndexNumber||0;if(m!==c)return m-c;const h=t.Name||"",j=r.Name||"";return h.localeCompare(j)}),[f,P,u]),fe=()=>{ue(t=>t==="Alphabetical"?"Newest":t==="Newest"?"Oldest":"Alphabetical")},he=()=>{N.length>0&&A(N)},xe=()=>{N.length>0&&x(N)};return l.useEffect(()=>{p||Q(W)},[u.length,p]),l.useEffect(()=>{J(0)},[i]),l.useEffect(()=>{H(Z)},[N.length]),K({totalCount:N.length,visibleCount:q,increment:Ye,setVisibleCount:H,threshold:1}),K({totalCount:u.length,visibleCount:$,increment:Te,setVisibleCount:Q,threshold:1,enabled:!p}),ee?e.jsxs("div",{className:"pb-20",children:[e.jsx("div",{className:`fixed top-0 left-0 right-0 bg-black z-10 lg:left-16 transition-[left,right] duration-300 ${y?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top))"},children:e.jsx("div",{className:"max-w-[768px] mx-auto",children:e.jsxs("div",{className:"flex items-center gap-4 p-4",children:[e.jsx("button",{onClick:()=>b(-1),className:"text-white hover:text-zinc-300 transition-colors",children:e.jsx(Y,{className:"w-6 h-6"})}),e.jsx("h1",{className:"text-xl font-bold flex-1 truncate",children:(d==null?void 0:d.Name)||""}),e.jsx("div",{className:"flex items-center",children:e.jsx(Ae,{})})]})})}),e.jsx("div",{className:"pt-20",children:e.jsx("div",{className:"flex items-center justify-center h-screen text-gray-400"})})]}):!d||f.length===0?e.jsxs("div",{className:"pb-20",children:[e.jsx("div",{className:`fixed top-0 left-0 right-0 bg-black z-10 lg:left-16 transition-[left,right] duration-300 ${y?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top))"},children:e.jsx("div",{className:"max-w-[768px] mx-auto",children:e.jsxs("div",{className:"flex items-center gap-4 p-4",children:[e.jsx("button",{onClick:()=>b(-1),className:"text-white hover:text-zinc-300 transition-colors",children:e.jsx(Y,{className:"w-6 h-6"})}),e.jsx("h1",{className:"text-xl font-bold flex-1 truncate",children:"Genre"})]})})}),e.jsx("div",{className:"pt-20",children:e.jsx("div",{className:"flex items-center justify-center h-screen text-gray-400",children:e.jsx("p",{children:"Genre not found or no songs available"})})})]}):e.jsxs("div",{className:"pb-20",children:[e.jsx("div",{className:`fixed top-0 left-0 right-0 bg-black z-10 lg:left-16 transition-[left,right] duration-300 ${y?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top))"},children:e.jsx("div",{className:"max-w-[768px] mx-auto",children:e.jsxs("div",{className:"flex items-center gap-4 p-4",children:[e.jsx("button",{onClick:()=>b(-1),className:"text-white hover:text-zinc-300 transition-colors",children:e.jsx(Y,{className:"w-6 h-6"})}),e.jsx("h1",{className:"text-xl font-bold flex-1 truncate",children:d.Name}),e.jsx("button",{onClick:me,disabled:w,className:"w-8 h-8 flex items-center justify-center text-white hover:bg-zinc-800 rounded-full transition-colors disabled:opacity-50","aria-label":"Shuffle genre songs",children:w?e.jsx("div",{className:"w-4 h-4 border-2 border-zinc-400 border-t-white rounded-full animate-spin"}):e.jsx(Ie,{className:"w-5 h-5"})})]})})}),e.jsx("div",{className:`fixed left-0 right-0 z-[60] lg:left-16 transition-[left,right] duration-300 ${y?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 5rem - 16px)",height:"24px",background:"linear-gradient(to bottom, rgba(0, 0, 0, 0.8), transparent)"}}),e.jsxs("div",{style:{paddingTop:"calc(env(safe-area-inset-top) + 5rem)"},children:[u.length>0&&e.jsxs("div",{className:"mb-10 px-4 pt-4",children:[e.jsxs("h2",{className:"text-xl font-bold text-white mb-4",children:["Albums (",u.length,")"]}),e.jsx("div",{className:"grid grid-cols-3 md:grid-cols-4 gap-4",children:(p?de:u).map((t,r)=>{const s=t.ProductionYear||(t.PremiereDate?new Date(t.PremiereDate).getFullYear():null);return e.jsx(Be,{album:t,year:s,onNavigate:n=>b(`/album/${n}`),onContextMenu:(n,a,o)=>{U(n),R("album"),re(a||"mobile"),ae(o||null),V(!0)},showImage:p?!0:r<$},t.Id)})})]}),p&&u.length>0&&e.jsx("div",{className:"-mt-10 mb-10",children:e.jsx(Ge,{currentPage:L,totalPages:Math.ceil(u.length/D),onPageChange:J,itemsPerPage:D,totalItems:u.length})}),f.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"px-4 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h2",{className:"text-2xl font-bold text-white",children:["Songs (",f.length,")"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:he,className:"w-10 h-10 flex items-center justify-center text-white hover:bg-white/10 rounded-lg transition-colors","aria-label":"Play all songs",children:e.jsx(Pe,{className:"w-5 h-5"})}),e.jsx("button",{type:"button",onClick:xe,className:"w-10 h-10 flex items-center justify-center text-white hover:bg-white/10 rounded-lg transition-colors","aria-label":"Add all songs to queue",children:e.jsx(ye,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"mt-1",children:e.jsxs("button",{type:"button",onClick:fe,className:"text-sm text-gray-400 hover:text-white transition-colors flex items-center gap-1",children:[P,e.jsx(Le,{className:"w-4 h-4"})]})})]}),e.jsx("div",{className:"space-y-0",children:N.map((t,r)=>{const s=r<q;return e.jsx(ke,{song:t,showImage:s},t.Id)})})]})]}),e.jsx(Ce,{item:le,itemType:oe,isOpen:te,onClose:()=>{V(!1),U(null),R(null)},mode:se,position:ne||void 0})]})}export{Re as default};
