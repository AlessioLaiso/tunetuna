import{b as z,r as s,f as oe,j as e,I as ie,L as ce,e as D,C as Q,u as E,a as $,l as F,z as ue,w as de,A as fe}from"./index-CGRvUryl.js";import{u as he,S as me}from"./search-CLKUzEQC.js";import{A as xe}from"./arrow-up-down-Oh2KK2ce.js";import"./tag-qu5Bmic4.js";import"./piano-D_6wLoPK.js";function pe({playlist:l}){const v=z(),[p,u]=s.useState(!1),[j,g]=s.useState("mobile"),[w,y]=s.useState(null),i=s.useRef(!1),o=n=>{if(i.current){n.preventDefault(),i.current=!1;return}v(`/playlist/${l.Id}`)},d=oe({onLongPress:n=>{n.preventDefault(),i.current=!0,g("mobile"),y(null),u(!0)}}),N=n=>{n.preventDefault(),n.stopPropagation(),i.current=!0,g("desktop"),y({x:n.clientX,y:n.clientY}),u(!0),setTimeout(()=>{i.current=!1},300)};return e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:n=>{if(p||i.current){n.preventDefault(),n.stopPropagation();return}o(n)},onContextMenu:N,...d,className:"text-left group",children:[e.jsx("div",{className:"aspect-square rounded overflow-hidden bg-zinc-900 relative flex items-center justify-center",children:e.jsx(ie,{src:D.getAlbumArtUrl(l.Id,474),alt:l.Name,className:"w-full h-full object-cover",showOutline:!0,rounded:"rounded",fallbackIcon:ce})}),e.jsx("div",{className:"text-sm font-medium text-white truncate group-hover:text-[var(--accent-color)] transition-colors",children:l.Name}),e.jsx("div",{className:"text-xs text-gray-400 truncate",children:l.ChildCount?`${l.ChildCount} tracks`:"Playlist"})]}),e.jsx(Q,{item:l,itemType:"playlist",isOpen:p,onClose:()=>u(!1),mode:j,position:w||void 0})]})}const ge=[{type:"playlists"},{type:"artists",limit:5},{type:"albums",limit:12},{type:"songs"}];function Ne(){const[l,v]=s.useState([]),[p,u]=s.useState(!0),j=E(t=>t.sortPreferences),g=E(t=>t.setSortPreference),{playTrack:w,playAlbum:y,addToQueue:i}=$(),o=j.playlists,d=s.useRef(!0),[N,n]=s.useState(!1),k=s.useRef(o),S=z(),[C,f]=s.useState(""),[h,m]=s.useState(!1),[x,c]=s.useState(null),[_,P]=s.useState(!1),r=s.useRef(null),[G,U]=s.useState(!1),[B,H]=s.useState(null),[Y,J]=s.useState(null),[W,ye]=s.useState("mobile"),[X,Se]=s.useState(null),M=$(t=>t.isQueueSidebarOpen),[q,O]=s.useState(!1);s.useEffect(()=>{const t=()=>I();return window.addEventListener("playlistUpdated",t),()=>window.removeEventListener("playlistUpdated",t)},[]),s.useEffect(()=>{h||(!d.current&&k.current!==o&&n(!0),k.current=o,I())},[o,h]),s.useEffect(()=>{d.current&&(d.current=!1)},[]),s.useEffect(()=>{if(r.current&&r.current.abort(),C.trim()){P(!0),r.current=new AbortController;const t=window.setTimeout(async()=>{var b,R,L,T;if(!((b=r.current)!=null&&b.signal.aborted))try{const A=await he(C,450);(R=r.current)!=null&&R.signal.aborted||c(A)}catch(A){(L=r.current)!=null&&L.signal.aborted||(F.error("Search failed:",A),c(null))}finally{(T=r.current)!=null&&T.signal.aborted||P(!1)}},250);return()=>{window.clearTimeout(t),r.current&&r.current.abort()}}else r.current=null,c(null),P(!1)},[C]),s.useEffect(()=>()=>{r.current&&r.current.abort()},[]);const I=async()=>{u(!0);try{const t={limit:100};o==="RecentlyAdded"?(t.sortBy=["DateCreated"],t.sortOrder="Descending"):(t.sortBy=["SortName"],t.sortOrder="Ascending");const b=await D.getPlaylists(t);v(b.Items)}catch(t){F.error("Failed to load playlists:",t)}finally{u(!1),n(!1)}},K=t=>{f(t),t.trim().length>0&&!h&&m(!0)},V=()=>{f(""),c(null)},Z=()=>{m(!1),f(""),c(null)},ee=t=>{S(`/artist/${t}`),m(!1),f(""),c(null)},te=t=>{S(`/album/${t}`),m(!1),f(""),c(null)},se=t=>{w(t,[t])},ne=()=>{a!=null&&a.songs&&a.songs.length>0&&y(a.songs)},re=()=>{a!=null&&a.songs&&a.songs.length>0&&i(a.songs)},le=t=>{S(`/playlist/${t}`),m(!1),f(""),c(null)},ae=t=>{},a=s.useMemo(()=>x?{playlists:x.playlists||[],artists:x.artists||[],albums:x.albums||[],songs:x.songs||[]}:null,[x]);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"pb-20",children:[e.jsx("div",{className:`fixed top-0 left-0 right-0 bg-black z-10 lg:left-16 transition-[left,right] duration-300 ${M?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top))"},children:e.jsx("div",{className:"max-w-[768px] mx-auto",children:e.jsxs("div",{className:"p-4 min-[780px]:px-[0.66rem]",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Playlists"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>m(!0),className:"w-10 h-10 flex items-center justify-center text-white hover:bg-zinc-800 rounded-full transition-colors","aria-label":"Search",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("button",{onClick:()=>O(!0),className:"w-10 h-10 flex items-center justify-center text-white hover:bg-zinc-800 rounded-full transition-colors","aria-label":"Create playlist",children:e.jsx(ue,{className:"w-6 h-6"})})]})]}),!h&&l.length>0&&e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("button",{onClick:()=>g("playlists",o==="RecentlyAdded"?"Alphabetical":"RecentlyAdded"),className:"text-sm text-gray-400 hover:text-white transition-colors flex items-center gap-1",children:[o==="RecentlyAdded"?"Recently Added":"Alphabetically",e.jsx(xe,{className:"w-4 h-4"})]}),p&&!d.current&&e.jsx("div",{className:"flex items-center",children:e.jsx(de,{})})]})]})})}),e.jsx("div",{className:`fixed left-0 right-0 z-10 lg:left-16 transition-[left,right] duration-300 ${M?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 7rem - 8px)",height:"24px",background:"linear-gradient(to bottom, rgba(0, 0, 0, 0.8), transparent)"}}),e.jsx("div",{style:{paddingTop:"calc(env(safe-area-inset-top) + 7rem)"},children:e.jsx("div",{className:`${N?"opacity-50 pointer-events-none":""} ${h?"hidden [@media((hover:hover)_and_(pointer:fine)_and_(min-width:1024px))]:block":""}`,children:l.length===0&&!p?e.jsx("div",{className:"flex items-center justify-center py-16 text-gray-400",children:e.jsx("p",{children:"No playlists found"})}):e.jsx("div",{className:"p-4",children:e.jsx("div",{className:"grid grid-cols-3 md:grid-cols-4 gap-3",children:l.map(t=>e.jsx(pe,{playlist:t},t.Id))})})})})]}),e.jsx(me,{isOpen:h,onClose:Z,searchQuery:C,onSearchChange:K,onClearSearch:V,isLoading:_,results:a,sections:ge,filterConfig:{showGenreFilter:!1,showYearFilter:!1,showGroupingFilters:!1},filterState:{selectedGenres:[],yearRange:{min:null,max:null},selectedGroupings:{}},onOpenFilterSheet:ae,onArtistClick:ee,onAlbumClick:te,onSongClick:se,onPlaylistClick:le,onPlayAllSongs:ne,onAddSongsToQueue:re,isQueueSidebarOpen:M}),e.jsx(Q,{item:B,itemType:Y,isOpen:G,onClose:()=>{U(!1),H(null),J(null)},zIndex:99999,mode:W,position:X||void 0}),e.jsx(fe,{isOpen:q,onClose:()=>O(!1),onCreated:t=>S(`/playlist/${t}`)})]})}export{Ne as default};
