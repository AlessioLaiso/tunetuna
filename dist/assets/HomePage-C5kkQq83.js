import{c as _e,r as l,u as D,a as U,b as ke,d as Ye,j as e,e as Ge,S as Ue,G as pe,f as z,P as be,L as ve,C as se,g as L,U as je,D as H,h as Ae,I as Me}from"./index-CB1tZ40M.js";import{S as ee,u as He,f as We}from"./search-DrExcZA3.js";import{F as ye}from"./FilterBottomSheet-CsTkfI7q.js";import{C as we}from"./calendar-QRx5zCcl.js";/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qe=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Xe=_e("settings",Qe),te=new Map;function Ne({artist:t,onClick:N,onContextMenu:c,contextMenuItemId:f}){var w,A;const[i,o]=l.useState(!1),n=l.useRef(!1),u=f===t.Id,[p,y]=l.useState(null);l.useEffect(()=>{var M;if((M=t.ImageTags)!=null&&M.Primary){y(null);return}const C=te.get(t.Id);if(C!==void 0){y(C);return}let S=!1;return(async()=>{try{const{albums:h,songs:x}=await z.getArtistItems(t.Id),T=h[0],E=x.find(O=>O.AlbumId)||x[0],I=T||E,R=I?I.AlbumId||I.Id:null,b=R?z.getAlbumArtUrl(R,96):null;te.set(t.Id,b),S||y(b)}catch(h){console.error("Failed to load fallback album art for artist (home search):",t.Id,h),te.set(t.Id,null)}})(),()=>{S=!0}},[t.Id,t.ImageTags]);const g=C=>{if(u||n.current){n.current=!1;return}N(t.Id)},d=C=>{C.preventDefault(),C.stopPropagation(),n.current=!0,c(t,"artist","desktop",{x:C.clientX,y:C.clientY}),setTimeout(()=>{n.current=!1},300)},j=L({onLongPress:C=>{C.preventDefault(),n.current=!0,c(t,"artist","mobile")},onClick:()=>{if(n.current){n.current=!1;return}g()}});return e.jsxs("button",{onClick:()=>{if(n.current){n.current=!1;return}g()},onContextMenu:d,...j,className:`w-full flex items-center gap-4 hover:bg-white/10 transition-colors text-left px-4 h-[72px] ${u?"bg-white/10":""}`,children:[e.jsx("div",{className:"w-12 h-12 rounded-full overflow-hidden flex-shrink-0 bg-zinc-900 flex items-center justify-center",children:i?e.jsx(je,{className:"w-6 h-6 text-gray-500"}):(w=t.ImageTags)!=null&&w.Primary||p?e.jsx("img",{src:(A=t.ImageTags)!=null&&A.Primary?z.getArtistImageUrl(t.Id,96):p||"",alt:t.Name,className:"w-full h-full object-cover",onError:()=>o(!0),loading:"lazy"}):e.jsx(je,{className:"w-6 h-6 text-gray-500"})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("div",{className:"text-base font-medium text-white truncate group-hover:text-[var(--accent-color)] transition-colors",children:t.Name})})]})}function Ce({album:t,onClick:N,onContextMenu:c,contextMenuItemId:f}){var d,j;const[i,o]=l.useState(!1),n=l.useRef(!1),u=f===t.Id,p=w=>{if(u||n.current){n.current=!1;return}N(t.Id)},y=w=>{w.preventDefault(),w.stopPropagation(),n.current=!0,c(t,"album","desktop",{x:w.clientX,y:w.clientY}),setTimeout(()=>{n.current=!1},300)},g=L({onLongPress:w=>{w.preventDefault(),n.current=!0,c(t,"album","mobile")},onClick:()=>{if(n.current){n.current=!1;return}p()}});return e.jsxs("button",{onClick:()=>{if(n.current){n.current=!1;return}p()},onContextMenu:y,...g,className:"text-left group",children:[e.jsx("div",{className:"aspect-square rounded overflow-hidden mb-3 bg-zinc-900 shadow-lg relative flex items-center justify-center",children:i?e.jsx(H,{className:"w-12 h-12 text-gray-500"}):e.jsxs(e.Fragment,{children:[e.jsx("img",{src:z.getAlbumArtUrl(t.Id,474),alt:t.Name,className:"w-full h-full object-cover",onError:()=>o(!0)}),e.jsx("div",{className:"absolute inset-0 pointer-events-none border border-white rounded",style:{borderColor:"rgba(255, 255, 255, 0.03)",borderWidth:"1px"}})]})}),e.jsx("div",{className:"text-sm font-semibold text-white truncate mb-1",children:t.Name}),e.jsx("div",{className:"text-xs text-gray-400 truncate",children:t.AlbumArtist||((j=(d=t.ArtistItems)==null?void 0:d[0])==null?void 0:j.Name)||"Unknown Artist"})]})}function Ie({song:t,onClick:N,onContextMenu:c,contextMenuItemId:f,showImage:i=!0}){var A,C;const o=Ae(),n=l.useRef(!1),u=f===t.Id,[p,y]=l.useState(!1),g=S=>{const m=Math.floor(S/1e7),M=Math.floor(m/60),h=m%60;return`${M}:${h.toString().padStart(2,"0")}`},d=S=>{if(u||n.current){n.current=!1;return}N(t)},j=S=>{S.preventDefault(),S.stopPropagation(),n.current=!0,c(t,"song","desktop",{x:S.clientX,y:S.clientY}),setTimeout(()=>{n.current=!1},300)},w=L({onLongPress:S=>{S.preventDefault(),n.current=!0,c(t,"song","mobile")},onClick:()=>{if(n.current){n.current=!1;return}d()}});return e.jsxs("button",{onClick:()=>{if(n.current){n.current=!1;return}d()},onContextMenu:j,...w,className:`w-full flex items-center gap-3 hover:bg-white/10 transition-colors group px-4 py-3 ${u?"bg-white/10":""}`,children:[e.jsx("div",{className:"w-12 h-12 rounded-sm overflow-hidden flex-shrink-0 bg-zinc-900 self-center relative flex items-center justify-center",children:p?e.jsx(H,{className:"w-7 h-7 text-gray-500"}):e.jsxs(e.Fragment,{children:[e.jsx("img",{src:z.getAlbumArtUrl(t.AlbumId||t.Id,96),alt:t.Name,className:"w-full h-full object-cover",loading:"lazy",onError:()=>y(!0)}),e.jsx("div",{className:"absolute inset-0 pointer-events-none border border-white rounded-sm",style:{borderColor:"rgba(255, 255, 255, 0.03)",borderWidth:"1px"}})]})}),e.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[e.jsx("div",{className:`text-sm font-medium truncate transition-colors ${(o==null?void 0:o.Id)===t.Id?"text-[var(--accent-color)]":"text-white group-hover:text-[var(--accent-color)]"}`,children:t.Name}),e.jsxs("div",{className:"text-xs text-gray-400 truncate",children:[t.AlbumArtist||((C=(A=t.ArtistItems)==null?void 0:A[0])==null?void 0:C.Name)||"Unknown Artist",t.Album&&` • ${t.Album}`]})]}),t.RunTimeTicks&&e.jsx("div",{className:"text-xs text-gray-500 flex-shrink-0 text-right",children:g(t.RunTimeTicks)})]})}function Ve({onSearchStateChange:t,title:N="Search"}){const[c,f]=l.useState(""),[i,o]=l.useState(!1),[n,u]=l.useState(null),[p,y]=l.useState(!1),g=l.useRef(null),[d,j]=l.useState(!1),[w,A]=l.useState("mobile"),[C,S]=l.useState(null),[m,M]=l.useState(null),[h,x]=l.useState(null),T=l.useRef(null),E=l.useRef(null),[I,R]=l.useState([]),[b,O]=l.useState({min:null,max:null}),[ne,W]=l.useState(!1),[le,Pe]=l.useState(null),{genres:Te}=D(),[Ee,re]=l.useState([]),[Ke,ae]=l.useState(!1),[ie,oe]=l.useState(45),{playAlbum:ze,addToQueue:Re,playTrack:$e,shuffleAllSongs:Oe,isQueueSidebarOpen:Q}=U(),[F,X]=l.useState(!1);l.useEffect(()=>{if(F){const s=setTimeout(()=>{X(!1)},1e4);return()=>clearTimeout(s)}},[F]);const _=ke(),[V,Fe]=Ye();l.useEffect(()=>{const s=V.get("yearMin"),r=V.get("yearMax"),k=V.get("genre");let v=!1;(s||r)&&(O({min:s?parseInt(s,10):null,max:r?parseInt(r,10):null}),v=!0),k&&(R([k]),v=!0),v&&(o(!0),Fe({},{replace:!0}))},[]),l.useEffect(()=>{(async()=>{ae(!0);try{const r=D.getState();if(r.years.length>0)re(r.years);else{const k=await z.getYears();re(k)}}catch(r){console.error("Failed to load filter values:",r)}finally{ae(!1)}})()},[]);const ce=I.length>0||b.min!==null||b.max!==null;l.useEffect(()=>{g.current&&g.current.abort();const s=c.trim().length>0;if(s||ce){y(!0);const r=new AbortController;return g.current=r,(async()=>{if(!r.signal.aborted)try{let v;s?v=await He(c,450):v=await We(450),r.signal.aborted||u(v)}catch(v){r.signal.aborted||(console.error("Search failed:",v),u(null))}finally{r.signal.aborted||y(!1)}})(),()=>{r.abort()}}else g.current=null,u(null),y(!1)},[c,ce]),l.useEffect(()=>{oe(45)},[c,i,n==null?void 0:n.songs.length]),l.useEffect(()=>{var r;if(!i||!((r=n==null?void 0:n.songs)!=null&&r.length))return;const s=()=>{const k=window.scrollY||document.documentElement.scrollTop,v=window.innerHeight||document.documentElement.clientHeight,P=document.documentElement.scrollHeight;k+v*1.5>=P&&oe(q=>Math.min(q+45,n.songs.length))};return window.addEventListener("scroll",s,{passive:!0}),()=>window.removeEventListener("scroll",s)},[i,n==null?void 0:n.songs.length]);const a=l.useMemo(()=>{if(!n)return null;const s=v=>{if(b.min!==null||b.max!==null)return!1;if(I.length>0){const P=v.Genres||[];if(!I.some(K=>P.some(Z=>Z.toLowerCase()===K.toLowerCase())))return!1}return!0},r=v=>{if(I.length>0){const P=v.Genres||[];if(!I.some(K=>P.some(Z=>Z.toLowerCase()===K.toLowerCase())))return!1}if(b.min!==null||b.max!==null){const P=v.ProductionYear;if(!P||P<=0||b.min!==null&&P<b.min||b.max!==null&&P>b.max)return!1}return!0},k=v=>!(b.min!==null||b.max!==null||I.length>0);return{artists:n.artists.filter(s),albums:n.albums.filter(r),playlists:(n.playlists||[]).filter(k),songs:n.songs.filter(r)}},[n,I,b]),B=s=>{f(s),s.trim().length>0&&!i&&o(!0)},de=s=>{_(`/artist/${s}`),o(!1),f(""),u(null)},ue=s=>{_(`/album/${s}`),o(!1),f(""),u(null)},me=s=>{$e(s,[s])},he=s=>{_(`/playlist/${s}`),o(!1),f(""),u(null)},$=(s,r,k="mobile",v)=>{M(s),x(r),A(k),S(v||null),j(!0)},J=()=>{f(""),u(null)},Y=()=>{o(!1),f(""),u(null),R([]),O({min:null,max:null})},G=s=>{Pe(s),W(!0)},De=s=>{R(s)},Le=s=>{O(s)},xe=s=>{s.preventDefault(),s.stopPropagation(),a!=null&&a.songs&&a.songs.length>0&&ze(a.songs)},fe=s=>{s.preventDefault(),s.stopPropagation(),a!=null&&a.songs&&a.songs.length>0&&Re(a.songs)},ge=i;return l.useEffect(()=>{t&&t(ge)},[ge,t]),l.useEffect(()=>{if(i){const r=window.matchMedia("(hover: hover) and (pointer: fine) and (min-width: 1024px)").matches?E:T;setTimeout(()=>{var k;if((k=r.current)==null||k.focus(),r.current){const v=r.current.value.length;r.current.setSelectionRange(v,v)}},50)}},[i]),l.useEffect(()=>{if(!i)return;const s=r=>{r.key==="Escape"&&(r.preventDefault(),r.stopPropagation(),Y())};return window.addEventListener("keydown",s,!0),()=>window.removeEventListener("keydown",s,!0)},[i]),l.useEffect(()=>()=>{g.current&&g.current.abort()},[]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"px-4 pt-4 pb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"text-lg font-semibold text-white",children:"Tunetuna"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:async()=>{const s=U.getState(),{isShuffleAllActive:r,isShuffleGenreActive:k,shuffle:v}=s;if(!(F||r||k)){X(!0);try{await Oe()}catch(P){console.error("Home shuffle button - shuffleAllSongs failed:",P),console.error("Shuffle all failed:",P)}finally{X(!1)}}},disabled:F,className:"w-8 h-8 flex items-center justify-center text-white hover:bg-zinc-800 rounded-full transition-colors disabled:opacity-50","aria-label":"Shuffle all songs",children:F?e.jsx("div",{className:"w-4 h-4 border-2 border-zinc-400 border-t-white rounded-full animate-spin"}):e.jsx(Ue,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>_("/settings"),className:"w-8 h-8 flex items-center justify-center text-white hover:bg-zinc-800 rounded-full transition-colors","aria-label":"Settings",children:e.jsx(Xe,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"relative",onClick:()=>o(!0),children:e.jsx(ee,{value:c,onChange:B,placeholder:"Search for artists, albums, songs...",showClearButton:c.trim().length>0,onClear:J})})]}),i&&Ge.createPortal(e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden [@media((hover:hover)_and_(pointer:fine)_and_(min-width:1024px))]:block fixed inset-0 z-[9998] bg-black/50",onClick:Y}),e.jsx("div",{className:`hidden [@media((hover:hover)_and_(pointer:fine)_and_(min-width:1024px))]:flex fixed top-0 left-16 z-[9999] justify-center pointer-events-none ${Q?"":"right-0"}`,style:Q?{right:"var(--sidebar-width)"}:void 0,children:e.jsxs("div",{className:"w-[768px] max-h-[80vh] overflow-y-auto bg-zinc-900 rounded-b-xl shadow-2xl pointer-events-auto border-l border-r border-b border-zinc-800",children:[e.jsxs("div",{className:"px-4 pt-4 pb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"text-lg font-semibold text-white",children:N}),e.jsx("button",{onClick:Y,className:"px-3 py-1.5 text-white text-sm font-medium hover:bg-zinc-800 rounded-lg transition-colors",children:"Cancel"})]}),e.jsx(ee,{ref:E,value:c,onChange:B,placeholder:"Search for artists, albums, songs...",showClearButton:c.trim().length>0,onClear:J})]}),e.jsxs("div",{className:"flex items-center gap-3 px-4 pt-3 pb-4",children:[e.jsxs("button",{onClick:()=>G("genre"),className:`flex items-center gap-2 px-3 py-2 rounded-lg transition-colors ${I.length>0?"bg-[var(--accent-color)] text-white":"bg-white/10 text-white hover:bg-white/20"}`,"aria-label":"Filter by genre",children:[e.jsx(pe,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Genre"})]}),e.jsxs("button",{onClick:()=>G("year"),className:`flex items-center gap-2 px-3 py-2 rounded-lg transition-colors ${b.min!==null||b.max!==null?"bg-[var(--accent-color)] text-white":"bg-white/10 text-white hover:bg-white/20"}`,"aria-label":"Filter by year",children:[e.jsx(we,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Year"})]})]}),e.jsx("div",{className:"px-4 pb-8",children:p?e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-zinc-800 border-t-[var(--accent-color)]"})}):a?e.jsxs("div",{className:"space-y-8",children:[a.artists.length>0&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Artists"}),e.jsx("div",{className:"space-y-0 -mx-4",children:a.artists.slice(0,5).map(s=>e.jsx(Ne,{artist:s,onClick:de,onContextMenu:$,contextMenuItemId:(m==null?void 0:m.Id)||null},s.Id))})]}),a.albums.length>0&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Albums"}),e.jsx("div",{className:"grid grid-cols-3 md:grid-cols-4 gap-4",children:a.albums.slice(0,12).map(s=>e.jsx(Ce,{album:s,onClick:ue,onContextMenu:$,contextMenuItemId:(m==null?void 0:m.Id)||null},s.Id))})]}),a.playlists&&a.playlists.length>0&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Playlists"}),e.jsx("div",{className:"space-y-0 -mx-4",children:a.playlists.map(s=>e.jsxs("button",{onClick:()=>he(s.Id),onContextMenu:r=>{r.preventDefault(),r.stopPropagation(),$(s,"playlist","desktop",{x:r.clientX,y:r.clientY})},className:"w-full flex items-center gap-3 hover:bg-white/10 transition-colors group px-4 py-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-sm overflow-hidden flex-shrink-0 bg-zinc-900 self-center",children:e.jsx("img",{src:z.getAlbumArtUrl(s.Id,96),alt:s.Name,className:"w-full h-full object-cover",loading:"lazy"})}),e.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[e.jsx("div",{className:"text-sm font-medium text-white truncate group-hover:text-[var(--accent-color)] transition-colors",children:s.Name}),e.jsx("div",{className:"text-xs text-gray-400 truncate",children:s.ChildCount?`${s.ChildCount} tracks`:"Playlist"})]})]},s.Id))})]}),a.songs.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"Songs"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:xe,className:"w-10 h-10 flex items-center justify-center text-white hover:bg-white/10 rounded-lg transition-colors","aria-label":"Play all songs",children:e.jsx(be,{className:"w-5 h-5"})}),e.jsx("button",{type:"button",onClick:fe,className:"w-10 h-10 flex items-center justify-center text-white hover:bg-white/10 rounded-lg transition-colors","aria-label":"Add all songs to queue",children:e.jsx(ve,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"space-y-0 -mx-4",children:a.songs.map((s,r)=>e.jsx(Ie,{song:s,onClick:me,onContextMenu:$,contextMenuItemId:(m==null?void 0:m.Id)||null,showImage:r<ie},s.Id))})]}),a.artists.length===0&&a.albums.length===0&&(!a.playlists||a.playlists.length===0)&&a.songs.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 text-gray-400",children:[e.jsx("div",{className:"text-lg mb-2",children:"No results found"}),e.jsx("div",{className:"text-sm",children:"Try a different search term"})]})]}):e.jsx("div",{className:"flex flex-col items-center justify-center py-16 text-gray-400"})})]})}),e.jsxs("div",{className:"fixed inset-0 bg-black z-[9999] overflow-y-scroll p-0 m-0 [@media((hover:hover)_and_(pointer:fine)_and_(min-width:1024px))]:hidden",children:[e.jsx("div",{className:"fixed top-0 left-0 right-0 bg-black z-50 pointer-events-none",style:{height:"env(safe-area-inset-top)",top:"var(--header-offset, 0px)"}}),e.jsx("div",{className:"fixed top-0 left-0 right-0 bg-black z-10 pt-0 pb-0 w-full m-0",style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top))",height:"76px"},children:e.jsx("div",{className:"max-w-[768px] mx-auto w-full",children:e.jsxs("div",{className:"flex items-center gap-3 pl-2 pr-4 pt-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(ee,{ref:T,value:c,onChange:B,showClearButton:c.trim().length>0,onClear:J})}),e.jsx("button",{onClick:Y,className:"px-4 py-2 text-white text-sm font-medium hover:text-zinc-300 transition-colors whitespace-nowrap flex-shrink-0",children:"Cancel"})]})})}),e.jsxs("div",{className:"max-w-[768px] mx-auto w-full",style:{paddingTop:"calc(76px + env(safe-area-inset-top))"},children:[e.jsx("div",{className:"sticky bg-black z-10 pt-3 pb-4",style:{top:"calc(76px + env(safe-area-inset-top))"},children:e.jsxs("div",{className:"flex items-center gap-3 pl-2 pr-4",children:[e.jsxs("button",{onClick:()=>G("genre"),className:`flex items-center gap-2 px-3 py-2 rounded-lg transition-colors ${I.length>0?"bg-[var(--accent-color)] text-white":"bg-white/10 text-white hover:bg-white/20"}`,"aria-label":"Filter by genre",children:[e.jsx(pe,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Genre"})]}),e.jsxs("button",{onClick:()=>G("year"),className:`flex items-center gap-2 px-3 py-2 rounded-lg transition-colors ${b.min!==null||b.max!==null?"bg-[var(--accent-color)] text-white":"bg-white/10 text-white hover:bg-white/20"}`,"aria-label":"Filter by year",children:[e.jsx(we,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Year"})]})]})}),e.jsx("div",{className:`fixed left-0 right-0 z-[60] lg:left-16 transition-[left,right] duration-300 ${Q?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 76px + 4rem)",height:"24px",background:"linear-gradient(to bottom, rgba(0, 0, 0, 0.8), transparent)"}}),e.jsx("div",{className:"pb-32",style:{paddingTop:"40px"},children:p?e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-zinc-800 border-t-[var(--accent-color)]"})}):a?e.jsxs("div",{className:"space-y-8",children:[a.artists.length>0&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-4 pl-2 pr-4",children:"Artists"}),e.jsx("div",{className:"space-y-0",children:a.artists.slice(0,5).map(s=>e.jsx(Ne,{artist:s,onClick:de,onContextMenu:$,contextMenuItemId:(m==null?void 0:m.Id)||null},s.Id))})]}),a.albums.length>0&&e.jsxs("div",{className:"pl-2 pr-4",children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Albums"}),e.jsx("div",{className:"grid grid-cols-3 md:grid-cols-4 gap-4",children:a.albums.slice(0,12).map(s=>e.jsx(Ce,{album:s,onClick:ue,onContextMenu:$,contextMenuItemId:(m==null?void 0:m.Id)||null},s.Id))})]}),a.playlists&&a.playlists.length>0&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-4 pl-2 pr-4",children:"Playlists"}),e.jsx("div",{className:"space-y-0",children:a.playlists.map(s=>e.jsxs("button",{onClick:()=>he(s.Id),onContextMenu:r=>{r.preventDefault(),r.stopPropagation(),$(s,"playlist","desktop",{x:r.clientX,y:r.clientY})},className:"w-full flex items-center gap-3 hover:bg-white/10 transition-colors group px-4 py-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-sm overflow-hidden flex-shrink-0 bg-zinc-900 self-center",children:e.jsx("img",{src:z.getAlbumArtUrl(s.Id,96),alt:s.Name,className:"w-full h-full object-cover",loading:"lazy"})}),e.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[e.jsx("div",{className:"text-sm font-medium text-white truncate group-hover:text-[var(--accent-color)] transition-colors",children:s.Name}),e.jsx("div",{className:"text-xs text-gray-400 truncate",children:s.ChildCount?`${s.ChildCount} tracks`:"Playlist"})]})]},s.Id))})]}),a.songs.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 pl-2 pr-4",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"Songs"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:xe,className:"w-10 h-10 flex items-center justify-center text-white hover:bg-white/10 rounded-lg transition-colors","aria-label":"Play all songs",children:e.jsx(be,{className:"w-5 h-5"})}),e.jsx("button",{type:"button",onClick:fe,className:"w-10 h-10 flex items-center justify-center text-white hover:bg-white/10 rounded-lg transition-colors","aria-label":"Add all songs to queue",children:e.jsx(ve,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"space-y-0",children:a.songs.map((s,r)=>e.jsx(Ie,{song:s,onClick:me,onContextMenu:$,contextMenuItemId:(m==null?void 0:m.Id)||null,showImage:r<ie},s.Id))})]}),a.artists.length===0&&a.albums.length===0&&(!a.playlists||a.playlists.length===0)&&a.songs.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 text-gray-400 px-4",children:[e.jsx("div",{className:"text-lg mb-2",children:"No results found"}),e.jsx("div",{className:"text-sm",children:"Try a different search term"})]})]}):e.jsx("div",{className:"flex flex-col items-center justify-center py-16 text-gray-400 px-4"})})]})]}),e.jsx(se,{item:m,itemType:h,isOpen:d,onClose:()=>{j(!1),M(null),x(null)},zIndex:999999,mode:w,position:C||void 0})]}),document.body),le==="genre"&&e.jsx(ye,{isOpen:ne,onClose:()=>W(!1),filterType:"genre",genres:Te,selectedValues:I,onApply:De}),le==="year"&&e.jsx(ye,{isOpen:ne,onClose:()=>W(!1),filterType:"year",availableYears:Ee,yearRange:b,onApplyYear:Le})]})}function Se({album:t,onNavigate:N,onContextMenu:c}){var y,g;const[f,i]=l.useState(!1),o=l.useRef(!1),n=d=>{if(o.current){o.current=!1;return}N(t.Id)},u=d=>{d.preventDefault(),d.stopPropagation(),o.current=!0,c(t,"desktop",{x:d.clientX,y:d.clientY}),setTimeout(()=>{o.current=!1},300)},p=L({onLongPress:d=>{d.preventDefault(),o.current=!0,c(t,"mobile")},onClick:()=>{if(o.current){o.current=!1;return}n()}});return e.jsxs("button",{onClick:()=>{if(o.current){o.current=!1;return}n()},onContextMenu:u,...p,className:"text-left group",children:[e.jsx("div",{className:"aspect-square rounded overflow-hidden mb-2 bg-zinc-900 flex items-center justify-center",children:f?e.jsx(H,{className:"w-12 h-12 text-gray-500"}):e.jsx(Me,{src:z.getAlbumArtUrl(t.Id,474),alt:t.Name,className:"w-full h-full object-cover",showOutline:!0,rounded:"rounded",onError:()=>i(!0)})}),e.jsx("div",{className:"text-sm font-medium text-white truncate",children:t.Name}),e.jsx("div",{className:"text-xs text-gray-400 truncate",children:t.AlbumArtist||((g=(y=t.ArtistItems)==null?void 0:y[0])==null?void 0:g.Name)||"Unknown Artist"})]})}function Be(){const{recentlyAdded:t,setRecentlyAdded:N,setLoading:c}=D(),f=ke(),i=l.useRef(null),[o,n]=l.useState(0),[u,p]=l.useState(!1),[y,g]=l.useState("mobile"),[d,j]=l.useState(null),[w,A]=l.useState(null);l.useEffect(()=>{(async()=>{c("recentlyAdded",!0);try{const x=await z.getRecentlyAdded(18);N(x.Items||[])}catch(x){console.error("Failed to load recently added:",x)}finally{c("recentlyAdded",!1)}})()},[N,c]);const C=()=>{if(!i.current)return;const h=i.current,x=h.scrollLeft,T=h.clientWidth,E=Math.round(x/T);n(E)},S=h=>{if(!i.current)return;const x=i.current,T=x.clientWidth;x.scrollTo({left:h*T,behavior:"smooth"})};if(!t||t.length===0)return null;const m=6,M=[];for(let h=0;h<t.length;h+=m)M.push(t.slice(h,h+m));return e.jsxs("div",{className:"px-4 mb-8",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Recently Added"}),e.jsxs("div",{className:"md:hidden",children:[e.jsx("div",{ref:i,onScroll:C,className:"overflow-x-auto snap-x snap-mandatory scrollbar-hide",style:{scrollbarWidth:"none",msOverflowStyle:"none"},children:e.jsx("div",{className:"flex",style:{width:`${M.length*100}%`},children:M.map((h,x)=>{const T=Math.ceil(h.length/3);return e.jsx("div",{className:"snap-start flex-shrink-0 w-full",style:{width:`${100/M.length}%`},children:e.jsx("div",{className:"grid grid-cols-3 gap-3",style:{gridTemplateRows:`repeat(${T}, minmax(0, 1fr))`},children:h.map(E=>e.jsx(Se,{album:E,onNavigate:I=>f(`/album/${I}`),onContextMenu:(I,R,b)=>{A(I),g(R||"desktop"),j(b||null),p(!0)}},E.Id))})},x)})})}),M.length>1&&e.jsx("div",{className:"flex justify-center gap-2 mt-4",children:M.map((h,x)=>e.jsx("button",{onClick:()=>S(x),className:`w-2 h-2 rounded-full transition-colors ${x===o?"bg-white":"bg-zinc-600"}`,"aria-label":`Go to page ${x+1}`},x))})]}),e.jsx("div",{className:"hidden md:block",children:e.jsx("div",{className:"grid grid-cols-4 gap-3",children:t.slice(0,8).map(h=>e.jsx(Se,{album:h,onNavigate:x=>f(`/album/${x}`),onContextMenu:(x,T,E)=>{A(x),g(T||"desktop"),j(E||null),p(!0)}},h.Id))})}),e.jsx("style",{children:`
        .scrollbar-hide::-webkit-scrollbar {
          display: none;
        }
      `}),e.jsx(se,{item:w,itemType:"album",isOpen:u,onClose:()=>{p(!1),A(null)},zIndex:999999,mode:y,position:d||void 0})]})}function Je({song:t,onClick:N,onContextMenu:c,contextMenuItemId:f}){var g,d;const i=Ae(),[o,n]=l.useState(!1),u=f===t.Id,p=j=>{const w=Math.floor(j/1e7),A=Math.floor(w/60),C=w%60;return`${A}:${C.toString().padStart(2,"0")}`},y=L({onLongPress:j=>{j.preventDefault(),c(t,"mobile")},onClick:()=>N(t)});return e.jsxs("button",{onClick:()=>N(t),onContextMenu:j=>{j.preventDefault(),c(t,"desktop",{x:j.clientX,y:j.clientY})},...y,className:`w-full flex items-center gap-3 hover:bg-white/10 transition-colors group px-4 py-3 ${u?"bg-white/10":""}`,children:[e.jsx("div",{className:"w-12 h-12 rounded-sm overflow-hidden flex-shrink-0 bg-zinc-900 self-center flex items-center justify-center",children:o?e.jsx(H,{className:"w-7 h-7 text-gray-500"}):e.jsx(Me,{src:z.getAlbumArtUrl(t.AlbumId||t.Id,96),alt:t.Name,className:"w-full h-full object-cover",showOutline:!0,rounded:"rounded-sm",onError:()=>n(!0)})}),e.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[e.jsx("div",{className:`text-sm font-medium truncate transition-colors ${(i==null?void 0:i.Id)===t.Id?"text-[var(--accent-color)]":"text-white group-hover:text-[var(--accent-color)]"}`,children:t.Name}),e.jsxs("div",{className:"text-xs text-gray-400 truncate",children:[t.AlbumArtist||((d=(g=t.ArtistItems)==null?void 0:g[0])==null?void 0:d.Name)||"Unknown Artist",t.Album&&` • ${t.Album}`]})]}),t.RunTimeTicks&&e.jsx("div",{className:"text-xs text-gray-500 flex-shrink-0 text-right",children:p(t.RunTimeTicks)})]})}function qe(){const{recentlyPlayed:t}=D(),{playTrack:N}=U(),[c,f]=l.useState(!1),[i,o]=l.useState("mobile"),[n,u]=l.useState(null),[p,y]=l.useState(null),g=d=>{N(d,t)};return!t||t.length===0?null:e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-xl font-bold mb-2 px-4",children:"Recently Played"}),e.jsx("div",{className:"space-y-0",children:t.map(d=>e.jsx(Je,{song:d,onClick:g,onContextMenu:(j,w,A)=>{y(j),o(w||"mobile"),u(A||null),f(!0)},contextMenuItemId:(p==null?void 0:p.Id)||null},d.Id))}),e.jsx(se,{item:p,itemType:"song",isOpen:c,onClose:()=>{f(!1),y(null)},zIndex:99999,mode:i,position:n||void 0})]})}function nt(){const[t,N]=l.useState(!1),{recentlyAdded:c,recentlyPlayed:f,loading:i}=D(),o=l.useRef(!1),{isQueueSidebarOpen:n}=U();l.useEffect(()=>{(i.recentlyAdded||i.recentlyPlayed)&&(o.current=!0)},[i.recentlyAdded,i.recentlyPlayed]);const u=o.current&&!i.recentlyAdded&&!i.recentlyPlayed&&c.length===0&&f.length===0;return e.jsxs("div",{className:"pb-20",children:[e.jsx("div",{className:`fixed top-0 left-0 right-0 bg-black z-10 lg:left-16 transition-[left,right] duration-300 ${n?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top))"},children:e.jsx("div",{className:"max-w-[768px] mx-auto",children:e.jsx(Ve,{onSearchStateChange:N})})}),e.jsx("div",{className:`fixed left-0 right-0 z-[60] lg:left-16 transition-[left,right] duration-300 ${n?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 7.5rem - 2px)",height:"24px",background:"linear-gradient(to bottom, rgba(0, 0, 0, 0.8), transparent)"}}),e.jsx("div",{className:t?"hidden [@media((hover:hover)_and_(pointer:fine)_and_(min-width:1024px))]:block":"",style:{paddingTop:"calc(env(safe-area-inset-top) + 7.5rem + 24px)"},children:e.jsxs("div",{className:"max-w-[768px] mx-auto",children:[e.jsx(Be,{}),e.jsx(qe,{}),u&&e.jsx("div",{className:"flex items-center justify-center py-16 text-gray-400",children:e.jsx("p",{children:"No music found"})})]})})]})}export{nt as default};
