import{u as m,a as j,r as t,b as Oe,l as O,e as X,j as s,i as Le,C as ke}from"./index-BWSTvX5b.js";import{S as Re}from"./SongItem-CYdogBKE.js";import{P as Fe}from"./Pagination-DfY4RETS.js";import{F as Z}from"./FilterBottomSheet-CBQHUdAy.js";import{u as Ge,f as _e,a as Qe}from"./search-DdCGGPtZ.js";import{A as Ye}from"./arrow-up-down-CXy_BSoS.js";const Ve=[{type:"songs"},{type:"artists",limit:5},{type:"albums",limit:12},{type:"playlists"}],w=90,ee=45,Be=45,$e=45;function Ke(){const C=m(e=>e.songs),L=m(e=>e.setSongs),te=m(e=>e.sortPreferences),se=m(e=>e.setSortPreference),k=m(e=>e.setLoading),R=m(e=>e.loading),ne=m(e=>e.genres),re=j(e=>e.playTrack),le=j(e=>e.playAlbum),ae=j(e=>e.addToQueue),N=j(e=>e.isQueueSidebarOpen),[d,p]=t.useState(""),[b,S]=t.useState(!1),[x,g]=t.useState(null),[oe,F]=t.useState(!1),[ie,ce]=t.useState("mobile"),[ue,fe]=t.useState(null),[v,G]=t.useState(null),[de,_]=t.useState(null),[ge,M]=t.useState(!1),a=t.useRef(null),[I,Q]=t.useState(0),[Y,V]=t.useState(0),T=Oe(),[u,B]=t.useState([]),[r,$]=t.useState({min:null,max:null}),[H,E]=t.useState(!1),[z,he]=t.useState(null),[me,D]=t.useState([]),h=te.songs,A=t.useRef(!0),[pe,U]=t.useState(!1),W=t.useRef(h),[q,J]=t.useState(ee),[Se,He]=t.useState($e);t.useEffect(()=>{(async()=>{try{const n=m.getState();if(n.years.length>0)D(n.years);else{const c=await X.getYears();D(c)}}catch(n){O.error("Failed to load filter values:",n)}})()},[]);const K=u.length>0||r.min!==null||r.max!==null;t.useEffect(()=>{a.current&&a.current.abort();const e=d.trim().length>0;if(e||K){M(!0),a.current=new AbortController;const n=window.setTimeout(async()=>{var c,o,l,y;if(!((c=a.current)!=null&&c.signal.aborted))try{let f;e?f=await Ge(d,450):f=await _e(450),(o=a.current)!=null&&o.signal.aborted||g(f)}catch(f){(l=a.current)!=null&&l.signal.aborted||(O.error("Search failed:",f),g(null))}finally{(y=a.current)!=null&&y.signal.aborted||M(!1)}},250);return()=>{window.clearTimeout(n),a.current&&a.current.abort()}}else a.current=null,g(null),M(!1)},[d,K]);const i=t.useMemo(()=>{if(!x)return null;const e=o=>{if(r.min!==null||r.max!==null)return!1;if(u.length>0){const l=o.Genres||[];if(!u.some(f=>l.some(P=>P.toLowerCase()===f.toLowerCase())))return!1}return!0},n=o=>{if(u.length>0){const l=o.Genres||[];if(!u.some(f=>l.some(P=>P.toLowerCase()===f.toLowerCase())))return!1}if(r.min!==null||r.max!==null){const l=o.ProductionYear;if(!l||l<=0||r.min!==null&&l<r.min||r.max!==null&&l>r.max)return!1}return!0},c=o=>!(r.min!==null||r.max!==null||u.length>0);return{songs:x.songs.filter(n),artists:x.artists.filter(e),albums:x.albums.filter(n),playlists:(x.playlists||[]).filter(c)}},[x,u,r]);t.useEffect(()=>()=>{a.current&&a.current.abort()},[]);const xe=e=>{p(e),e.trim().length>0&&!b&&S(!0)},ye=()=>{p(""),g(null)},Ce=()=>{S(!1),p(""),g(null),B([]),$({min:null,max:null})},be=e=>{he(e),E(!0)},ve=e=>{B(e)},Ie=e=>{$(e)},Ae=e=>{T(`/artist/${e}`),S(!1),p(""),g(null)},je=e=>{T(`/album/${e}`),S(!1),p(""),g(null)},we=e=>{re(e,[e])},Ne=()=>{i!=null&&i.songs&&i.songs.length>0&&le(i.songs)},Me=()=>{i!=null&&i.songs&&i.songs.length>0&&ae(i.songs)},Te=e=>{T(`/playlist/${e}`),S(!1),p(""),g(null)},Ee=(e,n,c="mobile",o)=>{G(e),_(n),ce(c),fe(o||null),F(!0)};t.useEffect(()=>{d.trim()||Q(0)},[h,d]),t.useEffect(()=>{J(ee)},[I,C.length]),t.useEffect(()=>{const e=document.querySelector(".main-scrollable");if(!e)return;const n=()=>{const c=e.scrollTop,o=e.clientHeight,l=e.scrollHeight;c+o*1.5>=l&&J(y=>Math.min(y+Be,C.length))};return e.addEventListener("scroll",n,{passive:!0}),()=>e.removeEventListener("scroll",n)},[C.length,q]),t.useEffect(()=>{d.trim()||(!A.current&&W.current!==h&&U(!0),W.current=h,Pe())},[I,h,d]),t.useEffect(()=>{A.current&&(A.current=!1)},[]);const Pe=async()=>{k("songs",!0);try{const e={limit:w,startIndex:I*w};h==="RecentlyAdded"?(e.sortBy=["DateCreated"],e.sortOrder="Descending"):(e.sortBy=["SortName"],e.sortOrder="Ascending");const n=await X.getSongs(e);L(n.Items),V(n.TotalRecordCount||0)}catch(e){O.error("Failed to load songs:",e),L([]),V(0)}finally{k("songs",!1),U(!1)}};return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"pb-20",children:[s.jsx("div",{className:`fixed top-0 left-0 right-0 bg-black z-10 lg:left-16 transition-[left,right] duration-300 ${N?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top))"},children:s.jsx("div",{className:"max-w-[768px] mx-auto",children:s.jsxs("div",{className:"p-4",children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsx("h1",{className:"text-2xl font-bold text-white",children:"Songs"}),s.jsx("button",{onClick:()=>S(!0),className:"w-10 h-10 flex items-center justify-center text-white hover:bg-zinc-800 rounded-full transition-colors","aria-label":"Search",children:s.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})]}),!b&&s.jsxs("div",{className:"flex items-center justify-between gap-2",children:[s.jsxs("button",{onClick:()=>se("songs",h==="RecentlyAdded"?"Alphabetical":"RecentlyAdded"),className:"text-sm text-gray-400 hover:text-white transition-colors flex items-center gap-1",children:[h==="RecentlyAdded"?"Recently Added":"Alphabetically",s.jsx(Ye,{className:"w-4 h-4"})]}),R.songs&&!A.current&&s.jsx("div",{className:"flex items-center",children:s.jsx(Le,{})})]})]})})}),s.jsx("div",{className:`fixed left-0 right-0 z-10 lg:left-16 transition-[left,right] duration-300 ${N?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 7rem - 8px)",height:"24px",background:"linear-gradient(to bottom, rgba(0, 0, 0, 0.8), transparent)"}}),s.jsx("div",{style:{paddingTop:"calc(env(safe-area-inset-top) + 7rem)"},children:s.jsx("div",{className:`${pe?"opacity-50 pointer-events-none":""} ${b?"hidden [@media((hover:hover)_and_(pointer:fine)_and_(min-width:1024px))]:block":""}`,children:C.length===0&&!R.songs?s.jsx("div",{className:"flex items-center justify-center py-16 text-gray-400",children:s.jsx("p",{children:"No songs found"})}):s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"space-y-0",children:C.map((e,n)=>s.jsx(Re,{song:e,showImage:n<q,onContextMenu:Ee,contextMenuItemId:(v==null?void 0:v.Id)||null},e.Id))}),s.jsx(Fe,{currentPage:I,totalPages:Math.ceil(Y/w),onPageChange:Q,itemsPerPage:w,totalItems:Y})]})})})]}),s.jsx(Qe,{isOpen:b,onClose:Ce,searchQuery:d,onSearchChange:xe,onClearSearch:ye,isLoading:ge,results:i,sections:Ve,filterConfig:{showGenreFilter:!0,showYearFilter:!0},filterState:{selectedGenres:u,yearRange:r},onOpenFilterSheet:be,onArtistClick:Ae,onAlbumClick:je,onSongClick:we,onPlaylistClick:Te,onPlayAllSongs:Ne,onAddSongsToQueue:Me,visibleSongImageCount:Se,isQueueSidebarOpen:N}),z==="genre"&&s.jsx(Z,{isOpen:H,onClose:()=>E(!1),filterType:"genre",genres:ne,selectedValues:u,onApply:ve}),z==="year"&&s.jsx(Z,{isOpen:H,onClose:()=>E(!1),filterType:"year",availableYears:me,yearRange:r,onApplyYear:Ie}),s.jsx(ke,{item:v,itemType:de,isOpen:oe,onClose:()=>{F(!1),G(null),_(null)},zIndex:99999,mode:ie,position:ue||void 0})]})}export{Ke as default};
