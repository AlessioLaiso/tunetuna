import{c as ve,r as t,u as O,a as $,b as ee,d as be,j as e,S as we,l as R,e as G,C as te,f as ne,D as se,I as le,g as je,h as Ae}from"./index-D0jLw_Yc.js";import{S as Ce,a as Ne,u as Me,f as ke}from"./search-D4gl9jvZ.js";import{F as q}from"./FilterBottomSheet-wN87FD5U.js";/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Pe=ve("settings",Ie),Ee=[{type:"artists",limit:5},{type:"albums",limit:12},{type:"playlists"},{type:"songs"}];function Te({onSearchStateChange:n,title:v="Search"}){const[c,h]=t.useState(""),[r,o]=t.useState(!1),[a,m]=t.useState(null),[p,y]=t.useState(!1),x=t.useRef(null),i=t.useRef(null),k=t.useRef(null),[b,C]=t.useState([]),[g,P]=t.useState({min:null,max:null}),[E,A]=t.useState(!1),[f,u]=t.useState(null),{genres:N}=O(),[M,I]=t.useState([]),[_,F]=t.useState(!1),[V,U]=t.useState(45),{playAlbum:re,addToQueue:ae,playTrack:oe,shuffleAllSongs:ie,isQueueSidebarOpen:ce}=$(),[T,D]=t.useState(!1);t.useEffect(()=>{if(T){const s=setTimeout(()=>{D(!1)},1e4);return()=>clearTimeout(s)}},[T]);const L=ee(),[Y,ue]=be();t.useEffect(()=>{const s=Y.get("yearMin"),l=Y.get("yearMax"),S=Y.get("genre");let d=!1;(s||l)&&(P({min:s?parseInt(s,10):null,max:l?parseInt(l,10):null}),d=!0),S&&(C([S]),d=!0),d&&(o(!0),ue({},{replace:!0}))},[]),t.useEffect(()=>{(async()=>{F(!0);try{const l=O.getState();if(l.years.length>0)I(l.years);else{const S=await G.getYears();I(S)}}catch(l){R.error("Failed to load filter values:",l)}finally{F(!1)}})()},[]);const W=b.length>0||g.min!==null||g.max!==null;t.useEffect(()=>{x.current&&x.current.abort();const s=c.trim().length>0;if(s||W){y(!0);const l=new AbortController;return x.current=l,(async()=>{if(!l.signal.aborted)try{let d;s?d=await Me(c,450):d=await ke(450),l.signal.aborted||m(d)}catch(d){l.signal.aborted||(R.error("Search failed:",d),m(null))}finally{l.signal.aborted||y(!1)}})(),()=>{l.abort()}}else x.current=null,m(null),y(!1)},[c,W]),t.useEffect(()=>{U(45)},[c,r,a==null?void 0:a.songs.length]),t.useEffect(()=>{var l;if(!r||!((l=a==null?void 0:a.songs)!=null&&l.length))return;const s=()=>{const S=window.scrollY||document.documentElement.scrollTop,d=window.innerHeight||document.documentElement.clientHeight,w=document.documentElement.scrollHeight;S+d*1.5>=w&&U(z=>Math.min(z+45,a.songs.length))};return window.addEventListener("scroll",s,{passive:!0}),()=>window.removeEventListener("scroll",s)},[r,a==null?void 0:a.songs.length]);const j=t.useMemo(()=>{if(!a)return null;const s=d=>{if(g.min!==null||g.max!==null)return!1;if(b.length>0){const w=d.Genres||[];if(!b.some(H=>w.some(Q=>Q.toLowerCase()===H.toLowerCase())))return!1}return!0},l=d=>{if(b.length>0){const w=d.Genres||[];if(!b.some(H=>w.some(Q=>Q.toLowerCase()===H.toLowerCase())))return!1}if(g.min!==null||g.max!==null){const w=d.ProductionYear;if(!w||w<=0||g.min!==null&&w<g.min||g.max!==null&&w>g.max)return!1}return!0},S=d=>!(g.min!==null||g.max!==null||b.length>0);return{artists:a.artists.filter(s),albums:a.albums.filter(l),playlists:(a.playlists||[]).filter(S),songs:a.songs.filter(l)}},[a,b,g]),B=s=>{h(s),s.trim().length>0&&!r&&o(!0)},de=s=>{L(`/artist/${s}`),o(!1),h(""),m(null)},fe=s=>{L(`/album/${s}`),o(!1),h(""),m(null)},he=s=>{oe(s,[s])},me=s=>{L(`/playlist/${s}`),o(!1),h(""),m(null)},X=()=>{h(""),m(null)},J=()=>{o(!1),h(""),m(null),C([]),P({min:null,max:null})},xe=s=>{u(s),A(!0)},ge=s=>{C(s)},pe=s=>{P(s)},ye=()=>{j!=null&&j.songs&&j.songs.length>0&&re(j.songs)},Se=()=>{j!=null&&j.songs&&j.songs.length>0&&ae(j.songs)},K=r;return t.useEffect(()=>{n&&n(K)},[K,n]),t.useEffect(()=>{if(r){const l=window.matchMedia("(hover: hover) and (pointer: fine) and (min-width: 1024px)").matches?k:i;setTimeout(()=>{var S;if((S=l.current)==null||S.focus(),l.current){const d=l.current.value.length;l.current.setSelectionRange(d,d)}},50)}},[r]),t.useEffect(()=>{if(!r)return;const s=l=>{l.key==="Escape"&&(l.preventDefault(),l.stopPropagation(),J())};return window.addEventListener("keydown",s,!0),()=>window.removeEventListener("keydown",s,!0)},[r]),t.useEffect(()=>()=>{x.current&&x.current.abort()},[]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"px-4 pt-4 pb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"text-lg font-semibold text-white",children:"Tunetuna"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:async()=>{const s=$.getState(),{isShuffleAllActive:l,isShuffleGenreActive:S,shuffle:d}=s;if(!(T||l||S)){D(!0);try{await ie()}catch(w){R.error("Home shuffle button - shuffleAllSongs failed:",w),R.error("Shuffle all failed:",w)}finally{D(!1)}}},disabled:T,className:"w-8 h-8 flex items-center justify-center text-white hover:bg-zinc-800 rounded-full transition-colors disabled:opacity-50","aria-label":"Shuffle all songs",children:T?e.jsx("div",{className:"w-4 h-4 border-2 border-zinc-400 border-t-white rounded-full animate-spin"}):e.jsx(we,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>L("/settings"),className:"w-8 h-8 flex items-center justify-center text-white hover:bg-zinc-800 rounded-full transition-colors","aria-label":"Settings",children:e.jsx(Pe,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"relative",onClick:()=>o(!0),children:e.jsx(Ce,{value:c,onChange:B,placeholder:"Search for artists, albums, songs...",showClearButton:c.trim().length>0,onClear:X})})]}),e.jsx(Ne,{isOpen:r,onClose:J,title:v,searchQuery:c,onSearchChange:B,onClearSearch:X,isLoading:p,results:j,sections:Ee,filterConfig:{showGenreFilter:!0,showYearFilter:!0},filterState:{selectedGenres:b,yearRange:g},onOpenFilterSheet:xe,onArtistClick:de,onAlbumClick:fe,onSongClick:he,onPlaylistClick:me,onPlayAllSongs:ye,onAddSongsToQueue:Se,visibleSongImageCount:V,isQueueSidebarOpen:ce,desktopSearchInputRef:k,mobileSearchInputRef:i}),f==="genre"&&e.jsx(q,{isOpen:E,onClose:()=>A(!1),filterType:"genre",genres:N,selectedValues:b,onApply:ge}),f==="year"&&e.jsx(q,{isOpen:E,onClose:()=>A(!1),filterType:"year",availableYears:M,yearRange:g,onApplyYear:pe})]})}function Z({album:n,onNavigate:v,onContextMenu:c}){var y,x;const[h,r]=t.useState(!1),o=t.useRef(!1),a=i=>{if(o.current){o.current=!1;return}v(n.Id)},m=i=>{i.preventDefault(),i.stopPropagation(),o.current=!0,c(n,"desktop",{x:i.clientX,y:i.clientY}),setTimeout(()=>{o.current=!1},300)},p=ne({onLongPress:i=>{i.preventDefault(),o.current=!0,c(n,"mobile")},onClick:()=>{if(o.current){o.current=!1;return}a()}});return e.jsxs("button",{onClick:()=>{if(o.current){o.current=!1;return}a()},onContextMenu:m,...p,className:"text-left group",children:[e.jsx("div",{className:"aspect-square rounded overflow-hidden mb-2 bg-zinc-900 flex items-center justify-center",children:h?e.jsx(se,{className:"w-12 h-12 text-gray-500"}):e.jsx(le,{src:G.getAlbumArtUrl(n.Id,474),alt:n.Name,className:"w-full h-full object-cover",showOutline:!0,rounded:"rounded",onError:()=>r(!0)})}),e.jsx("div",{className:"text-sm font-medium text-white truncate",children:n.Name}),e.jsx("div",{className:"text-xs text-gray-400 truncate",children:n.AlbumArtist||((x=(y=n.ArtistItems)==null?void 0:y[0])==null?void 0:x.Name)||"Unknown Artist"})]})}function Re(){const{recentlyAdded:n,setRecentlyAdded:v,setLoading:c}=O(),h=ee(),r=t.useRef(null),[o,a]=t.useState(0),[m,p]=t.useState(!1),[y,x]=t.useState("mobile"),[i,k]=t.useState(null),[b,C]=t.useState(null);t.useEffect(()=>{(async()=>{c("recentlyAdded",!0);try{const u=await G.getRecentlyAdded(18);v(u.Items||[])}catch(u){R.error("Failed to load recently added:",u)}finally{c("recentlyAdded",!1)}})()},[v,c]);const g=()=>{if(!r.current)return;const f=r.current,u=f.scrollLeft,N=f.clientWidth,M=Math.round(u/N);a(M)},P=f=>{if(!r.current)return;const u=r.current,N=u.clientWidth;u.scrollTo({left:f*N,behavior:"smooth"})};if(!n||n.length===0)return null;const E=6,A=[];for(let f=0;f<n.length;f+=E)A.push(n.slice(f,f+E));return e.jsxs("div",{className:"px-4 mb-8",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Recently Added"}),e.jsxs("div",{className:"md:hidden",children:[e.jsx("div",{ref:r,onScroll:g,className:"overflow-x-auto snap-x snap-mandatory scrollbar-hide",style:{scrollbarWidth:"none",msOverflowStyle:"none"},children:e.jsx("div",{className:"flex",style:{width:`${A.length*100}%`},children:A.map((f,u)=>{const N=Math.ceil(f.length/3);return e.jsx("div",{className:"snap-start flex-shrink-0 w-full",style:{width:`${100/A.length}%`},children:e.jsx("div",{className:"grid grid-cols-3 gap-3",style:{gridTemplateRows:`repeat(${N}, minmax(0, 1fr))`},children:f.map(M=>e.jsx(Z,{album:M,onNavigate:I=>h(`/album/${I}`),onContextMenu:(I,_,F)=>{C(I),x(_||"desktop"),k(F||null),p(!0)}},M.Id))})},u)})})}),A.length>1&&e.jsx("div",{className:"flex justify-center gap-2 mt-4",children:A.map((f,u)=>e.jsx("button",{onClick:()=>P(u),className:`w-2 h-2 rounded-full transition-colors ${u===o?"bg-white":"bg-zinc-600"}`,"aria-label":`Go to page ${u+1}`},u))})]}),e.jsx("div",{className:"hidden md:block",children:e.jsx("div",{className:"grid grid-cols-4 gap-3",children:n.slice(0,8).map(f=>e.jsx(Z,{album:f,onNavigate:u=>h(`/album/${u}`),onContextMenu:(u,N,M)=>{C(u),x(N||"desktop"),k(M||null),p(!0)}},f.Id))})}),e.jsx("style",{children:`
        .scrollbar-hide::-webkit-scrollbar {
          display: none;
        }
      `}),e.jsx(te,{item:b,itemType:"album",isOpen:m,onClose:()=>{p(!1),C(null)},zIndex:999999,mode:y,position:i||void 0})]})}function Oe({song:n,onClick:v,onContextMenu:c,contextMenuItemId:h}){var y,x;const r=je(),[o,a]=t.useState(!1),m=h===n.Id,p=ne({onLongPress:i=>{i.preventDefault(),c(n,"mobile")},onClick:()=>v(n)});return e.jsxs("button",{onClick:()=>v(n),onContextMenu:i=>{i.preventDefault(),c(n,"desktop",{x:i.clientX,y:i.clientY})},...p,className:`w-full flex items-center gap-3 hover:bg-white/10 transition-colors group px-4 py-3 ${m?"bg-white/10":""}`,children:[e.jsx("div",{className:"w-12 h-12 rounded-sm overflow-hidden flex-shrink-0 bg-zinc-900 self-center flex items-center justify-center",children:o?e.jsx(se,{className:"w-7 h-7 text-gray-500"}):e.jsx(le,{src:G.getAlbumArtUrl(n.AlbumId||n.Id,96),alt:n.Name,className:"w-full h-full object-cover",showOutline:!0,rounded:"rounded-sm",onError:()=>a(!0)})}),e.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[e.jsx("div",{className:`text-sm font-medium truncate transition-colors ${(r==null?void 0:r.Id)===n.Id?"text-[var(--accent-color)]":"text-white group-hover:text-[var(--accent-color)]"}`,children:n.Name}),e.jsxs("div",{className:"text-xs text-gray-400 truncate",children:[n.AlbumArtist||((x=(y=n.ArtistItems)==null?void 0:y[0])==null?void 0:x.Name)||"Unknown Artist",n.Album&&` â€¢ ${n.Album}`]})]}),n.RunTimeTicks&&e.jsx("div",{className:"text-xs text-gray-500 flex-shrink-0 text-right",children:Ae(n.RunTimeTicks)})]})}function Fe(){const{recentlyPlayed:n}=O(),{playTrack:v}=$(),[c,h]=t.useState(!1),[r,o]=t.useState("mobile"),[a,m]=t.useState(null),[p,y]=t.useState(null),x=i=>{v(i,n)};return!n||n.length===0?null:e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-xl font-bold mb-2 px-4",children:"Recently Played"}),e.jsx("div",{className:"space-y-0",children:n.map(i=>e.jsx(Oe,{song:i,onClick:x,onContextMenu:(k,b,C)=>{y(k),o(b||"mobile"),m(C||null),h(!0)},contextMenuItemId:(p==null?void 0:p.Id)||null},i.Id))}),e.jsx(te,{item:p,itemType:"song",isOpen:c,onClose:()=>{h(!1),y(null)},zIndex:99999,mode:r,position:a||void 0})]})}function De(){const[n,v]=t.useState(!1),{recentlyAdded:c,recentlyPlayed:h,loading:r}=O(),o=t.useRef(!1),{isQueueSidebarOpen:a}=$();t.useEffect(()=>{(r.recentlyAdded||r.recentlyPlayed)&&(o.current=!0)},[r.recentlyAdded,r.recentlyPlayed]);const m=o.current&&!r.recentlyAdded&&!r.recentlyPlayed&&c.length===0&&h.length===0;return e.jsxs("div",{className:"pb-20",children:[e.jsx("div",{className:`fixed top-0 left-0 right-0 bg-black z-10 lg:left-16 transition-[left,right] duration-300 ${a?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top))"},children:e.jsx("div",{className:"max-w-[768px] mx-auto",children:e.jsx(Te,{onSearchStateChange:v})})}),e.jsx("div",{className:`fixed left-0 right-0 z-[60] lg:left-16 transition-[left,right] duration-300 ${a?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 7.5rem - 2px)",height:"24px",background:"linear-gradient(to bottom, rgba(0, 0, 0, 0.8), transparent)"}}),e.jsx("div",{className:n?"hidden [@media((hover:hover)_and_(pointer:fine)_and_(min-width:1024px))]:block":"",style:{paddingTop:"calc(env(safe-area-inset-top) + 7.5rem + 24px)"},children:e.jsxs("div",{className:"max-w-[768px] mx-auto",children:[e.jsx(Re,{}),e.jsx(Fe,{}),m&&e.jsx("div",{className:"flex items-center justify-center py-16 text-gray-400",children:e.jsx("p",{children:"No music found"})})]})})]})}export{De as default};
