import{b as me,r as n,f as W,j as e,U as X,e as A,C as he,u as Te,a as ce,d as Le,h as Oe,G as De,P as Fe,L as Re,D as fe}from"./index-DodxqSF6.js";import{S as ze,u as Ge,f as He}from"./search-BT_xL7AT.js";import{P as Ue}from"./Pagination-CSNNHXi_.js";import{F as $e}from"./FilterBottomSheet-C0SgVZ6Z.js";import{A as _e}from"./arrow-up-down-C5ozQQ1i.js";const ee=new Map;function Be({artist:t,onContextMenu:b,contextMenuItemId:j}){var M,R;const C=me(),[k,p]=n.useState(!1),[f,w]=n.useState(!1),[I,y]=n.useState("mobile"),[m,g]=n.useState(null),l=n.useRef(!1),[o,r]=n.useState(null),a=j===t.Id;n.useEffect(()=>{var c;if((c=t.ImageTags)!=null&&c.Primary){r(null);return}const u=ee.get(t.Id);if(u!==void 0){r(u);return}let v=!1;return(async()=>{try{const{albums:N,songs:Y}=await A.getArtistItems(t.Id),Q=N[0],D=Y.find(J=>J.AlbumId)||Y[0],z=Q||D,U=z?z.AlbumId||z.Id:null,$=U?A.getAlbumArtUrl(U,96):null;ee.set(t.Id,$),v||r($)}catch(N){console.error("Failed to load fallback album art for artist:",t.Id,N),ee.set(t.Id,null)}})(),()=>{v=!0}},[t.Id,t.ImageTags]);const O=u=>{if(l.current){u.preventDefault(),l.current=!1;return}C(`/artist/${t.Id}`)},S=W({onLongPress:u=>{u.preventDefault(),b?(l.current=!0,b(t,"artist","mobile")):(l.current=!0,y("mobile"),g(null),w(!0))}}),E=u=>{var v,P,c,N;u.preventDefault(),u.stopPropagation(),(P=(v=u.nativeEvent)==null?void 0:v.preventDefault)==null||P.call(v),(N=(c=u.nativeEvent)==null?void 0:c.stopImmediatePropagation)==null||N.call(c),l.current=!0,b?b(t,"artist","desktop",{x:u.clientX,y:u.clientY}):(y("desktop"),g({x:u.clientX,y:u.clientY}),w(!0)),setTimeout(()=>{l.current=!1},300)};return e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:u=>{if(f||l.current){u.preventDefault(),u.stopPropagation();return}O(u)},onContextMenu:E,...S,className:`w-full flex items-center gap-4 hover:bg-white/10 transition-colors group px-4 h-[72px] ${a?"bg-white/10":""}`,children:[e.jsx("div",{className:"w-12 h-12 rounded-full overflow-hidden flex-shrink-0 bg-zinc-900 flex items-center justify-center",children:k?e.jsx(X,{className:"w-6 h-6 text-gray-500"}):(M=t.ImageTags)!=null&&M.Primary||o?e.jsx("img",{src:(R=t.ImageTags)!=null&&R.Primary?A.getArtistImageUrl(t.Id,96):o||"",alt:t.Name,className:"w-full h-full object-cover",onError:()=>p(!0),loading:"lazy"}):e.jsx(X,{className:"w-6 h-6 text-gray-500"})}),e.jsx("div",{className:"flex-1 min-w-0 text-left",children:e.jsx("div",{className:"text-base font-medium text-white truncate group-hover:text-[var(--accent-color)] transition-colors",children:t.Name})})]}),e.jsx(he,{item:t,itemType:"artist",isOpen:f,onClose:()=>w(!1),zIndex:99999,mode:I,position:m||void 0})]})}const te=new Map;function Ye({artist:t,onClick:b,onContextMenu:j,contextMenuItemId:C}){var o;const[k,p]=n.useState(!1),f=n.useRef(!1),w=C===t.Id,[I,y]=n.useState(null);n.useEffect(()=>{var S;if((S=t.ImageTags)!=null&&S.Primary){y(null);return}const r=te.get(t.Id);if(r!==void 0){y(r);return}let a=!1;return(async()=>{try{const{albums:E,songs:M}=await A.getArtistItems(t.Id),R=E[0],u=M.find(N=>N.AlbumId)||M[0],v=R||u,P=v?v.AlbumId||v.Id:null,c=P?A.getAlbumArtUrl(P,96):null;te.set(t.Id,c),a||y(c)}catch(E){console.error("Failed to load fallback album art for artist (search item):",t.Id,E),te.set(t.Id,null)}})(),()=>{a=!0}},[t.Id,t.ImageTags]);const m=r=>{if(w||f.current){r.preventDefault(),r.stopPropagation(),f.current=!1;return}b(t.Id)},g=r=>{r.preventDefault(),r.stopPropagation(),f.current=!0,j(t,"artist","desktop",{x:r.clientX,y:r.clientY}),setTimeout(()=>{f.current=!1},300)},l=W({onLongPress:r=>{r.preventDefault(),f.current=!0,j(t,"artist","mobile")},onClick:m});return e.jsxs("button",{onClick:m,onContextMenu:g,...l,className:`w-full flex items-center gap-4 hover:bg-white/10 transition-colors text-left cursor-pointer px-4 h-[72px] ${w?"bg-white/10":""}`,children:[e.jsx("div",{className:"w-12 h-12 rounded-full overflow-hidden flex-shrink-0 bg-zinc-900 flex items-center justify-center",children:k?e.jsx(X,{className:"w-6 h-6 text-gray-500"}):I||(o=t.ImageTags)!=null&&o.Primary?e.jsx("img",{src:I||A.getArtistImageUrl(t.Id,96),alt:t.Name,className:"w-full h-full object-cover",onError:()=>p(!0),loading:"lazy"}):e.jsx(X,{className:"w-6 h-6 text-gray-500"})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("div",{className:"text-base font-medium text-white truncate group-hover:text-[var(--accent-color)] transition-colors",children:t.Name})})]})}function Qe({album:t,onClick:b,onContextMenu:j,contextMenuItemId:C}){var g,l;const[k,p]=n.useState(!1),f=n.useRef(!1),w=C===t.Id,I=o=>{if(w||f.current){o.preventDefault(),o.stopPropagation(),f.current=!1;return}b(t.Id)},y=o=>{o.preventDefault(),o.stopPropagation(),f.current=!0,j(t,"album","desktop",{x:o.clientX,y:o.clientY}),setTimeout(()=>{f.current=!1},300)},m=W({onLongPress:o=>{o.preventDefault(),f.current=!0,j(t,"album","mobile")},onClick:I});return e.jsxs("button",{onClick:I,onContextMenu:y,...m,className:"text-left group",children:[e.jsx("div",{className:"aspect-square rounded overflow-hidden mb-3 bg-zinc-900 shadow-lg relative flex items-center justify-center",children:k?e.jsx(fe,{className:"w-12 h-12 text-gray-500"}):e.jsxs(e.Fragment,{children:[e.jsx("img",{src:A.getAlbumArtUrl(t.Id,474),alt:t.Name,className:"w-full h-full object-cover",onError:()=>p(!0)}),e.jsx("div",{className:"absolute inset-0 pointer-events-none border border-white rounded",style:{borderColor:"rgba(255, 255, 255, 0.03)",borderWidth:"1px"}})]})}),e.jsx("div",{className:"text-sm font-semibold text-white truncate mb-1",children:t.Name}),e.jsx("div",{className:"text-xs text-gray-400 truncate",children:t.AlbumArtist||((l=(g=t.ArtistItems)==null?void 0:g[0])==null?void 0:l.Name)||"Unknown Artist"})]})}function Ve({song:t,onClick:b,onContextMenu:j,contextMenuItemId:C,showImage:k=!0}){var o,r;const p=n.useRef(!1),f=C===t.Id,[w,I]=n.useState(!1),y=a=>{const O=Math.floor(a/1e7),S=Math.floor(O/60),E=O%60;return`${S}:${E.toString().padStart(2,"0")}`},m=a=>{if(f||p.current){a.preventDefault(),a.stopPropagation(),p.current=!1;return}b(t)},g=a=>{a.preventDefault(),a.stopPropagation(),p.current=!0,j(t,"song","desktop",{x:a.clientX,y:a.clientY}),setTimeout(()=>{p.current=!1},300)},l=W({onLongPress:a=>{a.preventDefault(),p.current=!0,j(t,"song","mobile")},onClick:m});return e.jsxs("button",{onClick:m,onContextMenu:g,...l,className:`w-full flex items-center gap-3 hover:bg-white/10 transition-colors group px-4 py-3 ${f?"bg-white/10":""}`,children:[e.jsx("div",{className:"w-12 h-12 rounded-sm overflow-hidden flex-shrink-0 bg-zinc-900 self-center relative flex items-center justify-center",children:w?e.jsx(fe,{className:"w-7 h-7 text-gray-500"}):e.jsxs(e.Fragment,{children:[e.jsx("img",{src:A.getAlbumArtUrl(t.AlbumId||t.Id,96),alt:t.Name,className:"w-full h-full object-cover",loading:"lazy",onError:()=>I(!0)}),e.jsx("div",{className:"absolute inset-0 pointer-events-none border border-white rounded-sm",style:{borderColor:"rgba(255, 255, 255, 0.03)",borderWidth:"1px"}})]})}),e.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[e.jsx("div",{className:"text-sm font-medium text-white truncate group-hover:text-[var(--accent-color)] transition-colors",children:t.Name}),e.jsxs("div",{className:"text-xs text-gray-400 truncate",children:[t.AlbumArtist||((r=(o=t.ArtistItems)==null?void 0:o[0])==null?void 0:r.Name)||"Unknown Artist",t.Album&&` â€¢ ${t.Album}`]})]}),t.RunTimeTicks&&e.jsx("div",{className:"text-xs text-gray-500 flex-shrink-0 text-right",children:y(t.RunTimeTicks)})]})}const H=90,de=45,Xe=45,ue=45,We=45;function tt(){const{artists:t,setArtists:b,sortPreferences:j,setSortPreference:C,setLoading:k,loading:p,genres:f}=Te(),{playTrack:w,playAlbum:I,addToQueue:y}=ce(),[m,g]=n.useState(""),[l,o]=n.useState(!1),[r,a]=n.useState(null),[O,S]=n.useState(!1),[E,M]=n.useState(!1),[R,u]=n.useState("mobile"),[v,P]=n.useState(null),[c,N]=n.useState(null),[Y,Q]=n.useState(null),[D,z]=n.useState(0),[U,$]=n.useState(0),[J,se]=n.useState(ue),q=me(),_=n.useRef(null),[T,ne]=n.useState([]),[xe,re]=n.useState(!1),[ge,pe]=n.useState(null),L=j.artists,V=n.useRef(!0),[be,le]=n.useState(!1),ae=n.useRef(L),[ve,oe]=n.useState(de),K=ce(s=>s.isQueueSidebarOpen),ie=T.length>0;n.useEffect(()=>{const s=m.trim().length>0;if(s||ie){S(!0);const d=window.setTimeout(()=>{(async()=>{try{if(s){const h=await Ge(m,450);a(h)}else{const h=await He(450);a(h)}}catch(h){console.error("Search failed:",h),a(null)}finally{S(!1)}})()},250);return()=>{window.clearTimeout(d)}}else a(null),S(!1)},[m,ie]);const i=n.useMemo(()=>{if(!r)return null;const s=x=>{if(T.length>0){const h=x.Genres||[];if(!T.some(G=>h.some(Z=>Z.toLowerCase()===G.toLowerCase())))return!1}return!0},d=x=>{if(T.length>0){const h=x.Genres||[];if(!T.some(G=>h.some(Z=>Z.toLowerCase()===G.toLowerCase())))return!1}return!0};return{artists:r.artists.filter(s),albums:r.albums.filter(d),playlists:r.playlists||[],songs:r.songs.filter(d)}},[r,T]);n.useEffect(()=>{var s;if(l&&((s=_.current)==null||s.focus(),_.current)){const d=_.current.value.length;_.current.setSelectionRange(d,d)}},[l]);const je=s=>{g(s),s.trim().length>0&&!l&&o(!0)},we=()=>{g(""),a(null)},ye=()=>{o(!1),g(""),a(null),ne([])},Ie=()=>{pe("genre"),re(!0)},Ne=s=>{ne(s)},Ae=s=>{q(`/artist/${s}`),o(!1),g(""),a(null)},Se=s=>{q(`/album/${s}`),o(!1),g(""),a(null)},Ce=s=>{w(s,[s])},ke=s=>{s.preventDefault(),s.stopPropagation(),i!=null&&i.songs&&i.songs.length>0&&I(i.songs)},Ee=s=>{s.preventDefault(),s.stopPropagation(),i!=null&&i.songs&&i.songs.length>0&&y(i.songs)},Me=s=>{q(`/playlist/${s}`),o(!1),g(""),a(null)},B=(s,d,x="mobile",h)=>{N(s),Q(d),u(x),P(h||null),M(!0)},Pe=async()=>{var d;const s=Date.now();k("artists",!0);try{const x={limit:H,startIndex:D*H};L==="RecentlyAdded"?(x.sortBy=["DateCreated"],x.sortOrder="Descending"):(x.sortBy=["SortName"],x.sortOrder="Ascending");let h=await A.getArtists(x);(((d=h.Items)==null?void 0:d.length)||0)===0&&(h=await A.getArtists({limit:H,startIndex:D*H}));const F=h.Items||[];$(h.TotalRecordCount||0);const G=Date.now()-s;b(F)}catch(x){console.error("Failed to load artists:",x),b([]),$(0)}finally{k("artists",!1),le(!1)}};return n.useEffect(()=>{!m.trim()&&!l&&z(0)},[L,m,l]),n.useEffect(()=>{oe(de)},[m,l,r==null?void 0:r.songs.length]),n.useEffect(()=>{var d;if(!l||!((d=r==null?void 0:r.songs)!=null&&d.length))return;const s=()=>{const x=window.scrollY||document.documentElement.scrollTop,h=window.innerHeight||document.documentElement.clientHeight,F=document.documentElement.scrollHeight;x+h*1.5>=F&&oe(G=>Math.min(G+Xe,r.songs.length))};return window.addEventListener("scroll",s,{passive:!0}),()=>window.removeEventListener("scroll",s)},[l,r==null?void 0:r.songs.length]),n.useEffect(()=>{se(ue)},[D,t.length]),n.useEffect(()=>{const s=()=>{const d=window.scrollY||document.documentElement.scrollTop,x=window.innerHeight||document.documentElement.clientHeight,h=document.documentElement.scrollHeight;d+x*1.5>=h&&se(F=>Math.min(F+We,t.length))};return window.addEventListener("scroll",s,{passive:!0}),()=>window.removeEventListener("scroll",s)},[t.length]),n.useEffect(()=>{!m.trim()&&!l&&(!V.current&&ae.current!==L&&le(!0),ae.current=L,Pe())},[D,L,m,l]),n.useEffect(()=>{V.current&&(V.current=!1)},[]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"pb-20",children:[e.jsx("div",{className:`fixed top-0 left-0 right-0 bg-black z-10 lg:left-16 transition-[left,right] duration-300 ${K?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top))"},children:e.jsx("div",{className:"max-w-[768px] mx-auto",children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Artists"}),e.jsx("button",{onClick:()=>o(!0),className:"w-10 h-10 flex items-center justify-center text-white hover:bg-zinc-800 rounded-full transition-colors","aria-label":"Search",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})]}),!l&&e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("button",{onClick:()=>C("artists",L==="RecentlyAdded"?"Alphabetical":"RecentlyAdded"),className:"text-sm text-gray-400 hover:text-white transition-colors flex items-center gap-1",children:[L==="RecentlyAdded"?"Recently Added":"Alphabetically",e.jsx(_e,{className:"w-4 h-4"})]}),p.artists&&!V.current&&e.jsx("div",{className:"flex items-center",children:e.jsx(Oe,{})})]})]})})}),e.jsx("div",{className:`fixed left-0 right-0 z-10 lg:left-16 transition-[left,right] duration-300 ${K?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 7rem - 8px)",height:"24px",background:"linear-gradient(to bottom, rgba(0, 0, 0, 0.8), transparent)"}}),e.jsx("div",{style:{paddingTop:"calc(env(safe-area-inset-top) + 7rem)"},children:!l&&e.jsxs("div",{className:be?"opacity-50 pointer-events-none":"",children:[t.length===0&&!p.artists&&e.jsx("div",{className:"flex items-center justify-center py-8 text-gray-400",children:e.jsx("p",{children:"No artists found"})}),t.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-0",children:t.slice(0,J).map(s=>e.jsx(Be,{artist:s,onContextMenu:B,contextMenuItemId:(c==null?void 0:c.Id)||null},s.Id))}),e.jsx(Ue,{currentPage:D,totalPages:Math.ceil(U/H),onPageChange:z,itemsPerPage:H,totalItems:U})]})]})})]}),l&&Le.createPortal(e.jsx(e.Fragment,{children:e.jsxs("div",{className:"fixed inset-0 bg-black z-[9999] overflow-y-auto p-0 m-0",children:[e.jsx("div",{className:"fixed top-0 left-0 right-0 bg-black z-50 pointer-events-none",style:{height:"env(safe-area-inset-top)",top:"var(--header-offset, 0px)"}}),e.jsx("div",{className:"fixed top-0 left-0 right-0 bg-black z-10 pt-0 pb-0 w-full m-0",style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top))",height:"76px"},children:e.jsx("div",{className:"max-w-[768px] mx-auto w-full",children:e.jsxs("div",{className:"flex items-center gap-3 px-4 pt-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(ze,{ref:_,value:m,onChange:je,showClearButton:m.trim().length>0,onClear:we})}),e.jsx("button",{onClick:ye,className:"px-4 py-2 text-white text-sm font-medium hover:text-zinc-300 transition-colors whitespace-nowrap flex-shrink-0",children:"Cancel"})]})})}),e.jsxs("div",{className:"max-w-[768px] mx-auto w-full",style:{paddingTop:"calc(52px + env(safe-area-inset-top))"},children:[e.jsx("div",{className:"sticky bg-black z-10 pt-3 pb-4",style:{top:"calc(76px + env(safe-area-inset-top))"},children:e.jsx("div",{className:"flex items-center gap-3 px-4",children:e.jsxs("button",{onClick:Ie,className:`flex items-center gap-2 px-3 py-2 rounded-lg transition-colors ${T.length>0?"bg-[var(--accent-color)] text-white":"bg-white/10 text-white hover:bg-white/20"}`,"aria-label":"Filter by genre",children:[e.jsx(De,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Genre"})]})})}),e.jsx("div",{className:`fixed left-0 right-0 z-[60] lg:left-16 transition-[left,right] duration-300 ${K?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 76px + 4rem)",height:"24px",background:"linear-gradient(to bottom, rgba(0, 0, 0, 0.8), transparent)"}}),e.jsx("div",{className:"pb-32",style:{paddingTop:"40px"},children:O?e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-zinc-800 border-t-[var(--accent-color)]"})}):i?e.jsxs("div",{className:"space-y-8",children:[i.artists.length>0&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-4 px-4",children:"Artists"}),e.jsx("div",{className:"space-y-0",children:i.artists.map(s=>e.jsx(Ye,{artist:s,onClick:Ae,onContextMenu:B,contextMenuItemId:(c==null?void 0:c.Id)||null},s.Id))})]}),i.albums.length>0&&e.jsxs("div",{className:"px-4",children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Albums"}),e.jsx("div",{className:"grid grid-cols-3 gap-4",children:i.albums.slice(0,12).map(s=>e.jsx(Qe,{album:s,onClick:Se,onContextMenu:B,contextMenuItemId:(c==null?void 0:c.Id)||null},s.Id))})]}),i.playlists&&i.playlists.length>0&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-4 px-4",children:"Playlists"}),e.jsx("div",{className:"space-y-0",children:i.playlists.map(s=>e.jsxs("button",{onClick:()=>Me(s.Id),onContextMenu:d=>{d.preventDefault(),d.stopPropagation(),B(s,"playlist","desktop",{x:d.clientX,y:d.clientY})},className:"w-full flex items-center gap-3 hover:bg-white/10 transition-colors group px-4 py-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-sm overflow-hidden flex-shrink-0 bg-zinc-900 self-center",children:e.jsx("img",{src:A.getAlbumArtUrl(s.Id,96),alt:s.Name,className:"w-full h-full object-cover",loading:"lazy"})}),e.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[e.jsx("div",{className:"text-sm font-medium text-white truncate group-hover:text-[var(--accent-color)] transition-colors",children:s.Name}),e.jsx("div",{className:"text-xs text-gray-400 truncate",children:"Playlist"})]})]},s.Id))})]}),i.songs.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 px-4",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"Songs"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:ke,className:"w-10 h-10 flex items-center justify-center text-white hover:bg-white/10 rounded-lg transition-colors","aria-label":"Play all songs",children:e.jsx(Fe,{className:"w-5 h-5"})}),e.jsx("button",{type:"button",onClick:Ee,className:"w-10 h-10 flex items-center justify-center text-white hover:bg-white/10 rounded-lg transition-colors","aria-label":"Add all songs to queue",children:e.jsx(Re,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"space-y-0",children:i.songs.map((s,d)=>e.jsx(Ve,{song:s,onClick:Ce,onContextMenu:B,contextMenuItemId:(c==null?void 0:c.Id)||null,showImage:d<ve},s.Id))})]}),i.artists.length===0&&i.albums.length===0&&(!i.playlists||i.playlists.length===0)&&i.songs.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 text-gray-400 px-4",children:[e.jsx("div",{className:"text-lg mb-2",children:"No results found"}),e.jsx("div",{className:"text-sm",children:"Try a different search term"})]})]}):e.jsx("div",{className:"flex flex-col items-center justify-center py-16 text-gray-400 px-4"})})]})]})}),document.body),ge==="genre"&&e.jsx($e,{isOpen:xe,onClose:()=>re(!1),filterType:"genre",genres:f,selectedValues:T,onApply:Ne}),e.jsx(he,{item:c,itemType:Y,isOpen:E,onClose:()=>{M(!1),N(null),Q(null)},zIndex:99999,mode:R,position:v||void 0})]})}export{tt as default};
