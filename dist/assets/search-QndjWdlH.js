import{r as i,j as e,t as ue,v as de,f as U,e as D,U as O,B as me,C as xe,G as he,E as fe,H as pe,J as P}from"./index-BYKDqJ8o.js";import{C as ge,T as be,S as ve,G as we}from"./tag-C3OfJ6eg.js";import{P as Ne}from"./piano-Dd66CmwD.js";const B=i.forwardRef(({value:t,onChange:s,placeholder:h="Search...",debounceMs:r=150,showClearButton:g=!1,onClear:c},f)=>{const[n,N]=i.useState(t),b=i.useRef(s),l=i.useRef(null),v=u=>{l.current=u,typeof f=="function"?f(u):f&&(f.current=u)};return i.useEffect(()=>{b.current=s},[s]),i.useEffect(()=>{const u=setTimeout(()=>{b.current(n)},r);return()=>clearTimeout(u)},[n,r]),i.useEffect(()=>{t===""&&n!==""&&N(t)},[t]),e.jsxs("div",{className:"relative",children:[e.jsx("input",{ref:v,type:"text",value:n,onChange:u=>{N(u.target.value)},placeholder:h,className:"w-full px-4 py-2 pl-10 pr-10 bg-zinc-900 border border-zinc-800 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-[var(--accent-color)] focus:border-transparent"}),e.jsx("svg",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),e.jsx("button",{onClick:u=>{u.preventDefault(),u.stopPropagation(),N(""),c&&c(),setTimeout(()=>{var w;(w=l.current)==null||w.focus()},0)},className:`absolute right-3 top-1/2 transform -translate-y-1/2 w-5 h-5 transition-opacity ${g&&n?"text-gray-400 hover:text-white opacity-100 pointer-events-auto":"opacity-0 pointer-events-none"}`,"aria-label":"Clear search",type:"button",children:e.jsx("svg",{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",className:"w-full h-full",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})});B.displayName="SearchInput";const je=i.memo(function({artist:s,onClick:h,onContextMenu:r,contextMenuItemId:g}){var y;const[c,f]=i.useState(!1),n=i.useRef(!1),N=g===s.Id,[b,l]=i.useState(null);i.useEffect(()=>{var T;if((T=s.ImageTags)!=null&&T.Primary){l(null);return}const x=ue(s.Id);if(x!==void 0){l(x);return}let A=!1;return de(s.Id).then(S=>{A||l(S)}),()=>{A=!0}},[s.Id,s.ImageTags]);const v=x=>{if(N||n.current){x.preventDefault(),x.stopPropagation(),n.current=!1;return}h(s.Id)},u=x=>{x.preventDefault(),x.stopPropagation(),n.current=!0,r(s,"artist","desktop",{x:x.clientX,y:x.clientY}),setTimeout(()=>{n.current=!1},300)},w=U({onLongPress:x=>{x.preventDefault(),n.current=!0,r(s,"artist","mobile")},onClick:v}),a=(y=s.ImageTags)!=null&&y.Primary?D.getArtistImageUrl(s.Id,96):b;return e.jsxs("button",{onClick:v,onContextMenu:u,...w,className:`group w-full flex items-center gap-4 hover:bg-white/10 transition-colors text-left cursor-pointer px-4 h-[72px] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--accent-color)] focus-visible:ring-inset ${N?"bg-white/10":""}`,"aria-label":`Go to artist ${s.Name}`,children:[e.jsx("div",{className:"w-12 h-12 rounded-full overflow-hidden flex-shrink-0 bg-zinc-900 flex items-center justify-center",children:c?e.jsx(O,{className:"w-6 h-6 text-gray-500"}):a?e.jsx("img",{src:a,alt:s.Name,className:"w-full h-full object-cover",onError:()=>f(!0),loading:"lazy"}):e.jsx(O,{className:"w-6 h-6 text-gray-500"})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("div",{className:"text-base font-medium text-white truncate group-hover:text-[var(--accent-color)] transition-colors",children:s.Name})})]})});function ye({album:t,onClick:s,onArtistClick:h,onContextMenu:r,contextMenuItemId:g}){var l,v,u,w,a,y,x,A,T,S,d,o;const c=i.useRef(!1),f=g===t.Id,n=m=>{if(f||c.current){m.preventDefault(),m.stopPropagation(),c.current=!1;return}s(t.Id)},N=m=>{m.preventDefault(),m.stopPropagation(),c.current=!0,r(t,"album","desktop",{x:m.clientX,y:m.clientY}),setTimeout(()=>{c.current=!1},300)},b=U({onLongPress:m=>{m.preventDefault(),c.current=!0,r(t,"album","mobile")}});return e.jsxs("button",{onClick:n,onContextMenu:N,className:"text-left group",...b,children:[e.jsxs("div",{className:"aspect-square rounded overflow-hidden mb-3 bg-zinc-900 shadow-lg relative flex items-center justify-center",children:[e.jsx("img",{src:D.getAlbumArtUrl(t.Id,474),alt:t.Name,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 pointer-events-none border border-white rounded",style:{borderColor:"rgba(255, 255, 255, 0.03)",borderWidth:"1px"}})]}),e.jsx("div",{className:"text-sm font-semibold text-white truncate mb-1 group-hover:text-[var(--accent-color)] transition-colors",children:t.Name}),e.jsx("div",{className:"text-xs text-gray-400 truncate",children:(v=(l=t.AlbumArtists)==null?void 0:l[0])!=null&&v.Id||(w=(u=t.ArtistItems)==null?void 0:u[0])!=null&&w.Id?e.jsx("span",{className:"clickable-text",onMouseDown:m=>m.stopPropagation(),onClick:m=>{var I,k;m.stopPropagation(),h(((k=(I=t.AlbumArtists)==null?void 0:I[0])==null?void 0:k.Id)||t.ArtistItems[0].Id)},children:t.AlbumArtist||((y=(a=t.AlbumArtists)==null?void 0:a[0])==null?void 0:y.Name)||((A=(x=t.ArtistItems)==null?void 0:x[0])==null?void 0:A.Name)||"Unknown Artist"}):t.AlbumArtist||((S=(T=t.AlbumArtists)==null?void 0:T[0])==null?void 0:S.Name)||((o=(d=t.ArtistItems)==null?void 0:d[0])==null?void 0:o.Name)||"Unknown Artist"})]})}function Ae({song:t,onClick:s,onArtistClick:h,onContextMenu:r,contextMenuItemId:g,showImage:c=!0}){var u,w;const f=i.useRef(!1),n=g===t.Id,N=a=>{const y=Math.floor(a/1e7),x=Math.floor(y/60),A=y%60;return`${x}:${A.toString().padStart(2,"0")}`},b=a=>{if(n||f.current){a.preventDefault(),a.stopPropagation(),f.current=!1;return}s(t)},l=a=>{a.preventDefault(),a.stopPropagation(),f.current=!0,r(t,"song","desktop",{x:a.clientX,y:a.clientY}),setTimeout(()=>{f.current=!1},300)},v=U({onLongPress:a=>{a.preventDefault(),f.current=!0,r(t,"song","mobile")}});return e.jsxs("button",{onClick:b,onContextMenu:l,className:`w-full flex items-center gap-3 hover:bg-white/10 transition-colors group px-4 py-3 ${n?"bg-white/10":""}`,...v,children:[c&&e.jsx("div",{className:"w-12 h-12 rounded-sm overflow-hidden flex-shrink-0 bg-zinc-900 self-center",children:e.jsx("img",{src:D.getAlbumArtUrl(t.AlbumId||t.Id,96),alt:t.Name,className:"w-full h-full object-cover",loading:"lazy"})}),e.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[e.jsx("div",{className:"text-sm font-medium text-white truncate group-hover:text-[var(--accent-color)] transition-colors",children:t.Name}),e.jsx("div",{className:"text-xs text-gray-400 truncate",children:(w=(u=t.ArtistItems)==null?void 0:u[0])!=null&&w.Id?e.jsx("span",{className:"clickable-text",onMouseDown:a=>a.stopPropagation(),onClick:a=>{a.stopPropagation(),h(t.ArtistItems[0].Id)},children:t.ArtistItems[0].Name||t.AlbumArtist||"Unknown Artist"}):t.AlbumArtist||"Unknown Artist"})]}),t.RunTimeTicks&&e.jsx("div",{className:"text-xs text-gray-500 flex-shrink-0",children:N(t.RunTimeTicks)})]})}function Ie({playlist:t,onClick:s,onContextMenu:h}){const r=i.useRef(!1),g=U({onLongPress:c=>{c.preventDefault(),r.current=!0,h(t,"playlist","mobile")}});return e.jsxs("button",{onClick:()=>{if(r.current){r.current=!1;return}s(t.Id)},onContextMenu:c=>{c.preventDefault(),c.stopPropagation(),r.current=!0,h(t,"playlist","desktop",{x:c.clientX,y:c.clientY}),setTimeout(()=>{r.current=!1},300)},className:"w-full flex items-center gap-3 hover:bg-white/10 transition-colors group px-4 py-3",...g,children:[e.jsx("div",{className:"w-12 h-12 rounded-sm overflow-hidden flex-shrink-0 bg-zinc-900 self-center",children:e.jsx("img",{src:D.getAlbumArtUrl(t.Id,96),alt:t.Name,className:"w-full h-full object-cover",loading:"lazy"})}),e.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[e.jsx("div",{className:"text-sm font-medium text-white truncate group-hover:text-[var(--accent-color)] transition-colors",children:t.Name}),e.jsx("div",{className:"text-xs text-gray-400 truncate",children:t.ChildCount?`${t.ChildCount} tracks`:"Playlist"})]})]})}const ke=t=>{switch(t.toLowerCase()){case"language":return we;case"mood":return ve;case"instrumental":return Ne;default:return be}};function Te({isOpen:t,onClose:s,title:h="Search",searchQuery:r,onSearchChange:g,onClearSearch:c,isLoading:f,results:n,sections:N,filterConfig:b,filterState:l,onOpenFilterSheet:v,groupingCategories:u=[],onOpenGroupingFilterSheet:w,onArtistClick:a,onAlbumClick:y,onSongClick:x,onPlaylistClick:A,onPlayAllSongs:T,onAddSongsToQueue:S,isQueueSidebarOpen:d=!1,desktopSearchInputRef:o,mobileSearchInputRef:m}){const I=i.useRef(null),k=i.useRef(null),$=o||I,R=m||k,[Z,q]=i.useState(!1),[Q,H]=i.useState(!1);i.useEffect(()=>{if(t)H(!0),requestAnimationFrame(()=>{requestAnimationFrame(()=>{q(!0)})});else{q(!1);const p=setTimeout(()=>{H(!1)},200);return()=>clearTimeout(p)}},[t]);const[ee,J]=i.useState(!1),[te,se]=i.useState("mobile"),[ne,re]=i.useState(null),[M,W]=i.useState(null),[ae,V]=i.useState(null),F=(p,j,E,L)=>{W(p),V(j),se(E),re(L||null),J(!0)};i.useEffect(()=>{var p,j;t&&(window.matchMedia("(hover: hover) and (pointer: fine) and (min-width: 1024px)").matches?(p=$.current)==null||p.focus():(j=R.current)==null||j.focus())},[t,$,R]),i.useEffect(()=>{if(!t)return;const p=j=>{j.key==="Escape"&&s()};return window.addEventListener("keydown",p,!0),()=>window.removeEventListener("keydown",p,!0)},[t,s]);const _=b.showGenreFilter||b.showYearFilter||b.showGroupingFilters&&u.length>0,le=n&&(n.artists.length>0||n.albums.length>0||n.songs.length>0||n.playlists&&n.playlists.length>0),oe=(p,j)=>{if(!n)return null;const{type:E,limit:L}=p,Y=j?"":"-mx-4",G=j?"pl-2 pr-4":"";switch(E){case"artists":{const C=L?n.artists.slice(0,L):n.artists;return C.length===0?null:e.jsxs("div",{children:[e.jsx("h2",{className:`text-xl font-bold text-white mb-4 ${G}`,children:"Artists"}),e.jsx("div",{className:`space-y-0 ${Y}`,children:C.map(z=>e.jsx(je,{artist:z,onClick:a,onContextMenu:F,contextMenuItemId:(M==null?void 0:M.Id)||null},z.Id))})]},"artists")}case"albums":{const C=L?n.albums.slice(0,L):n.albums;return C.length===0?null:e.jsxs("div",{className:j?G:"",children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Albums"}),e.jsx("div",{className:"grid grid-cols-3 md:grid-cols-4 gap-4",children:C.map(z=>e.jsx(ye,{album:z,onClick:y,onArtistClick:a,onContextMenu:F,contextMenuItemId:(M==null?void 0:M.Id)||null},z.Id))})]},"albums")}case"songs":return n.songs.length===0?null:e.jsxs("div",{children:[e.jsxs("div",{className:`flex items-center justify-between mb-4 ${G}`,children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"Songs"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:T,className:"w-10 h-10 flex items-center justify-center text-white hover:bg-white/10 rounded-lg transition-colors","aria-label":"Play all songs",children:e.jsx(fe,{className:"w-5 h-5"})}),e.jsx("button",{type:"button",onClick:S,className:"w-10 h-10 flex items-center justify-center text-white hover:bg-white/10 rounded-lg transition-colors","aria-label":"Add all songs to queue",children:e.jsx(pe,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:`space-y-0 ${Y}`,children:n.songs.map((C,z)=>e.jsx(Ae,{song:C,onClick:x,onArtistClick:a,onContextMenu:F,contextMenuItemId:(M==null?void 0:M.Id)||null,showImage:!0},C.Id))})]},"songs");case"playlists":{const C=n.playlists;return!C||C.length===0?null:e.jsxs("div",{children:[e.jsx("h2",{className:`text-xl font-bold text-white mb-4 ${G}`,children:"Playlists"}),e.jsx("div",{className:`space-y-0 ${Y}`,children:C.map(z=>e.jsx(Ie,{playlist:z,onClick:A,onContextMenu:F},z.Id))})]},"playlists")}default:return null}},X=()=>_?e.jsxs(e.Fragment,{children:[b.showGenreFilter&&e.jsxs("button",{onClick:()=>v("genre"),className:`flex items-center gap-2 px-3 py-2 rounded-lg transition-colors ${l.selectedGenres.length>0?"bg-[var(--accent-color)] text-white":"bg-white/10 text-white hover:bg-white/20"}`,"aria-label":"Filter by genre",children:[e.jsx(he,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Genre"})]}),b.showYearFilter&&e.jsxs("button",{onClick:()=>v("year"),className:`flex items-center gap-2 px-3 py-2 rounded-lg transition-colors ${l.yearRange.min!==null||l.yearRange.max!==null?"bg-[var(--accent-color)] text-white":"bg-white/10 text-white hover:bg-white/20"}`,"aria-label":"Filter by year",children:[e.jsx(ge,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Year"})]}),b.showGroupingFilters&&u.map(p=>{var L;const j=ke(p.key),E=(((L=l.selectedGroupings[p.key])==null?void 0:L.length)||0)>0;return e.jsxs("button",{onClick:()=>w==null?void 0:w(p),className:`flex items-center gap-2 px-3 py-2 rounded-lg transition-colors ${E?"bg-[var(--accent-color)] text-white":"bg-white/10 text-white hover:bg-white/20"}`,"aria-label":`Filter by ${p.name}`,children:[e.jsx(j,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:p.name})]},p.key)})]}):null,ie=()=>e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-zinc-800 border-t-[var(--accent-color)]"})}),ce=()=>e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 text-gray-400",children:[e.jsx("div",{className:"text-lg mb-2",children:"No results found"}),e.jsx("div",{className:"text-sm",children:"Try a different search term"})]}),K=p=>f?ie():n?le?e.jsx("div",{className:"space-y-8",children:N.map(j=>oe(j,p))}):ce():e.jsx("div",{className:"flex flex-col items-center justify-center py-16 text-gray-400"});return Q?me.createPortal(e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`hidden [@media((hover:hover)_and_(pointer:fine)_and_(min-width:1024px))]:block fixed inset-0 z-[9998] bg-black/50 transition-opacity duration-200 ${Z?"opacity-100":"opacity-0"}`,onClick:s}),e.jsx("div",{className:`hidden [@media((hover:hover)_and_(pointer:fine)_and_(min-width:1024px))]:flex fixed top-0 left-0 right-0 xl:left-16 z-[9999] justify-center pointer-events-none ${d?"sidebar-open-right-offset":""}`,children:e.jsxs("div",{className:"w-[768px] max-h-[80vh] bg-zinc-900 rounded-b-xl shadow-2xl pointer-events-auto border-l border-r border-b border-zinc-800 flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"sticky top-0 bg-zinc-900 z-10 px-4 pt-4 pb-4 border-b border-zinc-800 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"text-lg font-semibold text-white",children:h}),e.jsx("button",{onClick:s,className:"px-3 py-1.5 text-white text-sm font-medium hover:bg-zinc-800 rounded-lg transition-colors",children:"Cancel"})]}),e.jsx(B,{ref:$,value:r,onChange:g,placeholder:"Search for artists, albums, songs...",showClearButton:r.trim().length>0,onClear:c})]}),e.jsxs("div",{className:"overflow-y-auto flex-1 px-4 pb-8",children:[_&&e.jsx("div",{className:"flex flex-wrap items-center gap-3 pt-3 pb-4 mb-4",children:X()}),K(!1)]})]})}),e.jsxs("div",{className:"fixed inset-0 bg-black z-[9999] flex flex-col p-0 m-0 [@media((hover:hover)_and_(pointer:fine)_and_(min-width:1024px))]:hidden",children:[e.jsx("div",{className:"fixed top-0 left-0 right-0 bg-black z-50 pointer-events-none",style:{height:"env(safe-area-inset-top)",top:"var(--header-offset, 0px)"}}),e.jsx("div",{className:"sticky top-0 left-0 right-0 bg-black z-10 pt-0 pb-0 w-full m-0",style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top))"},children:e.jsx("div",{className:"max-w-[768px] mx-auto w-full",children:e.jsxs("div",{className:"flex items-center gap-3 pl-2 pr-4 pt-4 pb-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(B,{ref:R,value:r,onChange:g,showClearButton:r.trim().length>0,onClear:c})}),e.jsx("button",{onClick:s,className:"px-4 py-2 text-white text-sm font-medium hover:text-zinc-300 transition-colors whitespace-nowrap flex-shrink-0",children:"Cancel"})]})})}),e.jsx("div",{className:"overflow-y-auto flex-1",children:e.jsxs("div",{className:"max-w-[768px] mx-auto w-full",children:[_&&e.jsx("div",{className:"bg-black pt-3 pb-4",children:e.jsx("div",{className:"flex flex-wrap items-center gap-3 pl-2 pr-4",children:X()})}),e.jsx("div",{className:"pb-32 pt-4",children:K(!0)})]})})]}),e.jsx(xe,{item:M,itemType:ae,isOpen:ee,onClose:()=>{J(!1),W(null),V(null)},zIndex:999999,mode:te,position:ne||void 0})]}),document.body):null}async function Me(t,s,h,r){var y,x,A,T,S;const g=await D.search(t,s,h),c=((y=g.Songs)==null?void 0:y.Items)||[],f=((x=g.Albums)==null?void 0:x.Items)||[],n=((A=g.Artists)==null?void 0:A.Items)||[],N=((T=g.Playlists)==null?void 0:T.Items)||[],l=P(t).toLowerCase().trim(),v=c.filter(d=>{var I,k,$;if(P(d.Name||"").toLowerCase().includes(l))return!0;const m=[];return d.AlbumArtist&&m.push(P(d.AlbumArtist)),(I=d.AlbumArtists)!=null&&I.length&&m.push(...d.AlbumArtists.map(R=>P(R.Name||"")).filter(Boolean)),(k=d.ArtistItems)!=null&&k.length&&m.push(...d.ArtistItems.map(R=>P(R.Name||"")).filter(Boolean)),!!(m.some(R=>R.toLowerCase().includes(l))||($=d.Genres)!=null&&$.some(R=>P(R).toLowerCase().includes(l)))});if(r&&r.length>0){const d=new Set(v.map(o=>o.Id));for(const o of r){if(d.has(o.Id))continue;const m=(S=o.ArtistItems)==null?void 0:S.some(k=>P(k.Name||"").toLowerCase().includes(l)),I=o.AlbumArtist&&P(o.AlbumArtist).toLowerCase().includes(l);(m||I)&&(v.push({Id:o.Id,Name:o.Name,AlbumArtist:o.AlbumArtist,ArtistItems:o.ArtistItems,Album:o.Album,AlbumId:o.AlbumId,IndexNumber:o.IndexNumber,ProductionYear:o.ProductionYear,RunTimeTicks:o.RunTimeTicks,Genres:o.Genres,Grouping:o.Grouping,Type:"Audio"}),d.add(o.Id))}}const u=n.filter(d=>P(d.Name||"").toLowerCase().includes(l)),w=f.filter(d=>{var I,k;const o=P(d.Name||""),m=P(d.AlbumArtist||((k=(I=d.ArtistItems)==null?void 0:I[0])==null?void 0:k.Name)||"");return o.toLowerCase().includes(l)||m.toLowerCase().includes(l)}),a=N.filter(d=>P(d.Name||"").toLowerCase().includes(l));return{artists:u,albums:w,playlists:a,songs:v}}async function Se(t,s){var b,l,v,u;const h={};(b=s==null?void 0:s.genres)!=null&&b.length&&(h.genres=s.genres),(l=s==null?void 0:s.years)!=null&&l.length&&(h.years=s.years),(v=s==null?void 0:s.tags)!=null&&v.length&&(h.tags=s.tags);const r=((u=s==null?void 0:s.tags)==null?void 0:u.length)||(s==null?void 0:s.hasGroupingFilters),[g,c,f,n]=await Promise.all([r?Promise.resolve({Items:[]}):D.getArtists({limit:t}),r?Promise.resolve({Items:[]}):D.getAlbums({limit:t,...h}),r?Promise.resolve({Items:[]}):D.getPlaylists({limit:t}),D.getSongs({limit:r?5e3:t,...h})]),N=(n.Items||[]).map(w=>({...w,Grouping:(w.Tags||[]).filter(a=>a.startsWith("grouping:")).map(a=>a.replace("grouping:",""))}));return{artists:g.Items||[],albums:c.Items||[],playlists:f.Items||[],songs:N}}export{Te as S,Se as f,Me as u};
