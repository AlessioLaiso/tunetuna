import{k as V,b as K,a as P,g as k,r as n,j as e,l as Q,P as U,C as A,e as C,f as Y,I as J}from"./index-DodxqSF6.js";import{A as X}from"./arrow-left-Dw5Sd11w.js";import{E as q}from"./ellipsis-CE8sHW8i.js";const E=45,G=45;function W({track:t,index:I,tracks:f,onClick:p,onContextMenu:d,contextMenuItemId:g}){var j,m;const o=g===t.Id,r=k(),s=n.useRef(!1),b=l=>{const x=Math.floor(l/1e7),w=Math.floor(x/60),N=x%60;return`${w}:${N.toString().padStart(2,"0")}`},v=l=>{l.preventDefault(),l.stopPropagation(),s.current=!0,d(t,"desktop",{x:l.clientX,y:l.clientY}),setTimeout(()=>{s.current=!1},300)},y=Y({onLongPress:l=>{l.preventDefault(),s.current=!0,d(t,"mobile")},onClick:()=>{if(s.current){s.current=!1;return}p(t,f)}});return e.jsxs("button",{onClick:()=>{if(s.current){s.current=!1;return}p(t,f)},onContextMenu:v,...y,className:`w-full flex items-center gap-3 hover:bg-white/10 transition-colors group px-4 py-3 ${o?"bg-white/10":""}`,children:[e.jsx("div",{className:"w-12 h-12 rounded-sm overflow-hidden flex-shrink-0 bg-zinc-900 self-center",children:e.jsx(J,{src:C.getAlbumArtUrl(t.AlbumId||t.Id,96),alt:t.Name,className:"w-full h-full object-cover",showOutline:!0,rounded:"rounded-sm"})}),e.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[e.jsx("div",{className:`text-sm font-medium truncate transition-colors ${(r==null?void 0:r.Id)===t.Id?"text-[var(--accent-color)]":"text-white group-hover:text-[var(--accent-color)]"}`,children:t.Name}),e.jsxs("div",{className:"text-xs text-gray-400 truncate",children:[t.AlbumArtist||((m=(j=t.ArtistItems)==null?void 0:j[0])==null?void 0:m.Name)||"Unknown Artist",t.Album&&` â€¢ ${t.Album}`]})]}),t.RunTimeTicks&&e.jsx("div",{className:"text-xs text-gray-500 flex-shrink-0 text-right",children:b(t.RunTimeTicks)})]})}function se(){const{id:t}=V(),I=K(),{playAlbum:f,playTrack:p,isPlaying:d}=P(),g=k(),[o,r]=n.useState(null),[s,b]=n.useState([]),[v,y]=n.useState(!0),[j,m]=n.useState(!1),[l,x]=n.useState(null),[w,N]=n.useState("mobile"),[L,O]=n.useState(null),[R,M]=n.useState(!1),[D,H]=n.useState("mobile"),[$,z]=n.useState(null),[B,T]=n.useState(E),_=P(i=>i.isQueueSidebarOpen);n.useEffect(()=>{if(!t)return;(async()=>{y(!0);try{const a=await C.getAlbumTracks(t);b(a);const u=(await C.getPlaylists({limit:1e3})).Items.find(h=>h.Id===t);u?r(u):a.length>0&&r({Id:t,Name:"Playlist",Type:"Playlist"})}catch(a){console.error("Failed to load playlist data:",a)}finally{y(!1)}})()},[t]),n.useEffect(()=>{T(E)},[s.length]),n.useEffect(()=>{const i=()=>{const a=window.scrollY||document.documentElement.scrollTop,c=window.innerHeight||document.documentElement.clientHeight,u=document.documentElement.scrollHeight;a+c*1.5>=u&&T(h=>Math.min(h+G,s.length))};return window.addEventListener("scroll",i,{passive:!0}),()=>window.removeEventListener("scroll",i)},[s.length]);const F=()=>{s.length>0&&f(s)},S=()=>!s.length||!g?!1:s.some(i=>i.Id===g.Id);return v?e.jsx("div",{className:"pb-20",children:e.jsx("div",{className:"flex items-center justify-center h-screen text-gray-400",children:e.jsx("p",{children:"Loading..."})})}):!o||s.length===0?e.jsx("div",{className:"pb-20",children:e.jsx("div",{className:"flex items-center justify-center h-screen text-gray-400",children:e.jsx("p",{children:"Playlist not found"})})}):e.jsxs("div",{className:"pb-20",children:[e.jsx("div",{className:`fixed top-0 left-0 right-0 bg-black z-10 lg:left-16 transition-[left,right] duration-300 ${_?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top))"},children:e.jsx("div",{className:"max-w-[768px] mx-auto",children:e.jsxs("div",{className:"flex items-center justify-between gap-4 px-4",style:{paddingTop:"calc(1rem + 8px)",paddingBottom:"1rem"},children:[e.jsx("button",{onClick:()=>I(-1),className:"text-white hover:text-zinc-300 transition-colors",children:e.jsx(X,{className:"w-6 h-6"})}),o&&e.jsx("button",{onClick:i=>{const a=i.currentTarget.getBoundingClientRect();H("desktop"),z({x:a.left+a.width/2,y:a.bottom+5}),M(!0)},className:"text-white hover:text-zinc-300 transition-colors",children:e.jsx(q,{className:"w-6 h-6"})})]})})}),e.jsxs("div",{className:"pt-20",children:[e.jsx("div",{className:"mb-6 px-4 pt-4",children:e.jsxs("div",{className:"w-full",children:[e.jsx("h2",{className:"text-4xl md:text-5xl font-bold mb-0.5 text-left break-words",children:o.Name}),e.jsxs("div",{className:"flex items-center justify-between gap-4 mt-2",children:[e.jsxs("div",{className:"text-gray-400",children:[s.length," ",s.length===1?"track":"tracks"]}),e.jsx("button",{onClick:S()&&d?()=>P.getState().pause():F,className:"bg-white/10 hover:bg-white/20 text-white font-semibold py-1.5 px-3 rounded-full transition-all hover:scale-105 flex items-center gap-1.5 backdrop-blur-sm border border-white/20 flex-shrink-0",children:S()&&d?e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"w-3.5 h-3.5"}),"Pause"]}):e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"w-3.5 h-3.5"}),"Play"]})})]})]})}),e.jsx("div",{children:e.jsx("div",{className:"space-y-0",children:s.slice(0,B).map((i,a)=>e.jsx(W,{track:i,index:a,tracks:s,onClick:c=>p(c,s),onContextMenu:(c,u,h)=>{x(c),N(u||"mobile"),O(h||null),m(!0)},contextMenuItemId:(l==null?void 0:l.Id)||null},i.Id))})})]}),e.jsx(A,{item:l,itemType:"song",isOpen:j,onClose:()=>{m(!1),x(null)},mode:w,position:L||void 0}),e.jsx(A,{item:o,itemType:"playlist",isOpen:R,onClose:()=>{M(!1)},mode:D,position:$||void 0})]})}export{se as default};
