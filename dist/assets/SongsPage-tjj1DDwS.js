import{r as s,u as d,a as S,b as Pe,e as B,l as D,j as t,k as Te,C as we}from"./index-Kr6dcGJx.js";import{S as Me}from"./SongItem-DGvsaq52.js";import{P as Oe}from"./Pagination-DZaGO66_.js";import{u as Ee,F as V}from"./useSearch-cZV-4Owm.js";import{S as Re}from"./search-D2ETlu7_.js";import{A as Fe}from"./arrow-up-down-WmZJIXCJ.js";const Le=[{type:"songs"},{type:"artists",limit:5},{type:"albums",limit:12},{type:"playlists"}],x=90,z=45,_e=45;function Ve(){const[u,j]=s.useState([]),H=d(e=>e.sortPreferences),U=d(e=>e.setSortPreference),b=d(e=>e.setLoading),A=d(e=>e.loading),W=d(e=>e.genres),q=S(e=>e.playTrack),J=S(e=>e.playAlbum),K=S(e=>e.addToQueue),y=S(e=>e.isQueueSidebarOpen),[l,i]=s.useState(!1),[X,I]=s.useState(!1),[Z,ee]=s.useState("mobile"),[te,se]=s.useState(null),[f,N]=s.useState(null),[ne,k]=s.useState(null),[g,P]=s.useState(0),[T,w]=s.useState(0),C=Pe(),[M,v]=s.useState(!1),[O,oe]=s.useState(null),[ae,E]=s.useState([]),a=H.songs,p=s.useRef(!0),[re,R]=s.useState(!1),F=s.useRef(a),[L,_]=s.useState(z),Q=s.useRef(null),G=s.useRef(null),{searchQuery:h,setSearchQuery:le,isSearching:ie,searchResults:o,selectedGenres:Y,setSelectedGenres:ce,yearRange:$,setYearRange:de,clearSearch:m,clearAll:ue}=Ee();s.useEffect(()=>{(async()=>{try{const n=d.getState();if(n.years.length>0)E(n.years);else{const r=await B.getYears();E(r)}}catch(n){D.error("Failed to load filter values:",n)}})()},[]),s.useEffect(()=>{if(l){const n=window.matchMedia("(hover: hover) and (pointer: fine) and (min-width: 1024px)").matches?G:Q;setTimeout(()=>{var r;if((r=n.current)==null||r.focus(),n.current){const c=n.current.value.length;n.current.setSelectionRange(c,c)}},50)}},[l]);const he=e=>{le(e),e.trim().length>0&&!l&&i(!0)},fe=()=>{m()},ge=()=>{i(!1),ue()},pe=e=>{oe(e),v(!0)},me=e=>{ce(e)},Se=e=>{de(e)},xe=e=>{C(`/artist/${e}`),i(!1),m()},ye=e=>{C(`/album/${e}`),i(!1),m()},Ce=e=>{q(e,[e])},ve=()=>{o!=null&&o.songs&&o.songs.length>0&&J(o.songs)},je=()=>{o!=null&&o.songs&&o.songs.length>0&&K(o.songs)},be=e=>{C(`/playlist/${e}`),i(!1),m()},Ae=(e,n,r="mobile",c)=>{N(e),k(n),ee(r),se(c||null),I(!0)};s.useEffect(()=>{h.trim()||P(0)},[a,h]),s.useEffect(()=>{_(z)},[g,u.length]),s.useEffect(()=>{const e=document.querySelector(".main-scrollable");if(!e)return;const n=()=>{const r=e.scrollTop,c=e.clientHeight,Ne=e.scrollHeight;r+c*1.5>=Ne&&_(ke=>Math.min(ke+_e,u.length))};return e.addEventListener("scroll",n,{passive:!0}),()=>e.removeEventListener("scroll",n)},[u.length,L]),s.useEffect(()=>{h.trim()||(!p.current&&F.current!==a&&R(!0),F.current=a,Ie())},[g,a,h]),s.useEffect(()=>{p.current&&(p.current=!1)},[]);const Ie=async()=>{b("songs",!0);try{const e={limit:x,startIndex:g*x};a==="RecentlyAdded"?(e.sortBy=["DateCreated"],e.sortOrder="Descending"):(e.sortBy=["SortName"],e.sortOrder="Ascending");const n=await B.getSongs(e);j(n.Items),w(n.TotalRecordCount||0)}catch(e){D.error("Failed to load songs:",e),j([]),w(0)}finally{b("songs",!1),R(!1)}};return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"pb-20",children:[t.jsx("div",{className:`fixed top-0 left-0 right-0 bg-black z-10 lg:left-16 transition-[left,right] duration-300 ${y?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top))"},children:t.jsx("div",{className:"max-w-[768px] mx-auto",children:t.jsxs("div",{className:"p-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsx("h1",{className:"text-2xl font-bold text-white",children:"Songs"}),t.jsx("button",{onClick:()=>i(!0),className:"w-10 h-10 flex items-center justify-center text-white hover:bg-zinc-800 rounded-full transition-colors","aria-label":"Search",children:t.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})]}),!l&&t.jsxs("div",{className:"flex items-center justify-between gap-2",children:[t.jsxs("button",{onClick:()=>U("songs",a==="RecentlyAdded"?"Alphabetical":"RecentlyAdded"),className:"text-sm text-gray-400 hover:text-white transition-colors flex items-center gap-1",children:[a==="RecentlyAdded"?"Recently Added":"Alphabetically",t.jsx(Fe,{className:"w-4 h-4"})]}),A.songs&&!p.current&&t.jsx("div",{className:"flex items-center",children:t.jsx(Te,{})})]})]})})}),t.jsx("div",{className:`fixed left-0 right-0 z-10 lg:left-16 transition-[left,right] duration-300 ${y?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 7rem - 8px)",height:"24px",background:"linear-gradient(to bottom, rgba(0, 0, 0, 0.8), transparent)"}}),t.jsx("div",{style:{paddingTop:"calc(env(safe-area-inset-top) + 7rem)"},children:t.jsx("div",{className:`${re?"opacity-50 pointer-events-none":""} ${l?"hidden [@media((hover:hover)_and_(pointer:fine)_and_(min-width:1024px))]:block":""}`,children:u.length===0&&!A.songs?t.jsx("div",{className:"flex items-center justify-center py-16 text-gray-400",children:t.jsx("p",{children:"No songs found"})}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"space-y-0",children:u.map((e,n)=>t.jsx(Me,{song:e,showImage:n<L,onContextMenu:Ae,contextMenuItemId:(f==null?void 0:f.Id)||null},e.Id))}),t.jsx(Oe,{currentPage:g,totalPages:Math.ceil(T/x),onPageChange:P,itemsPerPage:x,totalItems:T})]})})})]}),t.jsx(Re,{isOpen:l,onClose:ge,searchQuery:h,onSearchChange:he,onClearSearch:fe,isLoading:ie,results:o,sections:Le,filterConfig:{showGenreFilter:!0,showYearFilter:!0},filterState:{selectedGenres:Y,yearRange:$},onOpenFilterSheet:pe,onArtistClick:xe,onAlbumClick:ye,onSongClick:Ce,onPlaylistClick:be,onPlayAllSongs:ve,onAddSongsToQueue:je,isQueueSidebarOpen:y,desktopSearchInputRef:G,mobileSearchInputRef:Q}),O==="genre"&&t.jsx(V,{isOpen:M,onClose:()=>v(!1),filterType:"genre",genres:W,selectedValues:Y,onApply:me}),O==="year"&&t.jsx(V,{isOpen:M,onClose:()=>v(!1),filterType:"year",availableYears:ae,yearRange:$,onApplyYear:Se}),t.jsx(we,{item:f,itemType:ne,isOpen:X,onClose:()=>{I(!1),N(null),k(null)},zIndex:99999,mode:Z,position:te||void 0})]})}export{Ve as default};
