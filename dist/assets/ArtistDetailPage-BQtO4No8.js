import{K as Se,b as Ce,a as Z,i as re,r as l,j as e,w as Pe,I as E,e as b,Q as ke,S as De,a5 as Me,H as Ee,L as Te,C as ee,l as Oe,f as le,D as ze,R as Le}from"./index-Def-zOqH.js";import{u as te}from"./useScrollLazyLoad-DmodI_VF.js";import{A as Be}from"./arrow-left-7VMywoCX.js";import{E as Re}from"./ellipsis-CqmsnN94.js";import{C as Fe}from"./chevron-up-3dl01qHu.js";import{A as Ye}from"./arrow-up-down-CUJ3dVTa.js";const se=45,_e=45,ne=45,Ue=45;function He({album:n,year:h,onNavigate:w,onContextMenu:A,showImage:I=!0}){const[C,P]=l.useState(!1),v=l.useRef(!1),m=o=>{if(v.current){o.preventDefault(),o.stopPropagation(),v.current=!1;return}w(n.Id)},s=o=>{o.preventDefault(),o.stopPropagation(),v.current=!0,A(n,"desktop",{x:o.clientX,y:o.clientY}),setTimeout(()=>{v.current=!1},100)},N=le({onLongPress:o=>{o.preventDefault(),v.current=!0,A(n,"mobile")},onClick:m});return e.jsxs("button",{onClick:m,onContextMenu:s,...N,className:"text-left group",children:[e.jsx("div",{className:"aspect-square rounded overflow-hidden mb-2 bg-zinc-900 flex items-center justify-center",children:C?e.jsx(ze,{className:"w-12 h-12 text-gray-500"}):I?e.jsx(E,{src:b.getAlbumArtUrl(n.Id,474),alt:n.Name,className:"w-full h-full object-cover",showOutline:!0,rounded:"rounded",onError:()=>P(!0)}):e.jsx("div",{className:"w-full h-full bg-zinc-900"})}),e.jsx("div",{className:"text-sm font-medium text-white truncate group-hover:text-[var(--accent-color)] transition-colors",children:n.Name}),h&&e.jsx("div",{className:"text-xs text-gray-400 truncate",children:h})]})}function Ve({song:n,album:h,year:w,onClick:A,onContextMenu:I,contextMenuItemId:C,showImage:P=!0}){const v=C===n.Id,m=re(),s=le({onLongPress:N=>{N.preventDefault(),I(n,"mobile")},onClick:()=>A(n)});return e.jsxs("button",{onClick:()=>A(n),onContextMenu:N=>{N.preventDefault(),I(n,"desktop",{x:N.clientX,y:N.clientY})},...s,className:`w-full flex items-center gap-3 hover:bg-white/10 transition-colors group px-4 py-3 ${v?"bg-white/10":""}`,children:[e.jsx("div",{className:"w-12 h-12 rounded-sm overflow-hidden flex-shrink-0 bg-zinc-900 self-center flex items-center justify-center",children:P?e.jsx(E,{src:b.getAlbumArtUrl(n.AlbumId||n.Id,96),alt:n.Name,className:"w-full h-full object-cover",showOutline:!0,rounded:"rounded-sm"}):e.jsx("div",{className:"w-full h-full bg-zinc-900"})}),e.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[e.jsx("div",{className:`text-sm font-medium truncate transition-colors ${(m==null?void 0:m.Id)===n.Id?"text-[var(--accent-color)]":"text-white group-hover:text-[var(--accent-color)]"}`,children:n.Name}),(h||w)&&e.jsxs("div",{className:"text-xs text-gray-400 flex items-center gap-1 min-w-0",children:[h&&e.jsx("span",{className:"truncate",children:h}),h&&w&&e.jsx("span",{className:"flex-shrink-0",children:"•"}),w&&e.jsx("span",{className:"flex-shrink-0",children:w})]})]}),n.RunTimeTicks&&e.jsx("div",{className:"text-xs text-gray-500 flex-shrink-0 text-right",children:Le(n.RunTimeTicks)})]})}function Ze(){var W;const{id:n}=Se(),h=Ce(),{playAlbum:w,playTrack:A,isPlaying:I,pause:C,addToQueue:P,shuffleArtist:v}=Z(),m=re(),[s,N]=l.useState(null),[o,ae]=l.useState([]),[y,ie]=l.useState([]),[oe,T]=l.useState(!0),[Y,O]=l.useState(!1),[$e,k]=l.useState(!0),[S,z]=l.useState(!0),[ce,L]=l.useState(!1),[ue,_]=l.useState("mobile"),[de,U]=l.useState(null),[D,B]=l.useState(null),[me,R]=l.useState(null),[xe,H]=l.useState(!1),[fe,he]=l.useState("mobile"),[pe,ge]=l.useState(null),[M,be]=l.useState("Alphabetical"),[V,$]=l.useState(se),[q,Q]=l.useState(ne),G=l.useRef(null),ve=Z(t=>t.isQueueSidebarOpen);l.useEffect(()=>{const t=document.querySelector(".main-scrollable");t&&t.scrollTo({top:0,behavior:"auto"})},[n]);const J=t=>t.toLowerCase().replace(/[_\*\-\.]/g,"").trim();l.useEffect(()=>{if(!n)return;let t=!0;return(async()=>{var r;T(!0);try{let c=await b.getArtistById(n);if(!c){const f=(await b.getArtists({limit:1e3})).Items.find(d=>d.Id===n);f&&(c=f)}if(!t)return;if(!c){T(!1);return}N(c),z(!0);const u=await b.getArtistItems(n);if(!t)return;if(u.albums.length===0&&u.songs.length===0&&c.Name){const x=J(c.Name),d=((r=(await b.search(c.Name,50)).Artists)==null?void 0:r.Items)||[];for(const p of d){if(!t)return;if(p.Id!==n&&J(p.Name)===x){const F=await b.getArtistItems(p.Id);if(F.albums.length>0||F.songs.length>0){h(`/artist/${p.Id}`,{replace:!0});return}}}}if(!t)return;const g=[...u.albums].sort((x,f)=>{const d=x.ProductionYear||(x.PremiereDate?new Date(x.PremiereDate).getFullYear():0);return(f.ProductionYear||(f.PremiereDate?new Date(f.PremiereDate).getFullYear():0))-d});ae(g),ie(u.songs)}catch(i){if(!t)return;Oe.error("Failed to load artist data:",i)}finally{t&&T(!1)}})(),()=>{t=!1}},[n,h]),l.useEffect(()=>{if(!(s!=null&&s.Overview))return;k(!0);let t=null,a=null,r=null,i=!1;const c=()=>{const x=G.current;if(!x||!(s!=null&&s.Overview)){k(!1);return}const f=window.getComputedStyle(x);let d=parseFloat(f.lineHeight||"0");if((!Number.isFinite(d)||d===0)&&(d=parseFloat(f.fontSize||"16")*1.5),d===0){k(!1);return}const p=x.scrollHeight;if(p===0&&!i){i=!0,u();return}const ye=Math.round(p/d)>2;k(ye)},u=()=>{t!==null&&cancelAnimationFrame(t),a!==null&&clearTimeout(a),t=requestAnimationFrame(()=>{a=window.setTimeout(c,0)}),r!==null&&clearTimeout(r),r=window.setTimeout(()=>{i=!1,c()},300)},g=()=>{i=!1,u()};return u(),window.addEventListener("resize",g),()=>{t!==null&&cancelAnimationFrame(t),a!==null&&clearTimeout(a),r!==null&&clearTimeout(r),window.removeEventListener("resize",g)}},[s==null?void 0:s.Overview]),l.useEffect(()=>{$(se)},[o.length]),l.useEffect(()=>{Q(ne)},[y.length]),te({totalCount:y.length,visibleCount:q,increment:Ue,setVisibleCount:Q,threshold:1}),te({totalCount:o.length,visibleCount:V,increment:_e,setVisibleCount:$,threshold:1});const Ne=()=>{j.length>0&&v(j)},X=t=>t.ProductionYear?t.ProductionYear.toString():t.PremiereDate?new Date(t.PremiereDate).getFullYear().toString():null,je=t=>{const a=t.Album||null;let r=null;if(t.AlbumId){const i=o.find(c=>c.Id===t.AlbumId);i&&(r=X(i))}return{album:a,year:r}},K=t=>{if(t.AlbumId){const a=o.find(r=>r.Id===t.AlbumId);if(a)return a.ProductionYear||(a.PremiereDate?new Date(a.PremiereDate).getFullYear():0)}return t.ProductionYear||(t.PremiereDate?new Date(t.PremiereDate).getFullYear():0)},j=l.useMemo(()=>{if(M==="Alphabetical")return[...y].sort((r,i)=>{const c=r.Name||"",u=i.Name||"";return c.localeCompare(u)});const t=(r,i,c)=>{const u=K(r),g=K(i),x=r.AlbumId||"",f=i.AlbumId||"";if(u!==g)return c?g-u:u-g;if(x!==f)return x.localeCompare(f);const d=r.IndexNumber||0,p=i.IndexNumber||0;return d!==p?d-p:(r.Name||"").localeCompare(i.Name||"")},a=M==="Newest";return[...y].sort((r,i)=>t(r,i,a))},[y,M,o]),we=t=>{t.preventDefault(),t.stopPropagation(),j.length>0&&w(j)},Ae=t=>{t.preventDefault(),t.stopPropagation(),j.length>0&&P(j)},Ie=()=>{be(t=>t==="Alphabetical"?"Newest":t==="Newest"?"Oldest":"Alphabetical")};return oe?e.jsx("div",{className:"pb-20",children:e.jsx("div",{className:"flex items-center justify-center h-screen text-gray-400",children:e.jsx(Pe,{})})}):s?e.jsxs("div",{className:"pb-20",children:[e.jsx("div",{className:`fixed top-0 left-0 right-0 z-[60] lg:left-16 transition-[left,right] duration-300 ${ve?"sidebar-open-right-offset":""}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top))"},children:e.jsx("div",{className:"max-w-[768px] mx-auto",children:e.jsxs("div",{className:"relative flex items-center justify-between gap-4 py-4 pl-3 pr-4",children:[e.jsx("button",{onClick:()=>h(-1),className:"text-white hover:text-zinc-300 transition-colors z-10",children:e.jsx(Be,{className:"w-6 h-6"})}),s&&e.jsx("button",{onClick:t=>{const a=t.currentTarget.getBoundingClientRect();he("desktop"),ge({x:a.left+a.width/2,y:a.bottom+5}),H(!0)},className:"text-white hover:text-zinc-300 transition-colors z-10",children:e.jsx(Re,{className:"w-6 h-6"})})]})})}),e.jsxs("div",{className:"relative z-30 w-screen",style:{marginTop:"calc(-1 * env(safe-area-inset-top))",marginLeft:"calc(50% - 50vw)",marginRight:"calc(50% - 50vw)"},children:[S&&e.jsxs("div",{className:"relative w-full min-h-64 md:min-h-80 bg-black",style:{paddingTop:"env(safe-area-inset-top)"},children:[e.jsx("div",{className:"w-full flex items-center justify-center md:hidden",children:e.jsx(E,{src:b.getArtistImageUrl(s.Id),alt:s.Name,className:"w-full h-auto object-contain",onError:()=>z(!1)})}),e.jsx("div",{className:"hidden md:block w-full h-80",children:e.jsx("img",{src:b.getArtistBackdropUrl(s.Id,1920),alt:s.Name,className:"w-full h-full object-cover object-[center_20%]",onError:()=>z(!1)})}),e.jsx("div",{className:"absolute inset-x-0 top-0 bottom-[-1px] bg-gradient-to-b from-transparent via-black/60 to-black pointer-events-none"})]}),e.jsx("div",{className:`left-0 right-0 ${S?"absolute":"relative"} ${S?"pt-16":"pt-12"}`,style:S?{bottom:"-28px",paddingBottom:"1.5rem"}:{},children:e.jsxs("div",{className:"max-w-[768px] mx-auto px-4 flex items-end gap-6 md:grid md:grid-cols-3 md:gap-4",children:[S&&e.jsx("div",{className:"hidden md:block md:col-span-1",children:e.jsx("div",{className:"aspect-square rounded overflow-hidden bg-zinc-900 flex items-center justify-center",children:e.jsx(E,{src:b.getArtistImageUrl(s.Id),alt:s.Name,className:"w-full h-full object-cover",showOutline:!0,rounded:"rounded"})})}),e.jsx("div",{className:`flex-1 min-w-0 pb-2 ${S?"md:col-span-2":"md:col-span-3"}`,children:e.jsxs("div",{className:"mb-4 mt-4",children:[e.jsx("h1",{className:"text-4xl md:text-5xl font-bold text-white mb-2 break-words",children:s.Name}),e.jsxs("div",{className:"flex items-center justify-between gap-4 mt-2",children:[e.jsxs("p",{className:"text-sm text-gray-300",children:[o.length," ",o.length===1?"album":"albums"," • ",j.length," ",j.length===1?"song":"songs"]}),e.jsx("button",{onClick:()=>{var a;m&&I&&(((a=m.ArtistItems)==null?void 0:a.some(r=>r.Id===n))||m.AlbumArtist===(s==null?void 0:s.Name))?C():Ne()},className:"bg-white/10 hover:bg-white/20 text-white font-semibold py-1.5 px-3 rounded-full transition-all hover:scale-105 flex items-center gap-1.5 backdrop-blur-sm border border-white/20 flex-shrink-0",children:m&&I&&((W=m.ArtistItems)!=null&&W.some(t=>t.Id===n)||m.AlbumArtist===(s==null?void 0:s.Name))?e.jsxs(e.Fragment,{children:[e.jsx(ke,{className:"w-3.5 h-3.5"}),"Pause"]}):e.jsxs(e.Fragment,{children:[e.jsx(De,{className:"w-3.5 h-3.5"}),"Shuffle"]})})]})]})})]})})]}),e.jsxs("div",{className:"pt-3 md:pt-7",children:[s.Overview&&e.jsx("div",{className:"mb-6 -mt-4 px-4",children:e.jsxs("div",{className:"text-white relative",children:[e.jsx("p",{ref:G,className:"text-sm text-gray-300 leading-relaxed absolute opacity-0 pointer-events-none -z-10",children:s.Overview}),!Y&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>O(!0),className:"flex-1 text-left min-w-0",children:e.jsx("p",{className:"text-sm text-gray-300 leading-relaxed line-clamp-2",children:s.Overview})}),e.jsx("button",{onClick:()=>O(!0),className:"flex-shrink-0 text-gray-400 hover:text-white transition-colors",children:e.jsx(Me,{className:"w-4 h-4"})})]}),Y&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-300 leading-relaxed whitespace-pre-line",children:s.Overview}),e.jsxs("button",{onClick:()=>O(!1),className:"mt-2 flex items-center gap-1 text-sm text-gray-400 hover:text-white transition-colors ml-auto",children:["Show less",e.jsx(Fe,{className:"w-4 h-4"})]})]})]})}),o.length>0&&e.jsxs("div",{className:"mb-10 px-4",children:[e.jsxs("h2",{className:"text-2xl font-bold text-white mb-4",children:["Albums (",o.length,")"]}),e.jsx("div",{className:"grid grid-cols-3 md:grid-cols-4 gap-4",children:o.map((t,a)=>{const r=X(t);return e.jsx(He,{album:t,year:r,onNavigate:i=>h(`/album/${i}`),onContextMenu:(i,c,u)=>{B(i),R("album"),_(c||"mobile"),U(u||null),L(!0)},showImage:a<V},t.Id)})})]}),y.length>0&&e.jsxs("div",{id:"songs-section",children:[e.jsxs("div",{className:"px-4 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h2",{className:"text-2xl font-bold text-white",children:["Songs (",y.length,")"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:we,className:"w-10 h-10 flex items-center justify-center text-white hover:bg-white/10 rounded-full transition-colors","aria-label":"Play all songs",children:e.jsx(Ee,{className:"w-5 h-5"})}),e.jsx("button",{type:"button",onClick:Ae,className:"w-10 h-10 flex items-center justify-center text-white hover:bg-white/10 rounded-full transition-colors","aria-label":"Add all songs to queue",children:e.jsx(Te,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"mt-1",children:e.jsxs("button",{type:"button",onClick:Ie,className:"text-sm text-gray-400 hover:text-white transition-colors flex items-center gap-1",children:[M,e.jsx(Ye,{className:"w-4 h-4"})]})})]}),e.jsx("div",{className:"space-y-0",children:j.map((t,a)=>{const{album:r,year:i}=je(t);return e.jsx(Ve,{song:t,album:r,year:i,onClick:A,onContextMenu:(c,u,g)=>{B(c),R("song"),_(u||"mobile"),U(g||null),L(!0)},contextMenuItemId:(D==null?void 0:D.Id)||null,showImage:a<q},t.Id)})})]})]}),e.jsx(ee,{item:D,itemType:me,isOpen:ce,onClose:()=>{L(!1),B(null),R(null)},zIndex:99999,mode:ue,position:de||void 0}),e.jsx(ee,{item:s,itemType:"artist",isOpen:xe,onClose:()=>{H(!1)},mode:fe,position:pe||void 0})]}):e.jsx("div",{className:"pb-20",children:e.jsx("div",{className:"flex items-center justify-center h-screen text-gray-400",children:e.jsx("p",{children:"Artist not found on the Jellyfin server"})})})}export{Ze as default};
