import{b as Z,r as t,f as be,j as e,U as J,e as H,C as q,u as je,a as W,k as Ae,l as Ie}from"./index-Kr6dcGJx.js";import{g as we,a as Ne,S as Te}from"./search-D2ETlu7_.js";import{P as ke}from"./Pagination-DZaGO66_.js";import{u as Pe,F as Me}from"./useSearch-cZV-4Owm.js";import{A as Ee}from"./arrow-up-down-WmZJIXCJ.js";function Oe({artist:n,onContextMenu:p,contextMenuItemId:E}){var b,k;const O=Z(),[I,w]=t.useState(!1),[N,v]=t.useState(!1),[R,T]=t.useState("mobile"),[o,d]=t.useState(null),f=t.useRef(!1),[y,C]=t.useState(null),F=E===n.Id;t.useEffect(()=>{var m;if((m=n.ImageTags)!=null&&m.Primary){C(null);return}const r=we(n.Id);if(r!==void 0){C(r);return}let a=!1;return Ne(n.Id).then(h=>{a||C(h)}),()=>{a=!0}},[n.Id,n.ImageTags]);const L=r=>{if(f.current){r.preventDefault(),f.current=!1;return}O(`/artist/${n.Id}`)},D=be({onLongPress:r=>{r.preventDefault(),p?(f.current=!0,p(n,"artist","mobile")):(f.current=!0,T("mobile"),d(null),v(!0))}}),x=r=>{var a,m,h,j;r.preventDefault(),r.stopPropagation(),(m=(a=r.nativeEvent)==null?void 0:a.preventDefault)==null||m.call(a),(j=(h=r.nativeEvent)==null?void 0:h.stopImmediatePropagation)==null||j.call(h),f.current=!0,p?p(n,"artist","desktop",{x:r.clientX,y:r.clientY}):(T("desktop"),d({x:r.clientX,y:r.clientY}),v(!0)),setTimeout(()=>{f.current=!1},300)};return e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:r=>{if(N||f.current){r.preventDefault(),r.stopPropagation();return}L(r)},onContextMenu:x,...D,className:`w-full flex items-center gap-4 hover:bg-white/10 transition-colors group px-4 h-[72px] ${F?"bg-white/10":""}`,children:[e.jsx("div",{className:"w-12 h-12 rounded-full overflow-hidden flex-shrink-0 bg-zinc-900 flex items-center justify-center",children:I?e.jsx(J,{className:"w-6 h-6 text-gray-500"}):(b=n.ImageTags)!=null&&b.Primary||y?e.jsx("img",{src:(k=n.ImageTags)!=null&&k.Primary?H.getArtistImageUrl(n.Id,96):y||"",alt:n.Name,className:"w-full h-full object-cover",onError:()=>w(!0),loading:"lazy"}):e.jsx(J,{className:"w-6 h-6 text-gray-500"})}),e.jsx("div",{className:"flex-1 min-w-0 text-left",children:e.jsx("div",{className:"text-base font-medium text-white truncate group-hover:text-[var(--accent-color)] transition-colors",children:n.Name})})]}),e.jsx(q,{item:n,itemType:"artist",isOpen:N,onClose:()=>v(!1),zIndex:99999,mode:R,position:o||void 0})]})}const Re=[{type:"artists"},{type:"albums",limit:12},{type:"playlists"},{type:"songs"}],S=90,K=45,Fe=45;function Qe(){const{artists:n,setArtists:p,sortPreferences:E,setSortPreference:O,setLoading:I,loading:w,genres:N}=je(),{playTrack:v,playAlbum:R,addToQueue:T}=W(),[o,d]=t.useState(!1),[f,y]=t.useState(!1),[C,F]=t.useState("mobile"),[L,D]=t.useState(null),[x,b]=t.useState(null),[k,r]=t.useState(null),[a,m]=t.useState(0),[h,j]=t.useState(0),[ee,Q]=t.useState(K),_=Z(),B=t.useRef(null),U=t.useRef(null),[te,G]=t.useState(!1),[se,ne]=t.useState(null),g=E.artists,P=t.useRef(!0),[re,Y]=t.useState(!1),V=t.useRef(g),$=W(s=>s.isQueueSidebarOpen),{searchQuery:A,setSearchQuery:le,isSearching:ae,searchResults:i,selectedGenres:X,setSelectedGenres:oe,clearSearch:M,clearAll:ie}=Pe({includeYearFilter:!1});t.useEffect(()=>{if(o){const c=window.matchMedia("(hover: hover) and (pointer: fine) and (min-width: 1024px)").matches?U:B;setTimeout(()=>{var l;if((l=c.current)==null||l.focus(),c.current){const u=c.current.value.length;c.current.setSelectionRange(u,u)}},50)}},[o]);const ce=s=>{le(s),s.trim().length>0&&!o&&d(!0)},ue=()=>{M()},de=()=>{d(!1),ie()},fe=s=>{s==="genre"&&(ne("genre"),G(!0))},he=s=>{oe(s)},me=s=>{_(`/artist/${s}`),d(!1),M()},ge=s=>{_(`/album/${s}`),d(!1),M()},pe=s=>{v(s,[s])},xe=()=>{i!=null&&i.songs&&i.songs.length>0&&R(i.songs)},Se=()=>{i!=null&&i.songs&&i.songs.length>0&&T(i.songs)},ve=s=>{_(`/playlist/${s}`),d(!1),M()},ye=(s,c,l="mobile",u)=>{b(s),r(c),F(l),D(u||null),y(!0)},Ce=async()=>{var c;const s=Date.now();I("artists",!0);try{const l={limit:S,startIndex:a*S};g==="RecentlyAdded"?(l.sortBy=["DateCreated"],l.sortOrder="Descending"):(l.sortBy=["SortName"],l.sortOrder="Ascending");let u=await H.getArtists(l);(((c=u.Items)==null?void 0:c.length)||0)===0&&(u=await H.getArtists({limit:S,startIndex:a*S}));const z=u.Items||[];j(u.TotalRecordCount||0);const Le=Date.now()-s;p(z)}catch(l){Ie.error("Failed to load artists:",l),p([]),j(0)}finally{I("artists",!1),Y(!1)}};return t.useEffect(()=>{!A.trim()&&!o&&m(0)},[g,A,o]),t.useEffect(()=>{Q(K)},[a,n.length]),t.useEffect(()=>{const s=()=>{const c=window.scrollY||document.documentElement.scrollTop,l=window.innerHeight||document.documentElement.clientHeight,u=document.documentElement.scrollHeight;c+l*1.5>=u&&Q(z=>Math.min(z+Fe,n.length))};return window.addEventListener("scroll",s,{passive:!0}),()=>window.removeEventListener("scroll",s)},[n.length]),t.useEffect(()=>{!A.trim()&&!o&&(!P.current&&V.current!==g&&Y(!0),V.current=g,Ce())},[a,g,A,o]),t.useEffect(()=>{P.current&&(P.current=!1)},[]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"pb-20",children:[e.jsx("div",{className:`fixed top-0 left-0 right-0 bg-black z-10 lg:left-16 transition-[left,right] duration-300 ${$?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top))"},children:e.jsx("div",{className:"max-w-[768px] mx-auto",children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Artists"}),e.jsx("button",{onClick:()=>d(!0),className:"w-10 h-10 flex items-center justify-center text-white hover:bg-zinc-800 rounded-full transition-colors","aria-label":"Search",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})]}),!o&&e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("button",{onClick:()=>O("artists",g==="RecentlyAdded"?"Alphabetical":"RecentlyAdded"),className:"text-sm text-gray-400 hover:text-white transition-colors flex items-center gap-1",children:[g==="RecentlyAdded"?"Recently Added":"Alphabetically",e.jsx(Ee,{className:"w-4 h-4"})]}),w.artists&&!P.current&&e.jsx("div",{className:"flex items-center",children:e.jsx(Ae,{})})]})]})})}),e.jsx("div",{className:`fixed left-0 right-0 z-10 lg:left-16 transition-[left,right] duration-300 ${$?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 7rem - 8px)",height:"24px",background:"linear-gradient(to bottom, rgba(0, 0, 0, 0.8), transparent)"}}),e.jsx("div",{style:{paddingTop:"calc(env(safe-area-inset-top) + 7rem)"},children:e.jsxs("div",{className:`${re?"opacity-50 pointer-events-none":""} ${o?"hidden [@media((hover:hover)_and_(pointer:fine)_and_(min-width:1024px))]:block":""}`,children:[n.length===0&&!w.artists&&e.jsx("div",{className:"flex items-center justify-center py-8 text-gray-400",children:e.jsx("p",{children:"No artists found"})}),n.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-0",children:n.slice(0,ee).map(s=>e.jsx(Oe,{artist:s,onContextMenu:ye,contextMenuItemId:(x==null?void 0:x.Id)||null},s.Id))}),e.jsx(ke,{currentPage:a,totalPages:Math.ceil(h/S),onPageChange:m,itemsPerPage:S,totalItems:h})]})]})})]}),e.jsx(Te,{isOpen:o,onClose:de,searchQuery:A,onSearchChange:ce,onClearSearch:ue,isLoading:ae,results:i,sections:Re,filterConfig:{showGenreFilter:!0,showYearFilter:!1},filterState:{selectedGenres:X,yearRange:{min:null,max:null}},onOpenFilterSheet:fe,onArtistClick:me,onAlbumClick:ge,onSongClick:pe,onPlaylistClick:ve,onPlayAllSongs:xe,onAddSongsToQueue:Se,isQueueSidebarOpen:$,desktopSearchInputRef:U,mobileSearchInputRef:B}),se==="genre"&&e.jsx(Me,{isOpen:te,onClose:()=>G(!1),filterType:"genre",genres:N,selectedValues:X,onApply:he}),e.jsx(q,{item:x,itemType:k,isOpen:f,onClose:()=>{y(!1),b(null),r(null)},zIndex:99999,mode:C,position:L||void 0})]})}export{Qe as default};
