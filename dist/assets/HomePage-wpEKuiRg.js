import{c as Me,r as n,u as L,a as H,b as ie,j as e,d as Pe,S as Te,G as Ee,e as T,P as Oe,L as Re,C as B,f as G,U as le,D as W,g as ce,I as ue}from"./index-scgXBtC7.js";import{u as $e,f as ze,S as re}from"./search-Ei8VsrFv.js";import{F as ae}from"./FilterBottomSheet-CShdrEBf.js";import{C as Fe}from"./calendar-DhXdNtGO.js";/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Le=Me("settings",De),X=new Map;function Ge({artist:t,onClick:m,onContextMenu:c,contextMenuItemId:f}){var v,A;const[a,r]=n.useState(!1),l=n.useRef(!1),w=f===t.Id,[b,o]=n.useState(null);n.useEffect(()=>{var I;if((I=t.ImageTags)!=null&&I.Primary){o(null);return}const j=X.get(t.Id);if(j!==void 0){o(j);return}let d=!1;return(async()=>{try{const{albums:h,songs:u}=await T.getArtistItems(t.Id),C=h[0],P=u.find(z=>z.AlbumId)||u[0],g=C||P,R=g?g.AlbumId||g.Id:null,$=R?T.getAlbumArtUrl(R,96):null;X.set(t.Id,$),d||o($)}catch(h){console.error("Failed to load fallback album art for artist (home search):",t.Id,h),X.set(t.Id,null)}})(),()=>{d=!0}},[t.Id,t.ImageTags]);const N=j=>{if(w||l.current){j.preventDefault(),j.stopPropagation(),l.current=!1;return}m(t.Id)},i=j=>{j.preventDefault(),j.stopPropagation(),l.current=!0,c(t,"artist","desktop",{x:j.clientX,y:j.clientY}),setTimeout(()=>{l.current=!1},300)},y=G({onLongPress:j=>{j.preventDefault(),l.current=!0,c(t,"artist","mobile")},onClick:()=>{if(l.current){l.current=!1;return}N({})}});return e.jsxs("button",{onClick:()=>{if(l.current){l.current=!1;return}N({})},onContextMenu:i,...y,className:`w-full flex items-center gap-4 hover:bg-white/10 transition-colors text-left px-4 h-[72px] ${w?"bg-white/10":""}`,children:[e.jsx("div",{className:"w-12 h-12 rounded-full overflow-hidden flex-shrink-0 bg-zinc-900 flex items-center justify-center",children:a?e.jsx(le,{className:"w-6 h-6 text-gray-500"}):(v=t.ImageTags)!=null&&v.Primary||b?e.jsx("img",{src:(A=t.ImageTags)!=null&&A.Primary?T.getArtistImageUrl(t.Id,96):b||"",alt:t.Name,className:"w-full h-full object-cover",onError:()=>r(!0),loading:"lazy"}):e.jsx(le,{className:"w-6 h-6 text-gray-500"})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("div",{className:"text-base font-medium text-white truncate group-hover:text-[var(--accent-color)] transition-colors",children:t.Name})})]})}function Ye({album:t,onClick:m,onContextMenu:c,contextMenuItemId:f}){var i,y;const[a,r]=n.useState(!1),l=n.useRef(!1),w=f===t.Id,b=v=>{if(w||l.current){v.preventDefault(),v.stopPropagation(),l.current=!1;return}m(t.Id)},o=v=>{v.preventDefault(),v.stopPropagation(),l.current=!0,c(t,"album","desktop",{x:v.clientX,y:v.clientY}),setTimeout(()=>{l.current=!1},300)},N=G({onLongPress:v=>{v.preventDefault(),l.current=!0,c(t,"album","mobile")},onClick:()=>{if(l.current){l.current=!1;return}b({})}});return e.jsxs("button",{onClick:()=>{if(l.current){l.current=!1;return}b({})},onContextMenu:o,...N,className:"text-left group",children:[e.jsx("div",{className:"aspect-square rounded overflow-hidden mb-3 bg-zinc-900 shadow-lg relative flex items-center justify-center",children:a?e.jsx(W,{className:"w-12 h-12 text-gray-500"}):e.jsxs(e.Fragment,{children:[e.jsx("img",{src:T.getAlbumArtUrl(t.Id,474),alt:t.Name,className:"w-full h-full object-cover",onError:()=>r(!0)}),e.jsx("div",{className:"absolute inset-0 pointer-events-none border border-white rounded",style:{borderColor:"rgba(255, 255, 255, 0.03)",borderWidth:"1px"}})]})}),e.jsx("div",{className:"text-sm font-semibold text-white truncate mb-1",children:t.Name}),e.jsx("div",{className:"text-xs text-gray-400 truncate",children:t.AlbumArtist||((y=(i=t.ArtistItems)==null?void 0:i[0])==null?void 0:y.Name)||"Unknown Artist"})]})}function Ue({song:t,onClick:m,onContextMenu:c,contextMenuItemId:f,showImage:a=!0}){var A,j;const r=ce(),l=n.useRef(!1),w=f===t.Id,[b,o]=n.useState(!1),N=d=>{const E=Math.floor(d/1e7),I=Math.floor(E/60),h=E%60;return`${I}:${h.toString().padStart(2,"0")}`},i=d=>{if(w||l.current){d.preventDefault(),d.stopPropagation(),l.current=!1;return}m(t)},y=d=>{d.preventDefault(),d.stopPropagation(),l.current=!0,c(t,"song","desktop",{x:d.clientX,y:d.clientY}),setTimeout(()=>{l.current=!1},300)},v=G({onLongPress:d=>{d.preventDefault(),l.current=!0,c(t,"song","mobile")},onClick:()=>{if(l.current){l.current=!1;return}i({})}});return e.jsxs("button",{onClick:()=>{if(l.current){l.current=!1;return}i({})},onContextMenu:y,...v,className:`w-full flex items-center gap-3 hover:bg-white/10 transition-colors group px-4 py-3 ${w?"bg-white/10":""}`,children:[e.jsx("div",{className:"w-12 h-12 rounded-sm overflow-hidden flex-shrink-0 bg-zinc-900 self-center relative flex items-center justify-center",children:b?e.jsx(W,{className:"w-7 h-7 text-gray-500"}):e.jsxs(e.Fragment,{children:[e.jsx("img",{src:T.getAlbumArtUrl(t.AlbumId||t.Id,96),alt:t.Name,className:"w-full h-full object-cover",loading:"lazy",onError:()=>o(!0)}),e.jsx("div",{className:"absolute inset-0 pointer-events-none border border-white rounded-sm",style:{borderColor:"rgba(255, 255, 255, 0.03)",borderWidth:"1px"}})]})}),e.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[e.jsx("div",{className:`text-sm font-medium truncate transition-colors ${(r==null?void 0:r.Id)===t.Id?"text-[var(--accent-color)]":"text-white group-hover:text-[var(--accent-color)]"}`,children:t.Name}),e.jsxs("div",{className:"text-xs text-gray-400 truncate",children:[t.AlbumArtist||((j=(A=t.ArtistItems)==null?void 0:A[0])==null?void 0:j.Name)||"Unknown Artist",t.Album&&` • ${t.Album}`]})]}),t.RunTimeTicks&&e.jsx("div",{className:"text-xs text-gray-500 flex-shrink-0 text-right",children:N(t.RunTimeTicks)})]})}function He({onSearchStateChange:t}){const[m,c]=n.useState(""),[f,a]=n.useState(!1),[r,l]=n.useState(null),[w,b]=n.useState(!1),o=n.useRef(null),[N,i]=n.useState(!1),[y,v]=n.useState("mobile"),[A,j]=n.useState(null),[d,E]=n.useState(null),[I,h]=n.useState(null),u=n.useRef(null),[C,P]=n.useState([]),[g,R]=n.useState({min:null,max:null}),[$,z]=n.useState(!1),[J,de]=n.useState(null),{genres:me}=L(),[fe,_]=n.useState([]),[Xe,q]=n.useState(!1),[he,K]=n.useState(45),{playAlbum:xe,addToQueue:ge,playTrack:pe,shuffleAllSongs:be,isQueueSidebarOpen:ve}=H(),[D,Q]=n.useState(!1);n.useEffect(()=>{if(D){const s=setTimeout(()=>{Q(!1)},1e4);return()=>clearTimeout(s)}},[D]);const Y=ie();n.useEffect(()=>{(async()=>{q(!0);try{const x=L.getState();if(x.years.length>0)_(x.years);else{const M=await T.getYears();_(M)}}catch(x){console.error("Failed to load filter values:",x)}finally{q(!1)}})()},[]);const Z=C.length>0||g.min!==null||g.max!==null;n.useEffect(()=>{o.current&&o.current.abort();const s=m.trim().length>0;if(s||Z){b(!0),o.current=new AbortController;const x=window.setTimeout(async()=>{var M,k,S,F;if(!((M=o.current)!=null&&M.signal.aborted))try{let O;s?O=await $e(m,450):O=await ze(450),(k=o.current)!=null&&k.signal.aborted||l(O)}catch(O){(S=o.current)!=null&&S.signal.aborted||(console.error("Search failed:",O),l(null))}finally{(F=o.current)!=null&&F.signal.aborted||b(!1)}},250);return()=>{window.clearTimeout(x),o.current&&o.current.abort()}}else o.current=null,l(null),b(!1)},[m,Z]),n.useEffect(()=>{K(45)},[m,f,r==null?void 0:r.songs.length]),n.useEffect(()=>{var x;if(!f||!((x=r==null?void 0:r.songs)!=null&&x.length))return;const s=()=>{const M=window.scrollY||document.documentElement.scrollTop,k=window.innerHeight||document.documentElement.clientHeight,S=document.documentElement.scrollHeight;M+k*1.5>=S&&K(F=>Math.min(F+45,r.songs.length))};return window.addEventListener("scroll",s,{passive:!0}),()=>window.removeEventListener("scroll",s)},[f,r==null?void 0:r.songs.length]);const p=n.useMemo(()=>{if(!r)return null;const s=k=>{if(g.min!==null||g.max!==null)return!1;if(C.length>0){const S=k.Genres||[];if(!C.some(O=>S.some(V=>V.toLowerCase()===O.toLowerCase())))return!1}return!0},x=k=>{if(C.length>0){const S=k.Genres||[];if(!C.some(O=>S.some(V=>V.toLowerCase()===O.toLowerCase())))return!1}if(g.min!==null||g.max!==null){const S=k.ProductionYear;if(!S||S<=0||g.min!==null&&S<g.min||g.max!==null&&S>g.max)return!1}return!0},M=k=>!(g.min!==null||g.max!==null||C.length>0);return{artists:r.artists.filter(s),albums:r.albums.filter(x),playlists:(r.playlists||[]).filter(M),songs:r.songs.filter(x)}},[r,C,g]),ee=s=>{c(s),s.trim().length>0&&!f&&a(!0)},ye=s=>{Y(`/artist/${s}`),a(!1),c(""),l(null)},je=s=>{Y(`/album/${s}`),a(!1),c(""),l(null)},we=s=>{pe(s,[s])},Ne=s=>{Y(`/playlist/${s}`),a(!1),c(""),l(null)},U=(s,x,M="mobile",k)=>{E(s),h(x),v(M),j(k||null),i(!0)},te=()=>{c(""),l(null)},Ce=()=>{a(!1),c(""),l(null),P([]),R({min:null,max:null})},se=s=>{de(s),z(!0)},Se=s=>{P(s)},Ae=s=>{R(s)},Ie=s=>{s.preventDefault(),s.stopPropagation(),p!=null&&p.songs&&p.songs.length>0&&xe(p.songs)},ke=s=>{s.preventDefault(),s.stopPropagation(),p!=null&&p.songs&&p.songs.length>0&&ge(p.songs)},ne=f;return n.useEffect(()=>{t&&t(ne)},[ne,t]),n.useEffect(()=>{var s;if(f&&((s=u.current)==null||s.focus(),u.current)){const x=u.current.value.length;u.current.setSelectionRange(x,x)}},[f]),n.useEffect(()=>()=>{o.current&&o.current.abort()},[]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"px-4 pt-4 pb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"text-lg font-semibold text-white",children:"Tunetuna"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:async()=>{const s=H.getState(),{isShuffleAllActive:x,isShuffleGenreActive:M,shuffle:k}=s;if(!(D||x||M)){Q(!0);try{await be()}catch(S){console.error("Home shuffle button - shuffleAllSongs failed:",S),console.error("Shuffle all failed:",S)}finally{Q(!1)}}},disabled:D,className:"w-8 h-8 flex items-center justify-center text-white hover:bg-zinc-800 rounded-full transition-colors disabled:opacity-50","aria-label":"Shuffle all songs",children:D?e.jsx("div",{className:"w-4 h-4 border-2 border-zinc-400 border-t-white rounded-full animate-spin"}):e.jsx(Te,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>Y("/settings"),className:"w-8 h-8 flex items-center justify-center text-white hover:bg-zinc-800 rounded-full transition-colors","aria-label":"Settings",children:e.jsx(Le,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"relative",onClick:()=>a(!0),children:e.jsx(re,{value:m,onChange:ee,placeholder:"Search for artists, albums, songs...",showClearButton:m.trim().length>0,onClear:te})})]}),f&&Pe.createPortal(e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"fixed inset-0 bg-black z-[9999] overflow-y-scroll p-0 m-0",children:[e.jsx("div",{className:"fixed top-0 left-0 right-0 bg-black z-50 pointer-events-none",style:{height:"env(safe-area-inset-top)",top:"var(--header-offset, 0px)"}}),e.jsx("div",{className:"fixed top-0 left-0 right-0 bg-black z-10 pt-0 pb-0 w-full m-0",style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top))",height:"76px"},children:e.jsx("div",{className:"max-w-[768px] mx-auto w-full",children:e.jsxs("div",{className:"flex items-center gap-3 pl-2 pr-4 pt-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(re,{ref:u,value:m,onChange:ee,showClearButton:m.trim().length>0,onClear:te})}),e.jsx("button",{onClick:Ce,className:"px-4 py-2 text-white text-sm font-medium hover:text-zinc-300 transition-colors whitespace-nowrap flex-shrink-0",children:"Cancel"})]})})}),e.jsxs("div",{className:"max-w-[768px] mx-auto w-full",style:{paddingTop:"calc(76px + env(safe-area-inset-top))"},children:[e.jsx("div",{className:"sticky bg-black z-10 pt-3 pb-4",style:{top:"calc(76px + env(safe-area-inset-top))"},children:e.jsxs("div",{className:"flex items-center gap-3 pl-2 pr-4",children:[e.jsxs("button",{onClick:()=>se("genre"),className:`flex items-center gap-2 px-3 py-2 rounded-lg transition-colors ${C.length>0?"bg-[var(--accent-color)] text-white":"bg-white/10 text-white hover:bg-white/20"}`,"aria-label":"Filter by genre",children:[e.jsx(Ee,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Genre"})]}),e.jsxs("button",{onClick:()=>se("year"),className:`flex items-center gap-2 px-3 py-2 rounded-lg transition-colors ${g.min!==null||g.max!==null?"bg-[var(--accent-color)] text-white":"bg-white/10 text-white hover:bg-white/20"}`,"aria-label":"Filter by year",children:[e.jsx(Fe,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Year"})]})]})}),e.jsx("div",{className:`fixed left-0 right-0 z-[60] lg:left-16 transition-[left,right] duration-300 ${ve?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 76px + 4rem)",height:"24px",background:"linear-gradient(to bottom, rgba(0, 0, 0, 0.8), transparent)"}}),e.jsx("div",{className:"pb-32",style:{paddingTop:"40px"},children:w?e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-zinc-800 border-t-[var(--accent-color)]"})}):p?e.jsxs("div",{className:"space-y-8",children:[p.artists.length>0&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-4 pl-2 pr-4",children:"Artists"}),e.jsx("div",{className:"space-y-0",children:p.artists.slice(0,5).map(s=>e.jsx(Ge,{artist:s,onClick:ye,onContextMenu:U,contextMenuItemId:(d==null?void 0:d.Id)||null},s.Id))})]}),p.albums.length>0&&e.jsxs("div",{className:"pl-2 pr-4",children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Albums"}),e.jsx("div",{className:"grid grid-cols-3 md:grid-cols-4 gap-4",children:p.albums.slice(0,12).map(s=>e.jsx(Ye,{album:s,onClick:je,onContextMenu:U,contextMenuItemId:(d==null?void 0:d.Id)||null},s.Id))})]}),p.playlists&&p.playlists.length>0&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-4 pl-2 pr-4",children:"Playlists"}),e.jsx("div",{className:"space-y-0",children:p.playlists.map(s=>e.jsxs("button",{onClick:()=>Ne(s.Id),onContextMenu:x=>{x.preventDefault(),x.stopPropagation(),U(s,"playlist","desktop",{x:x.clientX,y:x.clientY})},className:"w-full flex items-center gap-3 hover:bg-white/10 transition-colors group px-4 py-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-sm overflow-hidden flex-shrink-0 bg-zinc-900 self-center",children:e.jsx("img",{src:T.getAlbumArtUrl(s.Id,96),alt:s.Name,className:"w-full h-full object-cover",loading:"lazy"})}),e.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[e.jsx("div",{className:"text-sm font-medium text-white truncate group-hover:text-[var(--accent-color)] transition-colors",children:s.Name}),e.jsx("div",{className:"text-xs text-gray-400 truncate",children:s.ChildCount?`${s.ChildCount} tracks`:"Playlist"})]})]},s.Id))})]}),p.songs.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 pl-2 pr-4",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"Songs"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:Ie,className:"w-10 h-10 flex items-center justify-center text-white hover:bg-white/10 rounded-lg transition-colors","aria-label":"Play all songs",children:e.jsx(Oe,{className:"w-5 h-5"})}),e.jsx("button",{type:"button",onClick:ke,className:"w-10 h-10 flex items-center justify-center text-white hover:bg-white/10 rounded-lg transition-colors","aria-label":"Add all songs to queue",children:e.jsx(Re,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"space-y-0",children:p.songs.map((s,x)=>e.jsx(Ue,{song:s,onClick:we,onContextMenu:U,contextMenuItemId:(d==null?void 0:d.Id)||null,showImage:x<he},s.Id))})]}),p.artists.length===0&&p.albums.length===0&&(!p.playlists||p.playlists.length===0)&&p.songs.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 text-gray-400 px-4",children:[e.jsx("div",{className:"text-lg mb-2",children:"No results found"}),e.jsx("div",{className:"text-sm",children:"Try a different search term"})]})]}):e.jsx("div",{className:"flex flex-col items-center justify-center py-16 text-gray-400 px-4"})})]})]}),e.jsx(B,{item:d,itemType:I,isOpen:N,onClose:()=>{i(!1),E(null),h(null)},zIndex:999999,mode:y,position:A||void 0})]}),document.body),J==="genre"&&e.jsx(ae,{isOpen:$,onClose:()=>z(!1),filterType:"genre",genres:me,selectedValues:C,onApply:Se}),J==="year"&&e.jsx(ae,{isOpen:$,onClose:()=>z(!1),filterType:"year",availableYears:fe,yearRange:g,onApplyYear:Ae})]})}function oe({album:t,onNavigate:m,onContextMenu:c}){var o,N;const[f,a]=n.useState(!1),r=n.useRef(!1),l=i=>{if(r.current){i.preventDefault(),i.stopPropagation(),r.current=!1;return}m(t.Id)},w=i=>{i.preventDefault(),i.stopPropagation(),r.current=!0,c(t,"desktop",{x:i.clientX,y:i.clientY}),setTimeout(()=>{r.current=!1},300)},b=G({onLongPress:i=>{i.preventDefault(),r.current=!0,c(t,"mobile")},onClick:()=>{if(r.current){r.current=!1;return}l({})}});return e.jsxs("button",{onClick:()=>{if(r.current){r.current=!1;return}l({})},onContextMenu:w,...b,className:"text-left group",children:[e.jsx("div",{className:"aspect-square rounded overflow-hidden mb-2 bg-zinc-900 flex items-center justify-center",children:f?e.jsx(W,{className:"w-12 h-12 text-gray-500"}):e.jsx(ue,{src:T.getAlbumArtUrl(t.Id,474),alt:t.Name,className:"w-full h-full object-cover",showOutline:!0,rounded:"rounded",onError:()=>a(!0)})}),e.jsx("div",{className:"text-sm font-medium text-white truncate",children:t.Name}),e.jsx("div",{className:"text-xs text-gray-400 truncate",children:t.AlbumArtist||((N=(o=t.ArtistItems)==null?void 0:o[0])==null?void 0:N.Name)||"Unknown Artist"})]})}function We(){const{recentlyAdded:t,setRecentlyAdded:m,setLoading:c}=L(),f=ie(),a=n.useRef(null),[r,l]=n.useState(0),[w,b]=n.useState(!1),[o,N]=n.useState("mobile"),[i,y]=n.useState(null),[v,A]=n.useState(null);n.useEffect(()=>{(async()=>{c("recentlyAdded",!0);try{const u=await T.getRecentlyAdded(18);m(u.Items||[])}catch(u){console.error("Failed to load recently added:",u)}finally{c("recentlyAdded",!1)}})()},[m,c]);const j=()=>{if(!a.current)return;const h=a.current,u=h.scrollLeft,C=h.clientWidth,P=Math.round(u/C);l(P)},d=h=>{if(!a.current)return;const u=a.current,C=u.clientWidth;u.scrollTo({left:h*C,behavior:"smooth"})};if(!t||t.length===0)return null;const E=6,I=[];for(let h=0;h<t.length;h+=E)I.push(t.slice(h,h+E));return e.jsxs("div",{className:"px-4 mb-8",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Recently Added"}),e.jsxs("div",{className:"md:hidden",children:[e.jsx("div",{ref:a,onScroll:j,className:"overflow-x-auto snap-x snap-mandatory scrollbar-hide",style:{scrollbarWidth:"none",msOverflowStyle:"none"},children:e.jsx("div",{className:"flex",style:{width:`${I.length*100}%`},children:I.map((h,u)=>{const C=Math.ceil(h.length/3);return e.jsx("div",{className:"snap-start flex-shrink-0 w-full",style:{width:`${100/I.length}%`},children:e.jsx("div",{className:"grid grid-cols-3 gap-3",style:{gridTemplateRows:`repeat(${C}, minmax(0, 1fr))`},children:h.map(P=>e.jsx(oe,{album:P,onNavigate:g=>f(`/album/${g}`),onContextMenu:(g,R,$)=>{A(g),N(R||"desktop"),y($||null),b(!0)}},P.Id))})},u)})})}),I.length>1&&e.jsx("div",{className:"flex justify-center gap-2 mt-4",children:I.map((h,u)=>e.jsx("button",{onClick:()=>d(u),className:`w-2 h-2 rounded-full transition-colors ${u===r?"bg-white":"bg-zinc-600"}`,"aria-label":`Go to page ${u+1}`},u))})]}),e.jsx("div",{className:"hidden md:block",children:e.jsx("div",{className:"grid grid-cols-4 gap-3",children:t.slice(0,8).map(h=>e.jsx(oe,{album:h,onNavigate:u=>f(`/album/${u}`),onContextMenu:(u,C,P)=>{A(u),N(C||"desktop"),y(P||null),b(!0)}},h.Id))})}),e.jsx("style",{children:`
        .scrollbar-hide::-webkit-scrollbar {
          display: none;
        }
      `}),e.jsx(B,{item:v,itemType:"album",isOpen:w,onClose:()=>{b(!1),A(null)},zIndex:999999,mode:o,position:i||void 0})]})}function Qe({song:t,onClick:m,onContextMenu:c,contextMenuItemId:f}){var N,i;const a=ce(),[r,l]=n.useState(!1),w=f===t.Id,b=y=>{const v=Math.floor(y/1e7),A=Math.floor(v/60),j=v%60;return`${A}:${j.toString().padStart(2,"0")}`},o=G({onLongPress:y=>{y.preventDefault(),c(t,"mobile")},onClick:()=>m(t)});return e.jsxs("button",{onClick:()=>m(t),onContextMenu:y=>{y.preventDefault(),c(t,"desktop",{x:y.clientX,y:y.clientY})},...o,className:`w-full flex items-center gap-3 hover:bg-white/10 transition-colors group px-4 py-3 ${w?"bg-white/10":""}`,children:[e.jsx("div",{className:"w-12 h-12 rounded-sm overflow-hidden flex-shrink-0 bg-zinc-900 self-center flex items-center justify-center",children:r?e.jsx(W,{className:"w-7 h-7 text-gray-500"}):e.jsx(ue,{src:T.getAlbumArtUrl(t.AlbumId||t.Id,96),alt:t.Name,className:"w-full h-full object-cover",showOutline:!0,rounded:"rounded-sm",onError:()=>l(!0)})}),e.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[e.jsx("div",{className:`text-sm font-medium truncate transition-colors ${(a==null?void 0:a.Id)===t.Id?"text-[var(--accent-color)]":"text-white group-hover:text-[var(--accent-color)]"}`,children:t.Name}),e.jsxs("div",{className:"text-xs text-gray-400 truncate",children:[t.AlbumArtist||((i=(N=t.ArtistItems)==null?void 0:N[0])==null?void 0:i.Name)||"Unknown Artist",t.Album&&` • ${t.Album}`]})]}),t.RunTimeTicks&&e.jsx("div",{className:"text-xs text-gray-500 flex-shrink-0 text-right",children:b(t.RunTimeTicks)})]})}function Ve(){const{recentlyPlayed:t}=L(),{playTrack:m}=H(),[c,f]=n.useState(!1),[a,r]=n.useState("mobile"),[l,w]=n.useState(null),[b,o]=n.useState(null),N=i=>{m(i,t)};return!t||t.length===0?null:e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-xl font-bold mb-2 px-4",children:"Recently Played"}),e.jsx("div",{className:"space-y-0",children:t.map(i=>e.jsx(Qe,{song:i,onClick:N,onContextMenu:(y,v,A)=>{o(y),r(v||"mobile"),w(A||null),f(!0)},contextMenuItemId:(b==null?void 0:b.Id)||null},i.Id))}),e.jsx(B,{item:b,itemType:"song",isOpen:c,onClose:()=>{f(!1),o(null)},zIndex:99999,mode:a,position:l||void 0})]})}function Ke(){const[t,m]=n.useState(!1),{recentlyAdded:c,recentlyPlayed:f,loading:a}=L(),r=n.useRef(!1),{isQueueSidebarOpen:l}=H();n.useEffect(()=>{(a.recentlyAdded||a.recentlyPlayed)&&(r.current=!0)},[a.recentlyAdded,a.recentlyPlayed]);const w=r.current&&!a.recentlyAdded&&!a.recentlyPlayed&&c.length===0&&f.length===0;return e.jsxs("div",{className:"pb-20",children:[e.jsx("div",{className:`fixed top-0 left-0 right-0 bg-black z-10 lg:left-16 transition-[left,right] duration-300 ${l?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top))"},children:e.jsx("div",{className:"max-w-[768px] mx-auto",children:e.jsx(He,{onSearchStateChange:m})})}),e.jsx("div",{className:`fixed left-0 right-0 z-[60] lg:left-16 transition-[left,right] duration-300 ${l?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 7.5rem - 2px)",height:"24px",background:"linear-gradient(to bottom, rgba(0, 0, 0, 0.8), transparent)"}}),e.jsx("div",{className:t?"hidden":"",style:{paddingTop:"calc(env(safe-area-inset-top) + 7.5rem + 24px)"},children:e.jsxs("div",{className:"max-w-[768px] mx-auto",children:[e.jsx(We,{}),e.jsx(Ve,{}),w&&e.jsx("div",{className:"flex items-center justify-center py-16 text-gray-400",children:e.jsx("p",{children:"No music found"})})]})})]})}export{Ke as default};
