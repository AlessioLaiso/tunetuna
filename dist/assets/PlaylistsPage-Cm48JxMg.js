import{b as z,r as s,f as oe,j as e,I as ie,e as D,C as Q,u as L,a as $,l as F,z as ce,w as ue,A as de}from"./index-Def-zOqH.js";import{u as fe,S as he}from"./search-CX8aL8TO.js";import{A as xe}from"./arrow-up-down-CUJ3dVTa.js";import"./tag-Z6C-w5NC.js";import"./piano-GaLAw_6p.js";function me({playlist:a}){const v=z(),[p,u]=s.useState(!1),[j,g]=s.useState("mobile"),[w,y]=s.useState(null),i=s.useRef(!1),o=n=>{if(i.current){n.preventDefault(),i.current=!1;return}v(`/playlist/${a.Id}`)},d=oe({onLongPress:n=>{n.preventDefault(),i.current=!0,g("mobile"),y(null),u(!0)}}),N=n=>{n.preventDefault(),n.stopPropagation(),i.current=!0,g("desktop"),y({x:n.clientX,y:n.clientY}),u(!0),setTimeout(()=>{i.current=!1},300)};return e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:n=>{if(p||i.current){n.preventDefault(),n.stopPropagation();return}o(n)},onContextMenu:N,...d,className:"w-full flex items-center gap-3 hover:bg-white/10 transition-colors group px-4 py-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-sm overflow-hidden flex-shrink-0 bg-zinc-900 self-center",children:e.jsx(ie,{src:D.getAlbumArtUrl(a.Id,96),alt:a.Name,className:"w-full h-full object-cover",showOutline:!0,rounded:"rounded-sm"})}),e.jsxs("div",{className:"flex-1 min-w-0 text-left flex flex-col justify-center",children:[e.jsx("div",{className:"text-sm font-medium text-white truncate group-hover:text-[var(--accent-color)] transition-colors",children:a.Name}),e.jsx("div",{className:"text-xs text-gray-400 truncate",children:a.ChildCount?`${a.ChildCount} tracks`:"Playlist"})]})]}),e.jsx(Q,{item:a,itemType:"playlist",isOpen:p,onClose:()=>u(!1),mode:j,position:w||void 0})]})}const pe=[{type:"playlists"},{type:"artists",limit:5},{type:"albums",limit:12},{type:"songs"}];function we(){const[a,v]=s.useState([]),[p,u]=s.useState(!0),j=L(t=>t.sortPreferences),g=L(t=>t.setSortPreference),{playTrack:w,playAlbum:y,addToQueue:i}=$(),o=j.playlists,d=s.useRef(!0),[N,n]=s.useState(!1),k=s.useRef(o),S=z(),[C,f]=s.useState(""),[h,x]=s.useState(!1),[m,c]=s.useState(null),[_,P]=s.useState(!1),r=s.useRef(null),[G,U]=s.useState(!1),[B,H]=s.useState(null),[Y,J]=s.useState(null),[W,ge]=s.useState("mobile"),[X,ye]=s.useState(null),M=$(t=>t.isQueueSidebarOpen),[K,O]=s.useState(!1);s.useEffect(()=>{const t=()=>I();return window.addEventListener("playlistUpdated",t),()=>window.removeEventListener("playlistUpdated",t)},[]),s.useEffect(()=>{h||(!d.current&&k.current!==o&&n(!0),k.current=o,I())},[o,h]),s.useEffect(()=>{d.current&&(d.current=!1)},[]),s.useEffect(()=>{if(r.current&&r.current.abort(),C.trim()){P(!0),r.current=new AbortController;const t=window.setTimeout(async()=>{var b,R,T,E;if(!((b=r.current)!=null&&b.signal.aborted))try{const A=await fe(C,450);(R=r.current)!=null&&R.signal.aborted||c(A)}catch(A){(T=r.current)!=null&&T.signal.aborted||(F.error("Search failed:",A),c(null))}finally{(E=r.current)!=null&&E.signal.aborted||P(!1)}},250);return()=>{window.clearTimeout(t),r.current&&r.current.abort()}}else r.current=null,c(null),P(!1)},[C]),s.useEffect(()=>()=>{r.current&&r.current.abort()},[]);const I=async()=>{u(!0);try{const t={limit:100};o==="RecentlyAdded"?(t.sortBy=["DateCreated"],t.sortOrder="Descending"):(t.sortBy=["SortName"],t.sortOrder="Ascending");const b=await D.getPlaylists(t);v(b.Items)}catch(t){F.error("Failed to load playlists:",t)}finally{u(!1),n(!1)}},V=t=>{f(t),t.trim().length>0&&!h&&x(!0)},Z=()=>{f(""),c(null)},q=()=>{x(!1),f(""),c(null)},ee=t=>{S(`/artist/${t}`),x(!1),f(""),c(null)},te=t=>{S(`/album/${t}`),x(!1),f(""),c(null)},se=t=>{w(t,[t])},ne=()=>{l!=null&&l.songs&&l.songs.length>0&&y(l.songs)},re=()=>{l!=null&&l.songs&&l.songs.length>0&&i(l.songs)},le=t=>{S(`/playlist/${t}`),x(!1),f(""),c(null)},ae=t=>{},l=s.useMemo(()=>m?{playlists:m.playlists||[],artists:m.artists||[],albums:m.albums||[],songs:m.songs||[]}:null,[m]);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"pb-20",children:[e.jsx("div",{className:`fixed top-0 left-0 right-0 bg-black z-10 lg:left-16 transition-[left,right] duration-300 ${M?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top))"},children:e.jsx("div",{className:"max-w-[768px] mx-auto",children:e.jsxs("div",{className:"p-4 min-[780px]:px-[0.66rem]",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Playlists"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>O(!0),className:"w-10 h-10 flex items-center justify-center text-white hover:bg-zinc-800 rounded-full transition-colors","aria-label":"Create playlist",children:e.jsx(ce,{className:"w-6 h-6"})}),e.jsx("button",{onClick:()=>x(!0),className:"w-10 h-10 flex items-center justify-center text-white hover:bg-zinc-800 rounded-full transition-colors","aria-label":"Search",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})]})]}),!h&&e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("button",{onClick:()=>g("playlists",o==="RecentlyAdded"?"Alphabetical":"RecentlyAdded"),className:"text-sm text-gray-400 hover:text-white transition-colors flex items-center gap-1",children:[o==="RecentlyAdded"?"Recently Added":"Alphabetically",e.jsx(xe,{className:"w-4 h-4"})]}),p&&!d.current&&e.jsx("div",{className:"flex items-center",children:e.jsx(ue,{})})]})]})})}),e.jsx("div",{className:`fixed left-0 right-0 z-10 lg:left-16 transition-[left,right] duration-300 ${M?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 7rem - 8px)",height:"24px",background:"linear-gradient(to bottom, rgba(0, 0, 0, 0.8), transparent)"}}),e.jsx("div",{style:{paddingTop:"calc(env(safe-area-inset-top) + 7rem)"},children:e.jsx("div",{className:`${N?"opacity-50 pointer-events-none":""} ${h?"hidden [@media((hover:hover)_and_(pointer:fine)_and_(min-width:1024px))]:block":""}`,children:a.length===0&&!p?e.jsx("div",{className:"flex items-center justify-center py-16 text-gray-400",children:e.jsx("p",{children:"No playlists found"})}):e.jsx("div",{className:"space-y-0",children:a.map(t=>e.jsx(me,{playlist:t},t.Id))})})})]}),e.jsx(he,{isOpen:h,onClose:q,searchQuery:C,onSearchChange:V,onClearSearch:Z,isLoading:_,results:l,sections:pe,filterConfig:{showGenreFilter:!1,showYearFilter:!1,showGroupingFilters:!1},filterState:{selectedGenres:[],yearRange:{min:null,max:null},selectedGroupings:{}},onOpenFilterSheet:ae,onArtistClick:ee,onAlbumClick:te,onSongClick:se,onPlaylistClick:le,onPlayAllSongs:ne,onAddSongsToQueue:re,isQueueSidebarOpen:M}),e.jsx(Q,{item:B,itemType:Y,isOpen:G,onClose:()=>{U(!1),H(null),J(null)},zIndex:99999,mode:W,position:X||void 0}),e.jsx(de,{isOpen:K,onClose:()=>O(!1),onCreated:t=>S(`/playlist/${t}`)})]})}export{we as default};
