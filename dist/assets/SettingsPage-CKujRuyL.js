import{c as j,m as Y,p as Z,o as _,u as d,q as x,b as K,s as W,t as X,a as ee,r as R,j as e,R as E,B as te,e as V}from"./index-CSzK2hrG.js";import{A as se}from"./arrow-left-DEhp5iD0.js";/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]],O=j("cloud",ae);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=[["path",{d:"M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4",key:"tonef"}],["path",{d:"M9 18c-4.51 2-5-2-7-2",key:"9comsn"}]],le=j("github",ne);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=[["path",{d:"M19.414 14.414C21 12.828 22 11.5 22 9.5a5.5 5.5 0 0 0-9.591-3.676.6.6 0 0 1-.818.001A5.5 5.5 0 0 0 2 9.5c0 2.3 1.5 4 3 5.5l5.535 5.362a2 2 0 0 0 2.879.052 2.12 2.12 0 0 0-.004-3 2.124 2.124 0 1 0 3-3 2.124 2.124 0 0 0 3.004 0 2 2 0 0 0 0-2.828l-1.881-1.882a2.41 2.41 0 0 0-3.409 0l-1.71 1.71a2 2 0 0 1-2.828 0 2 2 0 0 1 0-2.828l2.823-2.762",key:"17lmqv"}]],ce=j("heart-handshake",re);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]],oe=j("log-out",ie);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=[["path",{d:"M13 16a3 3 0 0 1 2.24 5",key:"1epib5"}],["path",{d:"M18 12h.01",key:"yjnet6"}],["path",{d:"M18 21h-8a4 4 0 0 1-4-4 7 7 0 0 1 7-7h.2L9.6 6.4a1 1 0 1 1 2.8-2.8L15.8 7h.2c3.3 0 6 2.7 6 6v1a2 2 0 0 1-2 2h-1a3 3 0 0 0-3 3",key:"ue9ozu"}],["path",{d:"M20 8.54V4a2 2 0 1 0-4 0v3",key:"49iql8"}],["path",{d:"M7.612 12.524a3 3 0 1 0-1.6 4.3",key:"1e33i0"}]],ue=j("rabbit",de);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=[["path",{d:"m12 10 2 4v3a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1v-3a8 8 0 1 0-16 0v3a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1v-3l2-4h4Z",key:"1lbbv7"}],["path",{d:"M4.82 7.9 8 10",key:"m9wose"}],["path",{d:"M15.18 7.9 12 10",key:"p8dp2u"}],["path",{d:"M16.93 10H20a2 2 0 0 1 0 4H2",key:"12nsm7"}]],he=j("turtle",pe),ye="http://localhost:3001";class ge{async fetch(r,c={}){const i={"Content-Type":"application/json",...c.headers},u=await fetch(`${ye}${r}`,{...c,headers:i});if(!u.ok){const y=await u.json().catch(()=>({error:"Request failed"}));throw new Error(y.error||"Request failed")}return u.json()}async pullSync(r,c){const i=new URLSearchParams({jellyfinServer:r,jellyfinUserId:c});return this.fetch(`/api/sync?${i}`)}async pushSync(r){return this.fetch("/api/sync",{method:"POST",body:JSON.stringify(r)})}}const z=new ge;let L=null;const me=2e3;let f=!1,U=null,k=null;const P=Y()(Z((a,r)=>({cloudSyncEnabled:!1,isSyncing:!1,lastSyncAt:null,setCloudSyncEnabled:c=>{a({cloudSyncEnabled:c}),c&&r().pull().catch(()=>{})},pull:async()=>{var u,y,o,b,p,n;const{cloudSyncEnabled:c}=r();if(!c)return;const i=_.getState();if(!(!i.serverUrl||!i.userId)){a({isSyncing:!0});try{const t=await z.pullSync(i.serverUrl,i.userId),l=d.getState(),m=x.getState();f=!0;const h=l.genresLastUpdated||0,g=l.lastSyncCompleted||0,v=l.yearsLastUpdated||0,S=m.settingsLastUpdated||0,C=l.recentlyPlayedLastUpdated||0;if((u=t.genres)!=null&&u.updatedAt&&t.genres.updatedAt>h&&d.setState({genres:t.genres.data,genresLastUpdated:t.genres.updatedAt}),(y=t.songs)!=null&&y.updatedAt&&t.songs.updatedAt>g&&d.setState({songs:t.songs.data,lastSyncCompleted:t.songs.updatedAt}),(o=t.years)!=null&&o.updatedAt&&t.years.updatedAt>v&&d.setState({years:t.years.data,yearsLastUpdated:t.years.updatedAt}),(b=t.settings)!=null&&b.updatedAt&&t.settings.updatedAt>S){const w=t.settings.data;x.setState({pageVisibility:w.pageVisibility||m.pageVisibility,accentColor:w.accentColor||m.accentColor,settingsLastUpdated:t.settings.updatedAt})}(p=t.recentlyPlayed)!=null&&p.updatedAt&&t.recentlyPlayed.updatedAt>C&&d.setState({recentlyPlayed:t.recentlyPlayed.data,recentlyPlayedLastUpdated:t.recentlyPlayed.updatedAt}),U=x.getState().settingsLastUpdated,k=((n=d.getState().recentlyPlayed[0])==null?void 0:n.Id)||null,f=!1,a({lastSyncAt:Date.now()})}finally{f=!1,a({isSyncing:!1})}}},push:async()=>{var u,y,o,b,p;const{cloudSyncEnabled:c}=r();if(!c)return;const i=_.getState();if(!(!i.serverUrl||!i.userId)){a({isSyncing:!0});try{const n=d.getState(),t=x.getState(),l=await z.pushSync({jellyfinServer:i.serverUrl,jellyfinUserId:i.userId,genres:n.genres.length>0&&n.genresLastUpdated?{data:n.genres,updatedAt:n.genresLastUpdated}:void 0,songs:n.songs.length>0&&n.lastSyncCompleted?{data:n.songs,updatedAt:n.lastSyncCompleted}:void 0,years:n.years.length>0&&n.yearsLastUpdated?{data:n.years,updatedAt:n.yearsLastUpdated}:void 0,settings:{data:{pageVisibility:t.pageVisibility,accentColor:t.accentColor},updatedAt:t.settingsLastUpdated||1},recentlyPlayed:n.recentlyPlayed.length>0?{data:n.recentlyPlayed,updatedAt:n.recentlyPlayedLastUpdated||1}:void 0});f=!0;const m=n.genresLastUpdated||0,h=n.lastSyncCompleted||0,g=t.settingsLastUpdated||0,v=n.recentlyPlayedLastUpdated||0;if((u=l.genres)!=null&&u.updatedAt&&l.genres.updatedAt>m&&d.setState({genres:l.genres.data,genresLastUpdated:l.genres.updatedAt}),(y=l.songs)!=null&&y.updatedAt&&l.songs.updatedAt>h&&d.setState({songs:l.songs.data,lastSyncCompleted:l.songs.updatedAt}),(o=l.settings)!=null&&o.updatedAt&&l.settings.updatedAt>g){const S=l.settings.data;x.setState({pageVisibility:S.pageVisibility||t.pageVisibility,accentColor:S.accentColor||t.accentColor,settingsLastUpdated:l.settings.updatedAt})}(b=l.recentlyPlayed)!=null&&b.updatedAt&&l.recentlyPlayed.updatedAt>v&&d.setState({recentlyPlayed:l.recentlyPlayed.data,recentlyPlayedLastUpdated:l.recentlyPlayed.updatedAt}),U=x.getState().settingsLastUpdated,k=((p=d.getState().recentlyPlayed[0])==null?void 0:p.Id)||null,f=!1,a({lastSyncAt:Date.now()})}finally{f=!1,a({isSyncing:!1})}}},schedulePush:()=>{const{cloudSyncEnabled:c}=r();c&&(L&&clearTimeout(L),L=setTimeout(()=>{r().push().catch(()=>{}),L=null},me))}}),{name:"tunetuna-storage",partialize:a=>({cloudSyncEnabled:a.cloudSyncEnabled,lastSyncAt:a.lastSyncAt})}));x.subscribe(a=>{f||a.settingsLastUpdated&&a.settingsLastUpdated!==U&&(U=a.settingsLastUpdated,P.getState().schedulePush())});d.subscribe(a=>{var c;if(f)return;const r=(c=a.recentlyPlayed[0])==null?void 0:c.Id;r&&r!==k&&(k=r,P.getState().schedulePush())});setTimeout(()=>{const a=P.getState();a.cloudSyncEnabled&&a.pull().catch(()=>{})},100);const xe=[{name:"zinc",hex:"#71717a"},{name:"red",hex:"#ef4444"},{name:"orange",hex:"#f97316"},{name:"amber",hex:"#f59e0b"},{name:"yellow",hex:"#eab308"},{name:"lime",hex:"#84cc16"},{name:"green",hex:"#22c55e"},{name:"emerald",hex:"#10b981"},{name:"teal",hex:"#14b8a6"},{name:"cyan",hex:"#06b6d4"},{name:"sky",hex:"#0ea5e9"},{name:"blue",hex:"#3b82f6"},{name:"indigo",hex:"#6366f1"},{name:"violet",hex:"#8b5cf6"},{name:"purple",hex:"#a855f7"},{name:"fuchsia",hex:"#d946ef"},{name:"pink",hex:"#ec4899"},{name:"rose",hex:"#f43f5e"}];function Se(){const a=K(),{pageVisibility:r,setPageVisibility:c,accentColor:i,setAccentColor:u}=x(),{logout:y,serverUrl:o}=_(),{setGenres:b,lastSyncCompleted:p,setLastSyncCompleted:n}=d(),{state:t,startSync:l,completeSync:m}=W(),{addToast:h}=X(),{cloudSyncEnabled:g,setCloudSyncEnabled:v,isSyncing:S,push:C}=P(),w=ee(s=>s.isQueueSidebarOpen),[D,A]=R.useState(!1),[$,T]=R.useState({scope:"incremental"}),I=()=>{A(!1),T({scope:"incremental"})},H=()=>{y(),a("/")},F=s=>{c({[s]:!r[s]})},M=async()=>{const s=($.scope==="full","Syncing...");l("settings",s);try{await V.syncLibrary($);const B=(await V.getGenres()||[]).sort((J,Q)=>(J.Name||"").localeCompare(Q.Name||""));b(B),n(Date.now()),m(!0,"Library synced successfully"),g&&C().catch(()=>{})}catch(N){m(!1,N instanceof Error?N.message:"Failed to sync library")}},q=async()=>{if(o)try{if(navigator.clipboard&&navigator.clipboard.writeText){await navigator.clipboard.writeText(o),h("Server URL copied","success");return}const s=document.createElement("textarea");s.value=o,s.style.position="fixed",s.style.left="-9999px",s.style.top="-9999px",document.body.appendChild(s),s.focus(),s.select();const N=document.execCommand("copy");document.body.removeChild(s),N?h("Server URL copied","success"):h("Failed to copy URL","error")}catch{h("Failed to copy URL","error")}},G=async()=>{try{await C(),h("Synced to cloud","success")}catch(s){h(s instanceof Error?s.message:"Sync failed","error")}};return e.jsxs("div",{className:"pb-20",children:[e.jsx("div",{className:`fixed top-0 left-0 right-0 bg-black z-10 lg:left-16 transition-[left,right] duration-300 ${w?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top))"},children:e.jsx("div",{className:"max-w-[768px] mx-auto",children:e.jsxs("div",{className:"flex items-center gap-4 p-4",children:[e.jsx("button",{onClick:()=>a("/"),className:"text-white hover:text-zinc-300 transition-colors",children:e.jsx(se,{className:"w-6 h-6"})}),e.jsx("h1",{className:"text-xl font-bold flex-1",children:"Settings"})]})})}),e.jsx("div",{className:`fixed left-0 right-0 z-[60] lg:left-16 transition-[left,right] duration-300 ${w?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 5.5rem - 28px)",height:"24px",background:"linear-gradient(to bottom, rgba(0, 0, 0, 0.8), transparent)"}}),e.jsxs("div",{className:"p-4 space-y-8",style:{paddingTop:"calc(env(safe-area-inset-top) + 5.5rem + 24px)"},children:[e.jsxs("section",{children:[e.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:"Page Visibility"}),e.jsx("div",{className:"space-y-3",children:["artists","albums","songs","genres","playlists"].map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-zinc-900 rounded-lg",children:[e.jsx("label",{className:"text-white capitalize font-medium",children:s}),e.jsx("button",{onClick:()=>F(s),className:`relative w-12 h-6 rounded-full transition-colors ${r[s]?"bg-[var(--accent-color)]":"bg-zinc-600"}`,children:e.jsx("span",{className:`absolute top-1 left-1 w-4 h-4 bg-white rounded-full transition-transform ${r[s]?"translate-x-6":"translate-x-0"}`})})]},s))})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:"Accent Color"}),e.jsx("div",{className:"grid grid-cols-6 md:grid-cols-9 gap-3 mb-6",children:xe.map(s=>e.jsx("button",{onClick:()=>u(s.name),className:`aspect-square rounded-lg transition-all ${i===s.name?"ring-2 ring-white ring-offset-2 ring-offset-black scale-110":"hover:scale-105"}`,style:{backgroundColor:s.hex},"aria-label":`Select ${s.name} color`},s.name))}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-white mb-3",children:"About Tunetuna"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("a",{href:"https://github.com/AlessioLaiso/tunetuna",target:"_blank",rel:"noopener noreferrer",className:"flex-1 px-4 py-3 bg-transparent border border-[var(--accent-color)] text-white hover:bg-[var(--accent-color)]/10 font-semibold rounded-full transition-colors text-center flex items-center justify-center gap-2",children:[e.jsx(le,{className:"w-5 h-5"}),e.jsx("span",{children:"GitHub"})]}),e.jsxs("a",{href:"https://www.paypal.com/donate/?hosted_button_id=XBVKHU3JV9W8N",target:"_blank",rel:"noopener noreferrer",className:"flex-1 px-4 py-3 bg-transparent border border-[var(--accent-color)] text-white hover:bg-[var(--accent-color)]/10 font-semibold rounded-full transition-colors text-center flex items-center justify-center gap-2",children:[e.jsx(ce,{className:"w-5 h-5"}),e.jsx("span",{children:"Donate"})]})]})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-lg font-semibold text-white mb-1",children:"Cloud Sync"}),e.jsx("p",{className:"text-xs text-gray-400 mb-4",children:"Sync settings and library cache across devices"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-zinc-900 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{className:"w-5 h-5 text-[var(--accent-color)]"}),e.jsx("span",{className:"text-white font-medium",children:"Enable Cloud Sync"})]}),e.jsx("button",{onClick:()=>v(!g),className:`relative w-12 h-6 rounded-full transition-colors ${g?"bg-[var(--accent-color)]":"bg-zinc-600"}`,children:e.jsx("span",{className:`absolute top-1 left-1 w-4 h-4 bg-white rounded-full transition-transform ${g?"translate-x-6":"translate-x-0"}`})})]}),g&&e.jsx("button",{onClick:G,disabled:S,className:"w-full px-4 py-3 bg-transparent border border-[var(--accent-color)] text-white hover:bg-[var(--accent-color)]/10 disabled:opacity-50 font-semibold rounded-full transition-colors flex items-center justify-center gap-2",children:S?e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"w-5 h-5 animate-spin"}),e.jsx("span",{children:"Syncing..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(O,{className:"w-5 h-5"}),e.jsx("span",{children:"Sync Now"})]})})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-lg font-semibold text-white mb-1",children:"Jellyfin Library"}),e.jsx("button",{type:"button",onClick:q,disabled:!o,className:`text-left text-xs break-all transition-colors mb-2 ${o?"text-gray-400 hover:text-gray-200 cursor-pointer":"text-gray-600 cursor-not-allowed"}`,children:o?`Server: ${o}`:"Server: Not configured"}),t==="idle"&&p&&e.jsxs("div",{className:"text-xs text-gray-400 mb-4",children:["Last synced: ",new Date(p).getFullYear()," ",new Date(p).toLocaleString("default",{month:"short"})," ",new Date(p).getDate().toString().padStart(2,"0")," at ",new Date(p).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>A(!0),disabled:t==="syncing",className:"flex-1 px-4 py-3 bg-transparent border border-[var(--accent-color)] text-white hover:bg-[var(--accent-color)]/10 disabled:opacity-50 disabled:cursor-not-allowed font-semibold rounded-full transition-colors flex items-center justify-center gap-2",children:t==="syncing"?e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"w-5 h-5 animate-spin"}),e.jsx("span",{children:"Syncing..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"w-5 h-5"}),e.jsx("span",{children:"Sync"})]})}),e.jsxs("button",{onClick:H,className:"flex-1 px-4 py-3 bg-transparent border border-red-500 text-red-500 hover:bg-red-500/10 font-semibold rounded-full transition-colors flex items-center justify-center gap-2",children:[e.jsx(oe,{className:"w-5 h-5"}),e.jsx("span",{children:"Log Out"})]})]})]}),e.jsx(te,{isOpen:D,onClose:I,zIndex:10001,children:e.jsxs("div",{className:"pb-6",children:[e.jsxs("div",{className:"mb-6 pl-4 pr-4",children:[e.jsx("div",{className:"text-lg font-semibold text-white",children:"Sync"}),e.jsx("div",{className:"text-sm text-gray-400 mt-1",children:"Cache song metadata to speed up search and loading times"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:()=>{T({scope:"incremental"}),A(!1),M()},disabled:t==="syncing",className:"w-full flex items-center gap-3 py-4 pr-4 pl-4 hover:bg-white/10 disabled:opacity-50 disabled:cursor-not-allowed text-white text-left rounded-lg transition-colors",children:[e.jsx(ue,{className:"w-5 h-5 text-white flex-shrink-0"}),e.jsx("span",{className:"font-medium",children:"New and updated files"})]}),e.jsxs("button",{onClick:()=>{T({scope:"full"}),A(!1),M()},disabled:t==="syncing",className:"w-full flex items-center gap-3 py-4 pr-4 pl-4 hover:bg-white/10 disabled:opacity-50 disabled:cursor-not-allowed text-white text-left rounded-lg transition-colors",children:[e.jsx(he,{className:"w-5 h-5 text-white flex-shrink-0"}),e.jsx("span",{className:"font-medium",children:"All files (slower)"})]})]})]})})]})]})}export{Se as default};
