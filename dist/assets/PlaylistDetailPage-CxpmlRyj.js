import{c as re,K as oe,N as ce,b as de,a as k,u as ue,i as V,r as a,x as me,j as e,I as B,e as f,O as xe,S as he,H as fe,C as U,A as _,l as H,f as pe,Q as ye}from"./index-BN1iXlsH.js";import{u as ge}from"./useScrollLazyLoad-Cb68UZHk.js";import{A as be}from"./arrow-left-C8KgElyz.js";import{E as je}from"./ellipsis-CaewBiUb.js";import{A as ve}from"./arrow-up-down-CHDXKgJe.js";/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=[["path",{d:"M16 5H3",key:"m91uny"}],["path",{d:"M11 12H3",key:"51ecnj"}],["path",{d:"M16 19H3",key:"zzsher"}],["path",{d:"M21 12h-6",key:"bt1uis"}]],Ie=re("list-minus",Ne),$=45,Pe=45;function we({track:t,index:g,tracks:b,onClick:j,onContextMenu:v,contextMenuItemId:C}){var x,h;const N=C===t.Id,p=V(),d=a.useRef(!1),I=r=>{r.preventDefault(),r.stopPropagation(),d.current=!0,v(t,"desktop",{x:r.clientX,y:r.clientY}),setTimeout(()=>{d.current=!1},300)},P=pe({onLongPress:r=>{r.preventDefault(),d.current=!0,v(t,"mobile")},onClick:()=>{if(d.current){d.current=!1;return}j(t,b)}});return e.jsxs("button",{onClick:()=>{if(d.current){d.current=!1;return}j(t,b)},onContextMenu:I,...P,className:`w-full flex items-center gap-3 hover:bg-white/10 transition-colors group px-4 py-3 ${N?"bg-white/10":""}`,children:[e.jsx("div",{className:"w-12 h-12 rounded-sm overflow-hidden flex-shrink-0 bg-zinc-900 self-center",children:e.jsx(B,{src:f.getAlbumArtUrl(t.AlbumId||t.Id,96),alt:t.Name,className:"w-full h-full object-cover",showOutline:!0,rounded:"rounded-sm"})}),e.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[e.jsx("div",{className:`text-sm font-medium truncate transition-colors ${(p==null?void 0:p.Id)===t.Id?"text-[var(--accent-color)]":"text-white group-hover:text-[var(--accent-color)]"}`,children:t.Name}),e.jsxs("div",{className:"text-xs text-gray-400 truncate",children:[t.AlbumArtist||((h=(x=t.ArtistItems)==null?void 0:x[0])==null?void 0:h.Name)||"Unknown Artist",t.Album&&` â€¢ ${t.Album}`]})]}),t.RunTimeTicks&&e.jsx("div",{className:"text-xs text-gray-500 flex-shrink-0 text-right",children:ye(t.RunTimeTicks)})]})}function Ae(t){return t?t.charAt(0).toUpperCase()+t.slice(1):""}function Oe(){const{id:t,moodValue:g}=oe(),b=ce(),j=de(),{playAlbum:v,playTrack:C,isPlaying:N,shuffleArtist:p}=k(),{songs:d,recordMoodAccess:I}=ue(),P=V(),[x,h]=a.useState(null),[r,w]=a.useState([]),[G,T]=a.useState(!0),[K,O]=a.useState(!1),[A,R]=a.useState(null),[Q,q]=a.useState("mobile"),[J,W]=a.useState(null),[X,L]=a.useState(!1),[Y,Z]=a.useState("mobile"),[ee,te]=a.useState(null),[E,F]=a.useState($),[M,se]=a.useState("PlaylistOrder"),[z,S]=a.useState(!1),le=k(n=>n.isQueueSidebarOpen),o=b.pathname.startsWith("/mood/");a.useEffect(()=>{if(o||!t)return;const n=()=>{(async()=>{var i;try{const u=await f.getPlaylistItems(t);w(u);const m=(await f.getPlaylists({limit:1e3})).Items.find(y=>y.Id===t);m&&(h(m),S(!!((i=m.ImageTags)!=null&&i.Primary)))}catch(u){H.error("Failed to refresh playlist data:",u)}})()};return window.addEventListener("playlistUpdated",n),()=>window.removeEventListener("playlistUpdated",n)},[t,o]);const ae=async(n,s)=>{if(!(!t||!("PlaylistItemId"in s)||!s.PlaylistItemId))try{await f.removeItemsFromPlaylist(t,[s.PlaylistItemId]),_.getState().addToast("Removed from playlist","success",2e3),w(i=>i.filter(u=>u.PlaylistItemId!==s.PlaylistItemId))}catch{_.getState().addToast("Failed to remove track","error",3e3)}};a.useEffect(()=>{if(o&&g){const s=decodeURIComponent(g).toLowerCase();I(s);const i=d.filter(l=>!l.Grouping||l.Grouping.length===0?!1:l.Grouping.some(m=>{const y=me(m);return y&&y.category==="mood"&&y.value===s}));h({Id:`mood-${s}`,Name:Ae(s),Type:"Mood"});const u=[...i].sort((l,m)=>(l.Name||"").localeCompare(m.Name||"")).map(l=>({Id:l.Id,Name:l.Name,AlbumArtist:l.AlbumArtist,ArtistItems:l.ArtistItems,Album:l.Album,AlbumId:l.AlbumId,RunTimeTicks:l.RunTimeTicks,Type:"Audio"}));w(u),T(!1);return}if(!t)return;(async()=>{var s;T(!0);try{const i=await f.getPlaylistItems(t);w(i);const l=(await f.getPlaylists({limit:1e3})).Items.find(m=>m.Id===t);l?(h(l),S(!!((s=l.ImageTags)!=null&&s.Primary))):i.length>0&&h({Id:t,Name:"Playlist",Type:"Playlist"})}catch(i){H.error("Failed to load playlist data:",i)}finally{T(!1)}})()},[t,o,g,I,d]),a.useEffect(()=>{F($)},[r.length]),ge({totalCount:r.length,visibleCount:E,increment:Pe,setVisibleCount:F,threshold:1.5});const c=a.useMemo(()=>o?r:M==="Alphabetical"?[...r].sort((n,s)=>(n.Name||"").localeCompare(s.Name||"")):r,[r,M,o]),ne=()=>{c.length>0&&v(c)},ie=()=>{c.length>0&&p(c)},D=()=>!c.length||!P?!1:c.some(n=>n.Id===P.Id);return G?e.jsx("div",{className:"pb-20",children:e.jsx("div",{className:"flex items-center justify-center h-screen text-gray-400",children:e.jsx("p",{children:"Loading..."})})}):x?e.jsxs("div",{className:"pb-20",children:[e.jsx("div",{className:`fixed top-0 left-0 right-0 bg-black z-10 lg:left-16 transition-[left,right] duration-300 ${le?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top))"},children:e.jsx("div",{className:"max-w-[768px] mx-auto",children:e.jsxs("div",{className:"flex items-center justify-between gap-4 pl-3 pr-4",style:{paddingTop:"calc(1rem + 8px)",paddingBottom:"1rem"},children:[e.jsx("button",{onClick:()=>j(-1),className:"text-white hover:text-zinc-300 transition-colors",children:e.jsx(be,{className:"w-6 h-6"})}),!o&&e.jsx("button",{onClick:n=>{const s=n.currentTarget.getBoundingClientRect();Z("desktop"),te({x:s.left+s.width/2,y:s.bottom+5}),L(!0)},className:"text-white hover:text-zinc-300 transition-colors",children:e.jsx(je,{className:"w-6 h-6"})})]})})}),e.jsxs("div",{className:"pt-20",children:[e.jsx("div",{className:"px-4 pt-4 mb-6",children:e.jsxs("div",{className:"flex items-end gap-6 md:grid md:grid-cols-3 md:gap-4",children:[z&&e.jsx("div",{className:"w-28 flex-shrink-0 md:w-auto md:col-span-1",children:e.jsx("div",{className:"aspect-square rounded overflow-hidden bg-zinc-900 flex items-center justify-center",children:e.jsx(B,{src:f.getImageUrl(x.Id,"Primary",474),alt:x.Name,className:"w-full h-full object-cover",showOutline:!0,rounded:"rounded",onError:()=>S(!1)})})}),e.jsxs("div",{className:`flex-1 min-w-0 pb-2 ${z?"md:col-span-2":"md:col-span-3"}`,children:[e.jsx("h2",{className:"text-4xl md:text-5xl font-bold mb-0.5 text-left break-words",children:x.Name}),c.length>0&&e.jsxs("div",{className:"flex items-center justify-between gap-4 mt-2",children:[e.jsxs("div",{className:"text-gray-400",children:[c.length," ",c.length===1?"track":"tracks"]}),e.jsx("button",{onClick:D()&&N?()=>k.getState().pause():o?ie:ne,className:"bg-white/10 hover:bg-white/20 text-white font-semibold py-1.5 px-3 rounded-full transition-all hover:scale-105 flex items-center gap-1.5 backdrop-blur-sm border border-white/20 flex-shrink-0",children:D()&&N?e.jsxs(e.Fragment,{children:[e.jsx(xe,{className:"w-3.5 h-3.5"}),"Pause"]}):o?e.jsxs(e.Fragment,{children:[e.jsx(he,{className:"w-3.5 h-3.5"}),"Shuffle"]}):e.jsxs(e.Fragment,{children:[e.jsx(fe,{className:"w-3.5 h-3.5"}),"Play"]})})]})]})]})}),c.length===0?e.jsx("div",{className:"flex items-center justify-center px-8 pt-24",children:e.jsx("p",{className:"text-gray-400 text-center",children:"Long press or right click on songs and albums to add them to playlists"})}):e.jsxs(e.Fragment,{children:[!o&&e.jsx("div",{className:"px-4 mb-1",children:e.jsxs("button",{type:"button",onClick:()=>se(n=>n==="PlaylistOrder"?"Alphabetical":"PlaylistOrder"),className:"text-sm text-gray-400 hover:text-white transition-colors flex items-center gap-1",children:[M==="PlaylistOrder"?"Playlist Order":"Alphabetically",e.jsx(ve,{className:"w-4 h-4"})]})}),e.jsx("div",{children:e.jsx("div",{className:"space-y-0",children:c.slice(0,E).map((n,s)=>e.jsx(we,{track:n,index:s,tracks:c,onClick:i=>C(i,c),onContextMenu:(i,u,l)=>{R(i),q(u||"mobile"),W(l||null),O(!0)},contextMenuItemId:(A==null?void 0:A.Id)||null},n.Id))})})]})]}),e.jsx(U,{item:A,itemType:"song",isOpen:K,onClose:()=>{O(!1),R(null)},mode:Q,position:J||void 0,extraActions:o?void 0:[{id:"removeFromPlaylist",label:"Remove from Playlist",icon:Ie}],onExtraAction:o?void 0:ae}),e.jsx(U,{item:x,itemType:"playlist",isOpen:X,onClose:()=>{L(!1)},mode:Y,position:ee||void 0})]}):e.jsx("div",{className:"pb-20",children:e.jsx("div",{className:"flex items-center justify-center h-screen text-gray-400",children:e.jsx("p",{children:o?"No songs found for this mood":"Playlist not found"})})})}export{Oe as default};
