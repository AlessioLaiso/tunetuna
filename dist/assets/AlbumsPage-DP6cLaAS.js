import{b as ie,r as s,f as ke,j as t,I as Ee,e as K,C as ce,u as m,a as _,d as Oe,l as oe,w as Te}from"./index-Cd7_tvNc.js";import{P as Le}from"./Pagination-DhULEqXY.js";import{u as Re,F as ae}from"./useSearch-DqWqC4MG.js";import{S as Fe}from"./search-DU52e0J2.js";import{u as De}from"./useScrollLazyLoad-kkH2xyzx.js";import{A as _e}from"./arrow-up-down-0ksViGcK.js";import"./chevron-right-D5vpBqml.js";import"./tag-BuedTwWn.js";import"./piano-Bjwssuqk.js";function Ye({album:o,onContextMenu:f,contextMenuItemId:$,showImage:B=!0}){var O,T,p,A,L,b,h,C,j,I,N,w;const y=ie(),[S,v]=s.useState(!1),[z,k]=s.useState("mobile"),[G,l]=s.useState(null),a=s.useRef(!1),Q=$===o.Id,E=r=>{if(a.current){r.preventDefault(),a.current=!1;return}y(`/album/${o.Id}`)},V=r=>{var u,d,x,P;r.preventDefault(),r.stopPropagation(),(d=(u=r.nativeEvent)==null?void 0:u.preventDefault)==null||d.call(u),(P=(x=r.nativeEvent)==null?void 0:x.stopImmediatePropagation)==null||P.call(x),a.current=!0,f?f(o,"album","desktop",{x:r.clientX,y:r.clientY}):(k("desktop"),l({x:r.clientX,y:r.clientY}),v(!0)),setTimeout(()=>{a.current=!1},300)},U=ke({onLongPress:r=>{r.preventDefault(),f?(a.current=!0,f(o,"album","mobile")):(a.current=!0,k("mobile"),l(null),v(!0))}});return t.jsxs(t.Fragment,{children:[t.jsxs("button",{onClick:r=>{if(S||a.current){r.preventDefault(),r.stopPropagation();return}E(r)},onContextMenu:r=>{V(r)},...U,className:`text-left group ${Q?"ring-2 ring-blue-500":""}`,children:[t.jsx("div",{className:"aspect-square rounded overflow-hidden bg-zinc-900 relative flex items-center justify-center",children:B?t.jsx(Ee,{src:K.getAlbumArtUrl(o.Id,474),alt:o.Name,className:"w-full h-full object-cover",showOutline:!0,rounded:"rounded"}):t.jsx("div",{className:"w-full h-full bg-zinc-900"})}),t.jsx("div",{className:"text-sm font-medium text-white truncate group-hover:text-[var(--accent-color)] transition-colors",children:o.Name}),t.jsx("div",{className:"text-xs text-gray-400 truncate",children:(T=(O=o.AlbumArtists)==null?void 0:O[0])!=null&&T.Id||(A=(p=o.ArtistItems)==null?void 0:p[0])!=null&&A.Id?t.jsx("span",{className:"clickable-text",onClick:r=>{var u,d;r.stopPropagation(),y(`/artist/${((d=(u=o.AlbumArtists)==null?void 0:u[0])==null?void 0:d.Id)||o.ArtistItems[0].Id}`)},children:o.AlbumArtist||((b=(L=o.AlbumArtists)==null?void 0:L[0])==null?void 0:b.Name)||((C=(h=o.ArtistItems)==null?void 0:h[0])==null?void 0:C.Name)||"Unknown Artist"}):o.AlbumArtist||((I=(j=o.AlbumArtists)==null?void 0:j[0])==null?void 0:I.Name)||((w=(N=o.ArtistItems)==null?void 0:N[0])==null?void 0:w.Name)||"Unknown Artist"})]}),t.jsx(ce,{item:o,itemType:"album",isOpen:S,onClose:()=>v(!1),mode:z,position:G||void 0})]})}const $e=[{type:"albums"},{type:"artists",limit:5},{type:"playlists"},{type:"songs"}],Y=84,le=45,Be=45;function We(){const o=m(e=>e.albums),f=m(e=>e.setAlbums),$=m(e=>e.sortPreferences),B=m(e=>e.setSortPreference),y=m(e=>e.setLoading),S=m(e=>e.loading),v=m(e=>e.genres),z=_(e=>e.playTrack),k=_(e=>e.playAlbum),G=_(e=>e.addToQueue),[l,a]=s.useState(!1),[Q,E]=s.useState(!1),[V,U]=s.useState("mobile"),[O,T]=s.useState(null),[p,A]=s.useState(null),[L,b]=s.useState(null),[h,C]=s.useState(0),[j,I]=s.useState(0),[N,w]=s.useState(le),r=ie(),[u,d]=Oe(),x=s.useRef(null),P=s.useRef(null),[W,H]=s.useState(!1),[q,ue]=s.useState(null),[de,Z]=s.useState([]),i=$.albums,R=s.useRef(!0),[me,ee]=s.useState(!1),te=s.useRef(i),X=_(e=>e.isQueueSidebarOpen),{searchQuery:M,setSearchQuery:fe,isSearching:pe,searchResults:c,selectedGenres:se,setSelectedGenres:he,yearRange:ne,setYearRange:J,clearSearch:F,clearAll:xe}=Re();s.useEffect(()=>{const e=u.get("year");if(e){const n=parseInt(e,10);!isNaN(n)&&n>0&&(J({min:n,max:n}),a(!0),d({},{replace:!0}))}},[u,d,J]),s.useEffect(()=>{(async()=>{try{const n=m.getState();if(n.years.length>0)Z(n.years);else{const g=await K.getYears();Z(g)}}catch(n){oe.error("Failed to load filter values:",n)}})()},[]),s.useEffect(()=>{if(l){const n=window.matchMedia("(hover: hover) and (pointer: fine) and (min-width: 1024px)").matches?P:x;setTimeout(()=>{var g;if((g=n.current)==null||g.focus(),n.current){const D=n.current.value.length;n.current.setSelectionRange(D,D)}},50)}},[l]),s.useEffect(()=>{if(!l)return;const e=n=>{n.key==="Escape"&&(n.preventDefault(),n.stopPropagation(),re())};return window.addEventListener("keydown",e,!0),()=>window.removeEventListener("keydown",e,!0)},[l]);const ge=e=>{fe(e),e.trim().length>0&&!l&&a(!0)},ye=()=>{F()},re=()=>{a(!1),xe()},Se=e=>{ue(e),H(!0)},ve=e=>{he(e)},Ae=e=>{J(e)},be=e=>{r(`/artist/${e}`),a(!1),F()},Ce=e=>{r(`/album/${e}`),a(!1),F()},je=e=>{z(e,[e])},Ie=()=>{c!=null&&c.songs&&c.songs.length>0&&k(c.songs)},Ne=()=>{c!=null&&c.songs&&c.songs.length>0&&G(c.songs)},we=e=>{r(`/playlist/${e}`),a(!1),F()},Pe=(e,n,g="mobile",D)=>{A(e),b(n),U(g),T(D||null),E(!0)};s.useEffect(()=>{const e=n=>{};return document.addEventListener("contextmenu",e,!0),()=>{document.removeEventListener("contextmenu",e,!0)}},[]),s.useEffect(()=>{M.trim()||C(0)},[i,M]),s.useEffect(()=>{w(le)},[h,o.length]),De({totalCount:o.length,visibleCount:N,increment:Be,setVisibleCount:w,threshold:1}),s.useEffect(()=>{M.trim()||(!R.current&&te.current!==i&&ee(!0),te.current=i,Me())},[h,i,M]),s.useEffect(()=>{R.current&&(R.current=!1)},[]);const Me=async()=>{y("albums",!0);try{const e={limit:Y,startIndex:h*Y};i==="RecentlyAdded"?(e.sortBy=["DateCreated"],e.sortOrder="Descending"):i==="Newest"?(e.sortBy=["ProductionYear","SortName"],e.sortOrder=["Descending","Ascending"]):(e.sortBy=["SortName"],e.sortOrder="Ascending");const n=await K.getAlbums(e);f(n.Items),I(n.TotalRecordCount||0)}catch(e){oe.error("Failed to load albums:",e),f([]),I(0)}finally{y("albums",!1),ee(!1)}};return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"pb-20",children:[t.jsx("div",{className:`fixed top-0 left-0 right-0 bg-black z-10 lg:left-16 transition-[left,right] duration-300 ${X?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top))"},children:t.jsx("div",{className:"max-w-[768px] mx-auto",children:t.jsxs("div",{className:"p-4 min-[780px]:px-[0.66rem]",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsx("h1",{className:"text-2xl font-bold text-white",children:"Albums"}),t.jsx("button",{onClick:()=>a(!0),className:"w-10 h-10 flex items-center justify-center text-white hover:bg-zinc-800 rounded-full transition-colors","aria-label":"Search",children:t.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})]}),!l&&t.jsxs("div",{className:"flex items-center justify-between gap-2",children:[t.jsxs("button",{onClick:()=>{B("albums",i==="RecentlyAdded"?"Alphabetical":i==="Alphabetical"?"Newest":"RecentlyAdded")},className:"text-sm text-gray-400 hover:text-white transition-colors flex items-center gap-1",children:[i==="RecentlyAdded"?"Recently Added":i==="Newest"?"Newest":"Alphabetically",t.jsx(_e,{className:"w-4 h-4"})]}),S.albums&&!R.current&&t.jsx("div",{className:"flex items-center",children:t.jsx(Te,{})})]})]})})}),t.jsx("div",{className:`fixed left-0 right-0 z-10 lg:left-16 transition-[left,right] duration-300 ${X?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 7rem - 8px)",height:"24px",background:"linear-gradient(to bottom, rgba(0, 0, 0, 0.8), transparent)"}}),t.jsx("div",{style:{paddingTop:"calc(env(safe-area-inset-top) + 7rem)"},onContextMenu:e=>{},children:t.jsx("div",{className:`${me?"opacity-50 pointer-events-none":""} ${l?"hidden [@media((hover:hover)_and_(pointer:fine)_and_(min-width:1024px))]:block":""}`,onContextMenu:e=>{},children:o.length===0&&!S.albums?t.jsx("div",{className:"flex items-center justify-center py-16 text-gray-400",children:t.jsx("p",{children:"No albums found"})}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"p-4",children:t.jsx("div",{className:"grid grid-cols-3 md:grid-cols-4 gap-3",onContextMenu:e=>{},children:o.map((e,n)=>t.jsx(Ye,{album:e,onContextMenu:Pe,contextMenuItemId:(p==null?void 0:p.Id)||null,showImage:n<N},e.Id))})}),t.jsx(Le,{currentPage:h,totalPages:Math.ceil(j/Y),onPageChange:C,itemsPerPage:Y,totalItems:j})]})})})]}),t.jsx(Fe,{isOpen:l,onClose:re,title:"Search",searchQuery:M,onSearchChange:ge,onClearSearch:ye,isLoading:pe,results:c,sections:$e,filterConfig:{showGenreFilter:!0,showYearFilter:!0,showGroupingFilters:!1},filterState:{selectedGenres:se,yearRange:ne,selectedGroupings:{}},onOpenFilterSheet:Se,onArtistClick:be,onAlbumClick:Ce,onSongClick:je,onPlaylistClick:we,onPlayAllSongs:Ie,onAddSongsToQueue:Ne,isQueueSidebarOpen:X,desktopSearchInputRef:P,mobileSearchInputRef:x}),q==="genre"&&t.jsx(ae,{isOpen:W,onClose:()=>H(!1),filterType:"genre",genres:v,selectedValues:se,onApply:ve}),q==="year"&&t.jsx(ae,{isOpen:W,onClose:()=>H(!1),filterType:"year",availableYears:de,yearRange:ne,onApplyYear:Ae}),t.jsx(ce,{item:p,itemType:L,isOpen:Q,onClose:()=>{E(!1),A(null),b(null)},zIndex:99999,mode:V,position:O||void 0})]})}export{We as default};
