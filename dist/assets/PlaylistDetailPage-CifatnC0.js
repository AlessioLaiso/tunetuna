import{c as be,K as Ie,N as Ne,b as je,a as H,u as W,i as Z,r as l,e as x,l as _,O as $,x as Pe,j as e,I as ee,Q as we,S as Ce,H as Te,C as X,f as Ae,R as Se,T as Me}from"./index-Def-zOqH.js";import{u as ke}from"./useScrollLazyLoad-DmodI_VF.js";import{A as Oe}from"./arrow-left-7VMywoCX.js";import{E as De}from"./ellipsis-CqmsnN94.js";import{A as Le}from"./arrow-up-down-CUJ3dVTa.js";/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=[["path",{d:"M16 5H3",key:"m91uny"}],["path",{d:"M11 12H3",key:"51ecnj"}],["path",{d:"M16 19H3",key:"zzsher"}],["path",{d:"M21 12h-6",key:"bt1uis"}]],Fe=be("list-minus",Ee),Y=45,ze=45;function Re({track:t,index:p,tracks:A,onClick:S,onContextMenu:M,contextMenuItemId:E,reorderable:j,onReorderDragStart:P,onReorderDragEnd:b,onReorderDrop:g,onDragEnterRow:y,isDragOver:v}){var C,O;const I=E===t.Id,h=Z(),d=l.useRef(!1),F=r=>{r.preventDefault(),r.stopPropagation(),d.current=!0,M(t,"desktop",{x:r.clientX,y:r.clientY}),setTimeout(()=>{d.current=!1},300)},w=Ae({onLongPress:r=>{r.preventDefault(),d.current=!0,M(t,"mobile")},onClick:()=>{if(d.current){d.current=!1;return}S(t,A)}}),z=l.useCallback(r=>{r.preventDefault(),r.dataTransfer.dropEffect="move"},[]),k=l.useCallback(r=>{r.preventDefault(),y==null||y(p)},[y,p]),N=l.useCallback(r=>{g==null||g(r,p)},[g,p]);return e.jsxs("div",{className:`relative w-full flex items-center gap-3 hover:bg-white/10 transition-colors group px-4 py-3 cursor-pointer ${I?"bg-white/10":""}`,onClick:()=>{if(d.current){d.current=!1;return}S(t,A)},onContextMenu:F,...w,...j?{onDragOver:z,onDragEnter:k,onDrop:N}:{},children:[v&&e.jsx("div",{className:"absolute left-3 right-3 top-0 h-0.5 bg-[var(--accent-color)] rounded-full pointer-events-none"}),e.jsx("div",{className:"playlist-drag-art w-12 h-12 rounded-sm overflow-hidden flex-shrink-0 bg-zinc-900 self-center",children:e.jsx(ee,{src:x.getAlbumArtUrl(t.AlbumId||t.Id,96),alt:t.Name,className:"w-full h-full object-cover",showOutline:!0,rounded:"rounded-sm"})}),e.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[e.jsx("div",{className:`text-sm font-medium truncate transition-colors ${(h==null?void 0:h.Id)===t.Id?"text-[var(--accent-color)]":"text-white group-hover:text-[var(--accent-color)]"}`,children:t.Name}),e.jsxs("div",{className:"text-xs text-gray-400 truncate",children:[t.AlbumArtist||((O=(C=t.ArtistItems)==null?void 0:C[0])==null?void 0:O.Name)||"Unknown Artist",t.Album&&` â€¢ ${t.Album}`]})]}),t.RunTimeTicks&&e.jsx("div",{className:"text-xs text-gray-500 flex-shrink-0 text-right",children:Se(t.RunTimeTicks)}),j&&e.jsx("button",{draggable:!0,onMouseDown:r=>r.stopPropagation(),onTouchStart:r=>r.stopPropagation(),onDragStart:r=>{r.stopPropagation(),P==null||P(r,p)},onDragEnd:r=>{r.stopPropagation(),b==null||b()},className:"text-gray-500 hover:text-zinc-300 transition-colors p-2 cursor-grab active:cursor-grabbing focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--accent-color)] rounded","aria-label":"Drag to reorder",children:e.jsx(Me,{className:"w-4 h-4"})})]})}function Ue(t){return t?t.charAt(0).toUpperCase()+t.slice(1):""}function Ke(){const{id:t,moodValue:p}=Ie(),A=Ne(),S=je(),{playAlbum:M,playTrack:E,isPlaying:j,shuffleArtist:P}=H(),b=W(s=>s.songs),g=W(s=>s.recordMoodAccess),y=Z(),[v,I]=l.useState(null),[h,d]=l.useState([]),[F,w]=l.useState(!0),[z,k]=l.useState(!1),[N,C]=l.useState(null),[O,r]=l.useState("mobile"),[te,se]=l.useState(null),[ae,G]=l.useState(!1),[le,ne]=l.useState("mobile"),[re,ie]=l.useState(null),[V,K]=l.useState(Y),[D,oe]=l.useState("PlaylistOrder"),[Q,R]=l.useState(!1),[q,ce]=l.useState(0),de=H(s=>s.isQueueSidebarOpen),[ue,U]=l.useState(null),[Be,B]=l.useState(null),L=l.useRef(null),me=l.useCallback((s,a)=>{s.dataTransfer.effectAllowed="move",s.dataTransfer.setData("text/plain",a.toString()),B(a),L.current=a;const i=s.currentTarget,o=i==null?void 0:i.closest(".playlist-track-row");if(o&&s.dataTransfer.setDragImage){const c=o.querySelector(".playlist-drag-art")??o,m=c.getBoundingClientRect();s.dataTransfer.setDragImage(c,m.width/2,m.height/2)}},[]),fe=l.useCallback(()=>{B(null),U(null),L.current=null},[]),he=l.useCallback(async(s,a)=>{s.preventDefault();const i=s.dataTransfer.getData("text/plain")||s.dataTransfer.getData("text/html"),o=parseInt(i,10);if(U(null),B(null),L.current=null,Number.isNaN(o)||o===a)return;d(c=>{const m=[...c],[T]=m.splice(o,1);return m.splice(a,0,T),m});const n=h[o];if(t&&(n!=null&&n.PlaylistItemId))try{await x.movePlaylistItem(t,n.PlaylistItemId,a)}catch(c){_.error("Failed to reorder playlist item:",c),$.getState().addToast("Failed to reorder track","error",3e3),d(m=>{const T=[...m],[ve]=T.splice(a,1);return T.splice(o,0,ve),T})}},[h,t]),pe=l.useCallback(s=>{L.current!=null&&U(s)},[]),u=A.pathname.startsWith("/mood/");l.useEffect(()=>{if(u||!t)return;const s=()=>{(async()=>{var i;try{const o=await x.getPlaylistItems(t);d(o);const c=(await x.getPlaylists({limit:1e3})).Items.find(m=>m.Id===t);c&&(I(c),R(!!((i=c.ImageTags)!=null&&i.Primary)),ce(Date.now()))}catch(o){_.error("Failed to refresh playlist data:",o)}})()};return window.addEventListener("playlistUpdated",s),()=>window.removeEventListener("playlistUpdated",s)},[t,u]);const xe=async(s,a)=>{if(!(!t||!("PlaylistItemId"in a)||!a.PlaylistItemId))try{await x.removeItemsFromPlaylist(t,[a.PlaylistItemId]),$.getState().addToast("Removed from playlist","success",2e3),d(i=>i.filter(o=>o.PlaylistItemId!==a.PlaylistItemId))}catch{$.getState().addToast("Failed to remove track","error",3e3)}};l.useEffect(()=>{if(u&&p){const a=decodeURIComponent(p).toLowerCase();g(a);const i=b.filter(n=>!n.Grouping||n.Grouping.length===0?!1:n.Grouping.some(c=>{const m=Pe(c);return m&&m.category==="mood"&&m.value===a}));I({Id:`mood-${a}`,Name:Ue(a),Type:"Mood"});const o=[...i].sort((n,c)=>(n.Name||"").localeCompare(c.Name||"")).map(n=>({Id:n.Id,Name:n.Name,AlbumArtist:n.AlbumArtist,ArtistItems:n.ArtistItems,Album:n.Album,AlbumId:n.AlbumId,RunTimeTicks:n.RunTimeTicks,Type:"Audio"}));d(o),w(!1);return}if(!t)return;(async()=>{var a;w(!0);try{const i=await x.getPlaylistItems(t);d(i);const n=(await x.getPlaylists({limit:1e3})).Items.find(c=>c.Id===t);n?(I(n),R(!!((a=n.ImageTags)!=null&&a.Primary))):i.length>0&&I({Id:t,Name:"Playlist",Type:"Playlist"})}catch(i){_.error("Failed to load playlist data:",i)}finally{w(!1)}})()},[t,u,p,g,b]),l.useEffect(()=>{K(Y)},[h.length]),ke({totalCount:h.length,visibleCount:V,increment:ze,setVisibleCount:K,threshold:1.5});const f=l.useMemo(()=>u?h:D==="Alphabetical"?[...h].sort((s,a)=>(s.Name||"").localeCompare(a.Name||"")):h,[h,D,u]),ge=()=>{f.length>0&&M(f)},ye=()=>{f.length>0&&P(f)},J=()=>!f.length||!y?!1:f.some(s=>s.Id===y.Id);return F?e.jsx("div",{className:"pb-20",children:e.jsx("div",{className:"flex items-center justify-center h-screen text-gray-400",children:e.jsx("p",{children:"Loading..."})})}):v?e.jsxs("div",{className:"pb-20",children:[e.jsx("div",{className:`fixed top-0 left-0 right-0 bg-black z-10 lg:left-16 transition-[left,right] duration-300 ${de?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top))"},children:e.jsx("div",{className:"max-w-[768px] mx-auto",children:e.jsxs("div",{className:"flex items-center justify-between gap-4 pl-3 pr-4",style:{paddingTop:"calc(1rem + 8px)",paddingBottom:"1rem"},children:[e.jsx("button",{onClick:()=>S(-1),className:"text-white hover:text-zinc-300 transition-colors",children:e.jsx(Oe,{className:"w-6 h-6"})}),!u&&e.jsx("button",{onClick:s=>{const a=s.currentTarget.getBoundingClientRect();ne("desktop"),ie({x:a.left+a.width/2,y:a.bottom+5}),G(!0)},className:"text-white hover:text-zinc-300 transition-colors",children:e.jsx(De,{className:"w-6 h-6"})})]})})}),e.jsxs("div",{className:"pt-20",children:[e.jsx("div",{className:"px-4 pt-4 mb-6",children:e.jsxs("div",{className:"flex items-end gap-6 md:grid md:grid-cols-3 md:gap-4",children:[Q&&e.jsx("div",{className:"w-28 flex-shrink-0 md:w-auto md:col-span-1",children:e.jsx("div",{className:"aspect-square rounded overflow-hidden bg-zinc-900 flex items-center justify-center",children:e.jsx(ee,{src:x.getImageUrl(v.Id,"Primary",474)+(q?`&cb=${q}`:""),alt:v.Name,className:"w-full h-full object-cover",showOutline:!0,rounded:"rounded",onError:()=>R(!1)})})}),e.jsxs("div",{className:`flex-1 min-w-0 pb-2 ${Q?"md:col-span-2":"md:col-span-3"}`,children:[e.jsx("h2",{className:"text-4xl md:text-5xl font-bold mb-0.5 text-left break-words",children:v.Name}),f.length>0&&e.jsxs("div",{className:"flex items-center justify-between gap-4 mt-2",children:[e.jsxs("div",{className:"text-gray-400",children:[f.length," ",f.length===1?"track":"tracks"]}),e.jsx("button",{onClick:J()&&j?()=>H.getState().pause():u?ye:ge,className:"bg-white/10 hover:bg-white/20 text-white font-semibold py-1.5 px-3 rounded-full transition-all hover:scale-105 flex items-center gap-1.5 backdrop-blur-sm border border-white/20 flex-shrink-0",children:J()&&j?e.jsxs(e.Fragment,{children:[e.jsx(we,{className:"w-3.5 h-3.5"}),"Pause"]}):u?e.jsxs(e.Fragment,{children:[e.jsx(Ce,{className:"w-3.5 h-3.5"}),"Shuffle"]}):e.jsxs(e.Fragment,{children:[e.jsx(Te,{className:"w-3.5 h-3.5"}),"Play"]})})]})]})]})}),f.length===0?e.jsx("div",{className:"flex items-center justify-center px-8 pt-24",children:e.jsx("p",{className:"text-gray-400 text-center",children:"Long press or right click on songs and albums to add them to playlists"})}):e.jsxs(e.Fragment,{children:[!u&&e.jsx("div",{className:"px-4 mb-1",children:e.jsxs("button",{type:"button",onClick:()=>oe(s=>s==="PlaylistOrder"?"Alphabetical":"PlaylistOrder"),className:"text-sm text-gray-400 hover:text-white transition-colors flex items-center gap-1",children:[D==="PlaylistOrder"?"Playlist Order":"Alphabetically",e.jsx(Le,{className:"w-4 h-4"})]})}),e.jsx("div",{children:e.jsx("div",{className:"space-y-0",children:f.slice(0,V).map((s,a)=>e.jsx("div",{className:"playlist-track-row",children:e.jsx(Re,{track:s,index:a,tracks:f,onClick:i=>E(i,f),onContextMenu:(i,o,n)=>{C(i),r(o||"mobile"),se(n||null),k(!0)},contextMenuItemId:(N==null?void 0:N.Id)||null,reorderable:D==="PlaylistOrder"&&!u,onReorderDragStart:me,onReorderDragEnd:fe,onReorderDrop:he,onDragEnterRow:pe,isDragOver:ue===a})},s.Id))})})]})]}),e.jsx(X,{item:N,itemType:"song",isOpen:z,onClose:()=>{k(!1),C(null)},mode:O,position:te||void 0,extraActions:u?void 0:[{id:"removeFromPlaylist",label:"Remove from Playlist",icon:Fe}],onExtraAction:u?void 0:xe}),e.jsx(X,{item:v,itemType:"playlist",isOpen:ae,onClose:()=>{G(!1)},mode:le,position:re||void 0})]}):e.jsx("div",{className:"pb-20",children:e.jsx("div",{className:"flex items-center justify-center h-screen text-gray-400",children:e.jsx("p",{children:u?"No songs found for this mood":"Playlist not found"})})})}export{Ke as default};
