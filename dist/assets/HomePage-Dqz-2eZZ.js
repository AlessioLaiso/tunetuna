import{c as Te,r as o,u as H,g as Ee,a as ce,b as we,d as Ge,j as e,S as qe,l as ge,e as O,I as Ae,C as Se,f as Ue,D as Ce,A as Ve,h as Ye,B as Xe,i as ve,k as Qe,F as ye,M as Ze}from"./index-CL-vPxhG.js";import{S as Je}from"./search-CmJSbKR8.js";import{u as Ke,F as je}from"./useSearch-DXTlQYhC.js";import{C as et,a as tt}from"./chevron-right-DOJZK_3J.js";import{E as st}from"./ellipsis-DNX-YLMM.js";import"./tag-DL2VFUzx.js";import"./piano-yv-kG2jV.js";/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nt=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],lt=Te("search",nt);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rt=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],ot=Te("settings",rt),it=[{type:"artists",limit:5},{type:"albums",limit:12},{type:"playlists"},{type:"songs"}];function at({onSearchStateChange:t,title:i="Search"}){const[s,a]=o.useState(!1),u=o.useRef(null),h=o.useRef(null),[x,g]=o.useState(!1),[f,d]=o.useState(null),[m,l]=o.useState(null),{genres:c,songs:r}=H(),[p,I]=o.useState([]),$=o.useMemo(()=>Ee(r),[r]),{playAlbum:R,addToQueue:P,playTrack:S,shuffleAllSongs:n,isQueueSidebarOpen:w}=ce(),[N,j]=o.useState(!1),{searchQuery:L,setSearchQuery:X,isSearching:Q,searchResults:T,selectedGenres:Z,setSelectedGenres:J,yearRange:W,setYearRange:K,selectedGroupings:q,setSelectedGroupings:ee,groupingMatchModes:se,setGroupingMatchModes:te,clearSearch:V,clearAll:de}=Ke({debounceMs:300});o.useEffect(()=>{if(N){const b=setTimeout(()=>{j(!1)},1e4);return()=>clearTimeout(b)}},[N]);const G=we(),[ne,ue]=Ge();o.useEffect(()=>{const b=ne.get("yearMin"),C=ne.get("yearMax"),U=ne.get("genre");let Y=!1;(b||C)&&(K({min:b?parseInt(b,10):null,max:C?parseInt(C,10):null}),Y=!0),U&&(J([U]),Y=!0),Y&&(a(!0),ue({},{replace:!0}))},[]),o.useEffect(()=>{(async()=>{try{const C=H.getState();if(C.years.length>0)I(C.years);else{const U=await O.getYears();I(U)}}catch(C){ge.error("Failed to load filter values:",C)}})()},[]);const me=b=>{X(b),b.trim().length>0&&!s&&a(!0)},M=b=>{G(`/artist/${b}`),a(!1),V()},F=b=>{G(`/album/${b}`),a(!1),V()},z=b=>{S(b,[b])},B=b=>{G(`/playlist/${b}`),a(!1),V()},D=()=>{V()},y=()=>{a(!1),de()},E=b=>{d(b),g(!0)},v=b=>{J(b)},k=b=>{K(b)},A=b=>{l(b),d("grouping"),g(!0)},le=(b,C)=>{ee(U=>({...U,[b]:C}))},oe=(b,C)=>{te(U=>({...U,[b]:C}))},ie=()=>{T!=null&&T.songs&&T.songs.length>0&&R(T.songs)},pe=()=>{T!=null&&T.songs&&T.songs.length>0&&P(T.songs)},re=s;return o.useEffect(()=>{t&&t(re)},[re,t]),o.useEffect(()=>{if(s){const C=window.matchMedia("(hover: hover) and (pointer: fine) and (min-width: 1024px)").matches?h:u;setTimeout(()=>{var U;if((U=C.current)==null||U.focus(),C.current){const Y=C.current.value.length;C.current.setSelectionRange(Y,Y)}},50)}},[s]),o.useEffect(()=>{if(!s)return;const b=C=>{C.key==="Escape"&&(C.preventDefault(),C.stopPropagation(),y())};return window.addEventListener("keydown",b,!0),()=>window.removeEventListener("keydown",b,!0)},[s]),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"px-4 md:pl-2 md:pr-4 pt-4 pb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Tunetuna"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:async()=>{const b=ce.getState(),{isShuffleAllActive:C,isShuffleGenreActive:U}=b;if(!(N||C||U)){j(!0);try{await n()}catch(Y){ge.error("Home shuffle button - shuffleAllSongs failed:",Y),ge.error("Shuffle all failed:",Y)}finally{j(!1)}}},disabled:N,className:"w-10 h-10 flex items-center justify-center text-white hover:bg-zinc-800 rounded-full transition-colors disabled:opacity-50","aria-label":"Shuffle all songs",children:N?e.jsx("div",{className:"w-5 h-5 border-2 border-zinc-400 border-t-white rounded-full animate-spin"}):e.jsx(qe,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>a(!0),className:"w-10 h-10 flex items-center justify-center text-white hover:bg-zinc-800 rounded-full transition-colors","aria-label":"Search",children:e.jsx(lt,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>G("/settings"),className:"w-10 h-10 flex items-center justify-center text-white hover:bg-zinc-800 rounded-full transition-colors","aria-label":"Settings",children:e.jsx(ot,{className:"w-5 h-5"})})]})]})}),e.jsx(Je,{isOpen:s,onClose:y,title:i,searchQuery:L,onSearchChange:me,onClearSearch:D,isLoading:Q,results:T,sections:it,filterConfig:{showGenreFilter:!0,showYearFilter:!0,showGroupingFilters:!0},filterState:{selectedGenres:Z,yearRange:W,selectedGroupings:q},onOpenFilterSheet:E,groupingCategories:$,onOpenGroupingFilterSheet:A,onArtistClick:M,onAlbumClick:F,onSongClick:z,onPlaylistClick:B,onPlayAllSongs:ie,onAddSongsToQueue:pe,isQueueSidebarOpen:w,desktopSearchInputRef:h,mobileSearchInputRef:u}),f==="genre"&&e.jsx(je,{isOpen:x,onClose:()=>g(!1),filterType:"genre",genres:c,selectedValues:Z,onApply:v}),f==="year"&&e.jsx(je,{isOpen:x,onClose:()=>g(!1),filterType:"year",availableYears:p,yearRange:W,onApplyYear:k}),f==="grouping"&&m&&e.jsx(je,{isOpen:x,onClose:()=>g(!1),filterType:"grouping",groupingCategory:m,selectedGroupingValues:q[m.key]||[],onApplyGrouping:le,groupingMatchMode:se[m.key]||"or",onGroupingMatchModeChange:oe})]})}function Ne({moodValue:t,moodName:i,albumId:s}){const a=we(),{recordMoodAccess:u}=H(),h=()=>{u(t),a(`/mood/${encodeURIComponent(t)}`)};return e.jsxs("button",{onClick:h,className:"bg-zinc-800/50 rounded border border-zinc-700/50 hover:bg-zinc-800 transition-colors group text-left flex items-center w-full h-11 overflow-hidden",children:[s&&e.jsx("div",{className:"h-full flex-shrink-0 hidden md:block",children:e.jsx(Ae,{src:O.getAlbumArtUrl(s,56),alt:"",className:"w-full h-full object-cover",showOutline:!1,rounded:""})}),e.jsx("div",{className:"text-sm font-medium text-white group-hover:text-[var(--accent-color)] transition-colors truncate py-2 pl-3",children:i})]})}function Pe({children:t,className:i="",gap:s=12}){const a=o.useRef(null),[u,h]=o.useState(!1),[x,g]=o.useState(!1),[f,d]=o.useState(!1),m=()=>{if(!a.current)return;const{scrollLeft:c,scrollWidth:r,clientWidth:p}=a.current;h(c>0),g(c+p<r-1)};o.useEffect(()=>{m();const c=a.current;if(c)return c.addEventListener("scroll",m,{passive:!0}),window.addEventListener("resize",m),()=>{c.removeEventListener("scroll",m),window.removeEventListener("resize",m)}},[t]);const l=c=>{if(!a.current)return;const r=a.current,p=r.clientWidth+s;r.scrollBy({left:c==="left"?-p:p,behavior:"smooth"})};return e.jsxs("div",{className:"relative",onMouseEnter:()=>d(!0),onMouseLeave:()=>d(!1),children:[e.jsx("div",{ref:a,className:`overflow-x-auto scrollbar-hide ${i}`,style:{scrollbarWidth:"none",msOverflowStyle:"none"},children:t}),u&&f&&e.jsx("button",{onClick:()=>l("left"),className:"absolute left-0 top-1/2 -translate-y-1/2 z-10 w-10 h-10 flex items-center justify-center bg-black/70 hover:bg-black/90 rounded-full transition-colors","aria-label":"Scroll left",children:e.jsx(et,{className:"w-6 h-6 text-white"})}),x&&f&&e.jsx("button",{onClick:()=>l("right"),className:"absolute right-0 top-1/2 -translate-y-1/2 z-10 w-10 h-10 flex items-center justify-center bg-black/70 hover:bg-black/90 rounded-full transition-colors","aria-label":"Scroll right",children:e.jsx(tt,{className:"w-6 h-6 text-white"})}),e.jsx("style",{children:`
        .scrollbar-hide::-webkit-scrollbar {
          display: none;
        }
      `})]})}function ct(t){let i=0;for(let s=0;s<t.length;s++){const a=t.charCodeAt(s);i=(i<<5)-i+a,i=i&i}return i}function dt(t){const i=new Date().toISOString().split("T")[0];return ct(`${i}-${t}`)}function ut(t){return t?t.charAt(0).toUpperCase()+t.slice(1):""}function mt(t,i,s){const a=i.filter(f=>{var d;return(d=f.Grouping)==null?void 0:d.some(m=>m.toLowerCase()===`mood_${t.toLowerCase()}`)});if(a.length===0)return null;const u=a.filter(f=>f.AlbumId);if(u.length===0)return null;let h=u.filter(f=>!s.has(f.AlbumId));h.length===0&&(h=u);const x=dt(t),g=Math.abs(x)%h.length;return h[g].AlbumId}function ft(t,i){return[...t].sort((s,a)=>{const u=i[s.toLowerCase()]||0,h=i[a.toLowerCase()]||0;return u!==h?h-u:s.localeCompare(a)})}function Re(t,i){const s=Math.ceil(t.length/i),a=[];for(let u=0;u<s;u++)for(let h=0;h<i;h++){const x=h*s+u;x<t.length&&a.push(t[x])}return a}function ht(){const{songs:t,recentlyAccessedMoods:i}=H(),s=o.useRef(null),[a,u]=o.useState(0),h=o.useMemo(()=>Ee(t).find(c=>c.key==="mood"),[t]),x=o.useMemo(()=>{if(!h||h.values.length===0)return[];const l=ft(h.values,i),c=new Set;return l.map(r=>{const p=mt(r.toLowerCase(),t,c);return p&&c.add(p),{value:r.toLowerCase(),name:ut(r),albumId:p}})},[h,t,i]);if(x.length===0)return null;const g=()=>{if(!s.current)return;const l=s.current,c=l.scrollLeft,r=l.clientWidth,p=Math.round(c/r);u(p)},f=l=>{if(!s.current)return;const c=s.current,r=c.clientWidth;c.scrollTo({left:l*r,behavior:"smooth"})},d=6,m=[];for(let l=0;l<x.length;l+=d)m.push(x.slice(l,l+d));return e.jsxs("div",{className:"px-4 mb-4",children:[e.jsxs("div",{className:"md:hidden",children:[e.jsx("div",{ref:s,onScroll:g,className:"overflow-x-auto snap-x snap-mandatory scrollbar-hide",style:{scrollbarWidth:"none",msOverflowStyle:"none"},children:e.jsx("div",{className:"flex",style:{width:`${m.length*100}%`},children:m.map((l,c)=>{const r=Math.ceil(l.length/3);return e.jsx("div",{className:"snap-start flex-shrink-0 w-full",style:{width:`${100/m.length}%`},children:e.jsx("div",{className:"grid grid-cols-3 gap-2",style:{gridTemplateRows:`repeat(${r}, minmax(0, 1fr))`},children:l.map(p=>e.jsx(Ne,{moodValue:p.value,moodName:p.name,albumId:p.albumId},p.value))})},c)})})}),m.length>1&&e.jsx("div",{className:"flex justify-center gap-2 mt-3",children:m.map((l,c)=>e.jsx("button",{onClick:()=>f(c),className:`w-2 h-2 rounded-full transition-colors ${c===a?"bg-white":"bg-zinc-600"}`,"aria-label":`Go to page ${c+1}`},c))})]}),e.jsx("div",{className:"hidden md:block min-[1680px]:hidden",children:e.jsx(Pe,{gap:8,children:e.jsx("div",{className:"grid grid-rows-2 grid-flow-col gap-2",style:{gridAutoColumns:"calc((100% - 24px) / 4)"},children:Re(x,2).map(l=>e.jsx(Ne,{moodValue:l.value,moodName:l.name,albumId:l.albumId},l.value))})})}),e.jsx("div",{className:"hidden min-[1680px]:block",children:e.jsx(Pe,{gap:8,children:e.jsx("div",{className:"grid grid-rows-2 grid-flow-col gap-2",style:{gridAutoColumns:"calc((100% - 32px) / 5)"},children:Re(x,2).map(l=>e.jsx(Ne,{moodValue:l.value,moodName:l.name,albumId:l.albumId},l.value))})})}),e.jsx("style",{children:`
        .scrollbar-hide::-webkit-scrollbar {
          display: none;
        }
      `})]})}function Me({album:t,onNavigate:i,onContextMenu:s}){var d,m;const[a,u]=o.useState(!1),h=o.useRef(!1),x=l=>{if(h.current){h.current=!1;return}i(t.Id)},g=l=>{l.preventDefault(),l.stopPropagation(),h.current=!0,s(t,"desktop",{x:l.clientX,y:l.clientY}),setTimeout(()=>{h.current=!1},300)},f=Ue({onLongPress:l=>{l.preventDefault(),h.current=!0,s(t,"mobile")},onClick:()=>{if(h.current){h.current=!1;return}x()}});return e.jsxs("button",{onClick:()=>{if(h.current){h.current=!1;return}x()},onContextMenu:g,...f,className:"text-left group",children:[e.jsx("div",{className:"aspect-square rounded overflow-hidden mb-2 bg-zinc-900 flex items-center justify-center",children:a?e.jsx(Ce,{className:"w-12 h-12 text-gray-500"}):e.jsx(Ae,{src:O.getAlbumArtUrl(t.Id,474),alt:t.Name,className:"w-full h-full object-cover",showOutline:!0,rounded:"rounded",onError:()=>u(!0)})}),e.jsx("div",{className:"text-sm font-medium text-white truncate group-hover:text-[var(--accent-color)] transition-colors",children:t.Name}),e.jsx("div",{className:"text-xs text-gray-400 truncate",children:t.AlbumArtist||((m=(d=t.ArtistItems)==null?void 0:d[0])==null?void 0:m.Name)||"Unknown Artist"})]})}function pt(){const{recentlyAdded:t,setRecentlyAdded:i,setLoading:s}=H(),a=we(),u=o.useRef(null),[h,x]=o.useState(0),[g,f]=o.useState(!1),[d,m]=o.useState("mobile"),[l,c]=o.useState(null),[r,p]=o.useState(null);o.useEffect(()=>{(async()=>{s("recentlyAdded",!0);try{const n=await O.getRecentlyAdded(18);i(n.Items||[])}catch(n){ge.error("Failed to load recently added:",n)}finally{s("recentlyAdded",!1)}})()},[i,s]);const I=()=>{if(!u.current)return;const S=u.current,n=S.scrollLeft,w=S.clientWidth,N=Math.round(n/w);x(N)},$=S=>{if(!u.current)return;const n=u.current,w=n.clientWidth;n.scrollTo({left:S*w,behavior:"smooth"})};if(!t||t.length===0)return null;const R=6,P=[];for(let S=0;S<t.length;S+=R)P.push(t.slice(S,S+R));return e.jsxs("div",{className:"px-4 mb-8",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Recently Added"}),e.jsxs("div",{className:"md:hidden",children:[e.jsx("div",{ref:u,onScroll:I,className:"overflow-x-auto snap-x snap-mandatory scrollbar-hide",style:{scrollbarWidth:"none",msOverflowStyle:"none"},children:e.jsx("div",{className:"flex",style:{width:`${P.length*100}%`},children:P.map((S,n)=>{const w=Math.ceil(S.length/3);return e.jsx("div",{className:"snap-start flex-shrink-0 w-full",style:{width:`${100/P.length}%`},children:e.jsx("div",{className:"grid grid-cols-3 gap-3",style:{gridTemplateRows:`repeat(${w}, minmax(0, 1fr))`},children:S.map(N=>e.jsx(Me,{album:N,onNavigate:j=>a(`/album/${j}`),onContextMenu:(j,L,X)=>{p(j),m(L||"desktop"),c(X||null),f(!0)}},N.Id))})},n)})})}),P.length>1&&e.jsx("div",{className:"flex justify-center gap-2 mt-4",children:P.map((S,n)=>e.jsx("button",{onClick:()=>$(n),className:`w-2 h-2 rounded-full transition-colors ${n===h?"bg-white":"bg-zinc-600"}`,"aria-label":`Go to page ${n+1}`},n))})]}),e.jsx("div",{className:"hidden md:block min-[1680px]:hidden",children:e.jsx("div",{className:"grid grid-cols-4 gap-3",children:t.slice(0,8).map(S=>e.jsx(Me,{album:S,onNavigate:n=>a(`/album/${n}`),onContextMenu:(n,w,N)=>{p(n),m(w||"desktop"),c(N||null),f(!0)}},S.Id))})}),e.jsx("div",{className:"hidden min-[1680px]:block",children:e.jsx("div",{className:"grid grid-cols-5 gap-3",children:t.slice(0,10).map(S=>e.jsx(Me,{album:S,onNavigate:n=>a(`/album/${n}`),onContextMenu:(n,w,N)=>{p(n),m(w||"desktop"),c(N||null),f(!0)}},S.Id))})}),e.jsx("style",{children:`
        .scrollbar-hide::-webkit-scrollbar {
          display: none;
        }
      `}),e.jsx(Se,{item:r,itemType:"album",isOpen:g,onClose:()=>{f(!1),p(null)},zIndex:999999,mode:d,position:l||void 0})]})}const xt="https://musicbrainz.org/ws/2",gt=`${Ve}/${Ye} (https://github.com/AlessioLaiso/tunetuna)`,yt="https://coverartarchive.org",bt="https://api.song.link/v1-alpha.1";let $e=0;const ze=1100;async function wt(t="gb",i=10){const s=`/api/stats/proxy/apple-music/${t}/${i}`,a=await fetch(s);if(!a.ok)throw new Error(`Apple Music RSS failed: ${a.status}`);return(await a.json()).feed.results}function St(t,i=300){return t.replace(/\d+x\d+/,`${i}x${i}`)}async function vt(){const i=Date.now()-$e;i<ze&&await new Promise(s=>setTimeout(s,ze-i)),$e=Date.now()}async function jt(t,i){await vt();const s=`releasegroup:"${i}" AND artist:"${t}"`,a=new URLSearchParams({query:s,fmt:"json",limit:"1"}),u=await fetch(`${xt}/release-group/?${a}`,{headers:{"User-Agent":gt,Accept:"application/json"}});if(!u.ok)throw new Error(`MusicBrainz search failed: ${u.status}`);const x=(await u.json())["release-groups"]||[];return x.length===0?null:{id:x[0].id,type:x[0]["primary-type"]||"Album"}}function Fe(t,i=500){return`${yt}/release-group/${t}/front-${i}`}async function Be(t,i){const s=new URLSearchParams({url:t});try{const a=await fetch(`${bt}/links?${s}`);if(!a.ok){if(a.status===404)return null;throw new Error(`Odesli API failed: ${a.status}`)}return await a.json()}catch{return null}}async function Nt(t,i=10){if(!t)return[];const s=`https://api.allorigins.win/raw?url=${encodeURIComponent(t)}`;console.log("[Muspy] Fetching from:",s);const a=await fetch(s);if(!a.ok)throw new Error(`Muspy RSS failed: ${a.status}`);const u=await a.text();console.log("[Muspy] Response length:",u.length,"First 500 chars:",u.substring(0,500));const x=new DOMParser().parseFromString(u,"text/xml"),g=x.querySelector("parsererror");g&&console.error("[Muspy] XML parse error:",g.textContent);const f=x.querySelectorAll("entry");console.log("[Muspy] Found",f.length,"entries");const d=[];return f.forEach((m,l)=>{var Z,J,W,K,q,ee;if(l>=i)return;const c=((Z=m.querySelector("title"))==null?void 0:Z.textContent)||"",r=m.querySelector('link[rel="alternate"]')||m.querySelector("link"),p=(r==null?void 0:r.getAttribute("href"))||(r==null?void 0:r.textContent)||"",I=((J=m.querySelector("summary"))==null?void 0:J.textContent)||((W=m.querySelector("content"))==null?void 0:W.textContent)||"",$=((K=m.querySelector("updated"))==null?void 0:K.textContent)||((q=m.querySelector("published"))==null?void 0:q.textContent)||"";(ee=m.querySelector("id"))!=null&&ee.textContent;const R=/[a-fA-F0-9]{8}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{12}/i,S=m.outerHTML.match(R),n=S?S[0]:`muspy-${l}`,w=I.match(/\((Single|Album|EP)\)/i),N=w?w[1]:"Album",j=c.split(" - "),L=j.length>1?j[0].trim():I,X=j.length>1?j.slice(1).join(" - ").trim():c;let Q="";if($)try{Q=new Date($).toISOString().split("T")[0]}catch{Q=$}const T=n.startsWith("muspy-")?p:`https://musicbrainz.org/release-group/${n}`;d.push({id:n,title:X,artistName:L,releaseDate:Q,type:N,artworkUrl:n.startsWith("muspy-")?void 0:Fe(n,500),mbUrl:T})}),d}const Mt=[{id:"spotify",name:"Spotify",icon:"spotify"},{id:"appleMusic",name:"Apple Music",icon:"apple"},{id:"youtube",name:"YouTube",icon:"youtube"},{id:"youtubeMusic",name:"YouTube Music",icon:"youtube"},{id:"tidal",name:"Tidal",icon:"tidal"},{id:"deezer",name:"Deezer",icon:"deezer"},{id:"amazonMusic",name:"Amazon Music",icon:"amazon"},{id:"soundcloud",name:"SoundCloud",icon:"soundcloud"}];function be(t,i){const s=encodeURIComponent(`${t} ${i}`);return{entityUniqueId:"search",userCountry:"US",pageUrl:`https://www.google.com/search?q=${s}`,linksByPlatform:{spotify:{url:`https://open.spotify.com/search/${s}`},appleMusic:{url:`https://music.apple.com/search?term=${s}`},youtube:{url:`https://www.youtube.com/results?search_query=${s}`},youtubeMusic:{url:`https://music.youtube.com/search?q=${s}`},tidal:{url:`https://listen.tidal.com/search?q=${s}`},deezer:{url:`https://www.deezer.com/search/${s}`},amazonMusic:{url:`https://music.amazon.com/search/${s}`}}}}const Le={spotify:e.jsx("svg",{viewBox:"0 0 24 24",className:"w-5 h-5",fill:"currentColor",children:e.jsx("path",{d:"M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.66 0 12 0zm5.521 17.34c-.24.359-.66.48-1.021.24-2.82-1.74-6.36-2.101-10.561-1.141-.418.122-.779-.179-.899-.539-.12-.421.18-.78.54-.9 4.56-1.021 8.52-.6 11.64 1.32.42.18.479.659.301 1.02zm1.44-3.3c-.301.42-.841.6-1.262.3-3.239-1.98-8.159-2.58-11.939-1.38-.479.12-1.02-.12-1.14-.6-.12-.48.12-1.021.6-1.141C9.6 9.9 15 10.561 18.72 12.84c.361.181.54.78.241 1.2zm.12-3.36C15.24 8.4 8.82 8.16 5.16 9.301c-.6.179-1.2-.181-1.38-.721-.18-.601.18-1.2.72-1.381 4.26-1.26 11.28-1.02 15.721 1.621.539.3.719 1.02.419 1.56-.299.421-1.02.599-1.559.3z"})}),appleMusic:e.jsx("svg",{viewBox:"0 0 24 24",className:"w-5 h-5",fill:"currentColor",children:e.jsx("path",{d:"M23.994 6.124a9.23 9.23 0 00-.24-2.19c-.317-1.31-1.062-2.31-2.18-3.043a5.022 5.022 0 00-1.877-.726 10.496 10.496 0 00-1.564-.15c-.04-.003-.083-.01-.124-.013H5.986c-.152.01-.303.017-.455.026-.747.043-1.49.123-2.193.4-1.336.53-2.3 1.452-2.865 2.78-.192.448-.292.925-.363 1.408-.056.392-.088.785-.1 1.18 0 .032-.007.062-.01.093v12.223c.01.14.017.283.027.424.05.815.154 1.624.497 2.373.65 1.42 1.738 2.353 3.234 2.802.42.127.856.187 1.293.228.555.053 1.11.06 1.667.06h11.03a12.5 12.5 0 001.57-.1c.822-.106 1.596-.35 2.296-.81a5.046 5.046 0 001.88-2.207c.186-.42.293-.87.37-1.324.113-.675.138-1.358.137-2.04-.002-3.8 0-7.595-.003-11.393zm-6.423 3.99v5.712c0 .417-.058.827-.244 1.206-.29.59-.76.962-1.388 1.14-.35.1-.706.157-1.07.173-.95.045-1.773-.6-1.943-1.536a1.88 1.88 0 011.038-2.022c.323-.16.67-.25 1.018-.324.378-.082.758-.153 1.134-.24.274-.063.457-.23.51-.516a.904.904 0 00.02-.193c0-1.815 0-3.63-.002-5.443a.725.725 0 00-.026-.185c-.04-.15-.15-.243-.304-.234-.16.01-.318.035-.475.066-.76.15-1.52.303-2.28.456l-2.326.47-1.374.278c-.016.003-.032.01-.048.013-.277.077-.377.203-.39.49-.002.042 0 .086 0 .13-.002 2.602 0 5.204-.003 7.805 0 .42-.047.836-.215 1.227-.278.64-.77 1.04-1.434 1.233-.35.1-.71.16-1.075.172-.96.036-1.755-.6-1.92-1.544-.14-.812.23-1.685 1.154-2.075.357-.15.73-.232 1.108-.31.287-.06.575-.116.86-.177.383-.083.583-.323.6-.714v-.15c0-2.96 0-5.922.002-8.883 0-.123.013-.25.042-.37.07-.285.273-.448.546-.518.255-.065.515-.112.774-.165.733-.15 1.466-.296 2.2-.444l2.27-.46c.67-.134 1.34-.27 2.01-.403.22-.043.443-.088.664-.106.31-.025.523.17.554.482.008.073.012.148.012.223.002 1.91.002 3.822 0 5.732z"})}),youtube:e.jsx("svg",{viewBox:"0 0 24 24",className:"w-5 h-5",fill:"currentColor",children:e.jsx("path",{d:"M23.498 6.186a3.016 3.016 0 00-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 00.502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 002.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 002.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"})}),youtubeMusic:e.jsx("svg",{viewBox:"0 0 24 24",className:"w-5 h-5",fill:"currentColor",children:e.jsx("path",{d:"M12 0C5.376 0 0 5.376 0 12s5.376 12 12 12 12-5.376 12-12S18.624 0 12 0zm0 19.104c-3.924 0-7.104-3.18-7.104-7.104S8.076 4.896 12 4.896s7.104 3.18 7.104 7.104-3.18 7.104-7.104 7.104zm0-13.332c-3.432 0-6.228 2.796-6.228 6.228S8.568 18.228 12 18.228s6.228-2.796 6.228-6.228S15.432 5.772 12 5.772zM9.684 15.54V8.46L15.816 12l-6.132 3.54z"})}),tidal:e.jsx("svg",{viewBox:"0 0 24 24",className:"w-5 h-5",fill:"currentColor",children:e.jsx("path",{d:"M12.012 3.992L8.008 7.996 4.004 3.992 0 7.996 4.004 12l4.004-4.004L12.012 12l4.004-4.004L20.02 12l4.004-4.004-4.004-4.004-4.004 4.004-4.004-4.004zM12.012 12.012L8.008 16.02l4.004 4.004 4.004-4.004-4.004-4.008z"})}),deezer:e.jsx("svg",{viewBox:"0 0 24 24",className:"w-5 h-5",fill:"currentColor",children:e.jsx("path",{d:"M18.81 4.16v3.03H24V4.16h-5.19zM6.27 8.38v3.027h5.189V8.38h-5.19zm12.54 0v3.027H24V8.38h-5.19zM6.27 12.594v3.027h5.189v-3.027h-5.19zm6.27 0v3.027h5.19v-3.027h-5.19zm6.27 0v3.027H24v-3.027h-5.19zM0 16.81v3.029h5.19v-3.03H0zm6.27 0v3.029h5.189v-3.03h-5.19zm6.27 0v3.029h5.19v-3.03h-5.19zm6.27 0v3.029H24v-3.03h-5.19z"})}),amazonMusic:e.jsx("svg",{viewBox:"0 0 24 24",className:"w-5 h-5",fill:"currentColor",children:e.jsx("path",{d:"M.045 18.02c.072-.116.187-.124.348-.022 3.636 2.11 7.594 3.166 11.87 3.166 2.852 0 5.668-.533 8.447-1.595l.315-.118c.138-.053.209-.073.315-.073.186 0 .27.089.27.267 0 .178-.089.355-.267.533l-.178.178c-2.852 2.346-6.22 3.52-10.106 3.52-4.24 0-7.942-1.192-11.107-3.574-.168-.133-.217-.244-.217-.333 0-.089.044-.133.133-.178zm21.243-3.928c-.236-.178-.712-.267-1.424-.267-.712 0-1.598.178-2.665.533-1.067.356-2.134.89-3.201 1.602-.178.089-.267.178-.267.267s.089.133.267.133c.089 0 .178-.044.267-.089l.356-.178c1.156-.533 2.223-.8 3.2-.8.979 0 1.469.267 1.469.8 0 .356-.178.712-.534 1.068-.356.355-.89.711-1.6 1.066l-.535.267c-.356.178-.534.356-.534.534 0 .133.089.2.267.2.089 0 .178-.022.267-.067l.445-.222c1.6-.8 2.756-1.424 3.467-1.869.712-.444 1.068-.889 1.068-1.333 0-.445-.178-.712-.534-.978-.356-.267-.978-.4-1.868-.4zm-6.844-7.11c0-1.067-.267-1.957-.8-2.67-.533-.711-1.422-1.066-2.666-1.066-1.244 0-2.223.355-2.933 1.066-.712.712-1.156 1.78-1.334 3.2h7.733v-.533zm3.911 1.956H8.045c.089 1.422.445 2.489 1.067 3.2.622.712 1.511 1.067 2.666 1.067.89 0 1.69-.178 2.4-.533.712-.356 1.334-.89 1.868-1.6.178-.178.356-.267.534-.267.178 0 .267.089.267.267 0 .178-.089.356-.267.533-.622.8-1.422 1.423-2.4 1.868-.978.445-2.044.667-3.2.667-1.778 0-3.2-.533-4.267-1.6-1.067-1.066-1.6-2.577-1.6-4.533 0-1.956.533-3.467 1.6-4.533 1.067-1.067 2.489-1.6 4.267-1.6 1.778 0 3.111.445 4 1.334.89.889 1.334 2.177 1.334 3.866v1.067c0 .266-.089.4-.267.4l-.089-.003z"})}),soundcloud:e.jsx("svg",{viewBox:"0 0 24 24",className:"w-5 h-5",fill:"currentColor",children:e.jsx("path",{d:"M1.175 12.225c-.051 0-.094.046-.101.1l-.233 2.154.233 2.105c.007.058.05.098.101.098.05 0 .09-.04.099-.098l.255-2.105-.27-2.154c-.009-.06-.048-.1-.098-.1m-.899.828c-.06 0-.091.037-.104.094L0 14.479l.165 1.308c.014.057.045.094.09.094s.089-.037.099-.094l.19-1.308-.19-1.334c-.01-.057-.045-.09-.09-.09m1.83-1.229c-.061 0-.12.045-.12.104l-.21 2.563.225 2.458c0 .06.045.104.106.104.061 0 .12-.044.12-.104l.24-2.458-.24-2.563c0-.06-.045-.104-.12-.104m.945-.089c-.075 0-.135.06-.15.135l-.193 2.64.21 2.544c.016.077.075.138.149.138.075 0 .135-.061.15-.138l.225-2.545-.225-2.64c-.015-.074-.06-.135-.135-.135m1.065.42c-.09 0-.149.075-.164.164l-.158 2.255.18 2.46c.015.09.074.165.164.165.089 0 .149-.075.164-.165l.209-2.46-.209-2.255c-.015-.09-.075-.164-.164-.164m.944-.54c-.104 0-.194.09-.209.195l-.149 2.81.164 2.445c.015.105.09.195.194.195.104 0 .195-.09.21-.195l.18-2.445-.18-2.81c-.015-.105-.09-.195-.194-.195m1.076-.505c-.119 0-.21.09-.225.21l-.135 3.3.149 2.4c.015.12.105.21.225.21.12 0 .21-.09.225-.21l.165-2.4-.165-3.3c-.015-.12-.105-.21-.225-.21m1.064-.54c-.135 0-.239.105-.254.24l-.12 3.825.135 2.354c.015.135.12.24.255.24.12 0 .24-.105.255-.24l.149-2.354-.149-3.825c-.015-.135-.12-.24-.255-.24m1.109-.27c-.015-.15-.135-.255-.27-.255-.15 0-.255.105-.27.255l-.12 4.08.12 2.31c.015.15.12.255.27.255.149 0 .255-.105.27-.255l.134-2.31-.134-4.08m.494 6.645c.015.165.135.284.285.284.149 0 .27-.12.284-.284l.121-2.325-.12-5.175c-.015-.165-.135-.285-.285-.285-.149 0-.27.12-.284.285l-.107 5.175.106 2.325m1.184-6.18c-.165 0-.3.135-.314.3l-.091 3.855.105 2.31c.015.165.135.3.3.3.164 0 .284-.135.299-.3l.12-2.31-.12-3.855c-.015-.165-.135-.3-.3-.3m1.199-.075c-.18 0-.314.135-.329.315l-.09 3.915.104 2.295c.015.18.135.315.315.315s.314-.135.314-.315l.12-2.295-.12-3.915c-.015-.18-.149-.315-.314-.315m1.139-.195c-.195 0-.345.149-.359.345l-.075 4.11.09 2.265c.014.195.149.345.344.345.195 0 .345-.15.359-.345l.105-2.265-.105-4.095c-.014-.195-.164-.36-.359-.36m1.305 0c-.209 0-.359.164-.374.359l-.074 4.095.089 2.25c.015.21.165.375.375.375.194 0 .359-.165.374-.375l.09-2.25-.09-4.095c-.015-.209-.165-.359-.375-.359m1.289.015c-.225 0-.39.18-.39.405l-.06 4.065.075 2.235c.016.225.166.39.391.39.225 0 .391-.165.406-.39l.09-2.235-.091-4.065c-.014-.24-.18-.405-.405-.405m1.35.09c-.24 0-.42.18-.42.42l-.045 3.975.06 2.205c.015.24.18.42.42.42.24 0 .404-.18.42-.42l.075-2.205-.075-3.975c-.015-.24-.18-.42-.42-.42m1.33.135c-.256 0-.435.194-.45.435l-.046 3.825.061 2.175c.015.255.195.45.435.45.256 0 .436-.195.45-.45l.076-2.175-.076-3.825c-.014-.255-.194-.435-.45-.435m1.453-.09c-.27 0-.48.21-.48.465l-.03 3.915.03 2.145c.015.27.21.465.48.465.27 0 .48-.195.48-.465l.045-2.145-.045-3.915c0-.255-.21-.465-.48-.465m1.444.285c-.285 0-.495.225-.51.495l-.015 3.645.03 2.13c.015.285.225.51.51.51.27 0 .494-.225.51-.51l.03-2.13-.03-3.645c-.016-.285-.225-.495-.51-.495m3.39.465c-.165-.045-.345-.075-.51-.075-.18 0-.345.015-.51.045-.044-.9-.39-1.695-.945-2.34-.556-.645-1.35-1.08-2.31-1.215-.27-.045-.405-.165-.405-.405V6.54c0-1.305-.465-2.415-1.395-3.345C19.2 2.265 18.09 1.8 16.77 1.8c-1.155 0-2.16.375-3.045 1.095-.885.72-1.44 1.635-1.68 2.745-.165-.03-.315-.045-.45-.045-1.35 0-2.355.93-2.355 2.115 0 .24.03.465.075.69-.645.12-1.17.435-1.59.945-.42.51-.63 1.095-.63 1.755 0 .75.255 1.38.765 1.89s1.14.765 1.89.765h10.53c.93 0 1.695-.285 2.31-.855.615-.57.93-1.29.93-2.145 0-.855-.3-1.575-.9-2.16-.6-.585-1.335-.885-2.205-.9"})})};function At(){return e.jsx("div",{className:"animate-pulse space-y-0",children:[...Array(4)].map((t,i)=>e.jsxs("div",{className:"flex items-center gap-3 px-4 py-2.5",children:[e.jsx("div",{className:"w-5 h-5 rounded bg-zinc-700"}),e.jsx("div",{className:"h-4 bg-zinc-700 rounded w-24"})]},i))})}function De({isOpen:t,onClose:i,odesliData:s,loading:a=!1,title:u,mode:h="mobile",position:x,zIndex:g=99999}){if(!t)return null;const f=s?Mt.filter(r=>s.linksByPlatform[r.id]):[],d=r=>{if(!s)return;const p=s.linksByPlatform[r];p!=null&&p.url&&window.open(p.url,"_blank","noopener,noreferrer"),i()},l=(()=>{if(u)return u;if(!(s!=null&&s.entitiesByUniqueId))return"Loading...";const r=Object.values(s.entitiesByUniqueId);for(const p of r)if(p.title)return p.title;return"Loading..."})(),c=a||!s||f.length===0;if(h==="desktop"){const p=c?4:f.length,I=Math.min(400,p*44+48);let $=(x==null?void 0:x.x)||100,R=(x==null?void 0:x.y)||100;return $+220>window.innerWidth&&($=window.innerWidth-220-10),R+I>window.innerHeight&&(R=window.innerHeight-I-10),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0",onClick:i,style:{zIndex:g-1}}),e.jsxs("div",{className:"fixed bg-zinc-900 border border-zinc-700 rounded-lg shadow-2xl py-2 min-w-[200px]",style:{left:$,top:R,zIndex:g},onClick:P=>P.stopPropagation(),children:[e.jsx("div",{className:"px-4 pb-2 mb-1 border-b border-zinc-700",children:e.jsx("div",{className:"text-sm font-medium text-white truncate",children:l})}),c?e.jsx(At,{}):e.jsx("div",{className:"space-y-0",children:f.map(P=>e.jsxs("button",{onClick:()=>d(P.id),className:"w-full flex items-center gap-3 px-4 py-2.5 hover:bg-zinc-800 transition-colors text-left",children:[e.jsx("span",{className:"text-white flex-shrink-0",children:Le[P.id]||e.jsx("span",{className:"w-5 h-5 flex items-center justify-center text-xs",children:"ðŸŽµ"})}),e.jsx("span",{className:"flex-1 text-sm text-white",children:P.name})]},P.id))})]})]})}return e.jsx(Xe,{isOpen:t,onClose:i,zIndex:g,children:e.jsxs("div",{className:"pb-6",children:[e.jsx("div",{className:"mb-4 ml-4",children:e.jsx("div",{className:"text-lg font-semibold text-white break-words",children:l})}),c?e.jsx("div",{className:"animate-pulse space-y-1",children:[...Array(4)].map((r,p)=>e.jsxs("div",{className:"flex items-center gap-4 pl-4 pr-4 py-3",children:[e.jsx("div",{className:"w-5 h-5 rounded bg-zinc-700"}),e.jsx("div",{className:"h-4 bg-zinc-700 rounded w-28"})]},p))}):e.jsx("div",{className:"space-y-1",children:f.map(r=>e.jsxs("button",{onClick:()=>d(r.id),className:"w-full flex items-center gap-4 pl-4 pr-4 py-3 rounded-lg hover:bg-white/10 transition-colors",children:[e.jsx("span",{className:"text-white",children:Le[r.id]||e.jsx("span",{className:"w-5 h-5 flex items-center justify-center text-xs",children:"ðŸŽµ"})}),e.jsx("span",{className:"flex-1 text-left text-white font-medium",children:r.name})]},r.id))})]})})}function Ct(){const[t,i]=o.useState(()=>H.persist.hasHydrated());return o.useEffect(()=>{if(H.persist.hasHydrated()){i(!0);return}return H.persist.onFinishHydration(()=>{i(!0)})},[]),t}function ae(t){return t.toLowerCase().replace(/[^a-z0-9]/g,"")}function xe(t){return t.replace(/\s*\(feat\..*?\)/gi,"").replace(/\s*\[feat\..*?\]/gi,"").replace(/\s*ft\..*$/gi,"").replace(/\s*\(with.*?\)/gi,"").replace(/\s*\[with.*?\]/gi,"").replace(/\s*\(explicit\)/gi,"").replace(/\s*\[explicit\]/gi,"").replace(/\s*\(deluxe.*?\)/gi,"").replace(/\s*\[deluxe.*?\]/gi,"").replace(/\s*-\s*single$/gi,"").replace(/\s*-\s*ep$/gi,"").trim()}function Oe(t){return t.split(/[,&]/)[0].replace(/\s*feat\..*$/gi,"").replace(/\s*ft\..*$/gi,"").replace(/\s*with\s+.*$/gi,"").trim()}function _e(){const t=H(f=>f.songs),i=H(f=>f.genreSongs),s=Ct(),a=o.useMemo(()=>{var m,l;if(!s)return new Map;let f=t;if(f.length===0&&i){const c=new Set;f=Object.values(i).flat().filter(r=>c.has(r.Id)?!1:(c.add(r.Id),!0))}const d=new Map;for(const c of f){const r=ae(Oe(c.AlbumArtist||((l=(m=c.ArtistItems)==null?void 0:m[0])==null?void 0:l.Name)||""));r&&(d.has(r)||d.set(r,[]),d.get(r).push(c))}return d},[t,i,s]),u=f=>{const d=ae(Oe(f));if(!d)return null;if(a.has(d))return a.get(d);for(const[m,l]of a)if(m.includes(d)||d.includes(m))return l;return null};return{findSong:(f,d)=>{const m=u(d);if(!m)return null;const l=ae(xe(f));if(!l)return null;for(const c of m){const r=ae(xe(c.Name||""));if(r===l||r.includes(l)||l.includes(r))return c}return null},findAlbum:(f,d)=>{const m=u(d);if(!m)return null;const l=ae(xe(f));if(!l)return null;for(const c of m){if(!c.AlbumId||!c.Album)continue;const r=ae(xe(c.Album));if(r===l||r.includes(l)||l.includes(r))return{albumId:c.AlbumId,albumName:c.Album}}return null},findArtistImageUrl:f=>{var l,c,r;const d=u(f);return!d||d.length===0?null:((r=(c=(l=d[0])==null?void 0:l.ArtistItems)==null?void 0:c[0])==null?void 0:r.Id)||null},artistIndex:a}}function he({title:t,subtitle:i,artworkUrl:s,fallbackArtworkUrl:a,secondFallbackUrl:u,rank:h,isCurrentTrack:x,isInLibrary:g,isMenuOpen:f,subtitleIcon:d,paddingRight:m=!1,onClick:l,onContextMenu:c,onLongPress:r,onExternalClick:p}){const[I,$]=o.useState(!1),[R,P]=o.useState(!1),[S,n]=o.useState(!1);o.useEffect(()=>{$(!1),P(!1),n(!1)},[s]);let w=s;S&&u?w=u:R&&a&&(w=a);const N=()=>{!R&&a?P(!0):!S&&u?n(!0):$(!0)},j=Ue({onLongPress:L=>{L.preventDefault(),r==null||r(L)},onClick:L=>l(L)});return e.jsxs("button",{onClick:L=>l(L),onContextMenu:c,...j,className:`w-full flex items-center gap-2 hover:bg-white/10 transition-colors group py-2.5 ${f?"bg-white/10":""} ${m?"pr-4":""}`,children:[e.jsx("div",{className:"w-12 h-12 rounded-sm overflow-hidden flex-shrink-0 bg-zinc-900 self-center flex items-center justify-center",children:I?e.jsx(Ce,{className:"w-6 h-6 text-gray-500"}):e.jsx(Ae,{src:w,alt:t,className:"w-full h-full object-cover",showOutline:!0,rounded:"rounded-sm",onError:N})}),e.jsxs("div",{className:"flex-1 min-w-0 text-left flex gap-3 items-baseline",children:[h!==void 0&&e.jsx("span",{className:"text-zinc-500 text-sm flex-shrink-0 w-5 text-right",children:h}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium truncate text-white group-hover:text-[var(--accent-color)] transition-colors",children:t}),e.jsxs("div",{className:"text-xs text-gray-400 flex items-center gap-1.5 min-w-0",children:[e.jsx("span",{className:"truncate",children:i}),d&&e.jsx("span",{className:"flex-shrink-0",children:d})]})]})]}),!g&&p&&e.jsx("div",{onClick:L=>{L.stopPropagation(),p(L)},className:"flex-shrink-0 p-2 text-gray-400 hover:text-white cursor-pointer",children:e.jsx(st,{className:"w-4 h-4"})})]})}function ke(){return e.jsx("div",{className:"animate-pulse",children:[...Array(5)].map((t,i)=>e.jsxs("div",{className:"flex items-center gap-3 py-2.5",children:[e.jsx("div",{className:"w-12 h-12 rounded-sm bg-zinc-800"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-4 bg-zinc-800 rounded w-3/4 mb-1.5"}),e.jsx("div",{className:"h-3 bg-zinc-800 rounded w-1/2"})]})]},i))})}function kt(){const{playTrack:t}=ce(),{feedTopSongs:i,feedLastUpdated:s,loading:a,setFeedTopSongs:u,setFeedLastUpdated:h,setLoading:x}=H(),{feedCountry:g,showTop10:f}=ve(),{findSong:d}=_e(),[m,l]=o.useState(!1),[c,r]=o.useState("mobile"),[p,I]=o.useState(null),[$,R]=o.useState(null),[P,S]=o.useState(!1),[n,w]=o.useState(!1),[N,j]=o.useState(null),[L,X]=o.useState(null),[Q,T]=o.useState(!1),[Z,J]=o.useState("mobile"),[W,K]=o.useState(null),[q,ee]=o.useState(null),[se,te]=o.useState(null),V=o.useCallback(async(M=!1)=>{const F=Date.now();if(!(!M&&s&&F-s<ye)){x("feed",!0),w(!1);try{const z=await wt(g,10);u(z),h(F)}catch(z){console.error("Failed to fetch top songs:",z),w(!0)}finally{x("feed",!1)}}},[g,s,u,h,x]);o.useEffect(()=>{if(f){const M=Date.now();(!s||M-s>=ye)&&V(!0)}},[f,g]);const de=async(M,F,z)=>{if(F){const B=await O.getSongById(F.Id);B&&t(B)}else await G(M,z)},G=async(M,F)=>{const z=!window.matchMedia("(hover: hover) and (pointer: fine)").matches;r(z?"mobile":"desktop"),z||I({x:F.clientX,y:F.clientY}),j(M.name),X(M.id),S(!0),l(!0);try{const B=await Be(M.url);if(B&&Object.keys(B.linksByPlatform).length>0)R(B);else{const D=be(M.artistName,M.name);R(D)}}catch{const B=be(M.artistName,M.name);R(B)}finally{S(!1)}};if(!f)return null;const ne=i.length>0,me=a.feed&&!ne&&!n;return e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-xl font-bold mb-2",children:"Top 10"}),me?e.jsx(ke,{}):ne?e.jsx("div",{className:"space-y-0",children:i.map((M,F)=>{const z=d(M.name,M.artistName),B=z!==null;return e.jsx(he,{rank:F+1,title:M.name,subtitle:M.artistName,artworkUrl:B&&z.AlbumId?O.getAlbumArtUrl(z.AlbumId,96):St(M.artworkUrl100,96),isInLibrary:B,isMenuOpen:se===M.id||L===M.id&&m,onClick:D=>de(M,z,D),onContextMenu:async D=>{if(D.preventDefault(),z){const y=await O.getSongById(z.Id);y&&(ee(y),te(M.id),J("desktop"),K({x:D.clientX,y:D.clientY}),T(!0))}},onLongPress:async()=>{if(z){const D=await O.getSongById(z.Id);D&&(ee(D),te(M.id),J("mobile"),K(null),T(!0))}},onExternalClick:D=>G(M,D)},M.id)})}):e.jsx("div",{className:"py-8 text-left text-gray-500 text-sm",children:"Could not load charts"}),e.jsx(De,{isOpen:m,onClose:()=>{l(!1),R(null),X(null)},odesliData:$,loading:P,title:N||void 0,mode:c,position:p||void 0}),e.jsx(Se,{item:q,itemType:"song",isOpen:Q,onClose:()=>{T(!1),ee(null),te(null)},zIndex:99999,mode:Z,position:W||void 0})]})}function It(){const t=we(),{playTrack:i}=ce(),{feedNewReleases:s,feedLastUpdated:a,loading:u,setFeedNewReleases:h,setFeedLastUpdated:x,setLoading:g}=H(),{showNewReleases:f,muspyRssUrl:d}=ve(),{findAlbum:m,findSong:l,findArtistImageUrl:c}=_e(),[r,p]=o.useState(!1),[I,$]=o.useState("mobile"),[R,P]=o.useState(null),[S,n]=o.useState(null),[w,N]=o.useState(!1),[j,L]=o.useState(!1),[X,Q]=o.useState(null),[T,Z]=o.useState(null),[J,W]=o.useState(!1),[K,q]=o.useState("mobile"),[ee,se]=o.useState(null),[te,V]=o.useState(null),[de,G]=o.useState(null),ne=o.useCallback(async(y=!1)=>{if(!d)return;const E=Date.now();if(!(!y&&a&&E-a<ye)){g("feed",!0),L(!1);try{const v=await Nt(d,10);h(v),x(E)}catch(v){console.error("Failed to fetch Muspy releases:",v),L(!0)}finally{g("feed",!1)}}},[d,a,h,x,g]);o.useEffect(()=>{if(f&&d){const y=Date.now();(!a||y-a>=ye)&&ne(!0)}},[f,d]);const ue=o.useRef(new Set);o.useEffect(()=>{const y=async()=>{const E=s.filter(v=>v.id.startsWith("muspy-")&&!ue.current.has(v.id));if(E.length!==0)for(const v of E){ue.current.add(v.id);try{console.log(`[FeedSection] Searching MB for: ${v.title} - ${v.artistName}`);const k=await jt(v.artistName,v.title);if(k){console.log(`[FeedSection] Found MBID for "${v.title}": ${k.id} (${k.type})`);const le=H.getState().feedNewReleases.map(oe=>oe.id===v.id?{...oe,id:k.id,type:k.type}:oe);h(le)}else console.log(`[FeedSection] No MBID found for "${v.title}"`)}catch(k){console.error(`[FeedSection] Failed to search MB for "${v.title}":`,k)}}};s.length>0&&y()},[s,h]);const me=async(y,E,v)=>{if(E)if(E.type==="song"){const k=await O.getSongById(E.song.Id);k&&i(k)}else t(`/album/${E.albumId}`);else await M(y,v)},M=async(y,E)=>{const v=!window.matchMedia("(hover: hover) and (pointer: fine)").matches;$(v?"mobile":"desktop"),v||P({x:E.clientX,y:E.clientY}),Q(y.title),Z(y.id),N(!0),p(!0);const k=y.mbUrl&&!y.id.startsWith("muspy-");try{let A=null;if(k&&(A=await Be(y.mbUrl)),A&&Object.keys(A.linksByPlatform).length>0)n(A);else{const le=be(y.artistName,y.title);n(le)}}catch{const A=be(y.artistName,y.title);n(A)}finally{N(!1)}};if(!f||!d)return null;const F=s.length>0,z=u.feed,B=!!d,D=z&&!F&&!j&&B;return e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-xl font-bold mb-2",children:"New Releases"}),D?e.jsx(ke,{}):F?e.jsx("div",{className:"space-y-0",children:s.map(y=>{const E=y.type==="Single",v=E?l(y.title,y.artistName):null,k=v?null:m(y.title,y.artistName),A=v?{type:"song",song:v}:k?{type:"album",albumId:k.albumId}:null,le=A!==null,ie=!y.id.startsWith("muspy-")?Fe(y.id,250):null,pe=c(y.artistName),re=pe?O.getArtistImageUrl(pe,96):null;let b,C,U;(A==null?void 0:A.type)==="song"&&(v!=null&&v.AlbumId)?(b=O.getAlbumArtUrl(v.AlbumId,96),C=ie||void 0,U=re||void 0):(A==null?void 0:A.type)==="album"&&(k!=null&&k.albumId)?(b=O.getAlbumArtUrl(k.albumId,96),C=ie||void 0,U=re||void 0):ie?(b=ie,C=re||void 0):b=re||"";const Y=new Date(y.releaseDate),Ie=!isNaN(Y.getTime())?Y.toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",He=Ie?`${y.artistName} â€¢ ${Ie}`:y.artistName,We=E?e.jsx(Ze,{className:"w-3 h-3"}):e.jsx(Ce,{className:"w-3 h-3"});return e.jsx(he,{title:y.title,subtitle:He,subtitleIcon:We,artworkUrl:b,fallbackArtworkUrl:C,secondFallbackUrl:U,isInLibrary:le,isMenuOpen:de===y.id||T===y.id&&r,onClick:_=>me(y,A,_),onContextMenu:async _=>{if(_.preventDefault(),(A==null?void 0:A.type)==="song"&&v){const fe=await O.getSongById(v.Id);fe&&(V(fe),G(y.id),q("desktop"),se({x:_.clientX,y:_.clientY}),W(!0))}else if((A==null?void 0:A.type)==="album"&&k){const fe=await O.getAlbumById(k.albumId);fe&&(V(fe),G(y.id),q("desktop"),se({x:_.clientX,y:_.clientY}),W(!0))}},onLongPress:async()=>{if((A==null?void 0:A.type)==="song"&&v){const _=await O.getSongById(v.Id);_&&(V(_),G(y.id),q("mobile"),se(null),W(!0))}else if((A==null?void 0:A.type)==="album"&&k){const _=await O.getAlbumById(k.albumId);_&&(V(_),G(y.id),q("mobile"),se(null),W(!0))}},onExternalClick:_=>M(y,_)},y.id)})}):B?e.jsx("div",{className:"py-8 text-left text-gray-500 text-sm",children:j?"Failed to load releases":"No new releases found"}):e.jsx("div",{className:"py-8 text-center text-gray-500 text-sm",children:"Configure Muspy RSS in settings"}),e.jsx(De,{isOpen:r,onClose:()=>{p(!1),n(null),Z(null)},odesliData:S,loading:w,title:X||void 0,mode:I,position:R||void 0}),e.jsx(Se,{item:te,itemType:(te==null?void 0:te.Type)==="Audio"?"song":"album",isOpen:J,onClose:()=>{W(!1),V(null),G(null)},zIndex:99999,mode:K,position:ee||void 0})]})}function Pt({twoColumns:t=!1}){const{recentlyPlayed:i,loading:s,setRecentlyPlayed:a,setLoading:u}=H(),{showRecentlyPlayed:h}=ve(),{playTrack:x}=ce(),g=Qe(),[f,d]=o.useState(!1),[m,l]=o.useState("mobile"),[c,r]=o.useState(null),[p,I]=o.useState(null);o.useEffect(()=>{h&&(async()=>{u("recentlyPlayed",!0);try{const w=await O.getRecentlyPlayed(10);a(w.Items||[])}catch(w){console.error(w)}finally{u("recentlyPlayed",!1)}})()},[h,a,u]);const $=n=>{x(n,i)};if(!h)return null;const R=i&&i.length>0,S=s.recentlyPlayed&&!R;return e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-xl font-bold mb-2",children:"Recently Played"}),S?e.jsx(ke,{}):R?e.jsx("div",{className:t?"md:grid md:grid-cols-2 md:gap-3 min-[1680px]:block":"",children:t?e.jsxs(e.Fragment,{children:[e.jsx("div",{children:i.slice(0,5).map(n=>{var w,N;return e.jsx(he,{title:n.Name||"Unknown",subtitle:`${n.AlbumArtist||((N=(w=n.ArtistItems)==null?void 0:w[0])==null?void 0:N.Name)||"Unknown Artist"}${n.Album?` â€¢ ${n.Album}`:""}`,artworkUrl:O.getAlbumArtUrl(n.AlbumId||n.Id,96),isCurrentTrack:(g==null?void 0:g.Id)===n.Id,isInLibrary:!0,isMenuOpen:(p==null?void 0:p.Id)===n.Id,paddingRight:!0,onClick:()=>$(n),onContextMenu:j=>{j.preventDefault(),I(n),l("desktop"),r({x:j.clientX,y:j.clientY}),d(!0)},onLongPress:()=>{I(n),l("mobile"),r(null),d(!0)}},n.Id)})}),e.jsx("div",{children:i.slice(5,10).map(n=>{var w,N;return e.jsx(he,{title:n.Name||"Unknown",subtitle:`${n.AlbumArtist||((N=(w=n.ArtistItems)==null?void 0:w[0])==null?void 0:N.Name)||"Unknown Artist"}${n.Album?` â€¢ ${n.Album}`:""}`,artworkUrl:O.getAlbumArtUrl(n.AlbumId||n.Id,96),isCurrentTrack:(g==null?void 0:g.Id)===n.Id,isInLibrary:!0,isMenuOpen:(p==null?void 0:p.Id)===n.Id,paddingRight:!0,onClick:()=>$(n),onContextMenu:j=>{j.preventDefault(),I(n),l("desktop"),r({x:j.clientX,y:j.clientY}),d(!0)},onLongPress:()=>{I(n),l("mobile"),r(null),d(!0)}},n.Id)})})]}):i.map(n=>{var w,N;return e.jsx(he,{title:n.Name||"Unknown",subtitle:`${n.AlbumArtist||((N=(w=n.ArtistItems)==null?void 0:w[0])==null?void 0:N.Name)||"Unknown Artist"}${n.Album?` â€¢ ${n.Album}`:""}`,artworkUrl:O.getAlbumArtUrl(n.AlbumId||n.Id,96),isCurrentTrack:(g==null?void 0:g.Id)===n.Id,isInLibrary:!0,isMenuOpen:(p==null?void 0:p.Id)===n.Id,paddingRight:!0,onClick:()=>$(n),onContextMenu:j=>{j.preventDefault(),I(n),l("desktop"),r({x:j.clientX,y:j.clientY}),d(!0)},onLongPress:()=>{I(n),l("mobile"),r(null),d(!0)}},n.Id)})}):null,e.jsx(Se,{item:p,itemType:"song",isOpen:f,onClose:()=>{d(!1),I(null)},zIndex:99999,mode:m,position:c||void 0})]})}function Ft(){const[t,i]=o.useState(!1),{recentlyAdded:s,recentlyPlayed:a,loading:u}=H(),{showMoodCards:h,showTop10:x,showNewReleases:g,showRecentlyPlayed:f,muspyRssUrl:d}=ve(),m=o.useRef(!1),{isQueueSidebarOpen:l}=ce();o.useEffect(()=>{(u.recentlyAdded||u.recentlyPlayed)&&(m.current=!0)},[u.recentlyAdded,u.recentlyPlayed]);const r=[x,g&&!!d,f].filter(Boolean).length,p=m.current&&!u.recentlyAdded&&!u.recentlyPlayed&&s.length===0&&a.length===0;return e.jsxs("div",{className:"pb-20",children:[e.jsx("div",{className:`fixed top-0 left-0 right-0 bg-black z-10 lg:left-16 transition-[left,right] duration-300 ${l?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top))"},children:e.jsx("div",{className:"max-w-[768px] min-[1680px]:max-w-[1080px] w-full mx-auto",children:e.jsx(at,{onSearchStateChange:i})})}),e.jsx("div",{className:`fixed left-0 right-0 z-[60] lg:left-16 transition-[left,right] duration-300 ${l?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 4.5rem - 2px)",height:"24px",background:"linear-gradient(to bottom, rgba(0, 0, 0, 0.8), transparent)"}}),e.jsx("div",{className:t?"hidden [@media((hover:hover)_and_(pointer:fine)_and_(min-width:1024px))]:block":"",style:{paddingTop:"calc(env(safe-area-inset-top) + 4.5rem + 24px)"},children:e.jsxs("div",{className:"w-full",children:[h&&e.jsx(ht,{}),e.jsx("div",{className:"mt-12 pb-4",children:e.jsx(pt,{})}),r>0&&e.jsxs("div",{className:`
              mt-4 px-4
              ${r>=2?"md:grid md:gap-3":""}
              ${r===2?"md:grid-cols-2":""}
              ${r>=3?"md:grid-cols-2 min-[1680px]:grid-cols-3":""}
            `,children:[f&&e.jsx("div",{className:r===3?"md:col-span-2 min-[1680px]:col-span-1":"",children:e.jsx(Pt,{twoColumns:r===3})}),x&&e.jsx("div",{children:e.jsx(kt,{})}),g&&e.jsx("div",{children:e.jsx(It,{})})]}),p&&e.jsx("div",{className:"flex items-center justify-center py-16 text-gray-400",children:e.jsx("p",{children:"No music found"})})]})})]})}export{Ft as default};
