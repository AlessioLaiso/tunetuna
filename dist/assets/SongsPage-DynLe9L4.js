import{r as s,u as l,a as x,b as Ge,g as Le,e as U,l as W,j as t,m as _e,C as Qe}from"./index-SABcFPCf.js";import{S as Ve}from"./SongItem-BxhwRQi6.js";import{P as Ye}from"./Pagination-DP0Uw0iU.js";import{u as $e,F as I}from"./useSearch-JRx9Gb2c.js";import{S as Be}from"./search-DxrwQPN1.js";import{A as De}from"./arrow-up-down-B8u66xU5.js";import"./chevron-right-DTK3rJeC.js";import"./piano-DaVkbRzM.js";const ze=[{type:"songs"},{type:"artists",limit:5},{type:"albums",limit:12},{type:"playlists"}],y=90,q=45,He=45;function tt(){const[d,N]=s.useState([]),J=l(e=>e.sortPreferences),K=l(e=>e.setSortPreference),T=l(e=>e.setLoading),k=l(e=>e.loading),X=l(e=>e.genres),Z=x(e=>e.playTrack),ee=x(e=>e.playAlbum),te=x(e=>e.addToQueue),C=x(e=>e.isQueueSidebarOpen),[i,c]=s.useState(!1),[se,w]=s.useState(!1),[ne,oe]=s.useState("mobile"),[re,ae]=s.useState(null),[h,O]=s.useState(null),[le,P]=s.useState(null),[f,M]=s.useState(0),[E,F]=s.useState(0),v=Ge(),[j,g]=s.useState(!1),[b,R]=s.useState(null),[A,ie]=s.useState(null),[ce,G]=s.useState([]),L=l(e=>e.songs),ue=s.useMemo(()=>Le(L),[L]),a=J.songs,m=s.useRef(!0),[de,_]=s.useState(!1),Q=s.useRef(a),[V,Y]=s.useState(q),$=s.useRef(null),B=s.useRef(null),{searchQuery:p,setSearchQuery:ge,isSearching:pe,searchResults:o,selectedGenres:D,setSelectedGenres:he,yearRange:z,setYearRange:fe,selectedGroupings:H,setSelectedGroupings:me,clearSearch:S,clearAll:Se}=$e();s.useEffect(()=>{(async()=>{try{const n=l.getState();if(n.years.length>0)G(n.years);else{const r=await U.getYears();G(r)}}catch(n){W.error("Failed to load filter values:",n)}})()},[]),s.useEffect(()=>{if(i){const n=window.matchMedia("(hover: hover) and (pointer: fine) and (min-width: 1024px)").matches?B:$;setTimeout(()=>{var r;if((r=n.current)==null||r.focus(),n.current){const u=n.current.value.length;n.current.setSelectionRange(u,u)}},50)}},[i]);const xe=e=>{ge(e),e.trim().length>0&&!i&&c(!0)},ye=()=>{S()},Ce=()=>{c(!1),Se()},ve=e=>{R(e),g(!0)},je=e=>{he(e)},be=e=>{fe(e)},Ae=e=>{ie(e),R("grouping"),g(!0)},Ie=(e,n)=>{me(r=>({...r,[e]:n}))},Ne=e=>{v(`/artist/${e}`),c(!1),S()},Te=e=>{v(`/album/${e}`),c(!1),S()},ke=e=>{Z(e,[e])},we=()=>{o!=null&&o.songs&&o.songs.length>0&&ee(o.songs)},Oe=()=>{o!=null&&o.songs&&o.songs.length>0&&te(o.songs)},Pe=e=>{v(`/playlist/${e}`),c(!1),S()},Me=(e,n,r="mobile",u)=>{O(e),P(n),oe(r),ae(u||null),w(!0)};s.useEffect(()=>{p.trim()||M(0)},[a,p]),s.useEffect(()=>{Y(q)},[f,d.length]),s.useEffect(()=>{const e=document.querySelector(".main-scrollable");if(!e)return;const n=()=>{const r=e.scrollTop,u=e.clientHeight,Fe=e.scrollHeight;r+u*1.5>=Fe&&Y(Re=>Math.min(Re+He,d.length))};return e.addEventListener("scroll",n,{passive:!0}),()=>e.removeEventListener("scroll",n)},[d.length,V]),s.useEffect(()=>{p.trim()||(!m.current&&Q.current!==a&&_(!0),Q.current=a,Ee())},[f,a,p]),s.useEffect(()=>{m.current&&(m.current=!1)},[]);const Ee=async()=>{T("songs",!0);try{const e={limit:y,startIndex:f*y};a==="RecentlyAdded"?(e.sortBy=["DateCreated"],e.sortOrder="Descending"):(e.sortBy=["SortName"],e.sortOrder="Ascending");const n=await U.getSongs(e);N(n.Items),F(n.TotalRecordCount||0)}catch(e){W.error("Failed to load songs:",e),N([]),F(0)}finally{T("songs",!1),_(!1)}};return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"pb-20",children:[t.jsx("div",{className:`fixed top-0 left-0 right-0 bg-black z-10 lg:left-16 transition-[left,right] duration-300 ${C?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top))"},children:t.jsx("div",{className:"max-w-[768px] mx-auto",children:t.jsxs("div",{className:"p-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsx("h1",{className:"text-2xl font-bold text-white",children:"Songs"}),t.jsx("button",{onClick:()=>c(!0),className:"w-10 h-10 flex items-center justify-center text-white hover:bg-zinc-800 rounded-full transition-colors","aria-label":"Search",children:t.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})]}),!i&&t.jsxs("div",{className:"flex items-center justify-between gap-2",children:[t.jsxs("button",{onClick:()=>K("songs",a==="RecentlyAdded"?"Alphabetical":"RecentlyAdded"),className:"text-sm text-gray-400 hover:text-white transition-colors flex items-center gap-1",children:[a==="RecentlyAdded"?"Recently Added":"Alphabetically",t.jsx(De,{className:"w-4 h-4"})]}),k.songs&&!m.current&&t.jsx("div",{className:"flex items-center",children:t.jsx(_e,{})})]})]})})}),t.jsx("div",{className:`fixed left-0 right-0 z-10 lg:left-16 transition-[left,right] duration-300 ${C?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 7rem - 8px)",height:"24px",background:"linear-gradient(to bottom, rgba(0, 0, 0, 0.8), transparent)"}}),t.jsx("div",{style:{paddingTop:"calc(env(safe-area-inset-top) + 7rem)"},children:t.jsx("div",{className:`${de?"opacity-50 pointer-events-none":""} ${i?"hidden [@media((hover:hover)_and_(pointer:fine)_and_(min-width:1024px))]:block":""}`,children:d.length===0&&!k.songs?t.jsx("div",{className:"flex items-center justify-center py-16 text-gray-400",children:t.jsx("p",{children:"No songs found"})}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"space-y-0",children:d.map((e,n)=>t.jsx(Ve,{song:e,showImage:n<V,onContextMenu:Me,contextMenuItemId:(h==null?void 0:h.Id)||null},e.Id))}),t.jsx(Ye,{currentPage:f,totalPages:Math.ceil(E/y),onPageChange:M,itemsPerPage:y,totalItems:E})]})})})]}),t.jsx(Be,{isOpen:i,onClose:Ce,searchQuery:p,onSearchChange:xe,onClearSearch:ye,isLoading:pe,results:o,sections:ze,filterConfig:{showGenreFilter:!0,showYearFilter:!0,showGroupingFilters:!0},filterState:{selectedGenres:D,yearRange:z,selectedGroupings:H},onOpenFilterSheet:ve,groupingCategories:ue,onOpenGroupingFilterSheet:Ae,onArtistClick:Ne,onAlbumClick:Te,onSongClick:ke,onPlaylistClick:Pe,onPlayAllSongs:we,onAddSongsToQueue:Oe,isQueueSidebarOpen:C,desktopSearchInputRef:B,mobileSearchInputRef:$}),b==="genre"&&t.jsx(I,{isOpen:j,onClose:()=>g(!1),filterType:"genre",genres:X,selectedValues:D,onApply:je}),b==="year"&&t.jsx(I,{isOpen:j,onClose:()=>g(!1),filterType:"year",availableYears:ce,yearRange:z,onApplyYear:be}),b==="grouping"&&A&&t.jsx(I,{isOpen:j,onClose:()=>g(!1),filterType:"grouping",groupingCategory:A,selectedGroupingValues:H[A.key]||[],onApplyGrouping:Ie}),t.jsx(Qe,{item:h,itemType:le,isOpen:se,onClose:()=>{w(!1),O(null),P(null)},zIndex:99999,mode:ne,position:re||void 0})]})}export{tt as default};
