import{r as i,j as e,B as D,X as O,l as q}from"./index-SABcFPCf.js";import{u as Q,f as A}from"./search-DxrwQPN1.js";function _({isOpen:j,onClose:b,filterType:a,availableYears:l=[],yearRange:v={min:null,max:null},onApplyYear:C,genres:F=[],selectedValues:M=[],onApply:N,groupingCategory:d,selectedGroupingValues:y=[],onApplyGrouping:x}){const[c,r]=i.useState(v),[I,S]=i.useState(M),[R,p]=i.useState(y),k=i.useRef(null),G=i.useRef(null);i.useEffect(()=>{r(v)},[v.min,v.max]),i.useEffect(()=>{S(M)},[M.join(",")]),i.useEffect(()=>{p(y)},[y.join(",")]);const $=t=>{S(s=>s.includes(t)?s.filter(n=>n!==t):[...s,t])},E=t=>{p(s=>s.includes(t)?s.filter(n=>n!==t):[...s,t])},B=()=>{a==="year"&&C?C(c):a==="genre"&&N?N(I):a==="grouping"&&x&&d&&x(d.key,R),b()},h=()=>{a==="year"?(r({min:null,max:null}),C&&C({min:null,max:null})):a==="genre"?S([]):a==="grouping"&&(p([]),x&&d&&x(d.key,[])),b()},f=l.length>0?l[0]:1900,L=l.length>0?l[l.length-1]:new Date().getFullYear(),m=i.useRef(!1);i.useEffect(()=>{if(a==="year"&&j&&l.length>0){const t=m.current;m.current=!1,setTimeout(()=>{if(k.current){const n=c.min!==null?l.indexOf(c.min):0;if(n!==-1){const o=k.current.querySelector(`[data-year-index="${n}"]`);o&&o.scrollIntoView({behavior:t?"instant":"smooth",block:"center"})}}if(G.current){const n=c.max!==null?l.indexOf(c.max):l.length-1;if(n!==-1){const o=G.current.querySelector(`[data-year-index="${n}"]`);o&&o.scrollIntoView({behavior:t?"instant":"smooth",block:"center"})}}},t?350:50)}},[a,j,c.min,c.max,l]),i.useEffect(()=>{j&&(m.current=!0)},[j]);const u=(t,s)=>{r(n=>{if(t==="min"){const o=n.max!==null&&s>n.max?n.max:s;return setTimeout(()=>{const z=l.indexOf(o);if(z!==-1&&k.current){const w=k.current.querySelector(`[data-year-index="${z}"]`);w&&w.scrollIntoView({behavior:"smooth",block:"center"})}},50),{...n,min:o}}else{const o=n.min!==null&&s<n.min?n.min:s;return setTimeout(()=>{const z=l.indexOf(o);if(z!==-1&&G.current){const w=G.current.querySelector(`[data-year-index="${z}"]`);w&&w.scrollIntoView({behavior:"smooth",block:"center"})}},50),{...n,max:o}}})},g=(c.min===null||c.min===f)&&(c.max===null||c.max===L)&&v.min===null&&v.max===null;return e.jsx(D,{isOpen:j,onClose:b,zIndex:10001,children:e.jsxs("div",{className:"pb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 px-4",children:[e.jsxs("div",{className:"text-lg font-semibold text-white",children:["Filter by ",a==="genre"?"Genre":a==="year"?"Year":(d==null?void 0:d.name)||"Tag"]}),e.jsx("button",{onClick:b,className:"w-8 h-8 flex items-center justify-center text-white hover:bg-white/10 rounded-full transition-colors","aria-label":"Close",children:e.jsx(O,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"px-4 max-h-[75vh] overflow-y-auto overscroll-none touch-pan-y",children:a==="year"?e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("div",{className:"text-center text-sm text-gray-400 mb-2",children:"From"}),e.jsx("div",{ref:k,className:"h-64 overflow-y-auto scroll-smooth snap-y snap-mandatory py-[calc(50%-1.5rem)] overscroll-contain",children:l.length>0?l.map((t,s)=>{const n=c.min===t,o=c.max!==null&&t>c.max;return e.jsx("button",{"data-year-index":s,onClick:()=>u("min",t),disabled:o,className:`w-full py-3 px-4 text-center snap-center transition-colors ${n?"bg-[var(--accent-color)] text-white font-semibold rounded-lg":o?"text-gray-500 cursor-not-allowed":"text-white hover:bg-white/10"}`,children:t},t)}):e.jsx("div",{className:"text-center py-8 text-gray-400",children:e.jsx("div",{className:"text-sm",children:"No years available"})})}),e.jsx("div",{className:"absolute left-0 right-0 h-12 bg-gradient-to-b from-zinc-900 to-transparent pointer-events-none",style:{top:"1.75rem"}}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-12 bg-gradient-to-t from-zinc-900 to-transparent pointer-events-none"})]}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("div",{className:"text-center text-sm text-gray-400 mb-2",children:"To"}),e.jsx("div",{ref:G,className:"h-64 overflow-y-auto scroll-smooth snap-y snap-mandatory py-[calc(50%-1.5rem)] overscroll-contain",children:l.length>0?l.map((t,s)=>{const n=c.max===t,o=c.min!==null&&t<c.min;return e.jsx("button",{"data-year-index":s,onClick:()=>u("max",t),disabled:o,className:`w-full py-3 px-4 text-center snap-center transition-colors ${n?"bg-[var(--accent-color)] text-white font-semibold rounded-lg":o?"text-gray-500 cursor-not-allowed":"text-white hover:bg-white/10"}`,children:t},t)}):e.jsx("div",{className:"text-center py-8 text-gray-400",children:e.jsx("div",{className:"text-sm",children:"No years available"})})}),e.jsx("div",{className:"absolute left-0 right-0 h-14 bg-gradient-to-b from-zinc-900 via-zinc-900/80 to-transparent pointer-events-none",style:{top:"1.75rem"}}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-14 bg-gradient-to-t from-zinc-900 via-zinc-900/80 to-transparent pointer-events-none"})]})]})}):a==="genre"?e.jsx("div",{className:"space-y-2",children:F.length>0?[...F].sort((t,s)=>(t.Name||"").localeCompare(s.Name||"")).map(t=>{const s=t.Name||"",n=I.includes(s);return e.jsxs("button",{onClick:()=>$(s),className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-white/10 transition-colors text-left",children:[e.jsx("div",{className:`w-5 h-5 rounded border-2 flex items-center justify-center transition-colors ${n?"bg-white border-white":"border-white/40 bg-transparent"}`,children:n&&e.jsx("svg",{className:"w-3 h-3 text-zinc-900",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),e.jsx("span",{className:"text-white font-medium",children:s})]},t.Id)}):e.jsx("div",{className:"text-center py-8 text-gray-400",children:e.jsx("div",{className:"text-sm",children:"No genres available"})})}):a==="grouping"&&d?e.jsx("div",{className:"space-y-2",children:d.isSingleValue?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>E("yes"),className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-white/10 transition-colors text-left",children:[e.jsx("div",{className:`w-5 h-5 rounded border-2 flex items-center justify-center transition-colors ${R.includes("yes")?"bg-white border-white":"border-white/40 bg-transparent"}`,children:R.includes("yes")&&e.jsx("svg",{className:"w-3 h-3 text-zinc-900",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),e.jsx("span",{className:"text-white font-medium",children:d.name})]}),e.jsxs("button",{onClick:()=>E("no"),className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-white/10 transition-colors text-left",children:[e.jsx("div",{className:`w-5 h-5 rounded border-2 flex items-center justify-center transition-colors ${R.includes("no")?"bg-white border-white":"border-white/40 bg-transparent"}`,children:R.includes("no")&&e.jsx("svg",{className:"w-3 h-3 text-zinc-900",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),e.jsxs("span",{className:"text-white font-medium",children:["Not ",d.name]})]})]}):d.values.length>0?d.values.map(t=>{const s=R.includes(t.toLowerCase());return e.jsxs("button",{onClick:()=>E(t.toLowerCase()),className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-white/10 transition-colors text-left",children:[e.jsx("div",{className:`w-5 h-5 rounded border-2 flex items-center justify-center transition-colors ${s?"bg-white border-white":"border-white/40 bg-transparent"}`,children:s&&e.jsx("svg",{className:"w-3 h-3 text-zinc-900",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),e.jsx("span",{className:"text-white font-medium",children:t})]},t)}):e.jsx("div",{className:"text-center py-8 text-gray-400",children:e.jsx("div",{className:"text-sm",children:"No options available"})})}):e.jsx("div",{className:"text-center py-8 text-gray-400",children:e.jsx("div",{className:"text-sm",children:"No options available"})})}),e.jsxs("div",{className:"flex gap-3 mt-6 px-4",children:[e.jsx("button",{onClick:h,disabled:a==="year"&&g,className:"flex-1 px-4 py-3 bg-white/10 hover:bg-white/20 disabled:opacity-30 disabled:cursor-not-allowed text-white font-medium rounded-lg transition-colors",children:"Clear"}),e.jsx("button",{onClick:B,className:"flex-1 px-4 py-3 bg-white text-zinc-900 font-medium rounded-lg hover:bg-gray-100 transition-colors",children:"Apply"})]})]})})}function P(j){if(!j||j.trim()==="")return null;const b=j.trim().toLowerCase(),a=b.indexOf("_");return a===-1?{category:b,value:null}:{category:b.substring(0,a),value:b.substring(a+1)}}function J(j={}){const{debounceMs:b=250,limit:a=450,includeYearFilter:l=!0}=j,[v,C]=i.useState(""),[F,M]=i.useState(!1),[N,d]=i.useState(null),y=i.useRef(null),[x,c]=i.useState([]),[r,I]=i.useState({min:null,max:null}),[S,R]=i.useState({}),p=Object.values(S).some(h=>h.length>0),k=l?x.length>0||r.min!==null||r.max!==null||p:x.length>0||p,G=i.useCallback(()=>{const h={};if(x.length>0&&(h.genres=x),l&&(r.min!==null||r.max!==null)){const f=new Date().getFullYear(),L=r.min??1900,m=r.max??f,u=[];for(let g=L;g<=m;g++)u.push(g);h.years=u}return h.genres||h.years?h:void 0},[x,r,l]);i.useEffect(()=>{y.current&&y.current.abort();const h=v.trim().length>0;if(h||k){M(!0);const f=new AbortController;y.current=f;const L=async()=>{if(!f.signal.aborted)try{const m=G();let u;h?u=await Q(v,a,m):u=await A(a,m),f.signal.aborted||d(u)}catch(m){f.signal.aborted||(q.error("Search failed:",m),d(null))}finally{f.signal.aborted||M(!1)}};if(b>0){const m=window.setTimeout(L,b);return()=>{window.clearTimeout(m),f.abort()}}else return L(),()=>{f.abort()}}else y.current=null,d(null),M(!1)},[v,x,r,S,k,b,a,G]),i.useEffect(()=>()=>{y.current&&y.current.abort()},[]);const $=i.useMemo(()=>{if(!N)return null;const h=m=>{if(l&&(r.min!==null||r.max!==null)||p)return!1;if(x.length>0){const u=m.Genres||[];if(!x.some(t=>u.some(s=>s.toLowerCase()===t.toLowerCase())))return!1}return!0},f=m=>{if(x.length>0){const u=m.Genres||[];if(!x.some(t=>u.some(s=>s.toLowerCase()===t.toLowerCase())))return!1}if(l&&(r.min!==null||r.max!==null)){const u=m.ProductionYear;if(!u||u<=0||r.min!==null&&u<r.min||r.max!==null&&u>r.max)return!1}if(p){const u=m.Grouping||[],g=new Map,t=new Set;u.forEach(s=>{const n=P(s);n&&(t.add(n.category),g.has(n.category)||g.set(n.category,new Set),n.value&&g.get(n.category).add(n.value))});for(const[s,n]of Object.entries(S)){if(n.length===0)continue;const o=n.includes("no"),z=n.includes("yes");if(o||z){const w=t.has(s);if(o&&!z&&w||z&&!o&&!w)return!1}else{const w=g.get(s);if(!w||w.size===0||!n.some(V=>w.has(V.toLowerCase())))return!1}}}return!0},L=m=>!(l&&(r.min!==null||r.max!==null)||x.length>0||p);return{artists:N.artists.filter(h),albums:N.albums.filter(f),playlists:(N.playlists||[]).filter(L),songs:N.songs.filter(f)}},[N,x,r,l,S,p]),E=i.useCallback(()=>{C(""),d(null)},[]),B=i.useCallback(()=>{C(""),d(null),c([]),I({min:null,max:null}),R({})},[]);return{searchQuery:v,setSearchQuery:C,isSearching:F,rawSearchResults:N,searchResults:$,selectedGenres:x,setSelectedGenres:c,yearRange:r,setYearRange:I,selectedGroupings:S,setSelectedGroupings:R,hasActiveFilters:k,clearSearch:E,clearAll:B}}export{_ as F,J as u};
