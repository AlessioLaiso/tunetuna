import{v as je,b as Ie,a as te,k as ne,r,j as e,o as Ne,l as V,e as A,I as Ce,x as Se,P as Pe,N as Re,C as se,f as Me,y as Ee}from"./index-CL-vPxhG.js";import{A as De}from"./arrow-left-dMQ-rbn1.js";import{E as Oe}from"./ellipsis-DNX-YLMM.js";import{C as ze}from"./chevron-up-eM4bxlCE.js";function Le({track:a,trackNumber:g,tracks:R,onClick:M,onContextMenu:o,contextMenuItemId:F}){const X=F===a.Id,n=ne(),t=r.useRef(!1),$=h=>{h.preventDefault(),h.stopPropagation(),t.current=!0,o(a,"desktop",{x:h.clientX,y:h.clientY}),setTimeout(()=>{t.current=!1},300)},u=Me({onLongPress:h=>{h.preventDefault(),t.current=!0,o(a,"mobile")},onClick:()=>{if(t.current){t.current=!1;return}M(a,R)}});return e.jsxs("button",{onClick:()=>{if(t.current){t.current=!1;return}M(a,R)},onContextMenu:$,...u,className:`w-full flex items-baseline hover:bg-white/10 transition-colors group py-3 ${X?"bg-white/10":""}`,children:[e.jsx("span",{className:`text-sm w-6 text-right flex-shrink-0 mr-4 ${(n==null?void 0:n.Id)===a.Id?"text-[var(--accent-color)]":"text-gray-500"}`,children:g&&g>0?g:"-"}),e.jsx("div",{className:"flex-1 min-w-0 text-left",children:e.jsx("div",{className:`text-sm font-medium truncate transition-colors ${(n==null?void 0:n.Id)===a.Id?"text-[var(--accent-color)]":"text-white group-hover:text-[var(--accent-color)]"}`,children:a.Name})}),a.RunTimeTicks&&e.jsx("div",{className:"text-xs text-gray-500 flex-shrink-0 text-right mr-4",children:Ee(a.RunTimeTicks)})]})}function Ye(){const{id:a}=je(),g=Ie(),{playAlbum:R,playTrack:M,isPlaying:o,play:F,pause:X}=te(),n=ne(),[t,$]=r.useState(null),[u,h]=r.useState([]),[re,B]=r.useState(!0),[H,U]=r.useState(!1),[E,W]=r.useState(!0),[ie,q]=r.useState(!1),[le,ae]=r.useState("mobile"),[oe,ce]=r.useState(null),[D,Q]=r.useState(null),[ue,J]=r.useState(!1),[de,k]=r.useState("mobile"),[fe,G]=r.useState(null),[K,I]=r.useState(null),[me,N]=r.useState(!1),[y,O]=r.useState(!1),[z,p]=r.useState(!1),C=r.useRef(!1),S=r.useRef(!1),[Z,xe]=r.useState(!1),[he,pe]=r.useState(0),Y=r.useRef(0),v=r.useRef(null),j=r.useRef(0),P=r.useRef(!1),ge=r.useRef(null),b=r.useRef(null),ve=te(s=>s.isQueueSidebarOpen),_=r.useRef(!1);r.useEffect(()=>{const s=()=>{xe(window.innerWidth>=1280&&window.innerHeight>=1080)};return s(),window.addEventListener("resize",s),()=>window.removeEventListener("resize",s)},[]),r.useEffect(()=>{if(!a)return;let s=!0;return(async()=>{var d;B(!0);try{const l=await A.getAlbumTracks(a);if(!s)return;h(l);let f=await A.getAlbumById(a);if(!f){const w=(await A.getAlbums({limit:1})).Items.find(ye=>ye.Id===a);w&&(f=w)}if(!s)return;f||l.length>0&&l[0].AlbumId===a&&(f={Id:a,Name:l[0].Album||"Unknown Album",AlbumArtist:l[0].AlbumArtist}),f&&($(f),W(!0));const x=be(l,f);if(x)try{const m=await A.getArtistById(x);if(!s)return;(d=m==null?void 0:m.ImageTags)!=null&&d.Logo?(I(A.getImageUrl(x,"Logo")),N(!0)):(N(!1),I(null))}catch(m){if(!s)return;V.warn("Failed to load artist logo:",m),N(!1),I(null)}else N(!1),I(null)}catch(l){if(!s)return;V.error("Failed to load album data:",l)}finally{s&&B(!1)}})(),()=>{s=!1}},[a]),r.useEffect(()=>{const s=(n==null?void 0:n.AlbumId)===(t==null?void 0:t.Id)&&o,i=(t==null?void 0:t.Id)||null,d=b.current!==null&&b.current!==i;if(_.current!==s&&(C.current=!1),_.current=s,!E){O(!1),p(!1),b.current=i;return}s?((d||!P.current||!y)&&(O(!0),p(!1),P.current=!0),S.current=window.innerWidth>=560,C.current||(C.current=!0,setTimeout(()=>{(n==null?void 0:n.AlbumId)===(t==null?void 0:t.Id)&&o&&p(!0)},500)),b.current=i):P.current&&y&&!s?(C.current||(C.current=!0,p(!1)),b.current=i):P.current?(O(!1),p(!1),b.current=i):(O(!1),p(!1),P.current=!0,b.current=i)},[n==null?void 0:n.AlbumId,t==null?void 0:t.Id,o,y,E,z]),r.useEffect(()=>{const s=()=>{if((n==null?void 0:n.AlbumId)===(t==null?void 0:t.Id)&&o&&y){const d=window.innerWidth>=560;S.current=d,z&&(p(!1),setTimeout(()=>p(!0),10))}};return window.addEventListener("resize",s),()=>window.removeEventListener("resize",s)},[n==null?void 0:n.AlbumId,t==null?void 0:t.Id,o,y,z]),r.useEffect(()=>{if((n==null?void 0:n.AlbumId)===(t==null?void 0:t.Id)&&o){const i=d=>{j.current===0&&(j.current=d);const l=d-j.current,c=360/1e4;Y.current=(Y.current+c*l)%360,pe(Y.current),j.current=d,v.current=requestAnimationFrame(i)};j.current=0,v.current=requestAnimationFrame(i)}else v.current&&(cancelAnimationFrame(v.current),v.current=null),j.current=0;return()=>{v.current&&cancelAnimationFrame(v.current)}},[n==null?void 0:n.AlbumId,t==null?void 0:t.Id,o]);const be=(s,i)=>{var d,l;if(i!=null&&i.AlbumArtists&&i.AlbumArtists.length>0)return i.AlbumArtists[0].Id;if(s.length>0){const c=(l=(d=s[0].ArtistItems)==null?void 0:d[0])==null?void 0:l.Id;if(c&&s.every(x=>{var m,w;return((w=(m=x.ArtistItems)==null?void 0:m[0])==null?void 0:w.Id)===c}))return c}return null},we=()=>{u.length>0&&R(u)},L=()=>{if(u.length>0){const s=u[0];if(s.ProductionYear&&s.ProductionYear>0)return s.ProductionYear.toString();if(s.PremiereDate){const i=new Date(s.PremiereDate).getFullYear();if(i>0)return i.toString()}}return null},T=()=>u.length>0&&u[0].ArtistItems&&u[0].ArtistItems.length>0?u[0].ArtistItems[0].Id:t!=null&&t.ArtistItems&&t.ArtistItems.length>0?t.ArtistItems[0].Id:null,ee=()=>{var s,i;return t.AlbumArtist||((i=(s=t.ArtistItems)==null?void 0:s[0])==null?void 0:i.Name)||null},Ae=()=>{const s=T();s&&g(`/artist/${s}`)};return re?e.jsx("div",{className:"pb-20",children:e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsx(Ne,{})})}):!t||u.length===0?e.jsx("div",{className:"pb-20",children:e.jsx("div",{className:"flex items-center justify-center h-screen text-gray-400",children:e.jsx("p",{children:"Album not found"})})}):e.jsxs("div",{className:"pb-20",style:{overflowX:"hidden",maxWidth:"100vw",width:"100%"},children:[e.jsx("div",{className:"fixed top-0 left-0 right-0 z-[55] pointer-events-none",style:{height:"env(safe-area-inset-top)",top:"var(--header-offset, 0px)",background:"transparent"}}),e.jsx("div",{className:"fixed top-0 left-0 right-0 z-10 pointer-events-none",style:{height:"calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 4rem)",top:"var(--header-offset, 0px)",background:`linear-gradient(to bottom,
            #000000 0%,
            #000000 calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 0.5rem),
            rgba(0, 0, 0, 0.95) calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 1rem),
            rgba(0, 0, 0, 0.85) calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 1.5rem),
            rgba(0, 0, 0, 0.7) calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 2rem),
            rgba(0, 0, 0, 0.5) calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 2.5rem),
            rgba(0, 0, 0, 0.3) calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 3rem),
            rgba(0, 0, 0, 0.15) calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 3.5rem),
            rgba(0, 0, 0, 0) calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 4rem)
          )`}}),e.jsx("div",{className:`fixed top-0 left-0 right-0 z-20 lg:left-16 transition-[left,right] duration-300 ${ve?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top))"},children:e.jsx("div",{className:"max-w-[768px] mx-auto relative",children:e.jsxs("div",{className:"flex items-center justify-between gap-4 py-4 pl-3 pr-4 relative z-10",children:[e.jsx("button",{onClick:()=>g(-1),className:"text-white hover:text-zinc-300 transition-colors",children:e.jsx(De,{className:"w-6 h-6"})}),t&&e.jsx("button",{onClick:s=>{if(window.innerWidth<768)k("mobile"),G(null);else{const i=s.currentTarget.getBoundingClientRect();k("desktop"),G({x:i.left+i.width/2,y:i.bottom+5})}J(!0)},className:"text-white hover:text-zinc-300 transition-colors",children:e.jsx(Oe,{className:"w-6 h-6"})})]})})}),e.jsxs("div",{style:{paddingTop:"calc(5rem + 12px - 48px)"},children:[e.jsxs("div",{className:"mb-6 px-4 pt-4",style:{overflow:"visible"},children:[E&&e.jsx("div",{className:"flex justify-center mb-6 relative",style:{overflowX:"visible",overflowY:"visible",paddingLeft:"16px",paddingRight:"16px"},children:e.jsxs("div",{ref:ge,className:"relative",style:{overflow:"visible",width:Z?"360px":"256px",height:Z?"360px":"256px"},children:[e.jsx("div",{className:"absolute inset-0 rounded-full overflow-hidden",style:{opacity:y?1:0,zIndex:1,transform:(n==null?void 0:n.AlbumId)===t.Id&&o&&S.current?"translateX(calc(50% + 8px))":"translateX(0)",transition:"transform 500ms ease-in-out, opacity 300ms ease-in-out"},children:e.jsxs("div",{className:"w-full h-full",style:{transformOrigin:"center center",transform:`rotate(${he}deg)`},children:[e.jsx("img",{src:"/assets/vinyl.png",alt:"Vinyl Record",className:"w-full h-full object-cover",onError:s=>{V.error("Failed to load vinyl image"),s.currentTarget.style.display="none"}}),e.jsx("div",{className:"absolute top-1/2 left-1/2 rounded-full",style:{width:"52%",height:"52%",backgroundColor:"#a1a1aa",transform:"translate(-50%, -50%)",transformOrigin:"center center"}}),me&&K?e.jsx("div",{className:"absolute top-1/2 left-1/2 rounded-full overflow-hidden flex items-center justify-center",style:{width:"47%",height:"47%",transform:"translate(-50%, -50%)",transformOrigin:"center center"},children:e.jsx("img",{src:K,alt:"Artist Logo",className:"w-full h-full object-contain",onError:()=>{N(!1),I(null)}})}):E?e.jsx("div",{className:"absolute top-1/2 left-1/2 rounded-full overflow-hidden flex items-center justify-center",style:{width:"52%",height:"52%",transform:"translate(-50%, -50%)",transformOrigin:"center center"},children:e.jsx("img",{src:A.getAlbumArtUrl(t.Id),alt:t.Name,className:"w-full h-full object-cover"})}):null]})}),e.jsx("div",{className:"absolute inset-0 rounded overflow-hidden bg-zinc-900 transition-all duration-500",style:{transform:(n==null?void 0:n.AlbumId)===t.Id&&o||z?S.current?"translateX(calc(-50% - 8px))":"translateX(calc(-100% - 24px))":"translateX(0)",opacity:1,transitionProperty:"transform",transitionDuration:"500ms",transitionTimingFunction:"ease-in-out",zIndex:10},children:e.jsx(Ce,{src:A.getAlbumArtUrl(t.Id),alt:t.Name,className:"w-full h-full object-cover",showOutline:!0,rounded:"rounded",onError:()=>W(!1)})})]})}),e.jsxs("div",{className:"w-full",children:[e.jsx("h2",{className:"text-4xl md:text-5xl font-bold mb-0.5 text-left break-words",children:t.Name}),e.jsxs("div",{className:"flex items-center justify-between gap-4 mt-2",children:[e.jsxs("div",{className:"text-gray-400 flex items-center gap-1.5",children:[ee()&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:Ae,className:`hover:text-white transition-colors ${T()?"cursor-pointer":"cursor-default"}`,children:ee()}),L()&&e.jsx("span",{children:"â€¢"})]}),L()&&e.jsx("button",{onClick:()=>g(`/albums?year=${L()}`),className:"hover:text-white transition-colors cursor-pointer",children:L()})]}),e.jsx("button",{onClick:()=>{(n==null?void 0:n.AlbumId)===t.Id&&o?X():(n==null?void 0:n.AlbumId)===t.Id&&!o?F():we()},className:"bg-white/10 hover:bg-white/20 text-white font-semibold py-1.5 px-3 rounded-full transition-all hover:scale-105 flex items-center gap-1.5 backdrop-blur-sm border border-white/20 flex-shrink-0",children:(n==null?void 0:n.AlbumId)===t.Id&&o?e.jsxs(e.Fragment,{children:[e.jsx(Se,{className:"w-3.5 h-3.5"}),"Pause"]}):e.jsxs(e.Fragment,{children:[e.jsx(Pe,{className:"w-3.5 h-3.5"}),"Play"]})})]})]})]}),t.Overview&&e.jsx("div",{className:"mb-6 px-4",children:e.jsxs("div",{className:"text-white relative",children:[!H&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>U(!0),className:"flex-1 text-left min-w-0",children:e.jsx("p",{className:"text-sm text-gray-300 leading-relaxed line-clamp-2",children:t.Overview})}),e.jsx("button",{onClick:()=>U(!0),className:"flex-shrink-0 text-gray-400 hover:text-white transition-colors",children:e.jsx(Re,{className:"w-4 h-4"})})]}),H&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-300 leading-relaxed whitespace-pre-line",children:t.Overview}),e.jsxs("button",{onClick:()=>U(!1),className:"mt-2 flex items-center gap-1 text-sm text-gray-400 hover:text-white transition-colors ml-auto",children:["Show less",e.jsx(ze,{className:"w-4 h-4"})]})]})]})}),e.jsx("div",{children:e.jsx("div",{className:"space-y-0",children:(()=>{const s=new Map;u.forEach(l=>{const c=l.ParentIndexNumber??1;s.has(c)||s.set(c,[]),s.get(c).push(l)});const i=s.size>1;return Array.from(s.keys()).sort((l,c)=>l-c).map(l=>{const c=s.get(l);return e.jsxs("div",{children:[i&&e.jsxs("div",{className:`px-4 py-2 text-xs font-medium text-gray-400 uppercase tracking-wider ${l>1?"pt-4":""}`,children:["Disc ",l]}),c.map(f=>e.jsx(Le,{track:f,trackNumber:f.IndexNumber??null,tracks:u,onClick:x=>M(x,u),onContextMenu:(x,m,w)=>{Q(x),ae(m||"mobile"),ce(w||null),q(!0)},contextMenuItemId:(D==null?void 0:D.Id)||null},f.Id))]},l)})})()})})]}),e.jsx(se,{item:D,itemType:"song",isOpen:ie,onClose:()=>{q(!1),Q(null)},mode:le,position:oe||void 0}),e.jsx(se,{item:t,itemType:"album",isOpen:ue,onClose:()=>{J(!1)},mode:de,position:fe||void 0})]})}export{Ye as default};
