import{k as Ne,b as je,a as T,g as Se,u as ve,p as we,r as l,j as e,h as Ae,S as Ie,P as Pe,L as ye,C as Ce,e as M,f as De,D as Me,I as Ee}from"./index-scgXBtC7.js";import{u as K}from"./useScrollLazyLoad-Dy2MVRnq.js";import{S as ke}from"./SongItem-D5JN92IM.js";import{P as Ge}from"./Pagination-BlzUVH5l.js";import{A as Y}from"./arrow-left-CXDjeGBi.js";import{A as Le}from"./arrow-up-down-DHpxObdw.js";const W=45,Te=45,D=84,Z=45,Ye=45;function Be({album:o,year:b,onNavigate:A,onContextMenu:E,showImage:B=!0}){const[O,k]=l.useState(!1),x=l.useRef(!1),S=g=>{g.preventDefault(),g.stopPropagation(),x.current=!0,E(o,"desktop",{x:g.clientX,y:g.clientY}),setTimeout(()=>{x.current=!1},300)},I=De({onLongPress:g=>{g.preventDefault(),x.current=!0,E(o,"mobile")},onClick:()=>{if(x.current){x.current=!1;return}A(o.Id)}});return e.jsxs("button",{onClick:()=>{if(x.current){x.current=!1;return}A(o.Id)},onContextMenu:S,...I,className:"text-left group",children:[e.jsx("div",{className:"aspect-square rounded overflow-hidden mb-2 bg-zinc-900 flex items-center justify-center",children:O?e.jsx(Me,{className:"w-12 h-12 text-gray-500"}):B?e.jsx(Ee,{src:M.getAlbumArtUrl(o.Id,474),alt:o.Name,className:"w-full h-full object-cover",showOutline:!0,rounded:"rounded",onError:()=>k(!0)}):e.jsx("div",{className:"w-full h-full bg-zinc-900"})}),e.jsx("div",{className:"text-sm font-medium text-white truncate",children:o.Name}),b&&e.jsx("div",{className:"text-xs text-gray-400 truncate",children:b})]})}function Re(){const{id:o}=Ne(),b=je(),{playAlbum:A,toggleShuffle:E,isPlaying:B,pause:O,shuffleGenreSongs:k,addToQueue:x}=T();Se();const{genres:S,genreSongs:I,setGenreSongs:g}=ve(),{state:z}=we(),[d,F]=l.useState(null),[f,_]=l.useState([]),[ee,v]=l.useState(!0),[te,V]=l.useState(!1),[se,ne]=l.useState("mobile"),[re,ae]=l.useState(null),[le,U]=l.useState(null),[oe,R]=l.useState(null),[$,Q]=l.useState(W),[q,H]=l.useState(Z),[ie,ce]=l.useState(0),[w,G]=l.useState(!1),[P,ue]=l.useState("Alphabetical"),[L,J]=l.useState(0),y=T(t=>t.isQueueSidebarOpen);l.useEffect(()=>{if(w){const t=setTimeout(()=>{G(!1)},1e4);return()=>clearTimeout(t)}},[w]),l.useEffect(()=>{z==="success"&&o&&ce(t=>t+1)},[z,o]),l.useEffect(()=>{if(!o)return;(async()=>{const n=I[o];if(n&&n.length>0){let s=S;s.length===0&&(s=await M.getGenres());const r=s.find(a=>a.Id===o);r&&F(r),_(n),v(!1);return}v(!0);try{let s=S;s.length===0&&(s=await M.getGenres());const r=s.find(m=>m.Id===o);if(!r){v(!1);return}F(r);const a=r.Name;if(!a){v(!1);return}const i=await M.getGenreSongs(o,a);g(o,i),_(i)}catch(s){console.error("Failed to load genre songs:",s)}finally{v(!1)}})()},[o,S,I,g,ie]);const me=async()=>{if(f.length>0&&(d!=null&&d.Id)&&(d!=null&&d.Name)&&!w){const t=T.getState(),{isShuffleAllActive:n,isShuffleGenreActive:s,shuffle:r}=t;if(n||s)return;G(!0);try{await k(d.Id,d.Name)}catch(a){console.error("Failed to shuffle genre:",a)}finally{G(!1)}}},u=l.useMemo(()=>{const t=new Map;return f.forEach(n=>{if(n.AlbumId&&n.Album&&!t.has(n.AlbumId)){const s={Id:n.AlbumId,Name:n.Album,AlbumArtist:n.AlbumArtist,ArtistItems:n.ArtistItems,ProductionYear:n.ProductionYear,PremiereDate:n.PremiereDate};t.set(n.AlbumId,s)}}),Array.from(t.values()).sort((n,s)=>{const r=n.ProductionYear||(n.PremiereDate?new Date(n.PremiereDate).getFullYear():0),a=s.ProductionYear||(s.PremiereDate?new Date(s.PremiereDate).getFullYear():0);if(r!==a)return a-r;const i=n.Name||"",m=s.Name||"";return i.localeCompare(m)})},[f]),p=u.length>84,de=l.useMemo(()=>{if(!p)return u;const t=L*D,n=t+D;return u.slice(t,n)},[u,L,p]);l.useMemo(()=>{const t=new Map;f.forEach(s=>{var m,c;const r=s.AlbumArtist||((c=(m=s.ArtistItems)==null?void 0:m[0])==null?void 0:c.Name)||"Unknown Artist",a=s.AlbumId||"no-album";t.has(r)||t.set(r,new Map);const i=t.get(r);i.has(a)||i.set(a,[]),i.get(a).push(s)});const n=[];return t.forEach((s,r)=>{const a=[];s.forEach((i,m)=>{var j;const c=[...i].sort((C,ge)=>{const pe=C.IndexNumber||0,be=ge.IndexNumber||0;return pe-be}),h=((j=c[0])==null?void 0:j.Album)||"Unknown Album";a.push({albumId:m,albumName:h,songs:c})}),a.sort((i,m)=>{const c=i.songs[0],h=m.songs[0],j=(c==null?void 0:c.ProductionYear)||(c!=null&&c.PremiereDate?new Date(c.PremiereDate).getFullYear():0),C=(h==null?void 0:h.ProductionYear)||(h!=null&&h.PremiereDate?new Date(h.PremiereDate).getFullYear():0);return j!==C?C-j:i.albumName.localeCompare(m.albumName)}),n.push({artist:r,albums:a})}),n.sort((s,r)=>s.artist.localeCompare(r.artist)),n},[f]);const X=(t,n)=>{const s=n.find(a=>a.Id===t.AlbumId);if(s){const a=s.ProductionYear||(s.PremiereDate?new Date(s.PremiereDate).getFullYear():0);return s.PremiereDate?new Date(s.PremiereDate).getTime():a*1e4}const r=t.ProductionYear||(t.PremiereDate?new Date(t.PremiereDate).getFullYear():0);return t.PremiereDate?new Date(t.PremiereDate).getTime():r*1e4},N=l.useMemo(()=>P==="Alphabetical"?[...f].sort((t,n)=>{const s=t.Name||"",r=n.Name||"";return s.localeCompare(r)}):[...f].sort((t,n)=>{const s=X(t,u),r=X(n,u);if(s!==r)return P==="Newest"?r-s:s-r;const a=t.Album||"",i=n.Album||"";if(a!==i)return a.localeCompare(i);const m=t.IndexNumber||0,c=n.IndexNumber||0;if(m!==c)return m-c;const h=t.Name||"",j=n.Name||"";return h.localeCompare(j)}),[f,P,u]),fe=()=>{ue(t=>t==="Alphabetical"?"Newest":t==="Newest"?"Oldest":"Alphabetical")},he=()=>{N.length>0&&A(N)},xe=()=>{N.length>0&&x(N)};return l.useEffect(()=>{p||Q(W)},[u.length,p]),l.useEffect(()=>{J(0)},[o]),l.useEffect(()=>{H(Z)},[N.length]),K({totalCount:N.length,visibleCount:q,increment:Ye,setVisibleCount:H,threshold:1}),K({totalCount:u.length,visibleCount:$,increment:Te,setVisibleCount:Q,threshold:1,enabled:!p}),ee?e.jsxs("div",{className:"pb-20",children:[e.jsx("div",{className:`fixed top-0 left-0 right-0 bg-black z-10 lg:left-16 transition-[left,right] duration-300 ${y?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top))"},children:e.jsx("div",{className:"max-w-[768px] mx-auto",children:e.jsxs("div",{className:"flex items-center gap-4 p-4",children:[e.jsx("button",{onClick:()=>b(-1),className:"text-white hover:text-zinc-300 transition-colors",children:e.jsx(Y,{className:"w-6 h-6"})}),e.jsx("h1",{className:"text-xl font-bold flex-1 truncate",children:(d==null?void 0:d.Name)||""}),e.jsx("div",{className:"flex items-center",children:e.jsx(Ae,{})})]})})}),e.jsx("div",{className:"pt-20",children:e.jsx("div",{className:"flex items-center justify-center h-screen text-gray-400"})})]}):!d||f.length===0?e.jsxs("div",{className:"pb-20",children:[e.jsx("div",{className:`fixed top-0 left-0 right-0 bg-black z-10 lg:left-16 transition-[left,right] duration-300 ${y?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top))"},children:e.jsx("div",{className:"max-w-[768px] mx-auto",children:e.jsxs("div",{className:"flex items-center gap-4 p-4",children:[e.jsx("button",{onClick:()=>b(-1),className:"text-white hover:text-zinc-300 transition-colors",children:e.jsx(Y,{className:"w-6 h-6"})}),e.jsx("h1",{className:"text-xl font-bold flex-1 truncate",children:"Genre"})]})})}),e.jsx("div",{className:"pt-20",children:e.jsx("div",{className:"flex items-center justify-center h-screen text-gray-400",children:e.jsx("p",{children:"Genre not found or no songs available"})})})]}):e.jsxs("div",{className:"pb-20",children:[e.jsx("div",{className:`fixed top-0 left-0 right-0 bg-black z-10 lg:left-16 transition-[left,right] duration-300 ${y?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top))"},children:e.jsx("div",{className:"max-w-[768px] mx-auto",children:e.jsxs("div",{className:"flex items-center gap-4 p-4",children:[e.jsx("button",{onClick:()=>b(-1),className:"text-white hover:text-zinc-300 transition-colors",children:e.jsx(Y,{className:"w-6 h-6"})}),e.jsx("h1",{className:"text-xl font-bold flex-1 truncate",children:d.Name}),e.jsx("button",{onClick:me,disabled:w,className:"w-8 h-8 flex items-center justify-center text-white hover:bg-zinc-800 rounded-full transition-colors disabled:opacity-50","aria-label":"Shuffle genre songs",children:w?e.jsx("div",{className:"w-4 h-4 border-2 border-zinc-400 border-t-white rounded-full animate-spin"}):e.jsx(Ie,{className:"w-5 h-5"})})]})})}),e.jsx("div",{className:`fixed left-0 right-0 z-[60] lg:left-16 transition-[left,right] duration-300 ${y?"sidebar-open-right-offset":"xl:right-0"}`,style:{top:"calc(var(--header-offset, 0px) + env(safe-area-inset-top) + 5rem - 16px)",height:"24px",background:"linear-gradient(to bottom, rgba(0, 0, 0, 0.8), transparent)"}}),e.jsxs("div",{style:{paddingTop:"calc(env(safe-area-inset-top) + 5rem)"},children:[u.length>0&&e.jsxs("div",{className:"mb-10 px-4 pt-4",children:[e.jsxs("h2",{className:"text-xl font-bold text-white mb-4",children:["Albums (",u.length,")"]}),e.jsx("div",{className:"grid grid-cols-3 md:grid-cols-4 gap-4",children:(p?de:u).map((t,n)=>{const s=t.ProductionYear||(t.PremiereDate?new Date(t.PremiereDate).getFullYear():null);return e.jsx(Be,{album:t,year:s,onNavigate:r=>b(`/album/${r}`),onContextMenu:(r,a,i)=>{U(r),R("album"),ne(a||"mobile"),ae(i||null),V(!0)},showImage:p?!0:n<$},t.Id)})})]}),p&&u.length>0&&e.jsx("div",{className:"-mt-10 mb-10",children:e.jsx(Ge,{currentPage:L,totalPages:Math.ceil(u.length/D),onPageChange:J,itemsPerPage:D,totalItems:u.length})}),f.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"px-4 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h2",{className:"text-2xl font-bold text-white",children:["Songs (",f.length,")"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:he,className:"w-10 h-10 flex items-center justify-center text-white hover:bg-white/10 rounded-lg transition-colors","aria-label":"Play all songs",children:e.jsx(Pe,{className:"w-5 h-5"})}),e.jsx("button",{type:"button",onClick:xe,className:"w-10 h-10 flex items-center justify-center text-white hover:bg-white/10 rounded-lg transition-colors","aria-label":"Add all songs to queue",children:e.jsx(ye,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"mt-1",children:e.jsxs("button",{type:"button",onClick:fe,className:"text-sm text-gray-400 hover:text-white transition-colors flex items-center gap-1",children:[P,e.jsx(Le,{className:"w-4 h-4"})]})})]}),e.jsx("div",{className:"space-y-0",children:N.map((t,n)=>{const s=n<q;return e.jsx(ke,{song:t,showImage:s},t.Id)})})]})]}),e.jsx(Ce,{item:le,itemType:oe,isOpen:te,onClose:()=>{V(!1),U(null),R(null)},mode:se,position:re||void 0})]})}export{Re as default};
